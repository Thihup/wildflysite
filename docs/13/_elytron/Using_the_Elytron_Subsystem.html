<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Using the Elytron Subsystem | Wildfly</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Using the Elytron Subsystem" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://jbossorg.github.io/wildflysite/docs/13/_elytron/Using_the_Elytron_Subsystem.html" />
<meta property="og:url" content="https://jbossorg.github.io/wildflysite/docs/13/_elytron/Using_the_Elytron_Subsystem.html" />
<meta property="og:site_name" content="Wildfly" />
<script type="application/ld+json">
{"@type":"WebPage","url":"https://jbossorg.github.io/wildflysite/docs/13/_elytron/Using_the_Elytron_Subsystem.html","headline":"Using the Elytron Subsystem","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/wildflysite/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://jbossorg.github.io/wildflysite/feed.xml" title="Wildfly" /></head>
<body><div class="header navigation">
  <div class="logo-wrapper">
    <a href="/wildflysite/"><img class="wf-logo" src="/wildflysite/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/wildflysite/" class="">Home</a>
        </li>
        <li>
          <a href="/wildflysite/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/wildflysite/blog/" class="">Blog</a>
        </li>
        <li>
          <a href="/wildflysite/about/" class="">About</a>
        </li>
        <li>
          <a href="/wildflysite/contribute/" class="">Contribute</a>
        </li>
        <li>
          <a href="/wildflysite/docs/" class="">Docs</a>
        </li>
        <li>
          <a class="button-cta secondary" href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="sect1">
<h2 id="set-up-and-configure-authentication-for-applications">Set Up and Configure Authentication for Applications</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configure-authentication-with-a-properties-file-based-identity-store">Configure Authentication with a Properties File-Based Identity Store</h3>
<div class="sect3">
<h4 id="create-properties-files">Create properties files:</h4>
<div class="paragraph">
<p>You need to create two properties files: one that maps user to passwords
and another that maps users to roles. Usually these files are located in
the <em>jboss.server.config.dir</em> directory and follow the naming convention
<em>*-users.properties</em> and <em>*-roles.properties</em>, but other locations and
names may be used. The <em>*-users.properties</em> file must also contain a
reference to the <em>properties-realm</em>, which you will create in the next
step: <em>#$REALM_NAME=YOUR_PROPERTIES_REALM_NAME$</em></p>
</div>
<div class="paragraph">
<p><strong>Example user to password file: example-users.properties</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>#$REALM_NAME=examplePropRealm$
user1=password123
user2=password123</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example user to roles file: example-roles.properties</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>user1=Admin
user2=Guest</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-properties-realm-in-wildfly">Configure a properties-realm in WildFly:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/properties-realm=examplePropRealm:add(groups-attribute=groups,groups-properties={path=example-roles.properties,relative-to=jboss.server.config.dir},users-properties={path=example-users.properties,relative-to=jboss.server.config.dir,plain-text=true})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the <em>properties-realm</em> is <em>examplePropRealm</em>, which is used
in the previous step in the <em>example-users.properties</em> file. Also, if
your properties files are located outside of <em>jboss.server.config.dir</em>,
then you need to change the <em>path</em> and <em>relative-to</em> values
appropriately.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-security-domain">Configure a security-domain:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/security-domain=exampleSD:add(realms=[{realm=examplePropRealm,role-decoder=groups-to-roles}],default-realm=examplePropRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-http-authentication-factory">Configure an http-authentication-factory:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=BASIC,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-application-security-domain-in-the-undertow-subsystem">Configure an application-security-domain in the Undertow subsystem:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-your-applications-web.xml-and-jboss-web.xml.">Configure your application&#8217;s web.xml and jboss-web.xml.</h4>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-authentication-with-a-filesystem-based-identity-store">Configure Authentication with a Filesystem-Based Identity Store</h3>
<div class="sect3">
<h4 id="chose-a-directory-for-users">Chose a directory for users:</h4>
<div class="paragraph">
<p>You need a directory where your users will be stored. In this example,
we are using a directory called <em>fs-realm-users</em> located in
<em>jboss.server.config.dir</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-filesystem-realm-in-wildfly">Configure a filesystem-realm in WildFly:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/filesystem-realm=exampleFsRealm:add(path=fs-realm-users,relative-to=jboss.server.config.dir)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your directory is located outside of <em>jboss.server.config.dir</em>, then
you need to change the <em>path</em> and <em>relative-to</em> values appropriately.</p>
</div>
</div>
<div class="sect3">
<h4 id="add-a-user">Add a user:</h4>
<div class="paragraph">
<p>When using the <em>filesystem-realm</em>, you can add users using the
management CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=user1:add()
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=user1:set-password( clear={password="password123"})
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=user1:add-attribute(name=Roles, value=["Admin","Guest"])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add-a-simple-role-decoder">Add a simple-role-decoder:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <em>simple-role-decoder</em> decodes a principal&#8217;s roles from the <em>Roles</em>
attribute. You can change this value if your roles are in a different
attribute.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-security-domain-1">Configure a security-domain:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/security-domain=exampleFsSD:add(realms=[{realm=exampleFsRealm,role-decoder=from-roles-attribute}],default-realm=exampleFsRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-http-authentication-factory-1">Configure an http-authentication-factory:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-fs-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleFsSD,mechanism-configurations=[{mechanism-name=BASIC,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-application-security-domain-in-the-undertow-subsystem-1">Configure an application-security-domain in the Undertow subsystem:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-fs-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-your-applications-web.xml-and-jboss-web.xml.-1">Configure your application&#8217;s web.xml and jboss-web.xml.</h4>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p>Your application is now using a filesystem-based identity store for
authentication.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-authentication-with-a-database-identity-store">Configure Authentication with a Database Identity Store</h3>
<div class="sect3">
<h4 id="determine-your-database-format-for-usernames-passwords-and-roles">Determine your database format for usernames, passwords, and roles:</h4>
<div class="paragraph">
<p>To set up authentication using a database for an identity store, you
need to determine how your usernames, passwords, and roles are stored in
that database. In this example, we are using a single table with the
following sample data:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">username</th>
<th class="tableblock halign-left valign-top">password</th>
<th class="tableblock halign-left valign-top">roles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guest</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="configure-a-datasource">Configure a datasource:</h4>
<div class="paragraph">
<p>To connect to a database from WildFly, you must have the appropriate
database driver deployed as well as a datasource configured. This
example shows deploying the driver for postgres and configuring a
datasource in WildFly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">deploy /path/to/postgresql-9.4.1210.jar
 
data-source add --name=examplePostgresDS --jndi-name=java:jboss/examplePostgresDS --driver-name=postgresql-9.4.1210.jar  --connection-url=jdbc:postgresql://localhost:5432/postgresdb --user-name=postgresAdmin --password=mysecretpassword</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-jdbc-realm-in-wildfly">Configure a jdbc-realm in WildFly:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/jdbc-realm=exampleDbRealm:add(principal-query=[{sql="SELECT password,roles FROM wildfly_users WHERE username=?",data-source=examplePostgresDS,clear-password-mapper={password-index=1},attribute-mapping=[{index=2,to=groups}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> The above example shows how to obtain passwords and roles from a
single <em>principal-query</em>. You can also create additional
<em>principal-query</em> with <em>attribute-mapping</em> attributes if you require
multiple queries to obtain roles or additional authentication or
authorization information.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-security-domain-2">Configure a security-domain:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/security-domain=exampleDbSD:add(realms=[{realm=exampleDbRealm,role-decoder=groups-to-roles}],default-realm=exampleDbRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-http-authentication-factory-2">Configure an http-authentication-factory:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-db-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleDbSD,mechanism-configurations=[{mechanism-name=BASIC,mechanism-realm-configurations=[{realm-name=exampleDbSD}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-application-security-domain-in-the-undertow-subsystem-2">Configure an application-security-domain in the Undertow subsystem:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-db-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-your-applications-web.xml-and-jboss-web.xml.-2">Configure your application&#8217;s web.xml and jboss-web.xml.</h4>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-authentication-with-an-ldap-based-identity-store">Configure Authentication with an LDAP-Based Identity Store</h3>
<div class="sect3">
<h4 id="determine-your-ldap-format-for-usernames-passwords-and-roles">Determine your LDAP format for usernames, passwords, and roles:</h4>
<div class="paragraph">
<p>To set up authentication using an LDAP server for an identity store, you
need to determine how your usernames, passwords, and roles are stored.
In this example, we are using the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">dn: dc=wildfly,dc=org
dc: wildfly
objectClass: top
objectClass: domain
 
dn: ou=Users,dc=wildfly,dc=org
objectClass: organizationalUnit
objectClass: top
ou: Users
 
dn: uid=jsmith,ou=Users,dc=wildfly,dc=org
objectClass: top
objectClass: person
objectClass: inetOrgPerson
cn: John Smith
sn: smith
uid: jsmith
userPassword: password123
 
dn: ou=Roles,dc=wildfly,dc=org
objectclass: top
objectclass: organizationalUnit
ou: Roles
 
dn: cn=Admin,ou=Roles,dc=wildfly,dc=org
objectClass: top
objectClass: groupOfNames
cn: Admin
member: uid=jsmith,ou=Users,dc=wildfly,dc=org</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-dir-context">Configure a dir-context:</h4>
<div class="paragraph">
<p>To connect to the LDAP server from WildFly, you need to configure a
<em>dir-context</em> that provides the URL as well as the principal used to
connect to the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/dir-context=exampleDC:add(url="ldap://127.0.0.1:10389",principal="uid=admin,ou=system",credential-reference={clear-text="secret"})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-ldap-realm-in-wildfly">Configure an ldap-realm in WildFly:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/ldap-realm=exampleLR:add(dir-context=exampleDC,identity-mapping={search-base-dn="ou=Users,dc=wildfly,dc=org",rdn-identifier="uid",user-password-mapper={from="userPassword"},attribute-mapping=[{filter-base-dn="ou=Roles,dc=wildfly,dc=org",filter="(&amp;(objectClass=groupOfNames)(member={1}))",from="cn",to="Roles"}]})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add-a-simple-role-decoder-1">Add a simple-role-decoder:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-security-domain-3">Configure a security-domain:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/security-domain=exampleLdapSD:add(realms=[{realm=exampleLR,role-decoder=from-roles-attribute}],default-realm=exampleLR,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-http-authentication-factory-3">Configure an http-authentication-factory:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-ldap-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleLdapSD,mechanism-configurations=[{mechanism-name=BASIC,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-application-security-domain-in-the-undertow-subsystem-3">Configure an application-security-domain in the Undertow subsystem:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-ldap-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-your-applications-web.xml-and-jboss-web.xml.-3">Configure your application&#8217;s web.xml and jboss-web.xml.</h4>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> In cases where you configure an LDAP server in the
<em>elytron</em> subsystem for authentication and that LDAP server then becomes
unreachable, WildFly will return a <em>500</em>, or internal server error,
error code when attempting authentication using that unreachable LDAP
server. This behavior differs from the legacy <em>security</em> subsystem,
which will return a <em>401</em>, or unauthorized, error code under the same
conditions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-authentication-with-certificates">Configure Authentication with Certificates</h3>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> Before you can set up certificate-based authentication, you
must have two-way SSL configured.</p>
</div>
<div class="sect3">
<h4 id="configure-a-key-store-realm.">Configure a key-store-realm.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store-realm=ksRealm:add(key-store=twoWayTS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must configure this realm with a truststore that contains the
client&#8217;s certificate. The authentication process uses the same
certificate presented by the client during the two-way SSL handshake.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-a-decoder.">Create a Decoder.</h4>
<div class="paragraph">
<p>You need to create a <em>x500-attribute-principal-decoder</em> to decode the
principal you get from your certificate. The below example will decode
the principal based on the first <em>CN</em> value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/x500-attribute-principal-decoder=CNDecoder:add(oid="2.5.4.3",maximum-segments=1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, if the full <em>DN</em> was
<em>CN=client,CN=client-certificate,DC=example,DC=jboss,DC=org</em>,
<em>CNDecoder</em> would decode the principal as <em>client</em>. This decoded
principal is used as the <em>alias</em> value to lookup a certificate in the
truststore configured in <em>ksRealm</em>.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> The decoded principal * <strong>MUST</strong>* must be the <em>alias</em> value
you set in your server&#8217;s truststore for the client&#8217;s certificate.</p>
</div>
</div>
<div class="sect3">
<h4 id="add-a-constant-role-mapper-for-assigning-roles.">Add a constant-role-mapper for assigning roles.</h4>
<div class="paragraph">
<p>This is example uses a <em>constant-role-mapper</em> to assign roles to a
principal from <em>ksRealm</em> but other approaches may also be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/constant-role-mapper=constantClientCertRole:add(roles=[Admin,Guest])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-security-domain.">Configure a security-domain.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/security-domain=exampleCertSD:add(realms=[{realm=ksRealm}],default-realm=ksRealm,permission-mapper=default-permission-mapper,principal-decoder=CNDecoder,role-mapper=constantClientCertRole)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-http-authentication-factory.">Configure an http-authentication-factory.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/http-authentication-factory=exampleCertHttpAuth:add(http-server-mechanism-factory=global,security-domain=exampleCertSD,mechanism-configurations=[{mechanism-name=CLIENT_CERT,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-application-security-domain-in-the-undertow-subsystem.">Configure an application-security-domain in the Undertow subsystem.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=exampleCertHttpAuth)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="update-server-ssl-context.">Update server-ssl-context.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/server-ssl-context=twoWaySSC:write-attribute(name=security-domain,value=exampleCertSD)
/subsystem=elytron/server-ssl-context=twoWaySSC:write-attribute(name=authentication-optional, value=true)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-your-applications-web.xml-and-jboss-web.xml.-4">Configure your application&#8217;s web.xml and jboss-web.xml.</h4>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p>In addition, you need to update your <em>web.xml</em> to use <em>CLIENT-CERT</em> as
its authentication method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;login-config&gt;
  &lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt;
  &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
&lt;/login-config&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-authentication-with-a-kerberos-based-identity-store">Configure Authentication with a Kerberos-Based Identity Store</h3>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: The following steps assume you have a working KDC and
Kerberos domain as well as your client browsers configured.</p>
</div>
<div class="sect3">
<h4 id="configure-a-kerberos-security-factory.">Configure a kerberos-security-factory.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/kerberos-security-factory=krbSF:add(principal="HTTP/host@REALM",path="/path/to/http.keytab",mechanism-oids=[1.2.840.113554.1.2.2,1.3.6.1.5.5.2])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-the-system-properties-for-kerberos.">Configure the system properties for Kerberos.</h4>
<div class="paragraph">
<p>Depending on how your environment is configured, you will need to set
some of the system properties below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.security.krb5.kdc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host name of the KDC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.security.krb5.realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the realm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.security.krb5.conf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to the configuration krb5.conf file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sun.security.krb5.debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, debugging mode will be enabled.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To configure a system property in WildFly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/system-property=java.security.krb5.conf:add(value="/path/to/krb5.conf")</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-eltyron-security-realm-for-assigning-roles.">Configure an Eltyron security realm for assigning roles.</h4>
<div class="paragraph">
<p>The the client&#8217;s Kerberos token will provide the principal, but you need
a way to map that principal to a role for your application. There are
several ways to accomplish this, but this example creates a
<em>filesystem-realm</em>, adds a user to the realm that matches the principal
from the Kerberos token, and assigns roles to that user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/filesystem-realm=exampleFsRealm:add(path=fs-realm-users,relative-to=jboss.server.config.dir)
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=user1@REALM:add()
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=user1@REALM:add-attribute(name=Roles, value=["Admin","Guest"])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add-a-simple-role-decoder.">Add a simple-role-decoder.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <em>simple-role-decoder</em> decodes a principal&#8217;s roles from the <em>Roles</em>
attribute. You can change this value if your roles are in a different
attribute.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-security-domain.-1">Configure a security-domain.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/security-domain=exampleFsSD:add(realms=[{realm=exampleFsRealm,role-decoder=from-roles-attribute}],default-realm=exampleFsRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-http-authentication-factory-that-uses-the-kerberos-security-factory.">Configure an http-authentication-factory that uses the</h4>
<div class="paragraph">
<p>kerberos-security-factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-krb-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleFsSD,mechanism-configurations=[{mechanism-name=SPNEGO,mechanism-realm-configurations=[{realm-name=exampleFsSD}],credential-security-factory=krbSF}])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-application-security-domain-in-the-undertow-subsystem-4">Configure an application-security-domain in the Undertow subsystem:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-krb-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-your-applications-web.xml-jboss-web.xml-and-jboss-deployment-structure.xml.">Configure your application&#8217;s web.xml, jboss-web.xml and</h4>
<div class="paragraph">
<p>jboss-deployment-structure.xml.</p>
</div>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p>In addition, you need to update your <em>web.xml</em> to use <em>SPNEGO</em> as its
authentication method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;login-config&gt;
  &lt;auth-method&gt;SPNEGO&lt;/auth-method&gt;
  &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
&lt;/login-config&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-authentication-with-a-form-as-a-fallback-for-kerberos">Configure Authentication with a Form as a Fallback for Kerberos</h3>
<div class="sect3">
<h4 id="configure-kerberos-based-authentication.">Configure kerberos-based authentication.</h4>
<div class="paragraph">
<p>Configuring kerberos-based authentication is covered in a previous
section.</p>
</div>
</div>
<div class="sect3">
<h4 id="add-a-mechanism-for-form-authentication-in-the-http-authentication-factory.">Add a mechanism for FORM authentication in the</h4>
<div class="paragraph">
<p>http-authentication-factory.</p>
</div>
<div class="paragraph">
<p>You can use the existing <em>http-authentication-factory</em> you configured
for kerberos-based authentication and and an additional mechanism for
<em>FORM</em> authentication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-krb-http-auth:list-add(name=mechanism-configurations, value={mechanism-name=FORM})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add-additional-fallback-principals.">Add additional fallback principals.</h4>
<div class="paragraph">
<p>The existing configuration for kerberos-based authentication should
already have a security realm configured for mapping principals from
kerberos token to roles for the application. You can add additional
users for fallback authentication to that realm. For example if you used
a <em>filesystem-realm</em>, you can simply create a new user with the
appropriate roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=fallbackUser1:add()
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=fallbackUser1:set-password(clear={password="password123"})
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=fallbackUser1:add-attribute(name=Roles, value=["Admin","Guest"])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="update-the-web.xml-for-form-fallback.">Update the web.xml for FORM fallback.</h4>
<div class="paragraph">
<p>You need to update the <em>web.xml</em> to use the value <em>SPNEGO,FORM</em> for the
<em>auth-method</em>, which will use <em>FORM</em> as a fallback authentication method
if <em>SPNEGO</em> fails. You also need to specify the location of your login
and error pages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;login-config&gt;
  &lt;auth-method&gt;SPNEGO,FORM&lt;/auth-method&gt;
  &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
  &lt;form-login-config&gt;
    &lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt;
    &lt;form-error-page&gt;/error.jsp&lt;/form-error-page&gt;
  &lt;/form-login-config&gt;
&lt;/login-config&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure Applications to Use Elytron or Legacy Security for</h3>
<div class="paragraph">
<p>Authentication</p>
</div>
<div class="paragraph">
<p>After you have configured the <em>elytron</em> or legacy <em>security</em> subsystems
for authentication, you need to configure your application to use it.</p>
</div>
<div class="sect3">
<h4 id="configure-your-applications-web.xml.">Configure your application&#8217;s web.xml.</h4>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> needs to be configured to use the
appropriate authentication method. When using <em>elytron</em>, this is defined
in the <em>http-authentication-factory</em> you created. When using the legacy
<em>security</em> subsystem, this depends on your login module and the type of
authentication you want to configure.</p>
</div>
<div class="paragraph">
<p>Example <em>web.xml</em> with <em>BASIC</em> Authentication</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;web-app&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;secure&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/secure/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
      &lt;role-name&gt;Admin&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
  &lt;security-role&gt;
    &lt;description&gt;The role that is required to log in to /secure/*&lt;/description&gt;
    &lt;role-name&gt;Admin&lt;/role-name&gt;
  &lt;/security-role&gt;
  &lt;login-config&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
    &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
  &lt;/login-config&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-your-application-to-use-a-security-domain.">Configure your application to use a security domain.</h4>
<div class="paragraph">
<p>You can configure your application&#8217;s <em>jboss-web.xml</em> to specify the
security domain you want to use for authentication. When using the
<em>elytron</em> subsystem, this is defined when you created the
<em>application-security-domain</em>. When using the legacy <em>security</em>
subsystem, this is the name of the legacy security domain.</p>
</div>
<div class="paragraph">
<p>Example <em>jboss-web.xml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;jboss-web&gt;
  &lt;security-domain&gt;exampleApplicationDomain&lt;/security-domain&gt;
&lt;/jboss-web&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <em>jboss-web.xml</em> allows you to configure the security domain for a
single application only. Alternatively, you can specify a default
security domain for all applications using the <em>undertow</em> subsystem.
This allows you to omit using <em>jboss-web.xml</em> to configure a security
domain for an individual application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow:write-attribute(name=default-security-domain, value="exampleApplicationDomain")</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: Setting <em>default-security-domain</em> in the <em>undertow</em>
subsystem will apply to <strong>ALL</strong> applications. If <em>default-security-domain</em>
is set and an application specifies a security domain in a
<em>jboss-web.xml</em> file, the configuration in <em>jboss-web.xml</em> will override
the <em>default-security-domain</em> in the <em>undertow</em> subsystem.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-elytron-and-legacy-security-subsystems-in-parallel">Using Elytron and Legacy Security Subsystems in Parallel</h4>
<div class="paragraph">
<p>You can define authentication in both the <em>elytron</em> and legacy
<em>security</em> subsystems and use them in parallel. If you use both
<em>jboss-web.xml</em> and <em>default-security-domain</em> in the <em>undertow</em>
subsystem, WildFly will first try to match the configured security
domain in the <em>elytron</em> subsystem. If a match is not found, then WildFly
will attempt to match the security domain with one configured in the
legacy <em>security</em> subsystem. If the <em>elytron</em> and legacy <em>security</em>
subsystem each have a security domain with the same name, the <em>elytron</em>
security domain is used.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="override-an-applications-authentication-configuration">Override an Application&#8217;s Authentication Configuration</h3>
<div class="paragraph">
<p>You can override the authentication configuration of an application with
one configured in WildFly. To do this, use the
<em>override-deployment-configuration</em> property in the
<em>application-security-domain</em> section of the <em>undertow</em> subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:write-attribute(name=override-deployment-config,value=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, an application is configured to use <em>FORM</em> authentication
with the <em>exampleApplicationDomain</em> in its <em>jboss-web.xml</em>.</p>
</div>
<div class="paragraph">
<p><em>Example jboss-web.xml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;login-config&gt;
  &lt;auth-method&gt;FORM&lt;/auth-method&gt;
  &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
&lt;/login-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By enabling <em>override-deployment-configuration</em>, you can create a new
<em>http-authentication-factory</em> that specifies a different authentication
mechanism such as <em>BASIC</em>.</p>
</div>
<div class="paragraph">
<p><em>Example http-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/http-authentication-factory=exampleHttpAuth:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "http-server-mechanism-factory" =&gt; "global",
        "mechanism-configurations" =&gt; [{
            "mechanism-name" =&gt; "BASIC",
            "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "exampleApplicationDomain"}]
        }],
        "security-domain" =&gt; "exampleSD"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will override the authentication mechanism defined in the
application&#8217;s <em>jboss-web.xml</em> and attempt to authenticate a user using
<em>BASIC</em> instead of <em>FORM</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-and-use-a-credential-store">Create and Use a Credential Store</h3>
<div class="sect3">
<h4 id="create-credential-store.">Create credential store.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/credential-store=exampleCS:add(uri="cr-store://exampleCS?create=true",credential-reference={clear-text=cs-secret})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add-a-credential-to-a-credential-store.">Add a credential to a credential store.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/credential-store=exampleCS/alias=keystorepw:add(secret-value="secret")</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="list-all-credentials-in-a-credential-store.">List all credentials in a credential store.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/credential-store=exampleCS:read-children-names(child-type=alias)
{
    "outcome" =&gt; "success",
    "result" =&gt; ["keystorepw"]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="remove-a-credential-from-a-credential-store.">Remove a credential from a credential store.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/credential-store=exampleCS/alias=keystorepw:remove</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="use-a-credential-store.">Use a credential store.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:write-attribute(name=credential-reference,value={store=exampleCS,alias=keystorepw})</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="set-up-and-configure-authentication-for-the-management-interfaces">Set up and Configure Authentication for the Management Interfaces</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="secure-the-management-interfaces-with-a-new-identity-store">Secure the Management Interfaces with a New Identity Store</h3>
<div class="sect3">
<h4 id="create-a-security-domain-and-any-supporting-security-realms-decoders-or-mappers-for-your-identity-store.">Create a security domain and any supporting security realms,</h4>
<div class="paragraph">
<p>decoders, or mappers for your identity store.</p>
</div>
<div class="paragraph">
<p>This process is covered in a previous section. For example, if you
wanted to secure the management interfaces using a filesystem-based
identity store, you would follow the steps in
<a href="#configure-authentication-with-a-filesystem-based-identity-store">Configure
Authentication with a Filesystem-Based Identity Store</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-an-http-authentication-factory-or-sasl-authentication-factory.">Create an http-authentication-factory or</h4>
<div class="paragraph">
<p>sasl-authentication-factory.</p>
</div>
<div class="paragraph">
<p>Example <em>http-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=DIGEST,mechanism-realm-configurations=[{realm-name=exampleManagementRealm}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example <em>sasl-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/sasl-authentication-factory=example-sasl-auth:add(sasl-server-factory=configured,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=DIGEST-MD5,mechanism-realm-configurations=[{realm-name=exampleManagementRealm}]}])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="update-the-management-interfaces-to-use-your-http-authentication-factory-or-sasl-authentication-factory.">Update the management interfaces to use your</h4>
<div class="paragraph">
<p>http-authentication-factory or sasl-authentication-factory.</p>
</div>
<div class="paragraph">
<p>Example update <em>http-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/core-service=management/management-interface=http-interface:write-attribute(name=http-authentication-factory, value=example-http-auth)
{
   "outcome" =&gt; "success",
   "response-headers" =&gt; {
       "operation-requires-reload" =&gt; true,
       "process-state" =&gt; "reload-required"
   }
}
 
reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example update <em>sasl-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/core-service=management/management-interface=http-interface:write-attribute(name=http-upgrade.sasl-authentication-factory, value=example-sasl-auth)
{
   "outcome" =&gt; "success",
   "response-headers" =&gt; {
       "operation-requires-reload" =&gt; true,
       "process-state" =&gt; "reload-required"
   }
}
 
reload</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="silent-authentication">Silent Authentication</h3>
<div class="paragraph">
<p>By default, WildFly provides an authentication mechanism for local
users, also know as silent authentication, through the <em>local</em> security
realm.</p>
</div>
<div class="paragraph">
<p>Silent authentication must be used via a <em>sasl-authentication-factory</em>.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: When enabling silent authentication, you must ensure the
security domain referenced by your <em>sasl-authentication-factory</em>
references a security realm that contains the <em>$local</em> user. By default,
WildFly provides the <em>local</em> identity realm that provides this user.</p>
</div>
<div class="sect3">
<h4 id="add-silent-authentication-to-an-existing-sasl-authentication-factory.">Add silent authentication to an existing</h4>
<div class="paragraph">
<p>sasl-authentication-factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/sasl-authentication-factory=example-sasl-auth:list-add(name=mechanism-configurations, value={mechanism-name=JBOSS-LOCAL-USER, realm-mapper=local})
 
reload</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-a-new-sasl-server-factory-with-silent-authentication.">Create a new sasl-server-factory with silent authentication.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/sasl-authentication-factory=example-sasl-auth:add(sasl-server-factory=configured,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=DIGEST-MD5,mechanism-realm-configurations=[{realm-name=exampleManagementRealm}]},{mechanism-name=JBOSS-LOCAL-USER, realm-mapper=local}])
 
reload</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="remove-silent-authentication-from-an-existing-sasl-server-factory">Remove silent authentication from an existing sasl-server-factory:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/sasl-authentication-factory=managenet-sasl-authentication:read-resource
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "mechanism-configurations" =&gt; [
            {
                "mechanism-name" =&gt; "JBOSS-LOCAL-USER",
                "realm-mapper" =&gt; "local"
            },
            {
                "mechanism-name" =&gt; "DIGEST-MD5",
                "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "ManagementRealm"}]
            }
        ],
        "sasl-server-factory" =&gt; "configured",
        "security-domain" =&gt; "ManagementDomain"
    }
}
 
/subsystem=elytron/sasl-authentication-factory=temp-sasl-authentication:list-remove(name=mechanism-configurations,index=0)
 
reload</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-rbac-with-elytron">Using RBAC with Elytron</h3>
<div class="paragraph">
<p>RBAC can be configured to automatically assign or exclude roles for
users that are members of groups. This is configured in the
<em>access-control</em> section of the core management. When the management
interfaces are secured with the <em>elytron</em> subsystem, and users are
assigned groups when they authenticate. You can also configure roles to
be assigned to authenticated users in a variety of ways using the
<em>elytron</em> subsystem, for example using a role mapper or a role decoder.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-ssltls">Configure SSL/TLS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="enable-one-way-ssltls-for-applications">Enable One-way SSL/TLS for Applications</h3>
<div class="paragraph">
<p>There are a couple ways to enable one-way SSL/TLS for deployed applications.</p>
</div>
<div class="sect3">
<h4 id="one-way-ssl-applications-using-security-command">Using a security command:</h4>
<div class="paragraph">
<p>The <em>security enable-ssl-http-server</em> command can be used to enable one-way
SSL/TLS for deployed applications. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">security enable-ssl-http-server --interactive
Please provide required pieces of information to enable SSL:
Key-store file name (default default-server.keystore): keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): n

SSL options:
key store file: keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
Server keystore file keystore.jks, certificate file keystore.pem and keystore.csr file
will be generated in server configuration directory.
Do you confirm y/n: y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server.</p>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for applications.</p>
</div>
</div>
<div class="sect3">
<h4 id="one-way-ssl-applications-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h4>
<div class="paragraph">
<p>You can also use the Elytron subsystem, along with the Undertow subsystem, to
enable HTTPS for deployed applications.</p>
</div>
<div class="sect4">
<h5 id="configure-a-key-store-in-wildfly">Configure a key-store in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:add(path=/path/to/keystore.jks,credential-reference={clear-text=secret},type=JKS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous command uses an absolute path to the keystore.
Alternatively you can use the <em>relative-to</em> attribute to specify the
base directory variable and <em>path</em> specify a relative path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:add(path=keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the keystore file does not exist yet, the following commands can be used to
generate an example key pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")
/subsystem=elytron/key-store=httpsKS:store()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-key-manager-in-that-references-your-key-store">Configure a key-manager that references your key-store:</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-manager=httpsKM:add(key-store=httpsKS,credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-server-ssl-context-in-that-references-your-key-manager">Configure a server-ssl-context that references your key-manager:</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/server-ssl-context=httpsSSC:add(key-manager=httpsKM,protocols=["TLSv1.2"])</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: You need to determine what SSL/TLS protocols you want to
support. The example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="check-and-see-if-the-https-listener-is-configured-to-use-a-legacy-security-realm-for-its-ssl-configuration">Check and see if the https-listener is configured to use a legacy security realm for its SSL configuration:</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/server=default-server/https-listener=https:read-attribute(name=security-realm)
{
    "outcome" =&gt; "success",
    "result" =&gt; "ApplicationRealm"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command shows that the <em>https-listener</em> is configured to use
the <em>ApplicationRealm</em> legacy security realm for its SSL configuration.
Undertow cannot reference both a legacy security realm and an
<em>ssl-context</em> in Elytron at the same time so you must remove the
reference to the legacy security realm. Also there has to be always
configured either <em>ssl-context</em> or <em>security-realm</em>. Thus when changing
between those, you have to use batch operation:</p>
</div>
<div class="paragraph">
<p><strong>Remove the reference to the legacy security realm and update the</strong>
<strong><em>https-listener</em></strong> <strong>to use the</strong> <strong><em>ssl-context</em></strong> <strong>from Elytron</strong> <strong>:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context,value=httpsSSC)
run-batch</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reload-the-server">Reload the server:</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for applications.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-two-way-ssltls-in-wildfly-for-applications">Enable Two-way SSL/TLS in WildFly for Applications</h3>
<div class="paragraph">
<p>First, obtain or generate your client keystore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ keytool -genkeypair -alias client -keyalg RSA -keysize 1024 -validity 365 -keystore client.keystore.jks -dname "CN=client" -keypass secret -storepass secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Export the client certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ keytool -exportcert  -keystore client.keystore.jks -alias client -keypass secret -storepass secret -file /path/to/client.cer</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a couple ways to enable two-way SSL/TLS for deployed applications.</p>
</div>
<div class="sect3">
<h4 id="two-way-ssl-applications-using-security-command">Using a security command:</h4>
<div class="paragraph">
<p>The <em>security enable-ssl-http-server</em> command can be used to enable two-way
SSL/TLS for the deployed applications. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">security enable-ssl-http-server --interactive
Please provide required pieces of information to enable SSL:
Key-store file name (default default-server.keystore): server.keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): y
Client certificate (path to pem file): /path/to/client.cer
Validate certificate y/n (blank y):
Trust-store file name (management.truststore): server.truststore.jks
Password (blank generated): secret

SSL options:
key store file: server.keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
client certificate: /path/to/client.cer
trust store file: server.trustore.jks
trust store password: secret
Server keystore file server.keystore.jks, certificate file server.pem and server.csr file will be generated in server configuration directory.
Server truststore file server.trustore.jks will be generated in server configuration directory.
Do you confirm y/n: y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server. To complete
the two-way SSL/TLS authentication, you need to
<a href="#import-server-certificate-into-client-truststore-applications">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-applications">configure your client</a>
to present the client certificate.</p>
</div>
</div>
<div class="sect3">
<h4 id="two-way-ssl-applications-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h4>
<div class="paragraph">
<p>You can also use the Elytron subsystem, along with the Undertow subsystem,
to enable two-way SSL/TLS for deployed applications.</p>
</div>
<div class="sect4">
<h5 id="obtain-or-generate-your-keystores-applications">Obtain or generate your key stores:</h5>
<div class="paragraph">
<p>Before enabling HTTPS in WildFly, you must obtain or generate the server key
store and trust store you plan on using. To generate an example key store and
trust store, use the following commands.</p>
</div>
<div class="paragraph">
<p>Create a server key-store:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:add(path=/path/to/server.keystore.jks,credential-reference={clear-text=secret},type=JKS)
/subsystem=elytron/key-store=twoWayKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")
/subsystem=elytron/key-store=twoWayKS:store()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE</strong><br>
The first command above uses an absolute path to the keystore.
Alternatively you can use the <em>relative-to</em> attribute to specify the
base directory variable and <em>path</em> specify a relative path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:add(path=server.keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Export the server certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:export-certificate(alias=localhost,path=/path/to/server.cer,pem=true)</code></pre>
</div>
</div>
<div id="import-client-certificate" class="paragraph">
<p>Create a key-store for the server truststore and import the client certificate
into the server truststore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=twoWayTS:add(path=/path/to/server.truststore.jks,credential-reference={clear-text=secret},type=JKS)
/subsystem=elytron/key-store=twoWayTS:import-certificate(alias=client,path=/path/to/client.cer,credential-reference={clear-text=secret},trust-cacerts=true)
/subsystem=elytron/key-store=twoWayTS:store()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-key-manager-in-that-references-your-key-store-key-store">Configure a key-manager that references your key store key-store:</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-manager=twoWayKM:add(key-store=twoWayKS,credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-trust-manager-in-that-references-your-truststore-key-store">Configure a trust-manager that references your truststore key-store:</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/trust-manager=twoWayTM:add(key-store=twoWayTS)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-server-ssl-context-in-that-references-your-key-manager-trust-manager-and-enables-client-authentication">Configure a server-ssl-context that references your key-manager, trust-manager, and enables client authentication:</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/server-ssl-context=twoWaySSC:add(key-manager=twoWayKM,protocols=["TLSv1.2"],trust-manager=twoWayTM,need-client-auth=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong><br>
You need to determine what SSL/TLS protocols you want to support. The
example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="check-and-see-if-the-https-listener-is-configured-to-use-a-legacy-security-realm-for-its-ssl-configuration-1">Check and see if the https-listener is configured to use a legacy security realm for its SSL configuration:</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/server=default-server/https-listener=https:read-attribute(name=security-realm)
{
    "outcome" =&gt; "success",
    "result" =&gt; "ApplicationRealm"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command shows that the <em>https-listener</em> is configured to use
the <em>ApplicationRealm</em> legacy security realm for its SSL configuration.
Undertow cannot reference both a legacy security realm and an
<em>ssl-context</em> in Elytron at the same time so you must remove the
reference to the legacy security realm. Also there has to be always
configured either <em>ssl-context</em> or <em>security-realm</em>. Thus when changing
between those, you have to use batch operation:</p>
</div>
</div>
<div class="sect4">
<h5 id="remove-the-reference-to-the-legacy-security-realm-and-update-the-https-listener-to-use-the-ssl-context-from-elytron">Remove the reference to the legacy security realm and update the</h5>
<div class="paragraph">
<p>https-listener to use the ssl-context from Elytron:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context,value=twoWaySSC)
run-batch</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reload-the-server-1">Reload the server</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>To complete the two-way SSL/TLS authentication, you need to
<a href="#import-server-certificate-into-client-truststore-applications">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-applications">configure your client</a>
to present the client certificate.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="import-server-certificate-into-client-truststore-applications">Import the server certificate into the client truststore</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ keytool -importcert -keystore client.truststore.jks -storepass secret -alias localhost -trustcacerts -file /path/to/server.cer</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-your-client-to-use-the-client-certificate-applications">Configure your client to use the client certificate</h4>
<div class="paragraph">
<p>You need to configure your client to present the trusted client
certificate to the server to complete the two-way SSL/TLS
authentication. For example, if using a browser, you need to import the
trusted certificate into the browser&#8217;s truststore.</p>
</div>
<div class="paragraph">
<p>Two-Way HTTPS is now enabled for applications.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-one-way-ssltls-for-the-management-interfaces">Enable One-way SSL/TLS for the Management Interfaces</h3>
<div class="paragraph">
<p>There are a couple ways to enable one-way SSL/TLS for the management interfaces.</p>
</div>
<div class="sect3">
<h4 id="one-way-ssl-management-interfaces-using-security-command">Using a security command:</h4>
<div class="paragraph">
<p>The <em>security enable-ssl-management</em> command can be used to enable one-way
SSL/TLS for the management interfaces. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">security enable-ssl-management --interactive
Please provide required pieces of information to enable SSL:
Key-store file name (default management.keystore): keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): n

SSL options:
key store file: keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
Server keystore file keystore.jks, certificate file keystore.pem and keystore.csr file
will be generated in server configuration directory.
Do you confirm y/n :y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server and reconnect to it.</p>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for the management interfaces.</p>
</div>
</div>
<div class="sect3">
<h4 id="one-way-ssl-management-interfaces-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h4>
<div class="paragraph">
<p>Elytron subsystem commands can also be used to enable one-way SSL/TLS for the
management interfaces.</p>
</div>
<div class="sect4">
<h5 id="configure-key-store">Configure a key-store:</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:add(path=keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> The above command uses <em>relative-to</em> to reference the location
of the keystore file. Alternatively, you can specify the full path to
the keystore in <em>path</em> and omit <em>relative-to</em>.</p>
</div>
<div class="paragraph">
<p>If the keystore file does not exist yet, the following commands can be used to
generate an example key pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")
/subsystem=elytron/key-store=httpsKS:store()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="create-a-key-manager-and-server-ssl-context">Create a key-manager and server-ssl-context.</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-manager=httpsKM:add(key-store=httpsKS,credential-reference={clear-text=secret})
 
/subsystem=elytron/server-ssl-context=httpsSSC:add(key-manager=httpsKM,protocols=["TLSv1.2"])</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> You need to determine what SSL/TLS protocols you want to
support. The example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="enable-https-on-the-management-interface.">Enable HTTPS on the management interface.</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/core-service=management/management-interface=http-interface:write-attribute(name=ssl-context, value=httpsSSC)
 
/core-service=management/management-interface=http-interface:write-attribute(name=secure-socket-binding, value=management-https)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reload-the-wildfly-instance.">Reload the WildFly instance.</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for the management interfaces.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-two-way-ssltls-for-the-management-interfaces">Enable Two-way SSL/TLS for the Management Interfaces</h3>
<div class="paragraph">
<p>First, obtain or generate your client keystore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ keytool -genkeypair -alias client -keyalg RSA -keysize 1024 -validity 365 -keystore client.keystore.jks -dname "CN=client" -keypass secret -storepass secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Export your client certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ keytool -exportcert  -keystore client.keystore.jks -alias client -keypass secret -storepass secret -file /path/to/client.cer</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a couple ways to enable two-way SSL/TLS for the management interfaces.</p>
</div>
<div class="sect3">
<h4 id="two-way-ssl-management-interfaces-using-security-command">Using a security command:</h4>
<div class="paragraph">
<p>The <em>security enable-ssl-management</em> command can be used to enable two-way
SSL/TLS for the management interfaces. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">security enable-ssl-management --interactive
Please provide required pieces of information to enable SSL:
Key-store file name (default management.keystore): server.keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): y
Client certificate (path to pem file): /path/to/client.cer
Validate certificate y/n (blank y):
Trust-store file name (management.truststore): server.truststore.jks
Password (blank generated): secret

SSL options:
key store file: server.keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
client certificate: /path/to/client.cer
trust store file: server.trustore.jks
trust store password: secret
Server keystore file server.keystore.jks, certificate file server.pem and server.csr file will be generated in server configuration directory.
Server truststore file server.trustore.jks will be generated in server configuration directory.
Do you confirm y/n: y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server and
attempt to reconnect to it. To complete the two-way SSL/TLS authentication,
you need to <a href="#import-server-certificate-into-client-truststore-management">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-management">configure your client</a>
to present the client certificate.</p>
</div>
</div>
<div class="sect3">
<h4 id="two-way-ssl-management-interfaces-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h4>
<div class="paragraph">
<p>Elytron subsystem commands can also be used to enable two-way SSL/TLS for the
management interfaces.</p>
</div>
<div class="sect4">
<h5 id="obtain-or-generate-your-key-stores-management">Obtain or generate your key stores.</h5>
<div class="paragraph">
<p>Before enabling HTTPS in WildFly, you must obtain or generate the server
key store and trust store you plan on using. To generate an example key
store and trust store, use the following commands.</p>
</div>
<div class="paragraph">
<p>Configure a key-store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:add(path=server.keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)

/subsystem=elytron/key-store=twoWayKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")

/subsystem=elytron/key-store=twoWayKS:store()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> The above command uses <em>relative-to</em> to reference the location
of the keystore file. Alternatively, you can specify the full path to
the keystore in <em>path</em> and omit <em>relative-to</em>.</p>
</div>
<div class="paragraph">
<p>Export your server certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:export-certificate(alias=localhost,path=/path/to/server.cer,pem=true)</code></pre>
</div>
</div>
<div id="import-client-certificate-into-server-truststore" class="paragraph">
<p>Create a key-store for the server trust store and import the client certificate
into the server trust store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=twoWayTS:add(path=server.truststore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)

/subsystem=elytron/key-store=twoWayTS:import-certificate(alias=client,path=/path/to/client.cer,credential-reference={clear-text=secret},trust-cacerts=true)

/subsystem=elytron/key-store=twoWayTS:store()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-key-manager-trust-manager-and-server-ssl-context-for-the-server-key-store-and-trust-store">Configure a key-manager, trust-manager, and server-ssl-context for the server key store and trust store.</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-manager=twoWayKM:add(key-store=twoWayKS,credential-reference={clear-text=secret})
 
/subsystem=elytron/trust-manager=twoWayTM:add(key-store=twoWayTS)
 
/subsystem=elytron/server-ssl-context=twoWaySSC:add(key-manager=twoWayKM,protocols=["TLSv1.2"],trust-manager=twoWayTM,want-client-auth=true,need-client-auth=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> You need to determine what SSL/TLS protocols you want to
support. The example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="enable-https-on-the-management-interface.-1">Enable HTTPS on the management interface.</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/core-service=management/management-interface=http-interface:write-attribute(name=ssl-context, value=twoWaySSC)
 
/core-service=management/management-interface=http-interface:write-attribute(name=secure-socket-binding, value=management-https)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reload-the-wildfly-instance.-1">Reload the WildFly instance.</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>To complete the two-way SSL/TLS authentication, you need to
<a href="#import-server-certificate-into-client-truststore-management">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-management">configure your client</a>
to present the client certificate.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="import-server-certificate-into-client-truststore-management">Import the server certificate into the client truststore.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ keytool -importcert -keystore client.truststore.jks -storepass secret -alias localhost -trustcacerts -file /path/to/server.cer</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-your-client-to-use-the-client-certificate-management">Configure your client to use the client certificate.</h4>
<div class="paragraph">
<p>You need to configure your client to present the trusted client
certificate to the server to complete the two-way SSL/TLS
authentication. For example, if using a browser, you need to import the
trusted certificate into the browser&#8217;s trust store.</p>
</div>
<div class="paragraph">
<p>Two-way SSL/TLS is now enabled for the management interfaces.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="keystore-manipulation-operations">KeyStore manipulation operations</h3>
<div class="paragraph">
<p>It is possible to perform various KeyStore manipulation operations on an
Elytron key-store resource using the management CLI.</p>
</div>
<div class="sect3">
<h4 id="generate-key-pair">Generate a key pair</h4>
<div class="paragraph">
<p>The <em>generate-key-pair</em> command generates a key pair and wraps the resulting
public key in a self-signed X.509 certificate. The generated private key and
self-signed certificate will be added to the KeyStore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:generate-key-pair(alias=example,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=www.example.com")</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="generate-certificate-signing-request">Generate a certificate signing request</h4>
<div class="paragraph">
<p>The <em>generate-certificate-signing-request</em> command generates a PKCS #10
certificate signing request using a PrivateKeyEntry from the KeyStore. The
generated certificate signing request will be output to a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:generate-certificate-signing-request(alias=example,path=server.csr,relative-to=jboss.server.config.dir,distinguished-name="CN=www.example.com",extensions=[{critical=false,name=KeyUsage,value=digitalSignature}],credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="import-certificate">Import a certificate or certificate chain</h4>
<div class="paragraph">
<p>The <em>import-certificate</em> command imports a certificate or certificate chain
from a file into an entry in the KeyStore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:import-certificate(alias=example,path=/path/to/certificate_or_chain/file,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},trust-cacerts=true)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="export-certificate">Export a certificate</h4>
<div class="paragraph">
<p>The <em>export-certificate</em> command exports a certificate from an entry in the
KeyStore to a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:export-certificate(alias=example,path=serverCert.cer,relative-to=jboss.server.config.dir,pem=true)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="change-alias">Change an alias</h4>
<div class="paragraph">
<p>The <em>change-alias</em> command moves an existing KeyStore entry to a new alias.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:change-alias(alias=example,new-alias=newExample,credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="store-changes">Store changes made to key-stores</h4>
<div class="paragraph">
<p>The <em>store</em> command persists any changes that have been made to the file that
backs the KeyStore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:store()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-an-ldap-key-store">Using an ldap-key-store</h3>
<div class="paragraph">
<p>An <em>ldap-key-store</em> allows you to use a keystore stored in an LDAP
server. You can use an <em>ldap-key-store</em> in same way you can use a
<em>key-store</em>.</p>
</div>
<div class="paragraph">
<p>To create and use an <em>ldap-key-store</em>:</p>
</div>
<div class="sect3">
<h4 id="configure-a-dir-context.">Configure a dir-context.</h4>
<div class="paragraph">
<p>To connect to the LDAP server from WildFly, you need to configure a
<em>dir-context</em> that provides the URL as well as the principal used to
connect to the server.</p>
</div>
<div class="paragraph">
<p><strong>Example dir-context</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/dir-context=exampleDC:add( \
  url="ldap://127.0.0.1:10389", \
  principal="uid=admin,ou=system", \
  credential-reference={clear-text=secret} \
)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-an-ldap-key-store.">Configure an ldap-key-store.</h4>
<div class="paragraph">
<p>When configure an <em>ldap-key-store</em>, you need to specify both the
<em>dir-context</em> used to connect to the LDAP server as well as how to
locate the keystore stored in the LDAP server. At a minimum, this
requires you specify a <em>search-path</em>.</p>
</div>
<div class="paragraph">
<p><strong>Example ldap-key-store</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/ldap-key-store=ldapKS:add( \
  dir-context=exampleDC, \
  search-path="ou=Keystores,dc=wildfly,dc=org" \
)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="use-the-ldap-key-store.">Use the ldap-key-store.</h4>
<div class="paragraph">
<p>Once you have defined your <em>ldap-key-store</em>, you can use it in the same
places where a <em>key-store</em> could be used. For example, you could use an
<em>ldap-key-store</em> when configuring HTTPS and Two-Way HTTPS for
applications.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-a-filtering-key-store">Using a filtering-key-store</h3>
<div class="paragraph">
<p>A <em>filtering-key-store</em> allows you to expose a subset of aliases from an
existing <em>key-store</em>, and use it in the same places you could use a
<em>key-store</em>. For example, if a keystore contained <em>alias1</em>, <em>alias2</em>,
and <em>alias3</em>, but you only wanted to expose <em>alias1</em> and <em>alias3</em>, a
<em>filtering-key-store</em> provides you several ways to do that.</p>
</div>
<div class="paragraph">
<p>To create a <em>filtering-key-store</em>:</p>
</div>
<div class="sect3">
<h4 id="configure-a-key-store.">Configure a key-store.</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=myKS:add( \
  path=keystore.jks, \
  relative-to=jboss.server.config.dir, \
  credential-reference={ \
    clear-text=secret \
  }, \
  type=JKS \
)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-filtering-key-store.">Configure a filtering-key-store.</h4>
<div class="paragraph">
<p>When you configure a <em>filtering-key-store</em>, you specify which
<em>key-store</em> you want to filter and the <em>alias-filter</em> for filtering
aliases from the <em>key-store</em>. The filter can be specified in one of the
following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>alias1,alias3</em>, which is a comma-delimited list of aliases to expose.</p>
</li>
<li>
<p><em>ALL:-alias2</em>, which exposes all aliases in the keystore except the
ones listed.</p>
</li>
<li>
<p><em>NONE:+alias1:+alias3</em>, which exposes no aliases in the keystore
except the ones listed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This example uses a comma-delimted list to expose <em>alias1</em> and <em>alias3</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/filtering-key-store=filterKS:add( \
  key-store=myKS, \
  alias-filter="alias1,alias3" \
)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="use-the-filtering-key-store.">Use the filtering-key-store.</h4>
<div class="paragraph">
<p>Once you have defined your <em>filtering-key-store</em>, you can use it in the
same places where a <em>key-store</em> could be used. For example, you could
use a <em>filtering-key-store</em> when configuring HTTPS and Two-Way HTTPS for
applications.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reload-a-keystore">Reload a Keystore</h3>
<div class="paragraph">
<p>You can reload a keystore configured in WildFly from the management CLI.
This is useful in cases where you have made changes to certificates
referenced by a keystore.</p>
</div>
<div class="paragraph">
<p>To reload a keystore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS:load</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="check-the-content-of-a-keystore-by-alias">Check the Content of a Keystore by Alias</h3>
<div class="paragraph">
<p>If you add a keystore to the <em>elytron</em> subsystem using the <em>key-store</em>
component, you can check the keystore&#8217;s contents using the <em>alias</em> child
element and reading its attributes.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/key-store=httpsKS/alias=localhost:read-attribute(name=certificate-chain)
{
    "outcome" =&gt; "success",
    "result" =&gt; [{
        "type" =&gt; "X.509",
        "algorithm" =&gt; "RSA",
        "format" =&gt; "X.509",
        "public-key" =&gt; "30:81:9f:30:0d:06:09:2a:8......</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following attributes can be read:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate associated with the alias. If the alias
has a certificate chain this will always be undefined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate-chain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate chain associated with the alias.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">creation-date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The creation date of the entry represented by this
alias.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entry-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the entry for this alias. Available types:
PasswordEntry, PrivateKeyEntry, SecretKeyEntry, TrustedCertificateEntry,
and Other. Unrecognized types will be reported as Other.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="custom-components">Custom Components</h3>
<div class="paragraph">
<p>When configuring SSL/TLS in the <em>elytron</em> subsystem, you can provide and
use custom implementations of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>key-store</em></p>
</li>
<li>
<p><em>key-manager</em></p>
</li>
<li>
<p><em>trust-manager</em></p>
</li>
<li>
<p><em>client-ssl-context</em></p>
</li>
<li>
<p><em>server-ssl-context</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When creating custom implementations of Elytron components, they must
present the appropriate capabilities and requirements.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-the-elytron-and-security-subsystems">Configuring the Elytron and Security Subsystems</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="enable-and-disable-the-elytron-subsystem">Enable and Disable the Elytron Subsystem</h3>
<div class="sect3">
<h4 id="to-add-the-elytron-extension-required-for-the-elytron-subsystem">To add the elytron extension required for the elytron subsystem:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/extension=org.wildfly.extension.elytron:add()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to-enable-the-elytron-subsystem-in-wildfly">To enable the Elytron subsystem in WildFly:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron:add
 
reload</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to-disable-the-elytron-subsystem-in-wildfly">To disable the Elytron subsystem in WildFly:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron:remove
 
reload</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> Other subsystems within WildFly may have dependencies on
the <em>elytron</em> subsystem. If these dependencies are not resolved before
disabling it, you will see errors when starting WildFly.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-and-disable-the-security-subsystem">Enable and Disable the Security Subsystem</h3>
<div class="sect3">
<h4 id="to-disable-the-security-subsystem-in-wildfly">To disable the security subsystem in WildFly:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=security:remove
 
reload</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> Other subsystems within WildFly may have dependencies on
the <em>security</em> subsystem. If these dependencies are not resolved before
disabling it, you will see errors when starting WildFly.</p>
</div>
</div>
<div class="sect3">
<h4 id="to-enable-the-security-subsystem-in-wildfly">To enable the security subsystem in WildFly:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=security:add
 
reload</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="use-the-elytron-and-security-subsystems-in-parallel">Use the Elytron and Security Subsystems in Parallel</h3>
<div class="paragraph">
<p>By default the <em>elytron</em> and <em>security</em> subsystems will run in parallel
if both are enabled. For authentication in applications, you can use the
<em>application-security-domain</em> property in the <em>undertow</em> subsystem to
configure a security domain in the <em>elytron</em> subsystem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-http-auth)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> This must match the <em>security-domain</em> configured in the
<em>jboss-web.xml</em> of your application.</p>
</div>
<div class="paragraph">
<p>If the <em>application-security-domain</em> is not set, WildFly will look for a
security domain configured in the <em>security</em> subsystem that matches the
<em>security-domain</em> configured in the <em>jboss-web.xml</em> of your application.</p>
</div>
<div class="paragraph">
<p>For enabling HTTPS using a legacy security realm, you can use the
<em>security-realm</em> attribute in the <em>https-listener</em> section of the
<em>undertow</em> subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/server=default-server/https-listener=https:read-attribute(name=security-realm)
{
    "outcome" =&gt; "success",
    "result" =&gt; "ApplicationRealm"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For enabling HTTPS using <em>elytron</em>, you need to undefine the
<em>security-realm</em> attribute and set the <em>ssl-context</em> attribute. As there
has to be always configured either <em>ssl-context</em> or <em>security-realm</em> you
have to use batch operation when changing between those:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context,value=httpsSSC)
run-batch</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-elytron-subsystem-components">Creating Elytron Subsystem Components</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="create-an-elytron-security-realm">Create an Elytron Security Realm</h3>
<div class="paragraph">
<p>Security realms in the Elytron subsystem, when used in conjunction with
security domains, are use for both core management authentication as
well as for authentication with applications. Security realms are also
specifically typed based on their identity store, for example
<em>jdbc-realm</em>, <em>filesystem-realm</em>, <em>properties-realm</em>, etc.</p>
</div>
<div class="paragraph">
<p>Adding a security realm takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/type-of-realm=realmName:add(....)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples of adding specific realms, such as <em>jdbc-realm</em>,
<em>filesystem-realm</em>, and <em>properties-realm</em> can be found in previous
sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-an-elytron-role-decoder">Create an Elytron Role Decoder</h3>
<div class="paragraph">
<p>A role decoder converts attributes from the identity provided by the
security realm into roles. Role decoders are also specifically typed
based on their functionality, for example <em>empty-role-decoder</em>,
<em>simple-role-decoder</em>, and <em>custom-role-decoder</em>.</p>
</div>
<div class="paragraph">
<p>Adding a role decoder takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/ROLE-DECODER-TYPE=roleDeoderName:add(....)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-an-elytron-permission-set">Create an Elytron Permission Set</h3>
<div class="paragraph">
<p>Permission sets can be used to assign permissions to an identity.</p>
</div>
<div class="paragraph">
<p>Adding a permission set takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/permission-set=PermissionSetName:add(permissions=[{class-name="...", module="...", target-name="...", action="..."}...])</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <em>permissions</em> consists of a set of permissions, where each permission has the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>class-name</em> is the fully qualified class name of the permission. This is the only permission attribute that is required.</p>
</li>
<li>
<p><em>module</em> is the optional module to use to load the permission.</p>
</li>
<li>
<p><em>target-name</em> is the optional target name to pass to the permission as it is constructed.</p>
</li>
<li>
<p><em>action</em> is the optional action to pass to the permission as it is constructed.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="create-an-elytron-permission-mapper">Create an Elytron Permission Mapper</h3>
<div class="paragraph">
<p>In addition to roles being assigned to a identity, permissions may also
be assigned. A permission mapper assigns permissions to an identity.
Permission mappers are also specifically typed based on their
functionality, for example <em>logical-permission-mapper</em>,
<em>simple-permission-mapper</em>, and <em>custom-permission-mapper</em>.</p>
</div>
<div class="paragraph">
<p>Adding a permission mapper takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/simple-permission-mapper=PermissionMapperName:add(...)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-an-elytron-role-mapper">Create an Elytron Role Mapper</h3>
<div class="paragraph">
<p>A role mapper maps roles after they have been decoded to other roles.
Examples include normalizing role names or adding and removing specific
roles from principals after they have been decoded. Role mappers are
also specifically typed based on their functionality, for example
<em>add-prefix-role-mapper</em>, <em>add-suffix-role-mapper</em>, and
<em>constant-role-mapper</em>.</p>
</div>
<div class="paragraph">
<p>Adding a role mapper takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/ROLEM-MAPPER-TYPE=roleMapperName:add(...)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-an-elytron-security-domain">Create an Elytron Security Domain</h3>
<div class="paragraph">
<p>Security domains in the Elytron subsystem, when used in conjunction with
security realms, are use for both core management authentication as well
as for authentication with applications.</p>
</div>
<div class="paragraph">
<p>Adding a security domain takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/security-domain=domainName:add(realms=[{realm=realmName,role-decoder=roleDecoderName}],default-realm=realmName,permission-mapper=permissionMapperName,role-mapper=roleMapperName,...)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-an-elytron-authentication-factory">Create an Elytron Authentication Factory</h3>
<div class="paragraph">
<p>An authentication factory is an authentication policy used for specific
authentication mechanisms. Authenticaion factories are specifically
based on the authentication mechanism, for example
<em>http-authentication-factory</em> and<br>
<em>sasl-authentication-factory</em> and <em>kerberos-security-factory</em>.</p>
</div>
<div class="paragraph">
<p>Adding an authentication factory takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/AUTH-FACTORY-TYPE=authFactoryName:add(....)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-an-elytron-policy-provider">Create an Elytron Policy Provider</h3>
<div class="paragraph">
<p>Elytron subsystem provides a specific resource definition that can be
used to configure a default ruby Policy provider. The subsystem allows
you to define multiple policy providers but select a single one as the
default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=elytron/policy=policy-provider-a:add(custom-policy=\[{name=policy-provider-a, class-name=MyPolicyProviderA, module=x.y.z}\])</code></pre>
</div>
</div>
</div>
</div>
</div>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/wildflysite/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Wildfly</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wildfly</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wildfly"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wildfly</span></a></li><li><a href="https://www.twitter.com/WildFlyAS"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">WildFlyAS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
