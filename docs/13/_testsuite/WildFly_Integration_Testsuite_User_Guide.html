<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>WildFly Integration Testsuite User Guide | Wildfly</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="WildFly Integration Testsuite User Guide" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://jbossorg.github.io/wildflysite/docs/13/_testsuite/WildFly_Integration_Testsuite_User_Guide.html" />
<meta property="og:url" content="https://jbossorg.github.io/wildflysite/docs/13/_testsuite/WildFly_Integration_Testsuite_User_Guide.html" />
<meta property="og:site_name" content="Wildfly" />
<script type="application/ld+json">
{"@type":"WebPage","url":"https://jbossorg.github.io/wildflysite/docs/13/_testsuite/WildFly_Integration_Testsuite_User_Guide.html","headline":"WildFly Integration Testsuite User Guide","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/wildflysite/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://jbossorg.github.io/wildflysite/feed.xml" title="Wildfly" /></head>
<body><div class="header navigation">
  <div class="logo-wrapper">
    <a href="/wildflysite/"><img class="wf-logo" src="/wildflysite/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/wildflysite/" class="">Home</a>
        </li>
        <li>
          <a href="/wildflysite/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/wildflysite/blog/" class="">Blog</a>
        </li>
        <li>
          <a href="/wildflysite/about/" class="">About</a>
        </li>
        <li>
          <a href="/wildflysite/contribute/" class="">Contribute</a>
        </li>
        <li>
          <a href="/wildflysite/docs/" class="">Docs</a>
        </li>
        <li>
          <a class="button-cta secondary" href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>See also:</strong> <a href="#WildFly_Testsuite_Test_Developer_Guide">WildFly
Testsuite Test Developer Guide</a></p>
</div>
<div class="paragraph">
<p><strong>Target Audience:</strong> Those interested in running the testsuite or a subset
thereof, with various configuration options.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-testsuite">Running the testsuite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The tests can be run using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>build.sh</code> or <code>build.bat</code>, as a part of WildFly build.</p>
<div class="ulist">
<ul>
<li>
<p>By default, only smoke tests are run. To run all tests, run build.sh
install -DallTests.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>integration-tests.sh</code> or <code>integration-tests.bat</code>, a convenience
script which uses bundled Maven (currently 3.0.3), and runs all parent
testsuite modules (which configure the AS server).</p>
</li>
<li>
<p>pure maven run, using <code>mvn install</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The scripts are wrappers around Maven-based build. Their arguments are
passed to Maven (with few exceptions described below). This means you
can use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>build.sh (defaults to install)</p>
</li>
<li>
<p>build.sh install</p>
</li>
<li>
<p>build.sh clean install</p>
</li>
<li>
<p>integration-tests.sh install</p>
</li>
<li>
<p>&#8230;&#8203;etc.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="supported-maven-phases">Supported Maven phases</h3>
<div class="paragraph">
<p>Testsuite actions are bounds to various Maven phases up to <code>verify</code>.
Running the build with earlier ﻿phases may fail in the submodules due to
missed configuration steps. Therefore, the only Maven phases you may
safely run, are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>clean</p>
</li>
<li>
<p>install</p>
</li>
<li>
<p>site</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>test</code> phase is not recommended to be used for scripted jobs as we
are planning to switch to the <code>failsafe</code> plugin bound to the
<code>integration-test</code> and <code>verify</code> phases. See
<a href="https://issues.jboss.org/browse/WFLY-625">WFLY-625</a> and
<a href="https://issues.jboss.org/browse/WFLY-228">WFLY-228</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="testsuite-structure">Testsuite structure</h3>
<div class="paragraph">
<p>testsuite<br>
integration<br>
smoke<br>
basic<br>
clust<br>
iiop<br>
multinode<br>
xts<br>
compat<br>
domain<br>
mixed-domain<br>
stress<br>
benchmark</p>
</div>
</div>
<div class="sect2">
<h3 id="test-groups">Test groups</h3>
<div class="paragraph">
<p>To define groups of tests to be run, these properties are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-DallTests</code> - Runs all subgroups.</p>
</li>
<li>
<p><code>-DallInteg</code> - Runs all integration tests. Same as
<code>cd testsuite/integration; mvn clean install -DallTests</code></p>
</li>
<li>
<p><code>-Dts.integ</code> - Basic integration + clustering tests.</p>
</li>
<li>
<p><code>-Dts.clust</code> - Clustering tests.</p>
</li>
<li>
<p><code>-Dts.iiop</code> - IIOP tests.</p>
</li>
<li>
<p>`-Dts.multinode `- Tests with many nodes.</p>
</li>
<li>
<p><code>-Dts.manualmode</code> - Tests with manual mode Arquillian containers.</p>
</li>
<li>
<p><code>-Dts.bench</code> - Benchmark tests.</p>
</li>
<li>
<p><code>-Dts.stress</code> - Stress tests.</p>
</li>
<li>
<p><code>-Dts.domain</code> - Domain mode tests.</p>
</li>
<li>
<p><code>-Dts.compat</code> - Compatibility tests.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples">Examples</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><code>integration-tests.sh [install] ` `</code> <code>-- Runs smoke tests.</code></p>
</li>
<li>
<p><code>integration-tests.sh clean install&#8201;&#8212;&#8201;Cleans the target directory, then runs smoke tests.</code></p>
</li>
<li>
<p><code>integration-tests.sh install -Dts.smoke ` `</code> <code>-- Same as above.</code></p>
</li>
<li>
<p><code>integration-tests.sh install -DallTests ` `</code>
<code>-- Runs all testsuite tests.</code></p>
</li>
<li>
<p><code>integration-tests.sh install -Dts.stress&#8201;&#8212;&#8201;Runs smoke tests and stress tests.</code></p>
</li>
<li>
<p><code>integration-tests.sh install -Dts.stress -Dts.noSmoke&#8201;&#8212;&#8201;Runs stress tests only.</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Pure maven</strong> - if you prefer not to use scripts, you may achieve the
same result with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mvn &#8230;&#8203; -rf testsuite</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>-rf &#8230;&#8203;</code> parameter stands for "resume from" and causes Maven to run
the specified module <em>and all successive</em>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to run only a single module (provided the ancestor modules
were already run to create the AS copies) :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mvn &#8230;&#8203; -pl testsuite/integration/cluster</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>-pl &#8230;&#8203;</code> parameter stands for "project list" and causes Maven to
run the specified module <em>only</em>.</p>
</div>
<div class="sect2">
<h3 id="output-to-console">Output to console</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">-DtestLogToFile</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="other-options">Other options</h3>
<div class="paragraph">
<p><code>-DnoWebProfile</code> - Run all tests with the <em>full</em> profile (
<code>standalone-full.xml</code>). By default, most tests are run under <em>web</em>
profile ( <code>standalone.xml</code>).</p>
</div>
<div class="paragraph">
<p><code>-Dts.skipTests</code> - Skip testsuite&#8217;s tests. Defaults to the value of
<code>-DskipTests</code>, which defaults to <code>false</code>. To build AS, skip unit tests
and run testsuite, use <code>-DskipTests -Dts.skipTests=false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="timeouts">Timeouts</h3>
<div class="sect3">
<h4 id="surefire-execution-timeout">Surefire execution timeout</h4>
<div class="paragraph">
<p>Unfortunatelly, no math can be done in Maven, so instead of applying a
timeout ratio, you need to specify timeout manually for Surefire.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">-Dsurefire.forked.process.timeout=900</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="in-test-timeout-ratios">In-test timeout ratios</h4>
<div class="paragraph">
<p>Ratio in prercent - 100 = default, 200 = two times longer timeouts for
given category.</p>
</div>
<div class="paragraph">
<p>Currently we have five different ratios. Later, it could be replaced
with just one generic, one for database and one for deployment
operations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">-Dtimeout.ratio.fsio=100
-Dtimeout.ratio.netio=100
-Dtimeout.ratio.memio=100
-Dtimeout.ratio.proc=100
-Dtimeout.ratio.db=100</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-a-single-test-or-specified-tests">Running a single test (or specified tests)</h3>
<div class="paragraph">
<p>Single test is run using <strong>-Dtest=&#8230;&#8203;</strong> . Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>./integration-tests.sh install -Dtest='</code> <code><strong></code> <code>Clustered</code> <code></strong></code>
<code>' -Dintegration.module</code> <code>-Dts.clust</code></p>
</li>
<li>
<p><code>./integration-tests.sh clean install -Dtest=org</code> <code>/</code> <code>jboss</code> <code>/</code> <code>as</code>
<code>/</code> <code>test</code> <code>/</code> <code>integration</code> <code>/</code> <code>ejb/async/*TestCase.java</code>
<code>-Dintegration.module</code> <code>-Dts.basic</code></p>
</li>
<li>
<p><code>cd testsuite; mvn install</code> <code>-Dtest='</code> <code><strong>Clustered</code> <code></strong></code> <code>'</code>
<code>-Dts.basic #</code>
<code>No need for -Dintegration.module - integration module is active by default.</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The same shortcuts listed in "Test groups" may be used to activate the
module and group profile.</p>
</div>
<div class="paragraph">
<p>Note that <code>-Dtest=</code> overrides <code>&lt;includes&gt;</code> and <code>&lt;exludes&gt;</code> defined in
pom.xml, so do not rely on them when using wildcards - all compiled test
classes matching the wildcard will be run.</p>
</div>
<div class="paragraph">
<p><strong>Which Surefire execution is used?</strong></p>
</div>
<div class="paragraph">
<p>Due to Surefire&#8217;s design flaw, tests run multiple times if there are
multiple surefire executions.<br>
To prevent this, if <code>-Dtest=</code>&#8230;&#8203; is specified, non-default executions
are disabled, and standalone-full is used for all tests.<br>
If you need it other way, you can overcome that need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>basic-integration-web.surefire with standalone.xml - Configure standalone.xml to be used as server config.</code></p>
</li>
<li>
<p><code>basic-integration-non-web.surefire - For tests included here, technically nothing changes.</code></p>
</li>
<li>
<p><code>basic-integration-2nd.surefire - Simply run the second test in another invocation of Maven.</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="running-against-existing-as-copy-not-the-one-from-buildtargetjboss-as-">Running against existing AS copy (not the one from</h3>
<div class="paragraph">
<p>build/target/jboss-as-*)</p>
</div>
<div class="paragraph">
<p><strong>-Djboss.dist=&lt;path/to/jboss-as&gt;</strong> will tell the testsuite to copy that
AS into submodules to run the tests against.</p>
</div>
<div class="paragraph">
<p>For example, you might want to run the testsuite against AS located in
<code>/opt/wildfly-8</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">./integration-tests.sh -DallTests -Djboss.dist=/opt/wildfly-8</code></pre>
</div>
</div>
<div class="paragraph">
<p>The difference between jboss.dist and jboss.home:</p>
</div>
<div class="paragraph">
<p>jboss.dist is the location of the tested binaries. It gets copied to
testsuite submodules.</p>
</div>
<div class="paragraph">
<p>jboss.home is internally used and points to those copied AS instances
(for multinode tests, may be even different for each AS started by
Arquillian).</p>
</div>
<div class="sect3">
<h4 id="running-against-a-running-jboss-as-instance">Running against a running JBoss AS instance</h4>
<div class="paragraph">
<p>Arquillian&#8217;s WildFly {wildflyVersion} container adapter allows specifying
<code>allowConnectingToRunningServer</code> in <code>arquillian.xml</code>, which makes it
check whether AS is listening at <code>managementAddress:managementPort</code>, and
if so, it uses that server instead of launching a new one, and doesn&#8217;t
shut it down at the end.</p>
</div>
<div class="paragraph">
<p>All arquillian.xml&#8217;s in the testsuite specify this parameter. Thus, if
you have a server already running, it will be re-used.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-against-jboss-enterprise-application-platform-eap-6.0">Running against JBoss Enterprise Application Platform (EAP) 6.0</h4>
<div class="paragraph">
<p>To run the testsuite against AS included JBoss Enterprise Application
Platform 6.x (EAP), special steps are needed.</p>
</div>
<div class="paragraph">
<p>Assuming you already have the sources available, and the distributed EAP
maven repository unzipped in e.g. <code>/opt/jboss/eap6-maven-repo/</code> :</p>
</div>
<div class="paragraph">
<p>1) Configure maven in settings.xml to use only the EAP repository. This
repo contains all artifacts necessary for building EAP, including maven
plugins.<br>
The build (unlike running testsuite) may be done offline.<br>
The recommended way of configuring is to use special settings.xml, not
your local one (typically in .m2/settings.xml).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">   &lt;mirror&gt;
      &lt;id&gt;eap6-mirror-setting&lt;/id&gt;
      &lt;mirrorOf&gt;
         *,!central-eap6,!central-eap6-plugins,!jboss-public-eap6,!jboss-public-eap6-plugins
      &lt;/mirrorOf&gt;
      &lt;name&gt;Mirror Settings for EAP 6 build&lt;/name&gt;
      &lt;url&gt;file:///opt/jboss/eap6-maven-repo&lt;/url&gt;
    &lt;/mirror&gt;
  &lt;/mirrors&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>\2) Build EAP. You won&#8217;t use the resulting EAP build, though. The
purpose is to get the artifacts which the testsuite depends on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">mvn clean install -s settings.xml -Dmaven.repo.local=local-repo-eap</code></pre>
</div>
</div>
<div class="paragraph">
<p>\3) Run the testsuite. Assuming that EAP is located in <code>/opt/eap6</code>, you
would run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">./integration-tests.sh -DallTests -Djboss.dist=/opt/eap6</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further information on building EAP and running the testsuite
against it, see the official EAP documentation (link to be added)
<a href="https://docspace.corp.redhat.com/docs/DOC-86875">.</a></p>
</div>
<div class="paragraph">
<p>How-to for EAP QA can be found
<a href="https://docspace.corp.redhat.com/docs/DOC-89200">here</a> (Red Hat internal
only).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-with-a-debugger">Running with a debugger</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Argument</th>
<th class="tableblock halign-left valign-top">What will start with debugger</th>
<th class="tableblock halign-left valign-top">Default port</th>
<th class="tableblock halign-left valign-top">Port change arg.</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Ddebug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AS instances run by Arquillian</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8787</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Das.debug.port=&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Djpda</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alias for -Ddebug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-DdebugClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test JVMs (currently Surefire)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5050</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Ddebug.port.surefire=&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-DdebugCLI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AS CLI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5051</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Ddebug.port.cli=&#8230;&#8203;</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="examples-1">Examples</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">./integration-tests.sh install -DdebugClient -Ddebug.port.surefire=4040
 
...
 
-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Listening for transport dt_socket at address: 4040</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./integration-tests.sh install -DdebugClient -Ddebug.port.surefire
 
...
 
-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Listening for transport dt_socket at address: 5050</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">./integration-tests.sh install -Ddebug</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">./integration-tests.sh install -Ddebug -Das.debug.port=5005</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
JBoss AS is started by Arquillian, when the first test which requires
given instance is run. Unless you pass <strong>-DtestLogToFile=false,</strong> <strong>there&#8217;s
(currently) no challenge text in the console</strong>; it will look like the
first test is stuck. This is being solved in
<a href="http://jira.codehaus.org/browse/SUREFIRE-781" class="bare">http://jira.codehaus.org/browse/SUREFIRE-781</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Depending on which test group(s) you run, multiple AS instances may be
started. In that case, you need to attach the debugger multiple times.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-tests-with-custom-database">Running tests with custom database</h3>
<div class="paragraph">
<p>To run with different database, specify the <code>-Dds</code> and use these
properties (with the following defaults):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">-Dds.jdbc.driver=
-Dds.jdbc.driver.version=
-Dds.jdbc.url=
-Dds.jdbc.user=test
-Dds.jdbc.pass=test
-Dds.jdbc.driver.jar=${ds.db}-jdbc-driver.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>driver</code> is JDBC driver class. JDBC <code>url</code>, <code>user</code> and <code>pass</code> is as
expected.</p>
</div>
<div class="paragraph">
<p><code>driver.version</code> is used for automated JDBC driver downloading. Users
can set up internal Maven repository hosting JDBC drivers, with
artifacts with</p>
</div>
<div class="paragraph">
<p>GAV = <code>jdbcdrivers:${ds.db}:${ds.jdbc.driver.version</code>}</p>
</div>
<div class="paragraph">
<p>Internally, JBoss has such repo at
<a href="http://nexus.qa.jboss.com:8081/nexus/content/repositories/thirdparty/jdbcdrivers/" class="bare">http://nexus.qa.jboss.com:8081/nexus/content/repositories/thirdparty/jdbcdrivers/</a>
.</p>
</div>
<div class="paragraph">
<p>The <code>ds.db</code> value is set depending on ds. E.g. <code>-Dds=mssql2005</code> sets
<code>ds.db=mssql</code> (since they have the same driver). <code>-Dds.db</code> may be
overriden to use different driver.</p>
</div>
<div class="paragraph">
<p><strong class="line-through">In case you don&#8217;t want to use such driver, set just
-Dds.db= (empty) and provide the driver to the AS manually.</strong><br>
<em>Not supported; work in progress on parameter to provide JDBC Driver
jar.</em></p>
</div>
<div class="sect3">
<h4 id="default-values">Default values</h4>
<div class="paragraph">
<p>For WildFly continuous integration, there are some predefined values for
some of databases, which can be set using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">-Dds.db=&lt;database-identifier&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where database-identifier is one of: <code>h2</code>, <code>mysql51</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-tests-with-ipv6">Running tests with IPv6</h3>
<div class="paragraph">
<p><code>-Dipv6</code> - Runs AS with
<code>-Djava.net.preferIPv4Stack=false -Djava.net.preferIPv6Addresses=true</code></p>
</div>
<div class="paragraph">
<p>and the following defaults, overridable by respective parameter:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">IPv4 default</th>
<th class="tableblock halign-left valign-top">IPv6 default</th>
<th class="tableblock halign-left valign-top"> </th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dnode0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127.0.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single-node tests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dnode1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127.0.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">::1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two-node tests (e.g. cluster) use this for the
2nd node.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dmcast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">230.0.0.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ff01::1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ff01::1 is IPv6 Node-Local scope mcast
addr.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dmcast.jgroupsDiag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.75.75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ff01::2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups diagnostics
multicast address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dmcast.modcluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.1.105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ff01::3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mod_cluster multicast
address.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Values are set in AS configuration XML, replaced in resources (like
ejb-jar.xml) and used in tests.</p>
</div>
</div>
<div class="sect2">
<h3 id="running-tests-with-security-manager-custom-security-policy">Running tests with security manager / custom security policy</h3>
<div class="paragraph">
<p><code>-Dsecurity.manager</code> - Run with default policy.</p>
</div>
<div class="paragraph">
<p><code>-Dsecurity.policy=&lt;path&gt;</code> - Run with the given policy.</p>
</div>
<div class="paragraph">
<p><code>-Dsecurity.manager.other=&lt;set of Java properties&gt;</code> - Run with the given
properties. Whole set is included in all server startup parameters.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">./integration-tests.sh clean install -Dintegration.module -DallTests \
\"-Dsecurity.manager.other=-Djava.security.manager \
-Djava.security.policy==$(pwd)/testsuite/shared/src/main/resources/secman/permitt_all.policy \
-Djava.security.debug=access:failure \"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the \" quotes delimiting the whole <code>-Dsecurity.manager.other</code>
property.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-test-reports">Creating test reports</h3>
<div class="paragraph">
<p>Test reports are created in the form known from EAP 5. To create them,
simply run the testsuite, which will create Surefire XML files.</p>
</div>
<div class="paragraph">
<p>Creation of the reports is bound to the <code>site</code> Maven phase, so it must
be run separatedly afterwards. Use one of these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./integration-tests.sh site
cd testsuite; mvn site
mvn -pl testsuite site</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that it will take all test results under <code>testsuite/integration/</code> -
the pattern is <code>**/*TestCase.xml</code>, without need to specify <code>-DallTests</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-coverage-reports">Creating coverage reports</h3>
<div class="paragraph">
<p><strong>Jira:</strong> <a href="https://issues.jboss.org/browse/WFLY-585" class="bare">https://issues.jboss.org/browse/WFLY-585</a></p>
</div>
<div class="paragraph">
<p>Coverage reports are created by
<a href="http://www.eclemma.org/jacoco/trunk/index.html">JaCoCo</a>.</p>
</div>
<div class="paragraph">
<p>During the integration tests, Arquillian is passed a JVM argument which
makes it run with JaCoCo agent, which records the executions into
<code>${basedir}/target/jacoco</code> .</p>
</div>
<div class="paragraph">
<p>In the <code>site</code> phase, a HTML, XML and CSV reports are generated. That is
done using <code>jacoco:report</code> Ant task in <code>maven-ant-plugin</code> since JaCoCo&#8217;s
maven report goal doesn&#8217;t support getting classes outside
target/classes.</p>
</div>
<div class="sect3">
<h4 id="usage">Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./build.sh clean install -DskipTests
./integration-tests.sh clean install -DallTests -Dcoverage
./integration-tests.sh site -DallTests -Dcoverage ## Must run in separatedly.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">mvn clean install -DskipTests
mvn -rf testsuite clean install -DallTests -Dcoverage
mvn -rf testsuite site -DallTests -Dcoverage</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cleaning-the-project">Cleaning the project</h3>
<div class="paragraph">
<p>To have most stable build process, it should start with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>clean target directories</p>
</li>
<li>
<p>only central Maven repo configured</p>
</li>
<li>
<p>clean local repository or at least:</p>
<div class="ulist">
<ul>
<li>
<p>free of artefacts to be built</p>
</li>
<li>
<p>free of dependencies to be used (especially snapshots)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use , you may use these commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">mvn clean install -DskipTests -DallTests  ## ...to clean all testsuite modules.
mvn dependency:purge-local-repository build-helper:remove-project-artifact -Dbuildhelper.removeAll</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the build happens in a shared environment (e.g. network disk),
it&#8217;s recommended to use local repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">cp /home/hudson/.m2/settings.xml .
sed "s|&lt;settings&gt;|&lt;settings&gt;&lt;localRepository&gt;/home/ozizka/hudson-repos/$JOBNAME&lt;/localRepository&gt;|" -i settings.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">mvn clean install ... -Dmaven.repo.local=localrepo</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also <a href="https://issues.jboss.org/browse/WFLY-628" class="bare">https://issues.jboss.org/browse/WFLY-628</a>.</p>
</div>
</div>
</div>
</div>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/wildflysite/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Wildfly</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wildfly</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wildfly"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wildfly</span></a></li><li><a href="https://www.twitter.com/WildFlyAS"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">WildFlyAS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
