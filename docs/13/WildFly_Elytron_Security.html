<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>WildFly Elytron Security | Wildfly</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="WildFly Elytron Security" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://jbossorg.github.io/wildflysite/docs/13/WildFly_Elytron_Security.html" />
<meta property="og:url" content="https://jbossorg.github.io/wildflysite/docs/13/WildFly_Elytron_Security.html" />
<meta property="og:site_name" content="Wildfly" />
<script type="application/ld+json">
{"@type":"WebPage","url":"https://jbossorg.github.io/wildflysite/docs/13/WildFly_Elytron_Security.html","headline":"WildFly Elytron Security","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/wildflysite/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://jbossorg.github.io/wildflysite/feed.xml" title="Wildfly" /></head>
<body><div class="header navigation">
  <div class="logo-wrapper">
    <a href="/wildflysite/"><img class="wf-logo" src="/wildflysite/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/wildflysite/" class="">Home</a>
        </li>
        <li>
          <a href="/wildflysite/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/wildflysite/blog/" class="">Blog</a>
        </li>
        <li>
          <a href="/wildflysite/about/" class="">About</a>
        </li>
        <li>
          <a href="/wildflysite/contribute/" class="">Contribute</a>
        </li>
        <li>
          <a href="/wildflysite/docs/" class="">Docs</a>
        </li>
        <li>
          <a class="button-cta secondary" href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">WildFly Elytron Security Guide</div>
<ul class="sectlevel1">
<li><a href="#about">1. About</a>
<ul class="sectlevel2">
<li><a href="#elytron-authentication">1.1. Authentication</a></li>
<li><a href="#elytron-authorization">1.2. Authorization</a></li>
<li><a href="#ssl-tls">1.3. SSL / TLS</a></li>
<li><a href="#secure-credential-storage">1.4. Secure Credential Storage</a></li>
</ul>
</li>
<li><a href="#General_Elytron_Architecture">2. General Elytron Architecture</a>
<ul class="sectlevel2">
<li><a href="#security-domains">2.1. Security Domains</a></li>
<li><a href="#sasl-authentication">2.2. SASL Authentication</a></li>
<li><a href="#http-authentication">2.3. HTTP Authentication</a></li>
<li><a href="#ssl-tls">2.4. SSL / TLS</a></li>
</ul>
</li>
<li><a href="#Elytron_Subsystem">3. Elytron Subsystem</a>
<ul class="sectlevel2">
<li><a href="#get-started-using-the-elytron-subsystem">3.1. Get Started using the Elytron Subsystem</a></li>
<li><a href="#provided-components">3.2. Provided components</a></li>
<li><a href="#out-of-the-box-configuration">3.3. Out of the Box Configuration</a></li>
<li><a href="#default-application-authentication-configuration">3.4. Default Application Authentication Configuration</a></li>
<li><a href="#default-management-authentication-configuration">3.5. Default Management Authentication Configuration</a></li>
<li><a href="#comparing-legacy-approaches-to-elytron-approaches">3.6. Comparing Legacy Approaches to Elytron Approaches</a></li>
</ul>
</li>
<li><a href="#Using_the_Elytron_Subsystem">4. Using the Elytron Subsystem</a>
<ul class="sectlevel2">
<li><a href="#set-up-and-configure-authentication-for-applications">4.1. Set Up and Configure Authentication for Applications</a></li>
<li><a href="#set-up-and-configure-authentication-for-the-management-interfaces">4.2. Set up and Configure Authentication for the Management Interfaces</a></li>
<li><a href="#configure-ssltls">4.3. Configure SSL/TLS</a></li>
<li><a href="#configuring-the-elytron-and-security-subsystems">4.4. Configuring the Elytron and Security Subsystems</a></li>
<li><a href="#creating-elytron-subsystem-components">4.5. Creating Elytron Subsystem Components</a></li>
</ul>
</li>
<li><a href="#Using_WildFly_Elytron_with_WildFly">5. Using Elytron within WildFly</a>
<ul class="sectlevel2">
<li><a href="#using-the-out-of-the-box-elytron-components">5.1. Using the Out of the Box Elytron Components</a></li>
<li><a href="#undertow-subsystem">5.2. Undertow Subsystem</a></li>
<li><a href="#ejb-subsystem">5.3. EJB Subsystem</a></li>
<li><a href="#webservices-subsystem">5.4. WebServices Subsystem</a></li>
<li><a href="#legacy-security-subsystem">5.5. Legacy Security Subsystem</a></li>
</ul>
</li>
<li><a href="#Client_Authentication_with_Elytron_Client">6. Client Authentication with Elytron Client</a>
<ul class="sectlevel2">
<li><a href="#the-configuration-file-approach">6.1. The Configuration File Approach</a></li>
<li><a href="#the-programmatic-approach">6.2. The Programmatic Approach</a></li>
<li><a href="#the-default-configuration-approach">6.3. The Default Configuration Approach</a></li>
<li><a href="#using-elytron-client-with-clients-deployed-to-wildfly">6.4. Using Elytron Client with Clients Deployed to WildFly</a></li>
<li><a href="#Configuring_other_clients_using_wildfly-config">6.5. Client configuration using wildfly-config.xml</a></li>
</ul>
</li>
<li><a href="#Elytron_and_Java_Authorization_Contract_for_Containers-JACC">7. Elytron and Java Authorization Contract for Containers (JACC)</a>
<ul class="sectlevel2">
<li><a href="#disabling-jacc-in-legacy-security-subsystem-picketbox">7.1. Disabling JACC in Legacy Security Subsystem (PicketBox)</a></li>
<li><a href="#defining-a-jacc-policy-provider">7.2. Defining a JACC Policy Provider</a></li>
<li><a href="#enabling-jacc-to-a-web-deployment">7.3. Enabling JACC to a Web Deployment</a></li>
<li><a href="#enabling-jacc-to-a-ejb-deployment">7.4. Enabling JACC to a EJB Deployment</a></li>
</ul>
</li>
<li><a href="#KeyCloak_Integration">8. Using KeyCloak with WildFly Elytron</a></li>
<li><a href="#OpenSSL">9. OpenSSL</a></li>
<li><a href="#Web_Single_Sign_On">10. Web Single Sign-On</a>
<ul class="sectlevel2">
<li><a href="#create-a-server-configuration-template">10.1. Create a Server Configuration Template</a></li>
<li><a href="#create-two-server-instances">10.2. Create Two Server Instances</a></li>
<li><a href="#deploy-an-application">10.3. Deploy an Application</a></li>
</ul>
</li>
<li><a href="#Migrate_Legacy_Security_to_Elytron_Security">11. Migrate Legacy Security to Elytron Security</a>
<ul class="sectlevel2">
<li><a href="#authentication-configuration">11.1. Authentication Configuration</a></li>
<li><a href="#Properties_File_Based_Authentication_Migration">11.2. Properties Based Authentication / Authorization</a></li>
<li><a href="#LDAP_Based_Authentication_Migration">11.3. LDAP Authentication Migration</a></li>
<li><a href="#Composite_Stores_Migration">11.4. Composite Stores Migration</a></li>
<li><a href="#Database_Authentication_Migration">11.5. Database Authentication</a></li>
<li><a href="#Kerberos_Based_Authentication_Migration">11.6. Kerberos Authentication Migration</a></li>
<li><a href="#Caching_Migration">11.7. Caching Migration</a></li>
<li><a href="#clients">11.8. Clients</a></li>
<li><a href="#Application_Client_Migration">11.9. Application Client Migration</a></li>
<li><a href="#general-utilities">11.10. General Utilities</a></li>
<li><a href="#Security_Vault_Migration">11.11. Security Vault Migration</a></li>
<li><a href="#Security_Property_Migration">11.12. Security Properties</a></li>
<li><a href="#ssl-migration">11.13. SSL Migration</a></li>
<li><a href="#Simple_SSL_Migration">11.14. Simple SSL Migration</a></li>
<li><a href="#SSL_with_Client_Cert_Migration">11.15. SSL with Client Cert Migration</a></li>
<li><a href="#documentation-still-needed">11.16. Documentation Still Needed</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about">1. About</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The WildFly Elytron project is a new security framework brought to
WildFly to provide a single unified security framework across the whole
of the application server. As a single framework it will be usable both
for configuring management access to the server and for applications
deployed to the server, it will also be usable across all process types
so there will be no need to learn a different security framework for
host controllers in a domain compared to configuring a standalone
server.</p>
</div>
<div class="paragraph">
<p>The project covers these main areas: -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication</p>
</li>
<li>
<p>Authorization</p>
</li>
<li>
<p>SSL / TLS</p>
</li>
<li>
<p>Secure Credential Storage</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="elytron-authentication">1.1. Authentication</h3>
<div class="paragraph">
<p>One of the fundamental objectives of the project was to ensure that we
can use stronger authentication mechanisms for both HTTP and SASL based
authentication, in both cases the new framework also makes it possible
to bring in new implementations opening up various integration
opportunities with external solutions.</p>
</div>
</div>
<div class="sect2">
<h3 id="elytron-authorization">1.2. Authorization</h3>
<div class="paragraph">
<p>The architecture of the project makes a very clear distinction between
the raw representation of the identity as returned by a SecurityRealm
from the repository of identities and the final representation as a
SecurityIdentity after roles have been decoded and mapped and
permissions have been mapped.</p>
</div>
<div class="paragraph">
<p>Custom implementations of the components to perform role decoding and
mapping, and permission mapping can be provided allowing for further
flexibility beyond the default set of components provided by the
project.</p>
</div>
</div>
<div class="sect2">
<h3 id="ssl-tls">1.3. SSL / TLS</h3>
<div class="paragraph">
<p>The project becomes the centralised point within the application server
for configuring SSL related resources meaning they can be configured in
a central location and referenced by resources across the application
server. The centralised configuration also covers advanced options such
as configuration of enabled cipher suites and protocols without this
information needing to be distributed across the management model.</p>
</div>
<div class="paragraph">
<p>The SSL / TLS implementation also includes an optimisation where it can
be closely tied to authentication allowing for permissions checks to be
performed on establishment of a connection before the first request is
received and the eager construction of a SecurityIdentity eliminating
the need for it to be constructed on a per-request basis.</p>
</div>
</div>
<div class="sect2">
<h3 id="secure-credential-storage">1.4. Secure Credential Storage</h3>
<div class="paragraph">
<p>The previous vault used for plain text String encryption is replaced
with a newly designed credential store. in addition to the protection it
offers for the credentials stored within it, the store currently
supports storage of clear text credentials.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="General_Elytron_Architecture">2. General Elytron Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The overall architecture for WildFly Elytron is building up a full
security policy from assembling smaller components together, by default
we include various implementations of the components - in addition to
this, custom implementations of many components can be provided in order
to provide more specialised implementations.</p>
</div>
<div class="paragraph">
<p>Within WildFly the different Elytron components are handled as
capabilities meaning that different implementations can be mixed and
matched, however the different implementations are modelled using
distinct resources. This section contains a number of diagrams to show
the general relationships between different components to provide a high
level view, however the different resource definitions may use different
dependencies depending on their purpose.</p>
</div>
<div class="sect2">
<h3 id="security-domains">2.1. Security Domains</h3>
<div class="paragraph">
<p>Within WildFly Elytron a SecurityDomain can be considered as a security
policy backed by one or more SecurityRealm instances. Resources that
make authorization decisions will be associated with a SecurityDomain,
from the SecurityDomain a SecurityIdentity can be obtained which is a
representation of the current identity, from this the identities roles
and permissions can be checked to make the authorization decision for
the resource.</p>
</div>
<div class="paragraph">
<p>The SecurityDomain is the general wrapper around the policy describing a
resulting SecurityIdentity and makes use of the following components to
define this policy.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NameRewriter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>NameRewriters are used in multiple places within the Elytron
configuration, as their name implies, their purpose is to take a name
and map it to another representation of the name or perform some
normalisation or clean up of the name.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RealmMapper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a SecurityDomain is able to reference multiple SecurityRealms the
RealmMapper is responsible for identifying which SecurityRealm to use
based on the supplied name for authentication.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SecurityRealm</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One more more named SecurityRealms are associated with a SecurityDomain,
the SecurityRealms are the access to the underlying repository of
identities and are used for obtaining credentials to allow
authentication mechanisms to perform verification, for validation of
Evidence and for obtaining the raw AuthorizationIdentity performing the
authentication.</p>
</div>
<div class="paragraph">
<p>Some SecurityRealm implementations are also modifiable so expose an API
that allows for updates to be made to the repository containing the
identities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RoleDecoder</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Along with the SecurityRealm association is also a reference to a
RoleDecoder, the RoleDecoder takes the raw AuthorizationIdentity
returned from the SecurityRealm and converts it&#8217;s attributes into roles.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RoleMapper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the roles have been decoded for an identity further mapping can be
applied, this could be as simple at normalising the format of the names
through to adding or removing specific role names. If a RoleMapper is
referenced by the SecurityRealm association that RoleMapper is applied
first before applying the RoleMapper associated with the SecurityDomain.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PrincipalDecoder</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A PrincipalDecoder converts from a Principal to a String representation
of a name, one example for this is we have an X500PrincipalDecoder which
is able to extract an attribute from a distinguished name.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PermissionMapper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to having roles a SecurityIdentity can also have a set of
permissions, the PermissionMapper assigns those permissions to the
identity.</p>
</div>
<div class="paragraph">
<p>Different secured resources can be associated with different
SecurityDomains for their authorization decisions, within WildFly
Elytron we have the ability to configure inflow between different
SecurityDomains. The inflow process means that a SecurityIdentity
inflowed into a second SecurityDomain has the mappings of the new
SecurityDomain applied to it so although a common identity may be
calling different resources each of those resources could have a very
different view.</p>
</div>
</div>
<div class="sect2">
<h3 id="sasl-authentication">2.2. SASL Authentication</h3>
<div class="paragraph">
<p>The SaslAuthenticationFactory is an authentication policy for
authentication using SASL authentication mechanisms, in addition to
being a policy it is also a factory for configured authentication
mechanisms backed by a SecurityDomain.</p>
</div>
<div class="paragraph">
<p>The SaslAuthenticationFactory references the following: -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SecurityDomain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the security domain that any mechanism authentication will be
performed against.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SaslServerFactory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the general factory for server side SASL authentication
mechanisms.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MechanismConfigurationSelector</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional configuration can be supplied for the authentication
mechanisms, the configuration will be described in more detail later but
the purpose of the MechanismConfigurationSelector is to obtain
configuration specific to the mechanism selected. This can include
information about realm names a mechanism should present to a remote
client plus additional NameRewriters and RealmMappers to use during the
authentication process.</p>
</div>
<div class="paragraph">
<p>The reason some of the components referenced by the SecurityDomain are
duplicated is so that mechanism specific mappings can be applied.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-authentication">2.3. HTTP Authentication</h3>
<div class="paragraph">
<p>The HttpAuthenticationFactory is an authentication policy for
authentication using HTTP authentication mechanisms, in addition to
being a policy it is also a factory for configured authentication
mechanisms backed by a SecurityDomain.</p>
</div>
<div class="paragraph">
<p>The HttpAuthenticationFactory references the following: -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SecurityDomain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the security domain that any mechanism authentication will be
performed against.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HttpServerAuthenticationMechanismFactory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the general factory for server side HTTP authentication
mechanisms.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MechanismConfigurationSelector</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional configuration can be supplied for the authentication
mechanisms, the configuration will be described in more detail later but
the purpose of the MechanismConfigurationSelector is to obtain
configuration specific to the mechanism selected. This can include
information about realm names a mechanism should present to a remote
client plus additional NameRewriters and RealmMappers to use during the
authentication process.</p>
</div>
<div class="paragraph">
<p>The reason some of the components referenced by the SecurityDomain are
duplicated is so that mechanism specific mappings can be applied.</p>
</div>
</div>
<div class="sect2">
<h3 id="ssl-tls">2.4. SSL / TLS</h3>
<div class="paragraph">
<p>The SSLContext defined within Elytron is a javax.net.ssl.SSLContext
meaning it can be used by anything that uses an SSLContext directly.</p>
</div>
<div class="paragraph">
<p>In addition to the usual configuration for an SSLContext it is possible
to configure additional items such as cipher suites and protocols and
the SSLContext returned will wrap any engines created to set these
values.</p>
</div>
<div class="paragraph">
<p>The SSLContext within Elytron can also reference the following: -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KeyManagers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An array of KeyManager instances to be used by the SSLContext, this in
turn can reference a KeyStore to load the keys.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TrustManagers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An array of TrustManager instances to be used by the SSLContext, this in
turn can also reference a KeyStore to load the certificates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SecurityDomain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is optional, however if an SSLContext is configured to reference a
SecurityDomain then verification of a clients certificate can be
performed as an authentication ensuring the appropriate permissions to
Logon are assigned before even allowing the connection to be fully
opened, additionally the SecurityIdentity can be established at the time
the connection is opened and used for any invocations over the
connection.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Elytron_Subsystem">3. Elytron Subsystem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly Elytron is a security framework used to unify security across
the entire application server. The <em>elytron</em> subsystem enables a single
point of configuration for securing both applications and the management
interfaces. WildFly Elytron also provides a set of APIs and SPIs for
providing custom implementations of functionality and integrating with
the <em>elytron</em> subsystem.</p>
</div>
<div class="paragraph">
<p>In addition, there are several other important features of the WildFly
Elytron:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Stronger authentication mechanisms for HTTP and SASL authentication.</p>
</li>
<li>
<p>Improved architecture that allows for <em>SecurityIdentities</em> to be
propagated across security domains and transparently transformed ready
to be used for authorization. This transformation takes place using
configurable role decoders, role mappers, and permission mappers.</p>
</li>
<li>
<p>Centralized point for SSL/TLS configuration including cipher suites
and protocols.</p>
</li>
<li>
<p>SSL/TLS optimizations such as eager <em>SecureIdentity</em> construction and
closely tying authorization to establishing an SSL/TLS connection. Eager
<em>SecureIdentity</em> construction eliminates the need for a <em>SecureIdentity</em>
to be constructed on a per-request basis. Closely tying authentication
to establishing an SSL/TLS connection enables permission checks to
happen <em>BEFORE</em> the first request is received.</p>
</li>
<li>
<p>A secure credential store that replaces the previous vault
implementation to store clear text credentials.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The new <em>elytron</em> subsystem exists in parallel to the legacy <em>security</em>
subsystem and legacy core management authentication. Both the legacy and
Elytron methods may be used for securing the management interfaces as
well as providing security for applications.</p>
</div>
<div class="sect2">
<h3 id="get-started-using-the-elytron-subsystem">3.1. Get Started using the Elytron Subsystem</h3>
<div class="paragraph">
<p>To get started using Elytron, refer to these topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the default Elytron components for
<a href="#default-application-authentication-configuration">application</a>
and
<a href="#src-557147_ElytronSubsystem-use-default-elytron-mgmt-auth">management</a>
authentication</p>
</li>
<li>
<p>Secure an application with a new identity store stored in a
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureAuthenticationwithaFilesystem-BasedIdentityStore">filesystem</a>
or
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureAuthenticationwithaDatabaseIdentityStore">database</a>.</p>
</li>
<li>
<p>Set up one-way SSL/TLS for
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-one-way-apps">applications</a>
or the
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-one-way-mgmt">management
interfaces</a>.</p>
</li>
<li>
<p>Set up two-way SSL/TLS for
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-two-way-apps">applications</a>
or the
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-two-way-mgmt">management
interfaces</a>.</p>
</li>
<li>
<p><a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-CreateandUseaCredentialStore">Create
a credential store and use it with your SSL/TLS configuration</a>.</p>
</li>
<li>
<p><a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureAuthenticationwithCertificates">Use
certificate-based authentication with applications</a>.</p>
</li>
<li>
<p><a href="Using_the_Elytron_Subsystem.html#src-557140_safe-id-VXNpbmd0aGVFbHl0cm9uU3Vic3lzdGVtLU92ZXJyaWRlYW5BcHBsaWNhdGlvbidzQXV0aGVudGljYXRpb25Db25maWd1cmF0aW9u">Override
an application&#8217;s authentication configuration</a> with Elytron
authentication.</p>
</li>
<li>
<p><a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureAuthenticationwithaKerberos-BasedIdentityStore">Configure
Kerberos authentication for applications</a>.</p>
</li>
<li>
<p>Secure
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureAuthenticationwithanLDAP-BasedIdentityStore">applications</a>
and the
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-SecuretheManagementInterfaceswithaNewIdentityStore">management
interfaces</a> with an LDAP-based identity store.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="provided-components">3.2. Provided components</h3>
<div class="paragraph">
<p>Wildfly Elytron provides a default set of implementations in the
<em>elytron</em> subsystem.</p>
</div>
<div class="sect3">
<h4 id="factories">3.2.1. Factories</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-http-server-mechanism-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTTP server factory
definition where the HTTP server factory is an aggregation of other HTTP
server factories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-sasl-server-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory definition where
the SASL server factory is an aggregation of other SASL server
factories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configurable-http-server-mechanism-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory
definition where the SASL server factory is an aggregation of other SASL
server factories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configurable-sasl-server-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory definition
where the SASL server factory is an aggregation of other SASL server
factories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-credential-security-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom credential SecurityFactory
definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http-authentication-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource containing the association of a
security domain with a HttpServerAuthenticationMechanismFactory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kerberos-security-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security factory for obtaining a
GSSCredential for use during authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mechanism-provider-filtering-sasl-server-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory
definition that enables filtering by provider where the factory was
loaded using a provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">provider-http-server-mechanism-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTTP server factory
definition where the HTTP server factory is an aggregation of factories
from the provider list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">provider-sasl-server-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory definition where
the SASL server factory is an aggregation of factories from the provider
list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sasl-authentication-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource containing the association of a
security domain with a SaslServerFactory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-loader-http-server-mechanism-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTTP server factory
definition where the HTTP server factory is an aggregation of factories
identified using a ServiceLoader</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-loader-sasl-server-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory definition
where the SASL server factory is an aggregation of factories identified
using a ServiceLoader</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="principal-transformers">3.2.2. Principal Transformers</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A principal transformer definition
where the principal transformer is an aggregation of other principal
transformers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">chained-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A principal transformer definition where
the principal transformer is a chaining of other principal transformers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constant-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A principal transformer definition
where the principal transformer always returns the same constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom principal transformer
definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regex-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A regular expression based principal
transformer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regex-validating-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A regular expression based
principal transformer which uses the regular expression to validate the
name.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="principal-decoders">3.2.3. Principal Decoders</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-principal-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A principal decoder definition where the
principal decoder is an aggregation of other principal decoders.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concatenating-principal-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A principal decoder definition where
the principal decoder is a concatenation of other principal decoders.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constant-principal-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a principal decoder that
always returns the same constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-principal-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a custom principal decoder.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x500-attribute-principal-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a X500 attribute based
principal decoder.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="realm-mappers">3.2.4. Realm Mappers</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constant-realm-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a constant realm mapper that
always returns the same value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-realm-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a custom realm mapper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapped-regex-realm-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a realm mapper implementation
that first uses a regular expression to extract the realm name, this is
then converted using the configured mapping of realm names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple-regex-realm-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a simple realm mapper that
attempts to extract the realm name using the capture group from the
regular expression, if that does not provide a match then the delegate
realm mapper is used instead.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="realms">3.2.5. Realms</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A realm definition that is an aggregation of two
realms, one for the authentication steps and one for loading the
identity for the authorization steps.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">caching-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A realm definition that enables caching to another
security realm. Caching strategy is Least Recently Used where least
accessed entries are discarded when maximum number of entries is
reached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-modifiable-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom realm configured as being modifiable
will be expected to implement the ModifiableSecurityRealm interface. By
configuring a realm as being modifiable management operations will be
made available to manipulate the realm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom realm definitions can implement either the s
SecurityRealm interface or the ModifiableSecurityRealm interface.
Regardless of which interface is implemented management operations will
not be exposed to manage the realm. However other services that depend
on the realm will still be able to perform a type check and cast to gain
access to the modification API.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">filesystem-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A simple security realm definition backed by the
filesystem.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identity-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition where identities are
represented in the management model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition backed by database using JDBC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key-store-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition backed by a keystore.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition backed by LDAP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">properties-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition backed by properties
files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">token-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition capable of validating and
extracting identities from security tokens.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trust-managers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A trust manager definition for creating the
TrustManager list as used to create an SSL context.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="permission-mappers">3.2.6. Permission Mappers</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-permission-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a custom permission mapper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical-permission-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a logical permission mapper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple-permission-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a simple configured permission
mapper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constant-permission-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a permission mapper that
always returns the same constant.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="role-decoders">3.2.7. Role Decoders</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-role-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a custom RoleDecoder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple-role-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a simple RoleDecoder that takes a
single attribute and maps it directly to roles.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="role-mappers">3.2.8. Role Mappers</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">add-prefix-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role mapper definition for a role mapper that
adds a prefix to each provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">add-suffix-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role mapper definition for a role mapper that
adds a suffix to each provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constant-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role mapper definition where a constant set of
roles is always returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role mapper definition where the role mapper
is an aggregation of other role mappers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role mapper definition for a role mapper that
performs a logical operation using two referenced role mappers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a custom role mapper</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="ssl-components">3.2.9. SSL Components</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">client-ssl-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An SSLContext for use on the client side of a
connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">filtering-key-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A filtering keystore definition, which provides a
keystore by filtering a key-store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key-managers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A key manager definition for creating the key manager
list as used to create an SSL context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A keystore definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap-key-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An LDAP keystore definition, which loads a keystore
from an LDAP server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">server-ssl-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An SSL context for use on the server side of a
connection.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="other">3.2.10. Other</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-providers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An aggregation of two or more Provider[]
resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication-configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An individual authentication
configuration definition, which is used by clients deployed to Wildfly
and other resources for authenticating when making a remote connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An individual authentication context
definition, which is used to supply an ssl-context and
authentication-configuration when clients deployed to Wildfly and other
resources make a remoting connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">credential-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Credential store to keep alias for sensitive
information such as passwords for external services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dir-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The configuration to connect to a directory (LDAP) server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">provider-loader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A definition for a provider loader.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security-domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security domain definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security-property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A definition of a security property to be set.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="out-of-the-box-configuration">3.3. Out of the Box Configuration</h3>
<div class="paragraph">
<p>WildFly provides a set of components configured by default. While these
components are ready to use, the legacy <em>security</em> subsystem and legacy
core management authentication is still used by default. To configure
WildFly to use the these configured components as well as create new
ones, see the <a href="#Using_the_Elytron_Subsystem">Using the Elytron
Subsystem</a> section.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Default Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ApplicationDomain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ApplicationDomain security domain uses
ApplicationRealm and groups-to-roles for authentication. It also uses
default-permission-mapper to assign the login permission.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagementDomain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ManagementDomain security domain uses two
security realms for authentication: ManagementRealm with groups-to-roles
and local with super-user-mapper. It also uses default-permission-mapper
to assign the login permission.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">local (security realm)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The local security realm does no authentication
and sets the identity of principals to $local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ApplicationRealm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ApplicationRealm security realm is a properties
realm that authenticates principals using application-users.properties
and assigns roles using application-roles.properties. These files are
located under jboss.server.config.dir, which by default, maps to
EAP_HOME/standalone/configuration. They are also the same files used by
the legacy security default configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagementRealm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ManagementRealm security realm is a properties
realm that authenticates principals using mgmt-users.properties and
assigns roles using mgmt-groups.properties. These files are located
under jboss.server.config.dir, which by default, maps to
EAP_HOME/standalone/configuration. They are also the same files used by
the legacy security default configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default-permission-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default-permission-mapper mapper is a
simple permission mapper that uses the default-permissions permission set
to assign the full set of permissions that an identity would require to
access any services on the server. For example, the default-permission-mapper
mapper uses org.wildfly.extension.batch.jberet.deployment.BatchPermission
specified by the default-permissions permission set to assign permission for
batch jobs. The batch permissions are start, stop, restart, abandon, and read
which aligns with javax.batch.operations.JobOperator. The default-permission-mapper
mapper also uses org.wildfly.security.auth.permission.LoginPermission specified
by the the login-permission permission set to assign the login permission.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">local (mapper)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The local mapper is a constant role mapper that maps to
the local security realm. This is used to map authentication to the
local security realm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groups-to-roles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The groups-to-roles mapper is a simple-role-decoder
that will decode the groups information of a principal and use it for
the role information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">super-user-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The super-user-mapper mapper is a constant role
mapper that maps the SuperUser role to a principal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management-http-authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The management-http-authentication
http-authentication-factory can be used for doing authentication over
http. It uses the global provider-http-server-mechanism-factory to
filter authentication mechanism and uses ManagementDomain for
authenticating principals. It accepts the DIGEST authentication
mechanisms and exposes it as ManagementRealm to applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application-http-authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application-http-authentication
http-authentication-factory can be used for doing authentication over
http. It uses the global provider-http-server-mechanism-factory to
filter authentication mechanism and uses ApplicationDomain for
authenticating principals. It accepts BASIC and FORM authentication
mechanisms and exposes BASIC as Application Realm to applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">global (provider-http-server-mechanism-factory)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the HTTP
server factory mechanism definition used to list the provided
authentication mechanisms when creating an http authentication factory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management-sasl-authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The management-sasl-authentication
sasl-authentication-factory can be used for authentication using SASL.
It uses the configured sasl-server-factory to filter authentication
mechanisms, which also uses the global provider-sasl-server-factory to
filter by provider names. management-sasl-authentication uses the
ManagementDomain security domain for authentication of principals. It
also maps authentication using JBOSS-LOCAL-USER mechanisms using the
local realm mapper and authentication using DIGEST-MD5 to
ManagementRealm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application-sasl-authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application-sasl-authentication
sasl-authentication-factory can be used for authentication using SASL.
It uses the configured sasl-server-factory to filter authentication
mechanisms, which also uses the global provider-sasl-server-factory to
filter by provider names. application-sasl-authentication uses the
ApplicationDomain security domain for authentication of principals.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">global (provider-sasl-server-factory)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the SASL server factory
definition used to create SASL authentication factories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">elytron (mechanism-provider-filtering-sasl-server-factor)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is used
to filter which sasl-authentication-factory is used based on the
provider. In this case, elytron will match on the WildFlyElytron
provider name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configured (configurable-sasl-server-factory)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is used to filter
sasl-authentication-factory is used based on the mechanism name. In this
case, configured will match on JBOSS-LOCAL-USER and DIGEST-MD5. It also
sets the wildfly.sasl.local-user.default-user to $local.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">combined-providers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is an aggregate provider that aggreates the elytron
and openssl provider loaders.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">elytron</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A provider loader</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">openssl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A provider loader</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Default WildFly Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=elytron:read-resource(recursive=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "default-authentication-context" =&gt; undefined,
        "disallowed-providers" =&gt; ["OracleUcrypto"],
        "final-providers" =&gt; "combined-providers",
        "initial-providers" =&gt; undefined,
        "security-properties" =&gt; undefined,
        "add-prefix-role-mapper" =&gt; undefined,
        "add-suffix-role-mapper" =&gt; undefined,
        "aggregate-http-server-mechanism-factory" =&gt; undefined,
        "aggregate-principal-decoder" =&gt; undefined,
        "aggregate-principal-transformer" =&gt; undefined,
        "aggregate-providers" =&gt; {"combined-providers" =&gt; {"providers" =&gt; [
            "elytron",
            "openssl"
        ]}},
        "aggregate-realm" =&gt; undefined,
        "aggregate-role-mapper" =&gt; undefined,
        "aggregate-sasl-server-factory" =&gt; undefined,
        "aggregate-security-event-listener" =&gt; undefined,
        "authentication-configuration" =&gt; undefined,
        "authentication-context" =&gt; undefined,
        "caching-realm" =&gt; undefined,
        "chained-principal-transformer" =&gt; undefined,
        "client-ssl-context" =&gt; undefined,
        "concatenating-principal-decoder" =&gt; undefined,
        "configurable-http-server-mechanism-factory" =&gt; undefined,
        "configurable-sasl-server-factory" =&gt; {"configured" =&gt; {
            "filters" =&gt; undefined,
            "properties" =&gt; {"wildfly.sasl.local-user.default-user" =&gt; "$local"},
            "protocol" =&gt; undefined,
            "sasl-server-factory" =&gt; "elytron",
            "server-name" =&gt; undefined
        }},
        "constant-permission-mapper" =&gt; undefined,
        "constant-principal-decoder" =&gt; undefined,
        "constant-principal-transformer" =&gt; undefined,
        "constant-realm-mapper" =&gt; {"local" =&gt; {"realm-name" =&gt; "local"}},
        "constant-role-mapper" =&gt; {"super-user-mapper" =&gt; {"roles" =&gt; ["SuperUser"]}},
        "credential-store" =&gt; undefined,
        "custom-credential-security-factory" =&gt; undefined,
        "custom-modifiable-realm" =&gt; undefined,
        "custom-permission-mapper" =&gt; undefined,
        "custom-principal-decoder" =&gt; undefined,
        "custom-principal-transformer" =&gt; undefined,
        "custom-realm" =&gt; undefined,
        "custom-realm-mapper" =&gt; undefined,
        "custom-role-decoder" =&gt; undefined,
        "custom-role-mapper" =&gt; undefined,
        "dir-context" =&gt; undefined,
        "file-audit-log" =&gt; {"local-audit" =&gt; {
            "format" =&gt; "JSON",
            "path" =&gt; "audit.log",
            "relative-to" =&gt; "jboss.server.log.dir",
            "synchronized" =&gt; true
        }},
        "filesystem-realm" =&gt; undefined,
        "filtering-key-store" =&gt; undefined,
        "http-authentication-factory" =&gt; {
            "management-http-authentication" =&gt; {
                "http-server-mechanism-factory" =&gt; "global",
                "mechanism-configurations" =&gt; [{
                    "mechanism-name" =&gt; "DIGEST",
                    "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "ManagementRealm"}]
                }],
                "security-domain" =&gt; "ManagementDomain"
            },
            "application-http-authentication" =&gt; {
                "http-server-mechanism-factory" =&gt; "global",
                "mechanism-configurations" =&gt; [
                    {
                        "mechanism-name" =&gt; "BASIC",
                        "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "Application Realm"}]
                    },
                    {"mechanism-name" =&gt; "FORM"}
                ],
                "security-domain" =&gt; "ApplicationDomain"
            }
        },
        "identity-realm" =&gt; {"local" =&gt; {
            "attribute-name" =&gt; undefined,
            "attribute-values" =&gt; undefined,
            "identity" =&gt; "$local"
        }},
        "jdbc-realm" =&gt; undefined,
        "kerberos-security-factory" =&gt; undefined,
        "key-manager" =&gt; undefined,
        "key-store" =&gt; undefined,
        "key-store-realm" =&gt; undefined,
        "ldap-key-store" =&gt; undefined,
        "ldap-realm" =&gt; undefined,
        "logical-permission-mapper" =&gt; undefined,
        "logical-role-mapper" =&gt; undefined,
        "mapped-regex-realm-mapper" =&gt; undefined,
        "mechanism-provider-filtering-sasl-server-factory" =&gt; {"elytron" =&gt; {
            "enabling" =&gt; true,
            "filters" =&gt; [{"provider-name" =&gt; "WildFlyElytron"}],
            "sasl-server-factory" =&gt; "global"
        }},
        "periodic-rotating-file-audit-log" =&gt; undefined,
        "permission-set" =&gt; {
            "login-permission" =&gt; {"permissions" =&gt; [{"class-name" =&gt; "org.wildfly.security.auth.permission.LoginPermission"}]},
            "default-permissions" =&gt; {"permissions" =&gt; [
                {
                    "class-name" =&gt; "org.wildfly.extension.batch.jberet.deployment.BatchPermission",
                    "module" =&gt; "org.wildfly.extension.batch.jberet",
                    "target-name" =&gt; "*"
                },
                {
                    "class-name" =&gt; "org.wildfly.transaction.client.RemoteTransactionPermission",
                    "module" =&gt; "org.wildfly.transaction.client"
                },
                {
                    "class-name" =&gt; "org.jboss.ejb.client.RemoteEJBPermission",
                    "module" =&gt; "org.jboss.ejb-client"
                }
            ]}
        },
        "policy" =&gt; undefined,
        "properties-realm" =&gt; {
            "ApplicationRealm" =&gt; {
                "groups-attribute" =&gt; "groups",
                "groups-properties" =&gt; {
                    "path" =&gt; "application-roles.properties",
                    "relative-to" =&gt; "jboss.server.config.dir"
                },
                "users-properties" =&gt; {
                    "path" =&gt; "application-users.properties",
                    "relative-to" =&gt; "jboss.server.config.dir",
                    "digest-realm-name" =&gt; "ApplicationRealm"
                }
            },
            "ManagementRealm" =&gt; {
                "groups-attribute" =&gt; "groups",
                "groups-properties" =&gt; {
                    "path" =&gt; "mgmt-groups.properties",
                    "relative-to" =&gt; "jboss.server.config.dir"
                },
                "users-properties" =&gt; {
                    "path" =&gt; "mgmt-users.properties",
                    "relative-to" =&gt; "jboss.server.config.dir",
                    "digest-realm-name" =&gt; "ManagementRealm"
                }
            }
        },
        "provider-http-server-mechanism-factory" =&gt; {"global" =&gt; {"providers" =&gt; undefined}},
        "provider-loader" =&gt; {
            "elytron" =&gt; {
                "argument" =&gt; undefined,
                "class-names" =&gt; undefined,
                "configuration" =&gt; undefined,
                "module" =&gt; "org.wildfly.security.elytron",
                "path" =&gt; undefined,
                "relative-to" =&gt; undefined
            },
            "openssl" =&gt; {
                "argument" =&gt; undefined,
                "class-names" =&gt; undefined,
                "configuration" =&gt; undefined,
                "module" =&gt; "org.wildfly.openssl",
                "path" =&gt; undefined,
                "relative-to" =&gt; undefined
            }
        },
        "provider-sasl-server-factory" =&gt; {"global" =&gt; {"providers" =&gt; undefined}},
        "regex-principal-transformer" =&gt; undefined,
        "regex-validating-principal-transformer" =&gt; undefined,
        "sasl-authentication-factory" =&gt; {
            "management-sasl-authentication" =&gt; {
                "mechanism-configurations" =&gt; [
                    {
                        "mechanism-name" =&gt; "JBOSS-LOCAL-USER",
                        "realm-mapper" =&gt; "local"
                    },
                    {
                        "mechanism-name" =&gt; "DIGEST-MD5",
                        "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "ManagementRealm"}]
                    }
                ],
                "sasl-server-factory" =&gt; "configured",
                "security-domain" =&gt; "ManagementDomain"
            },
            "application-sasl-authentication" =&gt; {
                "mechanism-configurations" =&gt; [
                    {
                        "mechanism-name" =&gt; "JBOSS-LOCAL-USER",
                        "realm-mapper" =&gt; "local"
                    },
                    {
                        "mechanism-name" =&gt; "DIGEST-MD5",
                        "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "ApplicationRealm"}]
                    }
                ],
                "sasl-server-factory" =&gt; "configured",
                "security-domain" =&gt; "ApplicationDomain"
            }
        },
        "security-domain" =&gt; {
            "ApplicationDomain" =&gt; {
                "default-realm" =&gt; "ApplicationRealm",
                "outflow-anonymous" =&gt; false,
                "outflow-security-domains" =&gt; undefined,
                "permission-mapper" =&gt; "default-permission-mapper",
                "post-realm-principal-transformer" =&gt; undefined,
                "pre-realm-principal-transformer" =&gt; undefined,
                "principal-decoder" =&gt; undefined,
                "realm-mapper" =&gt; undefined,
                "realms" =&gt; [
                    {
                        "realm" =&gt; "ApplicationRealm",
                        "role-decoder" =&gt; "groups-to-roles"
                    },
                    {"realm" =&gt; "local"}
                ],
                "role-mapper" =&gt; undefined,
                "security-event-listener" =&gt; undefined,
                "trusted-security-domains" =&gt; undefined
            },
            "ManagementDomain" =&gt; {
                "default-realm" =&gt; "ManagementRealm",
                "outflow-anonymous" =&gt; false,
                "outflow-security-domains" =&gt; undefined,
                "permission-mapper" =&gt; "default-permission-mapper",
                "post-realm-principal-transformer" =&gt; undefined,
                "pre-realm-principal-transformer" =&gt; undefined,
                "principal-decoder" =&gt; undefined,
                "realm-mapper" =&gt; undefined,
                "realms" =&gt; [
                    {
                        "realm" =&gt; "ManagementRealm",
                        "role-decoder" =&gt; "groups-to-roles"
                    },
                    {
                        "realm" =&gt; "local",
                        "role-mapper" =&gt; "super-user-mapper"
                    }
                ],
                "role-mapper" =&gt; undefined,
                "security-event-listener" =&gt; undefined,
                "trusted-security-domains" =&gt; undefined
            }
        },
        "server-ssl-context" =&gt; undefined,
        "service-loader-http-server-mechanism-factory" =&gt; undefined,
        "service-loader-sasl-server-factory" =&gt; undefined,
        "simple-permission-mapper" =&gt; {"default-permission-mapper" =&gt; {
            "mapping-mode" =&gt; "first",
            "permission-mappings" =&gt; [
                {
                    "principals" =&gt; ["anonymous"],
                    "permission-sets" =&gt; [{"permission-set" =&gt; "default-permissions"}]
                },
                {
                    "match-all" =&gt; true,
                    "permission-sets" =&gt; [
                        {"permission-set" =&gt; "login-permission"},
                        {"permission-set" =&gt; "default-permissions"}
                    ]
                }
            ]
        }},
        "simple-regex-realm-mapper" =&gt; undefined,
        "simple-role-decoder" =&gt; {"groups-to-roles" =&gt; {"attribute" =&gt; "groups"}},
        "size-rotating-file-audit-log" =&gt; undefined,
        "syslog-audit-log" =&gt; undefined,
        "token-realm" =&gt; undefined,
        "trust-manager" =&gt; undefined,
        "x500-attribute-principal-decoder" =&gt; undefined
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="default-application-authentication-configuration">3.4. Default Application Authentication Configuration</h3>
<div class="paragraph">
<p>By default, applications are secured using legacy security domains.
Applications must specify a security domain in their <em>web.xml</em> as well
as the authentication method. If no security domain is specified by the
application, WildFly will use the provided <em>other</em> legacy security
domain.</p>
</div>
<div class="sect3">
<h4 id="update-wildfly-to-use-the-default-elytron-components-for-application-authentication">3.4.1. Update WildFly to Use the Default Elytron Components for Application</h4>
<div class="paragraph">
<p>Authentication</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=application-http-authentication)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="default-elytron-application-http-authentication-configuration">3.4.2. Default Elytron Application HTTP Authentication Configuration</h4>
<div class="paragraph">
<p>By default, the <em>application-http-authentication</em>
http-authentication-factory is provided for application http
authentication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/http-authentication-factory=application-http-authentication:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "http-server-mechanism-factory" =&gt; "global",
        "mechanism-configurations" =&gt; [
            {
                "mechanism-name" =&gt; "BASIC",
                "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "Application Realm"}]
            },
            {"mechanism-name" =&gt; "FORM"}
        ],
        "security-domain" =&gt; "ApplicationDomain"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>application-http-authentication</em> http-authentication-factory is
configured to use the <em>ApplicationDomain</em> security domain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/security-domain=ApplicationDomain:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "default-realm" =&gt; "ApplicationRealm",
        "permission-mapper" =&gt; "default-permission-mapper",
        "post-realm-principal-transformer" =&gt; undefined,
        "pre-realm-principal-transformer" =&gt; undefined,
        "principal-decoder" =&gt; undefined,
        "realm-mapper" =&gt; undefined,
        "realms" =&gt; [{
            "realm" =&gt; "ApplicationRealm",
            "role-decoder" =&gt; "groups-to-roles"
        }],
        "role-mapper" =&gt; undefined,
        "trusted-security-domains" =&gt; undefined
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>ApplicationDomain</em> security domain is backed by the
<em>ApplicationRealm</em> Elytron security realm, which is a properties-based
realm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/properties-realm=ApplicationRealm:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "groups-attribute" =&gt; "groups",
        "groups-properties" =&gt; {
            "path" =&gt; "application-roles.properties",
            "relative-to" =&gt; "jboss.server.config.dir"
        },
        "users-properties" =&gt; {
            "path" =&gt; "application-users.properties",
            "relative-to" =&gt; "jboss.server.config.dir",
            "digest-realm-name" =&gt; "ApplicationRealm"
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="default-management-authentication-configuration">3.5. Default Management Authentication Configuration</h3>
<div class="paragraph">
<p>By default, the WildFly management interfaces are secured by the legacy
core management authentication.</p>
</div>
<div class="paragraph">
<p><strong>Default Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/core-service=management/management-interface=http-interface:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "allowed-origins" =&gt; undefined,
        "console-enabled" =&gt; true,
        "http-authentication-factory" =&gt; undefined,
        "http-upgrade" =&gt; {"enabled" =&gt; true},
        "http-upgrade-enabled" =&gt; true,
        "sasl-protocol" =&gt; "remote",
        "secure-socket-binding" =&gt; undefined,
        "security-realm" =&gt; "ManagementRealm",
        "server-name" =&gt; undefined,
        "socket-binding" =&gt; "management-http",
        "ssl-context" =&gt; undefined
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>WildFly does provide <em>management-http-authentication</em> and
<em>management-sasl-authentication</em> in the <em>elytron</em> subsystem for securing
the management interfaces as well.</p>
</div>
<div class="sect3">
<h4 id="update-wildfly-to-use-the-default-elytron-components-for-management-authentication">3.5.1. Update WildFly to Use the Default Elytron Components for Management</h4>
<div class="paragraph">
<p>Authentication</p>
</div>
<div class="sect4">
<h5 id="set-http-authentication-factory-to-use-management-http-authentication">Set http-authentication-factory to use</h5>
<div class="paragraph">
<p>management-http-authentication</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/core-service=management/management-interface=http-interface:write-attribute( \
  name=http-authentication-factory, \
  value=management-http-authentication \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="set-sasl-authentication-factory-to-use-management-sasl-authentication">Set sasl-authentication-factory to use</h5>
<div class="paragraph">
<p>management-sasl-authentication</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/core-service=management/management-interface=http-interface:write-attribute( \
  name=http-upgrade.sasl-authentication-factory, \
  value=management-sasl-authentication \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="undefine-security-realm">Undefine security-realm</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/core-service=management/management-interface=http-interface:undefine-attribute(name=security-realm)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reload-wildfly-for-the-changes-to-take-affect.">Reload WildFly for the changes to take affect.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>The management interfaces are now secured using the default components
provided by the 'elytron' subsystem.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="default-elytron-management-http-authentication-configuration">3.5.2. Default Elytron Management HTTP Authentication Configuration</h4>
<div class="paragraph">
<p>When you access the management interface over HTTP, for example when
using the web-based management console, WildFly will use the
<em>management-http-authentication</em> http-authentication-factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/http-authentication-factory=management-http-authentication:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "http-server-mechanism-factory" =&gt; "global",
        "mechanism-configurations" =&gt; [{
            "mechanism-name" =&gt; "DIGEST",
            "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "ManagementRealm"}]
        }],
        "security-domain" =&gt; "ManagementDomain"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>management-http-authentication</em> http-authentication-factory, is
configured to use the <em>ManagementDomain</em> security domain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/security-domain=ManagementDomain:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "default-realm" =&gt; "ManagementRealm",
        "permission-mapper" =&gt; "default-permission-mapper",
        "post-realm-principal-transformer" =&gt; undefined,
        "pre-realm-principal-transformer" =&gt; undefined,
        "principal-decoder" =&gt; undefined,
        "realm-mapper" =&gt; undefined,
        "realms" =&gt; [
            {
                "realm" =&gt; "ManagementRealm",
                "role-decoder" =&gt; "groups-to-roles"
            },
            {
                "realm" =&gt; "local",
                "role-mapper" =&gt; "super-user-mapper"
            }
        ],
        "role-mapper" =&gt; undefined,
        "trusted-security-domains" =&gt; undefined
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>ManagementDomain</em> security domain is backed by the
<em>ManagementRealm</em> Elytron security realm, which is a properties-based
realm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/properties-realm=ManagementRealm:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "groups-attribute" =&gt; "groups",
        "groups-properties" =&gt; {
            "path" =&gt; "mgmt-groups.properties",
            "relative-to" =&gt; "jboss.server.config.dir"
        },
        "plain-text" =&gt; false,
        "users-properties" =&gt; {
            "path" =&gt; "mgmt-users.properties",
            "relative-to" =&gt; "jboss.server.config.dir"
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="default-elytron-management-cli-authentication">3.5.3. Default Elytron Management CLI Authentication</h4>
<div class="paragraph">
<p>By default, the management CLI ( <em>jboss-cli.sh</em>) is configured to
connect over <em>remotehttp</em>.</p>
</div>
<div class="paragraph">
<p><strong>Default jboss-cli.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;jboss-cli xmlns="urn:jboss:cli:3.1"&gt;
 
    &lt;default-protocol use-legacy-override="true"&gt;remotehttp&lt;/default-protocol&gt;
 
    &lt;!-- The default controller to connect to when 'connect' command is executed w/o arguments --&gt;
    &lt;default-controller&gt;
        &lt;protocol&gt;remotehttp&lt;/protocol&gt;
        &lt;host&gt;localhost&lt;/host&gt;
        &lt;port&gt;9990&lt;/port&gt;
    &lt;/default-controller&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will establish a connection over HTTP and use HTTP upgrade to
change the communication protocol to <em>native</em>. The HTTP upgrade
connection is secured in the <em>http-upgrade</em> section of the
<em>http-interface</em> using a <em>sasl-authentication-factory</em>.</p>
</div>
<div class="paragraph">
<p><strong>Example Configuration with Default Components</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/core-service=management/management-interface=http-interface:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "allowed-origins" =&gt; undefined,
        "console-enabled" =&gt; true,
        "http-authentication-factory" =&gt; "management-http-authentication",
        "http-upgrade" =&gt; {
            "enabled" =&gt; true,
            "sasl-authentication-factory" =&gt; "management-sasl-authentication"
        },
        "http-upgrade-enabled" =&gt; true,
        "sasl-protocol" =&gt; "remote",
        "secure-socket-binding" =&gt; undefined,
        "security-realm" =&gt; undefined,
        "server-name" =&gt; undefined,
        "socket-binding" =&gt; "management-http",
        "ssl-context" =&gt; undefined
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default sasl-authentication-factory is
<em>management-sasl-authentication</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/sasl-authentication-factory=management-sasl-authentication:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "mechanism-configurations" =&gt; [
            {
                "mechanism-name" =&gt; "JBOSS-LOCAL-USER",
                "realm-mapper" =&gt; "local"
            },
            {
                "mechanism-name" =&gt; "DIGEST-MD5",
                "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "ManagementRealm"}]
            }
        ],
        "sasl-server-factory" =&gt; "configured",
        "security-domain" =&gt; "ManagementDomain"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>management-sasl-authentication</em> sasl-authentication-factory
specifies <em>JBOSS-LOCAL-USER</em> and <em>DIGEST-MD5</em> mechanisms.</p>
</div>
<div class="paragraph">
<p><strong>JBOSS-LOCAL-USER Realm</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/identity-realm=local:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "attribute-name" =&gt; undefined,
        "attribute-values" =&gt; undefined,
        "identity" =&gt; "$local"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>local</em> Elytron security realm is for handling silent authentication
for local users.</p>
</div>
<div class="paragraph">
<p>The <em>ManagementRealm</em> Elytron security realm is the same realm used in
the <em>management-http-authentication</em> http-authentication-factory.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="comparing-legacy-approaches-to-elytron-approaches">3.6. Comparing Legacy Approaches to Elytron Approaches</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy Approach</th>
<th class="tableblock halign-left valign-top">Elytron Approach</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UsersRoles Login Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication with a Properties
File-Based Identity Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database Login Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication with a Database
Identity Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ldap, LdapExtended, AdvancedLdap, AdvancedADLdap Login Modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication with an LDAP-Based Identity Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate, Certificate Roles Login Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication
with Certificates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos, SPNEGO Login Modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication with a
Kerberos-Based Identity Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos, SPNEGO Login Modules with Fallback</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication
with a Form as a Fallback for Kerberos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create and Use a Credential Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy Security Realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure the Management Interfaces with a New
Identity Store, Silent Authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RBAC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using RBAC with Elytron</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy Security Realms for One-way and Two-way SSL/TLS for Applications</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable One-way SSL/TLS for Applications, Enable Two-way SSL/TLS in
WildFly for Applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy Security Realms for One-way and Two-way SSL/TLS for Management
Interfaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable One-way for the Management Interfaces Using the
Elytron Subsystem, Enable Two-way SSL/TLS for the Management Interfaces
using the Elytron Subsystem</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Using_the_Elytron_Subsystem">4. Using the Elytron Subsystem</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="set-up-and-configure-authentication-for-applications">4.1. Set Up and Configure Authentication for Applications</h3>
<div class="sect3">
<h4 id="configure-authentication-with-a-properties-file-based-identity-store">4.1.1. Configure Authentication with a Properties File-Based Identity Store</h4>
<div class="sect4">
<h5 id="create-properties-files">Create properties files:</h5>
<div class="paragraph">
<p>You need to create two properties files: one that maps user to passwords
and another that maps users to roles. Usually these files are located in
the <em>jboss.server.config.dir</em> directory and follow the naming convention
<em>*-users.properties</em> and <em>*-roles.properties</em>, but other locations and
names may be used. The <em>*-users.properties</em> file must also contain a
reference to the <em>properties-realm</em>, which you will create in the next
step: <em>#$REALM_NAME=YOUR_PROPERTIES_REALM_NAME$</em></p>
</div>
<div class="paragraph">
<p><strong>Example user to password file: example-users.properties</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>#$REALM_NAME=examplePropRealm$
user1=password123
user2=password123</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example user to roles file: example-roles.properties</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>user1=Admin
user2=Guest</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-properties-realm-in-wildfly">Configure a properties-realm in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/properties-realm=examplePropRealm:add(groups-attribute=groups,groups-properties={path=example-roles.properties,relative-to=jboss.server.config.dir},users-properties={path=example-users.properties,relative-to=jboss.server.config.dir,plain-text=true})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the <em>properties-realm</em> is <em>examplePropRealm</em>, which is used
in the previous step in the <em>example-users.properties</em> file. Also, if
your properties files are located outside of <em>jboss.server.config.dir</em>,
then you need to change the <em>path</em> and <em>relative-to</em> values
appropriately.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain">Configure a security-domain:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/security-domain=exampleSD:add(realms=[{realm=examplePropRealm,role-decoder=groups-to-roles}],default-realm=examplePropRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory">Configure an http-authentication-factory:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=BASIC,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem">Configure an application-security-domain in the Undertow subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-and-jboss-web.xml.">Configure your application&#8217;s web.xml and jboss-web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-a-filesystem-based-identity-store">4.1.2. Configure Authentication with a Filesystem-Based Identity Store</h4>
<div class="sect4">
<h5 id="chose-a-directory-for-users">Chose a directory for users:</h5>
<div class="paragraph">
<p>You need a directory where your users will be stored. In this example,
we are using a directory called <em>fs-realm-users</em> located in
<em>jboss.server.config.dir</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-filesystem-realm-in-wildfly">Configure a filesystem-realm in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/filesystem-realm=exampleFsRealm:add(path=fs-realm-users,relative-to=jboss.server.config.dir)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your directory is located outside of <em>jboss.server.config.dir</em>, then
you need to change the <em>path</em> and <em>relative-to</em> values appropriately.</p>
</div>
</div>
<div class="sect4">
<h5 id="add-a-user">Add a user:</h5>
<div class="paragraph">
<p>When using the <em>filesystem-realm</em>, you can add users using the
management CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=user1:add()
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=user1:set-password( clear={password="password123"})
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=user1:add-attribute(name=Roles, value=["Admin","Guest"])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-a-simple-role-decoder">Add a simple-role-decoder:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <em>simple-role-decoder</em> decodes a principal&#8217;s roles from the <em>Roles</em>
attribute. You can change this value if your roles are in a different
attribute.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain-1">Configure a security-domain:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/security-domain=exampleFsSD:add(realms=[{realm=exampleFsRealm,role-decoder=from-roles-attribute}],default-realm=exampleFsRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory-1">Configure an http-authentication-factory:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-fs-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleFsSD,mechanism-configurations=[{mechanism-name=BASIC,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem-1">Configure an application-security-domain in the Undertow subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-fs-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-and-jboss-web.xml.-1">Configure your application&#8217;s web.xml and jboss-web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p>Your application is now using a filesystem-based identity store for
authentication.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-a-database-identity-store">4.1.3. Configure Authentication with a Database Identity Store</h4>
<div class="sect4">
<h5 id="determine-your-database-format-for-usernames-passwords-and-roles">Determine your database format for usernames, passwords, and roles:</h5>
<div class="paragraph">
<p>To set up authentication using a database for an identity store, you
need to determine how your usernames, passwords, and roles are stored in
that database. In this example, we are using a single table with the
following sample data:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">username</th>
<th class="tableblock halign-left valign-top">password</th>
<th class="tableblock halign-left valign-top">roles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guest</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="configure-a-datasource">Configure a datasource:</h5>
<div class="paragraph">
<p>To connect to a database from WildFly, you must have the appropriate
database driver deployed as well as a datasource configured. This
example shows deploying the driver for postgres and configuring a
datasource in WildFly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">deploy /path/to/postgresql-9.4.1210.jar
 
data-source add --name=examplePostgresDS --jndi-name=java:jboss/examplePostgresDS --driver-name=postgresql-9.4.1210.jar  --connection-url=jdbc:postgresql://localhost:5432/postgresdb --user-name=postgresAdmin --password=mysecretpassword</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-jdbc-realm-in-wildfly">Configure a jdbc-realm in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/jdbc-realm=exampleDbRealm:add(principal-query=[{sql="SELECT password,roles FROM wildfly_users WHERE username=?",data-source=examplePostgresDS,clear-password-mapper={password-index=1},attribute-mapping=[{index=2,to=groups}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> The above example shows how to obtain passwords and roles from a
single <em>principal-query</em>. You can also create additional
<em>principal-query</em> with <em>attribute-mapping</em> attributes if you require
multiple queries to obtain roles or additional authentication or
authorization information.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain-2">Configure a security-domain:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/security-domain=exampleDbSD:add(realms=[{realm=exampleDbRealm,role-decoder=groups-to-roles}],default-realm=exampleDbRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory-2">Configure an http-authentication-factory:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-db-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleDbSD,mechanism-configurations=[{mechanism-name=BASIC,mechanism-realm-configurations=[{realm-name=exampleDbSD}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem-2">Configure an application-security-domain in the Undertow subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-db-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-and-jboss-web.xml.-2">Configure your application&#8217;s web.xml and jboss-web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-an-ldap-based-identity-store">4.1.4. Configure Authentication with an LDAP-Based Identity Store</h4>
<div class="sect4">
<h5 id="determine-your-ldap-format-for-usernames-passwords-and-roles">Determine your LDAP format for usernames, passwords, and roles:</h5>
<div class="paragraph">
<p>To set up authentication using an LDAP server for an identity store, you
need to determine how your usernames, passwords, and roles are stored.
In this example, we are using the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dn: dc=wildfly,dc=org
dc: wildfly
objectClass: top
objectClass: domain
 
dn: ou=Users,dc=wildfly,dc=org
objectClass: organizationalUnit
objectClass: top
ou: Users
 
dn: uid=jsmith,ou=Users,dc=wildfly,dc=org
objectClass: top
objectClass: person
objectClass: inetOrgPerson
cn: John Smith
sn: smith
uid: jsmith
userPassword: password123
 
dn: ou=Roles,dc=wildfly,dc=org
objectclass: top
objectclass: organizationalUnit
ou: Roles
 
dn: cn=Admin,ou=Roles,dc=wildfly,dc=org
objectClass: top
objectClass: groupOfNames
cn: Admin
member: uid=jsmith,ou=Users,dc=wildfly,dc=org</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-dir-context">Configure a dir-context:</h5>
<div class="paragraph">
<p>To connect to the LDAP server from WildFly, you need to configure a
<em>dir-context</em> that provides the URL as well as the principal used to
connect to the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/dir-context=exampleDC:add(url="ldap://127.0.0.1:10389",principal="uid=admin,ou=system",credential-reference={clear-text="secret"})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-ldap-realm-in-wildfly">Configure an ldap-realm in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/ldap-realm=exampleLR:add(dir-context=exampleDC,identity-mapping={search-base-dn="ou=Users,dc=wildfly,dc=org",rdn-identifier="uid",user-password-mapper={from="userPassword"},attribute-mapping=[{filter-base-dn="ou=Roles,dc=wildfly,dc=org",filter="(&amp;(objectClass=groupOfNames)(member={1}))",from="cn",to="Roles"}]})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-a-simple-role-decoder-1">Add a simple-role-decoder:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain-3">Configure a security-domain:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/security-domain=exampleLdapSD:add(realms=[{realm=exampleLR,role-decoder=from-roles-attribute}],default-realm=exampleLR,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory-3">Configure an http-authentication-factory:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-ldap-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleLdapSD,mechanism-configurations=[{mechanism-name=BASIC,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem-3">Configure an application-security-domain in the Undertow subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-ldap-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-and-jboss-web.xml.-3">Configure your application&#8217;s web.xml and jboss-web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> In cases where you configure an LDAP server in the
<em>elytron</em> subsystem for authentication and that LDAP server then becomes
unreachable, WildFly will return a <em>500</em>, or internal server error,
error code when attempting authentication using that unreachable LDAP
server. This behavior differs from the legacy <em>security</em> subsystem,
which will return a <em>401</em>, or unauthorized, error code under the same
conditions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-certificates">4.1.5. Configure Authentication with Certificates</h4>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> Before you can set up certificate-based authentication, you
must have two-way SSL configured.</p>
</div>
<div class="sect4">
<h5 id="configure-a-key-store-realm.">Configure a key-store-realm.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store-realm=ksRealm:add(key-store=twoWayTS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must configure this realm with a truststore that contains the
client&#8217;s certificate. The authentication process uses the same
certificate presented by the client during the two-way SSL handshake.</p>
</div>
</div>
<div class="sect4">
<h5 id="create-a-decoder.">Create a Decoder.</h5>
<div class="paragraph">
<p>You need to create a <em>x500-attribute-principal-decoder</em> to decode the
principal you get from your certificate. The below example will decode
the principal based on the first <em>CN</em> value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/x500-attribute-principal-decoder=CNDecoder:add(oid="2.5.4.3",maximum-segments=1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, if the full <em>DN</em> was
<em>CN=client,CN=client-certificate,DC=example,DC=jboss,DC=org</em>,
<em>CNDecoder</em> would decode the principal as <em>client</em>. This decoded
principal is used as the <em>alias</em> value to lookup a certificate in the
truststore configured in <em>ksRealm</em>.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> The decoded principal * <strong>MUST</strong>* must be the <em>alias</em> value
you set in your server&#8217;s truststore for the client&#8217;s certificate.</p>
</div>
</div>
<div class="sect4">
<h5 id="add-a-constant-role-mapper-for-assigning-roles.">Add a constant-role-mapper for assigning roles.</h5>
<div class="paragraph">
<p>This is example uses a <em>constant-role-mapper</em> to assign roles to a
principal from <em>ksRealm</em> but other approaches may also be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/constant-role-mapper=constantClientCertRole:add(roles=[Admin,Guest])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain.">Configure a security-domain.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/security-domain=exampleCertSD:add(realms=[{realm=ksRealm}],default-realm=ksRealm,permission-mapper=default-permission-mapper,principal-decoder=CNDecoder,role-mapper=constantClientCertRole)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory.">Configure an http-authentication-factory.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/http-authentication-factory=exampleCertHttpAuth:add(http-server-mechanism-factory=global,security-domain=exampleCertSD,mechanism-configurations=[{mechanism-name=CLIENT_CERT,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem.">Configure an application-security-domain in the Undertow subsystem.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=exampleCertHttpAuth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="update-server-ssl-context.">Update server-ssl-context.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/server-ssl-context=twoWaySSC:write-attribute(name=security-domain,value=exampleCertSD)
/subsystem=elytron/server-ssl-context=twoWaySSC:write-attribute(name=authentication-optional, value=true)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-and-jboss-web.xml.-4">Configure your application&#8217;s web.xml and jboss-web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p>In addition, you need to update your <em>web.xml</em> to use <em>CLIENT-CERT</em> as
its authentication method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;login-config&gt;
  &lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt;
  &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
&lt;/login-config&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-a-kerberos-based-identity-store">4.1.6. Configure Authentication with a Kerberos-Based Identity Store</h4>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: The following steps assume you have a working KDC and
Kerberos domain as well as your client browsers configured.</p>
</div>
<div class="sect4">
<h5 id="configure-a-kerberos-security-factory.">Configure a kerberos-security-factory.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/kerberos-security-factory=krbSF:add(principal="HTTP/host@REALM",path="/path/to/http.keytab",mechanism-oids=[1.2.840.113554.1.2.2,1.3.6.1.5.5.2])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-the-system-properties-for-kerberos.">Configure the system properties for Kerberos.</h5>
<div class="paragraph">
<p>Depending on how your environment is configured, you will need to set
some of the system properties below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.security.krb5.kdc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host name of the KDC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.security.krb5.realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the realm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.security.krb5.conf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to the configuration krb5.conf file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sun.security.krb5.debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, debugging mode will be enabled.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To configure a system property in WildFly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/system-property=java.security.krb5.conf:add(value="/path/to/krb5.conf")</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-eltyron-security-realm-for-assigning-roles.">Configure an Eltyron security realm for assigning roles.</h5>
<div class="paragraph">
<p>The the client&#8217;s Kerberos token will provide the principal, but you need
a way to map that principal to a role for your application. There are
several ways to accomplish this, but this example creates a
<em>filesystem-realm</em>, adds a user to the realm that matches the principal
from the Kerberos token, and assigns roles to that user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/filesystem-realm=exampleFsRealm:add(path=fs-realm-users,relative-to=jboss.server.config.dir)
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=user1@REALM:add()
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=user1@REALM:add-attribute(name=Roles, value=["Admin","Guest"])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-a-simple-role-decoder.">Add a simple-role-decoder.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <em>simple-role-decoder</em> decodes a principal&#8217;s roles from the <em>Roles</em>
attribute. You can change this value if your roles are in a different
attribute.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain.-1">Configure a security-domain.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/security-domain=exampleFsSD:add(realms=[{realm=exampleFsRealm,role-decoder=from-roles-attribute}],default-realm=exampleFsRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory-that-uses-the-kerberos-security-factory.">Configure an http-authentication-factory that uses the</h5>
<div class="paragraph">
<p>kerberos-security-factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-krb-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleFsSD,mechanism-configurations=[{mechanism-name=SPNEGO,mechanism-realm-configurations=[{realm-name=exampleFsSD}],credential-security-factory=krbSF}])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem-4">Configure an application-security-domain in the Undertow subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-krb-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-jboss-web.xml-and-jboss-deployment-structure.xml.">Configure your application&#8217;s web.xml, jboss-web.xml and</h5>
<div class="paragraph">
<p>jboss-deployment-structure.xml.</p>
</div>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p>In addition, you need to update your <em>web.xml</em> to use <em>SPNEGO</em> as its
authentication method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;login-config&gt;
  &lt;auth-method&gt;SPNEGO&lt;/auth-method&gt;
  &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
&lt;/login-config&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-a-form-as-a-fallback-for-kerberos">4.1.7. Configure Authentication with a Form as a Fallback for Kerberos</h4>
<div class="sect4">
<h5 id="configure-kerberos-based-authentication.">Configure kerberos-based authentication.</h5>
<div class="paragraph">
<p>Configuring kerberos-based authentication is covered in a previous
section.</p>
</div>
</div>
<div class="sect4">
<h5 id="add-a-mechanism-for-form-authentication-in-the-http-authentication-factory.">Add a mechanism for FORM authentication in the</h5>
<div class="paragraph">
<p>http-authentication-factory.</p>
</div>
<div class="paragraph">
<p>You can use the existing <em>http-authentication-factory</em> you configured
for kerberos-based authentication and and an additional mechanism for
<em>FORM</em> authentication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-krb-http-auth:list-add(name=mechanism-configurations, value={mechanism-name=FORM})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-additional-fallback-principals.">Add additional fallback principals.</h5>
<div class="paragraph">
<p>The existing configuration for kerberos-based authentication should
already have a security realm configured for mapping principals from
kerberos token to roles for the application. You can add additional
users for fallback authentication to that realm. For example if you used
a <em>filesystem-realm</em>, you can simply create a new user with the
appropriate roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=fallbackUser1:add()
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=fallbackUser1:set-password(clear={password="password123"})
/subsystem=elytron/filesystem-realm=exampleFsRealm/identity=fallbackUser1:add-attribute(name=Roles, value=["Admin","Guest"])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="update-the-web.xml-for-form-fallback.">Update the web.xml for FORM fallback.</h5>
<div class="paragraph">
<p>You need to update the <em>web.xml</em> to use the value <em>SPNEGO,FORM</em> for the
<em>auth-method</em>, which will use <em>FORM</em> as a fallback authentication method
if <em>SPNEGO</em> fails. You also need to specify the location of your login
and error pages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;login-config&gt;
  &lt;auth-method&gt;SPNEGO,FORM&lt;/auth-method&gt;
  &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
  &lt;form-login-config&gt;
    &lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt;
    &lt;form-error-page&gt;/error.jsp&lt;/form-error-page&gt;
  &lt;/form-login-config&gt;
&lt;/login-config&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-applications-to-use-elytron-or-legacy-security-for-authentication">4.1.8. Configure Applications to Use Elytron or Legacy Security for</h4>
<div class="paragraph">
<p>Authentication</p>
</div>
<div class="paragraph">
<p>After you have configured the <em>elytron</em> or legacy <em>security</em> subsystems
for authentication, you need to configure your application to use it.</p>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml.">Configure your application&#8217;s web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> needs to be configured to use the
appropriate authentication method. When using <em>elytron</em>, this is defined
in the <em>http-authentication-factory</em> you created. When using the legacy
<em>security</em> subsystem, this depends on your login module and the type of
authentication you want to configure.</p>
</div>
<div class="paragraph">
<p>Example <em>web.xml</em> with <em>BASIC</em> Authentication</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;web-app&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;secure&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/secure/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
      &lt;role-name&gt;Admin&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
  &lt;security-role&gt;
    &lt;description&gt;The role that is required to log in to /secure/*&lt;/description&gt;
    &lt;role-name&gt;Admin&lt;/role-name&gt;
  &lt;/security-role&gt;
  &lt;login-config&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
    &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
  &lt;/login-config&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-application-to-use-a-security-domain.">Configure your application to use a security domain.</h5>
<div class="paragraph">
<p>You can configure your application&#8217;s <em>jboss-web.xml</em> to specify the
security domain you want to use for authentication. When using the
<em>elytron</em> subsystem, this is defined when you created the
<em>application-security-domain</em>. When using the legacy <em>security</em>
subsystem, this is the name of the legacy security domain.</p>
</div>
<div class="paragraph">
<p>Example <em>jboss-web.xml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;jboss-web&gt;
  &lt;security-domain&gt;exampleApplicationDomain&lt;/security-domain&gt;
&lt;/jboss-web&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <em>jboss-web.xml</em> allows you to configure the security domain for a
single application only. Alternatively, you can specify a default
security domain for all applications using the <em>undertow</em> subsystem.
This allows you to omit using <em>jboss-web.xml</em> to configure a security
domain for an individual application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow:write-attribute(name=default-security-domain, value="exampleApplicationDomain")</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: Setting <em>default-security-domain</em> in the <em>undertow</em>
subsystem will apply to <strong>ALL</strong> applications. If <em>default-security-domain</em>
is set and an application specifies a security domain in a
<em>jboss-web.xml</em> file, the configuration in <em>jboss-web.xml</em> will override
the <em>default-security-domain</em> in the <em>undertow</em> subsystem.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-elytron-and-legacy-security-subsystems-in-parallel">Using Elytron and Legacy Security Subsystems in Parallel</h5>
<div class="paragraph">
<p>You can define authentication in both the <em>elytron</em> and legacy
<em>security</em> subsystems and use them in parallel. If you use both
<em>jboss-web.xml</em> and <em>default-security-domain</em> in the <em>undertow</em>
subsystem, WildFly will first try to match the configured security
domain in the <em>elytron</em> subsystem. If a match is not found, then WildFly
will attempt to match the security domain with one configured in the
legacy <em>security</em> subsystem. If the <em>elytron</em> and legacy <em>security</em>
subsystem each have a security domain with the same name, the <em>elytron</em>
security domain is used.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="override-an-applications-authentication-configuration">4.1.9. Override an Application&#8217;s Authentication Configuration</h4>
<div class="paragraph">
<p>You can override the authentication configuration of an application with
one configured in WildFly. To do this, use the
<em>override-deployment-configuration</em> property in the
<em>application-security-domain</em> section of the <em>undertow</em> subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:write-attribute(name=override-deployment-config,value=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, an application is configured to use <em>FORM</em> authentication
with the <em>exampleApplicationDomain</em> in its <em>jboss-web.xml</em>.</p>
</div>
<div class="paragraph">
<p><em>Example jboss-web.xml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;login-config&gt;
  &lt;auth-method&gt;FORM&lt;/auth-method&gt;
  &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
&lt;/login-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By enabling <em>override-deployment-configuration</em>, you can create a new
<em>http-authentication-factory</em> that specifies a different authentication
mechanism such as <em>BASIC</em>.</p>
</div>
<div class="paragraph">
<p><em>Example http-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/http-authentication-factory=exampleHttpAuth:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "http-server-mechanism-factory" =&gt; "global",
        "mechanism-configurations" =&gt; [{
            "mechanism-name" =&gt; "BASIC",
            "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "exampleApplicationDomain"}]
        }],
        "security-domain" =&gt; "exampleSD"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will override the authentication mechanism defined in the
application&#8217;s <em>jboss-web.xml</em> and attempt to authenticate a user using
<em>BASIC</em> instead of <em>FORM</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-and-use-a-credential-store">4.1.10. Create and Use a Credential Store</h4>
<div class="sect4">
<h5 id="create-credential-store.">Create credential store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/credential-store=exampleCS:add(uri="cr-store://exampleCS?create=true",credential-reference={clear-text=cs-secret})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-a-credential-to-a-credential-store.">Add a credential to a credential store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/credential-store=exampleCS/alias=keystorepw:add(secret-value="secret")</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="list-all-credentials-in-a-credential-store.">List all credentials in a credential store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/credential-store=exampleCS:read-children-names(child-type=alias)
{
    "outcome" =&gt; "success",
    "result" =&gt; ["keystorepw"]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="remove-a-credential-from-a-credential-store.">Remove a credential from a credential store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/credential-store=exampleCS/alias=keystorepw:remove</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use-a-credential-store.">Use a credential store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:write-attribute(name=credential-reference,value={store=exampleCS,alias=keystorepw})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="set-up-and-configure-authentication-for-the-management-interfaces">4.2. Set up and Configure Authentication for the Management Interfaces</h3>
<div class="sect3">
<h4 id="secure-the-management-interfaces-with-a-new-identity-store">4.2.1. Secure the Management Interfaces with a New Identity Store</h4>
<div class="sect4">
<h5 id="create-a-security-domain-and-any-supporting-security-realms-decoders-or-mappers-for-your-identity-store.">Create a security domain and any supporting security realms,</h5>
<div class="paragraph">
<p>decoders, or mappers for your identity store.</p>
</div>
<div class="paragraph">
<p>This process is covered in a previous section. For example, if you
wanted to secure the management interfaces using a filesystem-based
identity store, you would follow the steps in
<a href="#configure-authentication-with-a-filesystem-based-identity-store">Configure
Authentication with a Filesystem-Based Identity Store</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="create-an-http-authentication-factory-or-sasl-authentication-factory.">Create an http-authentication-factory or</h5>
<div class="paragraph">
<p>sasl-authentication-factory.</p>
</div>
<div class="paragraph">
<p>Example <em>http-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/http-authentication-factory=example-http-auth:add(http-server-mechanism-factory=global,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=DIGEST,mechanism-realm-configurations=[{realm-name=exampleManagementRealm}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example <em>sasl-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/sasl-authentication-factory=example-sasl-auth:add(sasl-server-factory=configured,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=DIGEST-MD5,mechanism-realm-configurations=[{realm-name=exampleManagementRealm}]}])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="update-the-management-interfaces-to-use-your-http-authentication-factory-or-sasl-authentication-factory.">Update the management interfaces to use your</h5>
<div class="paragraph">
<p>http-authentication-factory or sasl-authentication-factory.</p>
</div>
<div class="paragraph">
<p>Example update <em>http-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/core-service=management/management-interface=http-interface:write-attribute(name=http-authentication-factory, value=example-http-auth)
{
   "outcome" =&gt; "success",
   "response-headers" =&gt; {
       "operation-requires-reload" =&gt; true,
       "process-state" =&gt; "reload-required"
   }
}
 
reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example update <em>sasl-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/core-service=management/management-interface=http-interface:write-attribute(name=http-upgrade.sasl-authentication-factory, value=example-sasl-auth)
{
   "outcome" =&gt; "success",
   "response-headers" =&gt; {
       "operation-requires-reload" =&gt; true,
       "process-state" =&gt; "reload-required"
   }
}
 
reload</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="silent-authentication">4.2.2. Silent Authentication</h4>
<div class="paragraph">
<p>By default, WildFly provides an authentication mechanism for local
users, also know as silent authentication, through the <em>local</em> security
realm.</p>
</div>
<div class="paragraph">
<p>Silent authentication must be used via a <em>sasl-authentication-factory</em>.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: When enabling silent authentication, you must ensure the
security domain referenced by your <em>sasl-authentication-factory</em>
references a security realm that contains the <em>$local</em> user. By default,
WildFly provides the <em>local</em> identity realm that provides this user.</p>
</div>
<div class="sect4">
<h5 id="add-silent-authentication-to-an-existing-sasl-authentication-factory.">Add silent authentication to an existing</h5>
<div class="paragraph">
<p>sasl-authentication-factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/sasl-authentication-factory=example-sasl-auth:list-add(name=mechanism-configurations, value={mechanism-name=JBOSS-LOCAL-USER, realm-mapper=local})
 
reload</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="create-a-new-sasl-server-factory-with-silent-authentication.">Create a new sasl-server-factory with silent authentication.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/sasl-authentication-factory=example-sasl-auth:add(sasl-server-factory=configured,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=DIGEST-MD5,mechanism-realm-configurations=[{realm-name=exampleManagementRealm}]},{mechanism-name=JBOSS-LOCAL-USER, realm-mapper=local}])
 
reload</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="remove-silent-authentication-from-an-existing-sasl-server-factory">Remove silent authentication from an existing sasl-server-factory:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/sasl-authentication-factory=managenet-sasl-authentication:read-resource
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "mechanism-configurations" =&gt; [
            {
                "mechanism-name" =&gt; "JBOSS-LOCAL-USER",
                "realm-mapper" =&gt; "local"
            },
            {
                "mechanism-name" =&gt; "DIGEST-MD5",
                "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "ManagementRealm"}]
            }
        ],
        "sasl-server-factory" =&gt; "configured",
        "security-domain" =&gt; "ManagementDomain"
    }
}
 
/subsystem=elytron/sasl-authentication-factory=temp-sasl-authentication:list-remove(name=mechanism-configurations,index=0)
 
reload</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-rbac-with-elytron">4.2.3. Using RBAC with Elytron</h4>
<div class="paragraph">
<p>RBAC can be configured to automatically assign or exclude roles for
users that are members of groups. This is configured in the
<em>access-control</em> section of the core management. When the management
interfaces are secured with the <em>elytron</em> subsystem, and users are
assigned groups when they authenticate. You can also configure roles to
be assigned to authenticated users in a variety of ways using the
<em>elytron</em> subsystem, for example using a role mapper or a role decoder.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-ssltls">4.3. Configure SSL/TLS</h3>
<div class="sect3">
<h4 id="enable-one-way-ssltls-for-applications">4.3.1. Enable One-way SSL/TLS for Applications</h4>
<div class="paragraph">
<p>There are a couple ways to enable one-way SSL/TLS for deployed applications.</p>
</div>
<div class="sect4">
<h5 id="one-way-ssl-applications-using-security-command">Using a security command:</h5>
<div class="paragraph">
<p>The <em>security enable-ssl-http-server</em> command can be used to enable one-way
SSL/TLS for deployed applications. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">security enable-ssl-http-server --interactive
Please provide required pieces of information to enable SSL:
Key-store file name (default default-server.keystore): keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): n

SSL options:
key store file: keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
Server keystore file keystore.jks, certificate file keystore.pem and keystore.csr file
will be generated in server configuration directory.
Do you confirm y/n: y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server.</p>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for applications.</p>
</div>
</div>
<div class="sect4">
<h5 id="one-way-ssl-applications-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h5>
<div class="paragraph">
<p>You can also use the Elytron subsystem, along with the Undertow subsystem, to
enable HTTPS for deployed applications.</p>
</div>
<div class="sect5">
<h6 id="configure-a-key-store-in-wildfly">Configure a key-store in WildFly:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:add(path=/path/to/keystore.jks,credential-reference={clear-text=secret},type=JKS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous command uses an absolute path to the keystore.
Alternatively you can use the <em>relative-to</em> attribute to specify the
base directory variable and <em>path</em> specify a relative path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:add(path=keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the keystore file does not exist yet, the following commands can be used to
generate an example key pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")
/subsystem=elytron/key-store=httpsKS:store()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-key-manager-in-that-references-your-key-store">Configure a key-manager that references your key-store:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-manager=httpsKM:add(key-store=httpsKS,credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-server-ssl-context-in-that-references-your-key-manager">Configure a server-ssl-context that references your key-manager:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/server-ssl-context=httpsSSC:add(key-manager=httpsKM,protocols=["TLSv1.2"])</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: You need to determine what SSL/TLS protocols you want to
support. The example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="check-and-see-if-the-https-listener-is-configured-to-use-a-legacy-security-realm-for-its-ssl-configuration">Check and see if the https-listener is configured to use a legacy security realm for its SSL configuration:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/server=default-server/https-listener=https:read-attribute(name=security-realm)
{
    "outcome" =&gt; "success",
    "result" =&gt; "ApplicationRealm"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command shows that the <em>https-listener</em> is configured to use
the <em>ApplicationRealm</em> legacy security realm for its SSL configuration.
Undertow cannot reference both a legacy security realm and an
<em>ssl-context</em> in Elytron at the same time so you must remove the
reference to the legacy security realm. Also there has to be always
configured either <em>ssl-context</em> or <em>security-realm</em>. Thus when changing
between those, you have to use batch operation:</p>
</div>
<div class="paragraph">
<p><strong>Remove the reference to the legacy security realm and update the</strong>
<strong><em>https-listener</em></strong> <strong>to use the</strong> <strong><em>ssl-context</em></strong> <strong>from Elytron</strong> <strong>:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context,value=httpsSSC)
run-batch</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="reload-the-server">Reload the server:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for applications.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-two-way-ssltls-in-wildfly-for-applications">4.3.2. Enable Two-way SSL/TLS in WildFly for Applications</h4>
<div class="paragraph">
<p>First, obtain or generate your client keystore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -genkeypair -alias client -keyalg RSA -keysize 1024 -validity 365 -keystore client.keystore.jks -dname "CN=client" -keypass secret -storepass secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Export the client certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -exportcert  -keystore client.keystore.jks -alias client -keypass secret -storepass secret -file /path/to/client.cer</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a couple ways to enable two-way SSL/TLS for deployed applications.</p>
</div>
<div class="sect4">
<h5 id="two-way-ssl-applications-using-security-command">Using a security command:</h5>
<div class="paragraph">
<p>The <em>security enable-ssl-http-server</em> command can be used to enable two-way
SSL/TLS for the deployed applications. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">security enable-ssl-http-server --interactive
Please provide required pieces of information to enable SSL:
Key-store file name (default default-server.keystore): server.keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): y
Client certificate (path to pem file): /path/to/client.cer
Validate certificate y/n (blank y):
Trust-store file name (management.truststore): server.truststore.jks
Password (blank generated): secret

SSL options:
key store file: server.keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
client certificate: /path/to/client.cer
trust store file: server.trustore.jks
trust store password: secret
Server keystore file server.keystore.jks, certificate file server.pem and server.csr file will be generated in server configuration directory.
Server truststore file server.trustore.jks will be generated in server configuration directory.
Do you confirm y/n: y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server. To complete
the two-way SSL/TLS authentication, you need to
<a href="#import-server-certificate-into-client-truststore-applications">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-applications">configure your client</a>
to present the client certificate.</p>
</div>
</div>
<div class="sect4">
<h5 id="two-way-ssl-applications-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h5>
<div class="paragraph">
<p>You can also use the Elytron subsystem, along with the Undertow subsystem,
to enable two-way SSL/TLS for deployed applications.</p>
</div>
<div class="sect5">
<h6 id="obtain-or-generate-your-keystores-applications">Obtain or generate your key stores:</h6>
<div class="paragraph">
<p>Before enabling HTTPS in WildFly, you must obtain or generate the server key
store and trust store you plan on using. To generate an example key store and
trust store, use the following commands.</p>
</div>
<div class="paragraph">
<p>Create a server key-store:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:add(path=/path/to/server.keystore.jks,credential-reference={clear-text=secret},type=JKS)
/subsystem=elytron/key-store=twoWayKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")
/subsystem=elytron/key-store=twoWayKS:store()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE</strong><br>
The first command above uses an absolute path to the keystore.
Alternatively you can use the <em>relative-to</em> attribute to specify the
base directory variable and <em>path</em> specify a relative path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:add(path=server.keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Export the server certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:export-certificate(alias=localhost,path=/path/to/server.cer,pem=true)</code></pre>
</div>
</div>
<div id="import-client-certificate" class="paragraph">
<p>Create a key-store for the server truststore and import the client certificate
into the server truststore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=twoWayTS:add(path=/path/to/server.truststore.jks,credential-reference={clear-text=secret},type=JKS)
/subsystem=elytron/key-store=twoWayTS:import-certificate(alias=client,path=/path/to/client.cer,credential-reference={clear-text=secret},trust-cacerts=true)
/subsystem=elytron/key-store=twoWayTS:store()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-key-manager-in-that-references-your-key-store-key-store">Configure a key-manager that references your key store key-store:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-manager=twoWayKM:add(key-store=twoWayKS,credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-trust-manager-in-that-references-your-truststore-key-store">Configure a trust-manager that references your truststore key-store:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/trust-manager=twoWayTM:add(key-store=twoWayTS)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-server-ssl-context-in-that-references-your-key-manager-trust-manager-and-enables-client-authentication">Configure a server-ssl-context that references your key-manager, trust-manager, and enables client authentication:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/server-ssl-context=twoWaySSC:add(key-manager=twoWayKM,protocols=["TLSv1.2"],trust-manager=twoWayTM,need-client-auth=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong><br>
You need to determine what SSL/TLS protocols you want to support. The
example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="check-and-see-if-the-https-listener-is-configured-to-use-a-legacy-security-realm-for-its-ssl-configuration-1">Check and see if the https-listener is configured to use a legacy security realm for its SSL configuration:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/server=default-server/https-listener=https:read-attribute(name=security-realm)
{
    "outcome" =&gt; "success",
    "result" =&gt; "ApplicationRealm"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command shows that the <em>https-listener</em> is configured to use
the <em>ApplicationRealm</em> legacy security realm for its SSL configuration.
Undertow cannot reference both a legacy security realm and an
<em>ssl-context</em> in Elytron at the same time so you must remove the
reference to the legacy security realm. Also there has to be always
configured either <em>ssl-context</em> or <em>security-realm</em>. Thus when changing
between those, you have to use batch operation:</p>
</div>
</div>
<div class="sect5">
<h6 id="remove-the-reference-to-the-legacy-security-realm-and-update-the-https-listener-to-use-the-ssl-context-from-elytron">Remove the reference to the legacy security realm and update the</h6>
<div class="paragraph">
<p>https-listener to use the ssl-context from Elytron:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context,value=twoWaySSC)
run-batch</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="reload-the-server-1">Reload the server</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>To complete the two-way SSL/TLS authentication, you need to
<a href="#import-server-certificate-into-client-truststore-applications">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-applications">configure your client</a>
to present the client certificate.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="import-server-certificate-into-client-truststore-applications">Import the server certificate into the client truststore</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -importcert -keystore client.truststore.jks -storepass secret -alias localhost -trustcacerts -file /path/to/server.cer</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-client-to-use-the-client-certificate-applications">Configure your client to use the client certificate</h5>
<div class="paragraph">
<p>You need to configure your client to present the trusted client
certificate to the server to complete the two-way SSL/TLS
authentication. For example, if using a browser, you need to import the
trusted certificate into the browser&#8217;s truststore.</p>
</div>
<div class="paragraph">
<p>Two-Way HTTPS is now enabled for applications.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-one-way-ssltls-for-the-management-interfaces">4.3.3. Enable One-way SSL/TLS for the Management Interfaces</h4>
<div class="paragraph">
<p>There are a couple ways to enable one-way SSL/TLS for the management interfaces.</p>
</div>
<div class="sect4">
<h5 id="one-way-ssl-management-interfaces-using-security-command">Using a security command:</h5>
<div class="paragraph">
<p>The <em>security enable-ssl-management</em> command can be used to enable one-way
SSL/TLS for the management interfaces. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">security enable-ssl-management --interactive
Please provide required pieces of information to enable SSL:
Key-store file name (default management.keystore): keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): n

SSL options:
key store file: keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
Server keystore file keystore.jks, certificate file keystore.pem and keystore.csr file
will be generated in server configuration directory.
Do you confirm y/n :y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server and reconnect to it.</p>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for the management interfaces.</p>
</div>
</div>
<div class="sect4">
<h5 id="one-way-ssl-management-interfaces-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h5>
<div class="paragraph">
<p>Elytron subsystem commands can also be used to enable one-way SSL/TLS for the
management interfaces.</p>
</div>
<div class="sect5">
<h6 id="configure-key-store">Configure a key-store:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:add(path=keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> The above command uses <em>relative-to</em> to reference the location
of the keystore file. Alternatively, you can specify the full path to
the keystore in <em>path</em> and omit <em>relative-to</em>.</p>
</div>
<div class="paragraph">
<p>If the keystore file does not exist yet, the following commands can be used to
generate an example key pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")
/subsystem=elytron/key-store=httpsKS:store()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="create-a-key-manager-and-server-ssl-context">Create a key-manager and server-ssl-context.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-manager=httpsKM:add(key-store=httpsKS,credential-reference={clear-text=secret})
 
/subsystem=elytron/server-ssl-context=httpsSSC:add(key-manager=httpsKM,protocols=["TLSv1.2"])</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> You need to determine what SSL/TLS protocols you want to
support. The example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="enable-https-on-the-management-interface.">Enable HTTPS on the management interface.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/core-service=management/management-interface=http-interface:write-attribute(name=ssl-context, value=httpsSSC)
 
/core-service=management/management-interface=http-interface:write-attribute(name=secure-socket-binding, value=management-https)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="reload-the-wildfly-instance.">Reload the WildFly instance.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for the management interfaces.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-two-way-ssltls-for-the-management-interfaces">4.3.4. Enable Two-way SSL/TLS for the Management Interfaces</h4>
<div class="paragraph">
<p>First, obtain or generate your client keystore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -genkeypair -alias client -keyalg RSA -keysize 1024 -validity 365 -keystore client.keystore.jks -dname "CN=client" -keypass secret -storepass secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Export your client certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -exportcert  -keystore client.keystore.jks -alias client -keypass secret -storepass secret -file /path/to/client.cer</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a couple ways to enable two-way SSL/TLS for the management interfaces.</p>
</div>
<div class="sect4">
<h5 id="two-way-ssl-management-interfaces-using-security-command">Using a security command:</h5>
<div class="paragraph">
<p>The <em>security enable-ssl-management</em> command can be used to enable two-way
SSL/TLS for the management interfaces. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">security enable-ssl-management --interactive
Please provide required pieces of information to enable SSL:
Key-store file name (default management.keystore): server.keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): y
Client certificate (path to pem file): /path/to/client.cer
Validate certificate y/n (blank y):
Trust-store file name (management.truststore): server.truststore.jks
Password (blank generated): secret

SSL options:
key store file: server.keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
client certificate: /path/to/client.cer
trust store file: server.trustore.jks
trust store password: secret
Server keystore file server.keystore.jks, certificate file server.pem and server.csr file will be generated in server configuration directory.
Server truststore file server.trustore.jks will be generated in server configuration directory.
Do you confirm y/n: y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server and
attempt to reconnect to it. To complete the two-way SSL/TLS authentication,
you need to <a href="#import-server-certificate-into-client-truststore-management">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-management">configure your client</a>
to present the client certificate.</p>
</div>
</div>
<div class="sect4">
<h5 id="two-way-ssl-management-interfaces-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h5>
<div class="paragraph">
<p>Elytron subsystem commands can also be used to enable two-way SSL/TLS for the
management interfaces.</p>
</div>
<div class="sect5">
<h6 id="obtain-or-generate-your-key-stores-management">Obtain or generate your key stores.</h6>
<div class="paragraph">
<p>Before enabling HTTPS in WildFly, you must obtain or generate the server
key store and trust store you plan on using. To generate an example key
store and trust store, use the following commands.</p>
</div>
<div class="paragraph">
<p>Configure a key-store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:add(path=server.keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)

/subsystem=elytron/key-store=twoWayKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")

/subsystem=elytron/key-store=twoWayKS:store()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> The above command uses <em>relative-to</em> to reference the location
of the keystore file. Alternatively, you can specify the full path to
the keystore in <em>path</em> and omit <em>relative-to</em>.</p>
</div>
<div class="paragraph">
<p>Export your server certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=twoWayKS:export-certificate(alias=localhost,path=/path/to/server.cer,pem=true)</code></pre>
</div>
</div>
<div id="import-client-certificate-into-server-truststore" class="paragraph">
<p>Create a key-store for the server trust store and import the client certificate
into the server trust store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=twoWayTS:add(path=server.truststore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)

/subsystem=elytron/key-store=twoWayTS:import-certificate(alias=client,path=/path/to/client.cer,credential-reference={clear-text=secret},trust-cacerts=true)

/subsystem=elytron/key-store=twoWayTS:store()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-key-manager-trust-manager-and-server-ssl-context-for-the-server-key-store-and-trust-store">Configure a key-manager, trust-manager, and server-ssl-context for the server key store and trust store.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-manager=twoWayKM:add(key-store=twoWayKS,credential-reference={clear-text=secret})
 
/subsystem=elytron/trust-manager=twoWayTM:add(key-store=twoWayTS)
 
/subsystem=elytron/server-ssl-context=twoWaySSC:add(key-manager=twoWayKM,protocols=["TLSv1.2"],trust-manager=twoWayTM,want-client-auth=true,need-client-auth=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> You need to determine what SSL/TLS protocols you want to
support. The example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="enable-https-on-the-management-interface.-1">Enable HTTPS on the management interface.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/core-service=management/management-interface=http-interface:write-attribute(name=ssl-context, value=twoWaySSC)
 
/core-service=management/management-interface=http-interface:write-attribute(name=secure-socket-binding, value=management-https)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="reload-the-wildfly-instance.-1">Reload the WildFly instance.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>To complete the two-way SSL/TLS authentication, you need to
<a href="#import-server-certificate-into-client-truststore-management">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-management">configure your client</a>
to present the client certificate.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="import-server-certificate-into-client-truststore-management">Import the server certificate into the client truststore.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -importcert -keystore client.truststore.jks -storepass secret -alias localhost -trustcacerts -file /path/to/server.cer</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-client-to-use-the-client-certificate-management">Configure your client to use the client certificate.</h5>
<div class="paragraph">
<p>You need to configure your client to present the trusted client
certificate to the server to complete the two-way SSL/TLS
authentication. For example, if using a browser, you need to import the
trusted certificate into the browser&#8217;s trust store.</p>
</div>
<div class="paragraph">
<p>Two-way SSL/TLS is now enabled for the management interfaces.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="keystore-manipulation-operations">4.3.5. KeyStore manipulation operations</h4>
<div class="paragraph">
<p>It is possible to perform various KeyStore manipulation operations on an
Elytron key-store resource using the management CLI.</p>
</div>
<div class="sect4">
<h5 id="generate-key-pair">Generate a key pair</h5>
<div class="paragraph">
<p>The <em>generate-key-pair</em> command generates a key pair and wraps the resulting
public key in a self-signed X.509 certificate. The generated private key and
self-signed certificate will be added to the KeyStore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:generate-key-pair(alias=example,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=www.example.com")</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="generate-certificate-signing-request">Generate a certificate signing request</h5>
<div class="paragraph">
<p>The <em>generate-certificate-signing-request</em> command generates a PKCS #10
certificate signing request using a PrivateKeyEntry from the KeyStore. The
generated certificate signing request will be output to a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:generate-certificate-signing-request(alias=example,path=server.csr,relative-to=jboss.server.config.dir,distinguished-name="CN=www.example.com",extensions=[{critical=false,name=KeyUsage,value=digitalSignature}],credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="import-certificate">Import a certificate or certificate chain</h5>
<div class="paragraph">
<p>The <em>import-certificate</em> command imports a certificate or certificate chain
from a file into an entry in the KeyStore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:import-certificate(alias=example,path=/path/to/certificate_or_chain/file,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},trust-cacerts=true)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="export-certificate">Export a certificate</h5>
<div class="paragraph">
<p>The <em>export-certificate</em> command exports a certificate from an entry in the
KeyStore to a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:export-certificate(alias=example,path=serverCert.cer,relative-to=jboss.server.config.dir,pem=true)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="change-alias">Change an alias</h5>
<div class="paragraph">
<p>The <em>change-alias</em> command moves an existing KeyStore entry to a new alias.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:change-alias(alias=example,new-alias=newExample,credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="store-changes">Store changes made to key-stores</h5>
<div class="paragraph">
<p>The <em>store</em> command persists any changes that have been made to the file that
backs the KeyStore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:store()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-an-ldap-key-store">4.3.6. Using an ldap-key-store</h4>
<div class="paragraph">
<p>An <em>ldap-key-store</em> allows you to use a keystore stored in an LDAP
server. You can use an <em>ldap-key-store</em> in same way you can use a
<em>key-store</em>.</p>
</div>
<div class="paragraph">
<p>To create and use an <em>ldap-key-store</em>:</p>
</div>
<div class="sect4">
<h5 id="configure-a-dir-context.">Configure a dir-context.</h5>
<div class="paragraph">
<p>To connect to the LDAP server from WildFly, you need to configure a
<em>dir-context</em> that provides the URL as well as the principal used to
connect to the server.</p>
</div>
<div class="paragraph">
<p><strong>Example dir-context</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/dir-context=exampleDC:add( \
  url="ldap://127.0.0.1:10389", \
  principal="uid=admin,ou=system", \
  credential-reference={clear-text=secret} \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-ldap-key-store.">Configure an ldap-key-store.</h5>
<div class="paragraph">
<p>When configure an <em>ldap-key-store</em>, you need to specify both the
<em>dir-context</em> used to connect to the LDAP server as well as how to
locate the keystore stored in the LDAP server. At a minimum, this
requires you specify a <em>search-path</em>.</p>
</div>
<div class="paragraph">
<p><strong>Example ldap-key-store</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/ldap-key-store=ldapKS:add( \
  dir-context=exampleDC, \
  search-path="ou=Keystores,dc=wildfly,dc=org" \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use-the-ldap-key-store.">Use the ldap-key-store.</h5>
<div class="paragraph">
<p>Once you have defined your <em>ldap-key-store</em>, you can use it in the same
places where a <em>key-store</em> could be used. For example, you could use an
<em>ldap-key-store</em> when configuring HTTPS and Two-Way HTTPS for
applications.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-a-filtering-key-store">4.3.7. Using a filtering-key-store</h4>
<div class="paragraph">
<p>A <em>filtering-key-store</em> allows you to expose a subset of aliases from an
existing <em>key-store</em>, and use it in the same places you could use a
<em>key-store</em>. For example, if a keystore contained <em>alias1</em>, <em>alias2</em>,
and <em>alias3</em>, but you only wanted to expose <em>alias1</em> and <em>alias3</em>, a
<em>filtering-key-store</em> provides you several ways to do that.</p>
</div>
<div class="paragraph">
<p>To create a <em>filtering-key-store</em>:</p>
</div>
<div class="sect4">
<h5 id="configure-a-key-store.">Configure a key-store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=myKS:add( \
  path=keystore.jks, \
  relative-to=jboss.server.config.dir, \
  credential-reference={ \
    clear-text=secret \
  }, \
  type=JKS \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-filtering-key-store.">Configure a filtering-key-store.</h5>
<div class="paragraph">
<p>When you configure a <em>filtering-key-store</em>, you specify which
<em>key-store</em> you want to filter and the <em>alias-filter</em> for filtering
aliases from the <em>key-store</em>. The filter can be specified in one of the
following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>alias1,alias3</em>, which is a comma-delimited list of aliases to expose.</p>
</li>
<li>
<p><em>ALL:-alias2</em>, which exposes all aliases in the keystore except the
ones listed.</p>
</li>
<li>
<p><em>NONE:+alias1:+alias3</em>, which exposes no aliases in the keystore
except the ones listed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This example uses a comma-delimted list to expose <em>alias1</em> and <em>alias3</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/filtering-key-store=filterKS:add( \
  key-store=myKS, \
  alias-filter="alias1,alias3" \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use-the-filtering-key-store.">Use the filtering-key-store.</h5>
<div class="paragraph">
<p>Once you have defined your <em>filtering-key-store</em>, you can use it in the
same places where a <em>key-store</em> could be used. For example, you could
use a <em>filtering-key-store</em> when configuring HTTPS and Two-Way HTTPS for
applications.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reload-a-keystore">4.3.8. Reload a Keystore</h4>
<div class="paragraph">
<p>You can reload a keystore configured in WildFly from the management CLI.
This is useful in cases where you have made changes to certificates
referenced by a keystore.</p>
</div>
<div class="paragraph">
<p>To reload a keystore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS:load</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="check-the-content-of-a-keystore-by-alias">4.3.9. Check the Content of a Keystore by Alias</h4>
<div class="paragraph">
<p>If you add a keystore to the <em>elytron</em> subsystem using the <em>key-store</em>
component, you can check the keystore&#8217;s contents using the <em>alias</em> child
element and reading its attributes.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=httpsKS/alias=localhost:read-attribute(name=certificate-chain)
{
    "outcome" =&gt; "success",
    "result" =&gt; [{
        "type" =&gt; "X.509",
        "algorithm" =&gt; "RSA",
        "format" =&gt; "X.509",
        "public-key" =&gt; "30:81:9f:30:0d:06:09:2a:8......</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following attributes can be read:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate associated with the alias. If the alias
has a certificate chain this will always be undefined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate-chain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate chain associated with the alias.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">creation-date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The creation date of the entry represented by this
alias.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entry-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the entry for this alias. Available types:
PasswordEntry, PrivateKeyEntry, SecretKeyEntry, TrustedCertificateEntry,
and Other. Unrecognized types will be reported as Other.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="custom-components">4.3.10. Custom Components</h4>
<div class="paragraph">
<p>When configuring SSL/TLS in the <em>elytron</em> subsystem, you can provide and
use custom implementations of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>key-store</em></p>
</li>
<li>
<p><em>key-manager</em></p>
</li>
<li>
<p><em>trust-manager</em></p>
</li>
<li>
<p><em>client-ssl-context</em></p>
</li>
<li>
<p><em>server-ssl-context</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When creating custom implementations of Elytron components, they must
present the appropriate capabilities and requirements.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-elytron-and-security-subsystems">4.4. Configuring the Elytron and Security Subsystems</h3>
<div class="sect3">
<h4 id="enable-and-disable-the-elytron-subsystem">4.4.1. Enable and Disable the Elytron Subsystem</h4>
<div class="sect4">
<h5 id="to-add-the-elytron-extension-required-for-the-elytron-subsystem">To add the elytron extension required for the elytron subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/extension=org.wildfly.extension.elytron:add()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="to-enable-the-elytron-subsystem-in-wildfly">To enable the Elytron subsystem in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron:add
 
reload</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="to-disable-the-elytron-subsystem-in-wildfly">To disable the Elytron subsystem in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron:remove
 
reload</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> Other subsystems within WildFly may have dependencies on
the <em>elytron</em> subsystem. If these dependencies are not resolved before
disabling it, you will see errors when starting WildFly.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-and-disable-the-security-subsystem">4.4.2. Enable and Disable the Security Subsystem</h4>
<div class="sect4">
<h5 id="to-disable-the-security-subsystem-in-wildfly">To disable the security subsystem in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=security:remove
 
reload</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> Other subsystems within WildFly may have dependencies on
the <em>security</em> subsystem. If these dependencies are not resolved before
disabling it, you will see errors when starting WildFly.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-enable-the-security-subsystem-in-wildfly">To enable the security subsystem in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=security:add
 
reload</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="use-the-elytron-and-security-subsystems-in-parallel">4.4.3. Use the Elytron and Security Subsystems in Parallel</h4>
<div class="paragraph">
<p>By default the <em>elytron</em> and <em>security</em> subsystems will run in parallel
if both are enabled. For authentication in applications, you can use the
<em>application-security-domain</em> property in the <em>undertow</em> subsystem to
configure a security domain in the <em>elytron</em> subsystem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(http-authentication-factory=example-http-auth)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> This must match the <em>security-domain</em> configured in the
<em>jboss-web.xml</em> of your application.</p>
</div>
<div class="paragraph">
<p>If the <em>application-security-domain</em> is not set, WildFly will look for a
security domain configured in the <em>security</em> subsystem that matches the
<em>security-domain</em> configured in the <em>jboss-web.xml</em> of your application.</p>
</div>
<div class="paragraph">
<p>For enabling HTTPS using a legacy security realm, you can use the
<em>security-realm</em> attribute in the <em>https-listener</em> section of the
<em>undertow</em> subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/server=default-server/https-listener=https:read-attribute(name=security-realm)
{
    "outcome" =&gt; "success",
    "result" =&gt; "ApplicationRealm"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For enabling HTTPS using <em>elytron</em>, you need to undefine the
<em>security-realm</em> attribute and set the <em>ssl-context</em> attribute. As there
has to be always configured either <em>ssl-context</em> or <em>security-realm</em> you
have to use batch operation when changing between those:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context,value=httpsSSC)
run-batch</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-elytron-subsystem-components">4.5. Creating Elytron Subsystem Components</h3>
<div class="sect3">
<h4 id="create-an-elytron-security-realm">4.5.1. Create an Elytron Security Realm</h4>
<div class="paragraph">
<p>Security realms in the Elytron subsystem, when used in conjunction with
security domains, are use for both core management authentication as
well as for authentication with applications. Security realms are also
specifically typed based on their identity store, for example
<em>jdbc-realm</em>, <em>filesystem-realm</em>, <em>properties-realm</em>, etc.</p>
</div>
<div class="paragraph">
<p>Adding a security realm takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/type-of-realm=realmName:add(....)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples of adding specific realms, such as <em>jdbc-realm</em>,
<em>filesystem-realm</em>, and <em>properties-realm</em> can be found in previous
sections.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-role-decoder">4.5.2. Create an Elytron Role Decoder</h4>
<div class="paragraph">
<p>A role decoder converts attributes from the identity provided by the
security realm into roles. Role decoders are also specifically typed
based on their functionality, for example <em>empty-role-decoder</em>,
<em>simple-role-decoder</em>, and <em>custom-role-decoder</em>.</p>
</div>
<div class="paragraph">
<p>Adding a role decoder takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/ROLE-DECODER-TYPE=roleDeoderName:add(....)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-permission-set">4.5.3. Create an Elytron Permission Set</h4>
<div class="paragraph">
<p>Permission sets can be used to assign permissions to an identity.</p>
</div>
<div class="paragraph">
<p>Adding a permission set takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/permission-set=PermissionSetName:add(permissions=[{class-name="...", module="...", target-name="...", action="..."}...])</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <em>permissions</em> consists of a set of permissions, where each permission has the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>class-name</em> is the fully qualified class name of the permission. This is the only permission attribute that is required.</p>
</li>
<li>
<p><em>module</em> is the optional module to use to load the permission.</p>
</li>
<li>
<p><em>target-name</em> is the optional target name to pass to the permission as it is constructed.</p>
</li>
<li>
<p><em>action</em> is the optional action to pass to the permission as it is constructed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-permission-mapper">4.5.4. Create an Elytron Permission Mapper</h4>
<div class="paragraph">
<p>In addition to roles being assigned to a identity, permissions may also
be assigned. A permission mapper assigns permissions to an identity.
Permission mappers are also specifically typed based on their
functionality, for example <em>logical-permission-mapper</em>,
<em>simple-permission-mapper</em>, and <em>custom-permission-mapper</em>.</p>
</div>
<div class="paragraph">
<p>Adding a permission mapper takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/simple-permission-mapper=PermissionMapperName:add(...)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-role-mapper">4.5.5. Create an Elytron Role Mapper</h4>
<div class="paragraph">
<p>A role mapper maps roles after they have been decoded to other roles.
Examples include normalizing role names or adding and removing specific
roles from principals after they have been decoded. Role mappers are
also specifically typed based on their functionality, for example
<em>add-prefix-role-mapper</em>, <em>add-suffix-role-mapper</em>, and
<em>constant-role-mapper</em>.</p>
</div>
<div class="paragraph">
<p>Adding a role mapper takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/ROLEM-MAPPER-TYPE=roleMapperName:add(...)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-security-domain">4.5.6. Create an Elytron Security Domain</h4>
<div class="paragraph">
<p>Security domains in the Elytron subsystem, when used in conjunction with
security realms, are use for both core management authentication as well
as for authentication with applications.</p>
</div>
<div class="paragraph">
<p>Adding a security domain takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/security-domain=domainName:add(realms=[{realm=realmName,role-decoder=roleDecoderName}],default-realm=realmName,permission-mapper=permissionMapperName,role-mapper=roleMapperName,...)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-authentication-factory">4.5.7. Create an Elytron Authentication Factory</h4>
<div class="paragraph">
<p>An authentication factory is an authentication policy used for specific
authentication mechanisms. Authenticaion factories are specifically
based on the authentication mechanism, for example
<em>http-authentication-factory</em> and<br>
<em>sasl-authentication-factory</em> and <em>kerberos-security-factory</em>.</p>
</div>
<div class="paragraph">
<p>Adding an authentication factory takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/AUTH-FACTORY-TYPE=authFactoryName:add(....)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-policy-provider">4.5.8. Create an Elytron Policy Provider</h4>
<div class="paragraph">
<p>Elytron subsystem provides a specific resource definition that can be
used to configure a default ruby Policy provider. The subsystem allows
you to define multiple policy providers but select a single one as the
default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/policy=policy-provider-a:add(custom-policy=\[{name=policy-provider-a, class-name=MyPolicyProviderA, module=x.y.z}\])</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Using_WildFly_Elytron_with_WildFly">5. Using Elytron within WildFly</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="using-the-out-of-the-box-elytron-components">5.1. Using the Out of the Box Elytron Components</h3>
<div class="sect3">
<h4 id="securing-management-interfaces">5.1.1. Securing Management Interfaces</h4>
<div class="paragraph">
<p>You can find more details on the enabling WildFly to use the out of the
box Elytron components for securing the management interfaces in the
<a href="Elytron_Subsystem.html#src-557147_ElytronSubsystem-DefaultManagementAuthenticationConfiguration">Default
Management Authentication Configuration</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="securing-applications">5.1.2. Securing Applications</h4>
<div class="paragraph">
<p>The <em>elytron</em> subsystem provides <em>application-http-authentication</em> by
default which can be used to secure applications. For more details on
how <em>application-http-authentication</em> is configured, see the
<a href="Elytron_Subsystem.html#src-557147_ElytronSubsystem-OutoftheBoxConfiguration">Out
of the Box Configuration</a> section.</p>
</div>
<div class="paragraph">
<p>To configure applications to use <em>application-http-authentication</em>, see
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureApplicationstoUseElytronorLegacySecurityforAuthentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>. You
can also override the default behavior of all applications using the
steps in
<a href="Using_the_Elytron_Subsystem.html#src-557140_safe-id-VXNpbmd0aGVFbHl0cm9uU3Vic3lzdGVtLU92ZXJyaWRlYW5BcHBsaWNhdGlvbidzQXV0aGVudGljYXRpb25Db25maWd1cmF0aW9u">Override
an Application&#8217;s Authentication Configuration</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-ssltls">5.1.3. Using SSL/TLS</h4>
<div class="paragraph">
<p>WildFly does provide a default one-way SSL/TLS configuration using the
legacy core management authentication but does not provide one in the
<em>elytron</em> subsystem. You can find more details on configuring SSL/TLS
using the <em>elytron</em> subsystem for both the management interfaces as well
as for applications in
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ssl-tls">Configure
SSL/TLS</a></p>
</div>
</div>
<div class="sect3">
<h4 id="using-elytron-with-other-subsystems">5.1.4. Using Elytron with Other Subsystems</h4>
<div class="paragraph">
<p>In addition to securing applications and management interfaces, Elytron
also integrates with other subsystems in WildFly.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Subsystem</th>
<th class="tableblock halign-left valign-top">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">batch-jberet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can configure the batch-jberet to run batch jobs
using an Elytron security domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can use a credential store or an Elytron security
domain to provide authentication information in a datasource definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messaging-activemq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can secure remote connections to the remote
connections used by the messaging-activemq subsystem.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iiop-openjdk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can use the elytron subsystem to configure SSL/TLS
between clients and servers using the iiop-openjdk subsystem.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can use a credential store to provide authentication
information in a server definition in the mail subsystem.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">undertow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can use the elytron subsystem to configure both SSL/TLS
and application authentication.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="undertow-subsystem">5.2. Undertow Subsystem</h3>
<div class="paragraph">
<p>As a web application is deployed the name of the security domain required by that application will be identified, this will either be from within the deployment or if the deployment does not have a security domain the <code>default-security-domain</code> as defined on the Undertow subsystem will be assumed.  By default it is assumed that the security domain maps to a PicketBox domain defined in the legacy security subsystem, however an <code>application-security-domain</code> resource can be added to the Undertow subsystem which maps from the name of the security domain required by the application to the appropriate WildFly Elytron configuration.</p>
</div>
<div class="paragraph">
<p>As an example in it&#8217;s simplest form a mapping can be added as: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=MyAppSecurity:add(security-domain=ApplicationDomain)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:undertow:7.0" ... default-security-domain="other"&gt;
...
    &lt;application-security-domains&gt;
        &lt;application-security-domain name="MyAppSecurity" security-domain="ApplicationDomain"/&gt;
    &lt;/application-security-domains&gt;
...
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Note: If the deployment was already deployed at this point the
application server should be reloaded or the deployment redeployed for
the application security domain mapping to take effect.</em></p>
</div>
<div class="paragraph">
<p>Here we are mapping from the applications security domain <code>MyAppSecurity</code> to the WildFly Elytron defined domain <code>ApplicationDomain</code>.</p>
</div>
<div class="paragraph">
<p>This simple form is suitable where a deployment is using the standard HTTP mechanisms as defined within the Servlet specification i.e. <code>BASIC</code>, <code>CLIENT_CERT</code>, <code>DIGEST</code>, <code>FORM</code> and authentication will be performed against the <code>ApplicationDomain</code> security domain.  This form is also suitable where an application is not using any authentication mechanisms and instead is using programatic authentication or even wishes to obtain the SecurityDomain associated with the deployment and use it directly.</p>
</div>
<div class="paragraph">
<p>An advanced form of the mapping can be added as: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=MyAppSecurity:add(http-authentication-factory=application-http-authentication)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:undertow:7.0" ... default-security-domain="other"&gt;
...
    &lt;application-security-domains&gt;
        &lt;application-security-domain name="MyAppSecurity" http-authentication-factory="application-http-authentication"/&gt;
    &lt;/application-security-domains&gt;
...
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this form of the configuration instead of referencing a security domain a <code>http-authentication-factory</code> is referenced instead, this is the factory that will be used to obtain the instances of the authentication mechansisms and is in turn associated with the security domain.  The standard mechanisms as defined in the Servlet specification can be used in this way but this approach also allows for other mechanisms to be used such as <code>SPNEGO</code> which requires additional configuration or even plug-in custom mechanism implementations.</p>
</div>
<div class="paragraph">
<p>When the advanced form of the mapping is used a further configuration option is available: -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>override-deployment-config</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The referenced <code>http-authentication-factory</code> can return a complete set of authentication mechanisms, by default these are filtered to just match the mechanisms requested by the application - if this option is set to <code>true</code> then the mechanisms offered by the factory will override the mechanisms requested by the application.  One example of where this could be useful is say an application has been developed to support <code>FORM</code> authentication, by overriding the mechanisms the application could be updated to support <code>SPNEGO</code>, and <code>FORM</code> authentication without any modifications to the deployment.</p>
</div>
<div class="paragraph">
<p>The <code>application-security-domain</code> resource also has one additional option <code>enable-jacc</code>, if this is set to true JACC will be enabled for any deployments matching against this mapping.</p>
</div>
<div class="sect3">
<h4 id="runtime-information">5.2.1. Runtime Information</h4>
<div class="paragraph">
<p>Where an <code>application-security-domain</code> mapping is in use it can be useful to double check that deployments did match against it as expected, if the resource is read with <code>include-runtime=true</code> the deployments that are associated with the mapping will also be shown: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 /] /subsystem=undertow/application-security-domain=MyAppSecurity:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "enable-jacc" =&gt; false,
        "http-authentication-factory" =&gt; undefined,
        "override-deployment-config" =&gt; false,
        "referencing-deployments" =&gt; ["simple-webapp.war"],
        "security-domain" =&gt; "ApplicationDomain",
        "setting" =&gt; undefined
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>In this output the <code>referencing-deployments</code> attribute shows that the deployment <code>simple-webapp.war</code> has been deployed using this mapping.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ejb-subsystem">5.3. EJB Subsystem</h3>
<div class="paragraph">
<p>Configuration can be added to the EJB subsystem to map a security domain
name referenced in a deployment to an Elytron security domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=ejb3/application-security-domain=MyAppSecurity:add(security-domain=ApplicationDomain)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:ejb3:5.0"&gt;
...
    &lt;application-security-domains&gt;
        &lt;application-security-domain name="MyAppSecurity" security-domain="ApplicationDomain"/&gt;
    &lt;/application-security-domains&gt;
...
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Note: If the deployment was already deployed at this point the
application server should be reloaded or the deployment redeployed for
the application security domain mapping to take effect.</em></p>
</div>
<div class="paragraph">
<p>An <code>application-security-domain</code> has two main attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name - the name of the security domain as specified in a deployment</p>
</li>
<li>
<p>security-domain - a reference to the Elytron security domain that
should be used</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When an application security domain mapping is configured for a bean in
a deployment, this indicates that security should be handled by Elytron.</p>
</div>
</div>
<div class="sect2">
<h3 id="webservices-subsystem">5.4. WebServices Subsystem</h3>
<div class="paragraph">
<p>There is adapter in webservices subsystem to make authentication works
for elytron security domain automatically. Like configure with legacy
security domain, you can configure elytron security domain in deployment
descriptor or annotation to secure webservice endpoint.</p>
</div>
</div>
<div class="sect2">
<h3 id="legacy-security-subsystem">5.5. Legacy Security Subsystem</h3>
<div class="paragraph">
<p>As previously described, Elytron based security is configured by
chaining together different capability references to form a complete
security policy. To allow an incremental migration from the legacy
Security subsystem some of the major components of this subsystem can be
mapped to Elytron capabilities and used within an Elytron based set up.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Client_Authentication_with_Elytron_Client">6. Client Authentication with Elytron Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly Elytron uses the Elytron Client project to enable remote clients
to authenticate using Elytron. Elytron Client has the following
components:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains authentication information such
as usernames, passwords, allowed SASL mechanisms, and the security realm
to use during digest authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MatchRule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rule used for deciding which authentication configuration to
use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of rules and authentication configurations
to use with a client for establishing a connection.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When a connection is established, the client makes use of an
authentication context, which gives rules that match which
authentication configuration is used with an outbound connection. For
example, you could have a rules that use one authentication
configuration when connecting to <em>server1</em> and another authentication
configuration when connecting with <em>server2</em>. The authentication context
is comprised of a set of authentication configurations and a set of
rules that define how they are selected when establishing a connection.
An authentication context can also reference <em>ssl-context</em> and can be
matched with rules.</p>
</div>
<div class="paragraph">
<p>To create a client that uses security information when establishing a
connection:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create one or more authentication configurations.</p>
</li>
<li>
<p>Create an authentication context by creating rule and authentication
configuration pairs.</p>
</li>
<li>
<p>Create a runnable for establishing your connection.</p>
</li>
<li>
<p>Use your authentication context to run your runnable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you establish your connection, Elytron Client will use the set of
rules provided by the authentication context to match the correct
authentication configuration to use during authentication.</p>
</div>
<div class="paragraph">
<p>You can use one of the following approaches to use security information
when establishing a client connection.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: When using Elytron Client to make EJB calls, any hard-coded
programatic authentication information, such as setting
<em>Context.SECURITY_PRINCIPAL</em> in the <em>javax.naming.InitialContext</em>, will
override the Elytron Client configuration.</p>
</div>
<div class="sect2">
<h3 id="the-configuration-file-approach">6.1. The Configuration File Approach</h3>
<div class="paragraph">
<p>The configuration file approach involves creating an XML file with your
authentication configuration, authentication context, and match rules.</p>
</div>
<div class="paragraph">
<p><strong>custom-config.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;configuration&gt;
    &lt;authentication-client xmlns="urn:elytron:1.0"&gt;
        &lt;authentication-rules&gt;
            &lt;rule use-configuration="monitor"&gt;
                &lt;match-host name="127.0.0.1" /&gt;
            &lt;/rule&gt;
            &lt;rule use-configuration="administrator"&gt;
                &lt;match-host name="localhost" /&gt;
            &lt;/rule&gt;
        &lt;/authentication-rules&gt;
        &lt;authentication-configurations&gt;
            &lt;configuration name="monitor"&gt;
                &lt;allow-sasl-mechanisms names="DIGEST-MD5" /&gt;
                 &lt;use-service-loader-providers /&gt;
                 &lt;set-user-name name="monitor" /&gt;
                 &lt;credentials&gt;
                     &lt;clear-password password="password1!" /&gt;
                 &lt;/credentials&gt;
                 &lt;set-mechanism-realm name="ManagementRealm" /&gt;
             &lt;/configuration&gt;

             &lt;configuration name="administrator"&gt;
                &lt;allow-sasl-mechanisms names="DIGEST-MD5" /&gt;
                 &lt;use-service-loader-providers /&gt;
                 &lt;set-user-name name="administrator" /&gt;
                 &lt;credentials&gt;
                     &lt;clear-password password="password1!" /&gt;
                 &lt;/credentials&gt;
                 &lt;set-mechanism-realm name="ManagementRealm" /&gt;
             &lt;/configuration&gt;
        &lt;/authentication-configurations&gt;
    &lt;/authentication-client&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then reference that file in your client&#8217;s code by setting a
system property when running your client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ java -Dwildfly.config.url=/path/to/the.xml .....</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: If you use the
<a href="#the-programmatic-approach">The
Programmatic Approach</a>, it will override any provided configuration
files even if the <em>wildfly.config.url</em> system property is set.</p>
</div>
<div class="paragraph">
<p>When creating rules, you can look for matches on various parameters such
as hostname, port, protocol, or username. A full list of options for
<em>MatchRule</em> are available in the
<a href="http://wildfly-security.github.io/wildfly-elytron/org/wildfly/security/auth/client/MatchRule.html">Javadocs</a>.
Rules are evaluated in the order in which they are configured.</p>
</div>
<div class="paragraph">
<p><strong>Common Rules</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Rule</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the security
domain to match against.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the hostname to
match against. For example, the host 127.0.0.1 would match on
<a href="http://127.0.0.1:9990/my/path" class="bare">http://127.0.0.1:9990/my/path</a> .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-no-userinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches against URIs with no userinfo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the path to match
against. For example, the path /my/path/ would match on
<a href="http://127.0.0.1:9990/my/path" class="bare">http://127.0.0.1:9990/my/path</a> .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the port to match
against. For example, the port 9990 would match on
<a href="http://127.0.0.1:9990/my/path" class="bare">http://127.0.0.1:9990/my/path</a> .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the protocol
to match against. For example, the protocol http would match on
<a href="http://127.0.0.1:9990/my/path" class="bare">http://127.0.0.1:9990/my/path</a> .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-purpose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a names attribute specifying the list of purposes
to match against.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-urn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the URN to match
against.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-userinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the userinfo
to match against.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="the-programmatic-approach">6.2. The Programmatic Approach</h3>
<div class="paragraph">
<p>The programatic approach configures all the Elytron Client configuration
in the client&#8217;s code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">//create your authentication configuration
AuthenticationConfiguration adminConfig =
    AuthenticationConfiguration.EMPTY
      .useProviders(() -&gt; new Provider[] { new WildFlyElytronProvider() })
      .allowSaslMechanisms("DIGEST-MD5")
      .useRealm("ManagementRealm")
      .useName("administrator")
      .usePassword("password1!");
 
//create your authentication context
AuthenticationContext context = AuthenticationContext.empty();
context = context.with(MatchRule.ALL.matchHost("127.0.0.1"), adminConfig);
 
 
//create your runnable for establishing a connection
Runnable runnable =
    new Runnable() {
      public void run() {
        try {
           //Establish your connection and do some work
        } catch (Exception e) {
          e.printStackTrace();
        }
      }
    };
 
//use your authentication context to run your client
context.run(runnable);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When adding configuration details to <em>AuthenticationConfiguration</em> and
<em>AuthenticationContext</em>, each method call returns a new instance of that
object. For example, if you wanted separate configurations when
connecting over different hostnames, you could do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">//create your authentication configuration
AuthenticationConfiguration commonConfig =
    AuthenticationConfiguration.EMPTY
      .useProviders(() -&gt; new Provider[] { new WildFlyElytronProvider() })
      .allowSaslMechanisms("DIGEST-MD5")
      .useRealm("ManagementRealm");
 
AuthenticationConfiguration administrator =
    commonConfig
      .useName("administrator")
      .usePassword("password1!");


AuthenticationConfiguration monitor =
    commonConfig
      .useName("monitor")
      .usePassword("password1!");
 
 
//create your authentication context
AuthenticationContext context = AuthenticationContext.empty();
context = context.with(MatchRule.ALL.matchHost("127.0.0.1"), administrator);
context = context.with(MatchRule.ALL.matchHost("localhost"), monitor);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Common Rules</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Rule</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchLocalSecurityDomain(String name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-domain
in the configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchNoUser()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-no-user in the configuration
file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchPath(String pathSpec)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-path in the
configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchPort(int port)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-port in the
configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchProtocol(String protoName)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-port in the
configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchPurpose(String purpose)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new rule which is the same as
this rule, but also matches the given purpose name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchPurposes(String&#8230;&#8203; purposes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-purpose in
the configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchUrnName(String name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-urn in the
configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchUser(String userSpec)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-userinfo in the
configuration file approach.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Also, instead of starting with an empty authentication configuration,
you can start with the current configured one by using
<em>captureCurrent()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">//create your authentication configuration
AuthenticationConfiguration commonConfig = AuthenticationConfiguration.captureCurrent();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <em>captureCurrent()</em> will capture any previously established
authentication context and use it as your new base configuration. A
authentication context is established once its been activated by calling
<em>run()</em>. If <em>captureCurrent()</em> is called and no context is currently
active, it will try and use the default authentication if available. You
can find more details about this in
<a href="#the-configuration-file-approach">The
Configuration File Approach</a>,
<a href="#the-default-configuration-approach">The
Default Configuration Approach</a>, and
<a href="#src-557099_ClientAuthenticationwithElytronClient-UsingElytronClientwithClientsDeployedtoWildFly">Using
Elytron Client with Clients Deployed to WildFly</a> sections.</p>
</div>
<div class="paragraph">
<p>Using <em>AuthenticationConfiguration.EMPTY</em> should only be used as a base
to build a configuration on top of and should not be used on its own. It
provides a configuration that uses the JVM-wide registered providers and
enables anonymous authentication.</p>
</div>
<div class="paragraph">
<p>When specifying the providers on top of the
<em>AuthenticationConfiguration.EMPTY</em> configuration, you can specify a
custom list, but most users should use <em>WildFlyElytronProvider()</em>
providers.</p>
</div>
<div class="paragraph">
<p>When creating an authentication context, using the <em>context.with(&#8230;&#8203;)</em>
will create a new context that merges the rules and authentication
configuration from the current context with the provided rule and
authentication configuration. The provided rule and authentication
configuration will appear after the ones in the current context.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-default-configuration-approach">6.3. The Default Configuration Approach</h3>
<div class="paragraph">
<p>The default configuration approach relies completely on the
configuration provided by Elytron Client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">//create your runnable for establishing a connection
Runnable runnable =
    new Runnable() {
      public void run() {
        try {
           //Establish your connection and do some work
        } catch (Exception e) {
          e.printStackTrace();
        }
      }
    };
 
// run runnable directly
runnable.run();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To provide a default configuration, Elytron Client tries to
auto-discover a <em>wildfly-config.xml</em> file on the filesystem. It looks in
the following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Location specified by the <em>wildfly.config.url</em> system property set
outside of the client code.</p>
</li>
<li>
<p>The classpath root directory.</p>
</li>
<li>
<p>The <em>META-INF</em> directory on the classpath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If it does not find one, it will try and use the default
<em>wildfly-config.xml</em> provided in the
<em>$WILDFLY_HOME/bin/client/jboss-client.jar</em>.</p>
</div>
<div class="paragraph">
<p><strong>default wildfly-config.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;configuration&gt;
  &lt;authentication-client xmlns="urn:elytron:1.0"&gt;
    &lt;authentication-rules&gt;
      &lt;rule use-configuration="default" /&gt;
    &lt;/authentication-rules&gt;
    &lt;authentication-configurations&gt;
      &lt;configuration name="default"&gt;
        &lt;allow-all-sasl-mechanisms /&gt;
        &lt;set-mechanism-properties&gt;
          &lt;property key="wildfly.sasl.local-user.quiet-auth" value="true" /&gt;
        &lt;/set-mechanism-properties&gt;
        &lt;use-service-loader-providers /&gt;
      &lt;/configuration&gt;
    &lt;/authentication-configurations&gt;
  &lt;/authentication-client&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-elytron-client-with-clients-deployed-to-wildfly">6.4. Using Elytron Client with Clients Deployed to WildFly</h3>
<div class="paragraph">
<p>Clients deployed to WildFly can also make use of Elytron Client. In
cases where you have included a <em>wildfly-config.xml</em> with your
deployment or the system property has been set, an
<em>AuthenticationContext</em> is automatically parsed and created from that
file.</p>
</div>
<div class="paragraph">
<p>To load a configuration file outside of the deployment, you can use the
<em>parseAuthenticationClientConfiguration(URI)</em> method. This method will
return an <em>AuthentcationContext</em> which you can then use in your client&#8217;s
code using the
<a href="#the-programmatic-approach">The
Programmatic Approach</a>.</p>
</div>
<div class="paragraph">
<p>Additionally, clients will also automatically parse and create an
AuthenticationContext from the client configuration provided by the
<em>elytron</em> subsystem. The client configuration in the <em>elytron</em> subsystem
can also take advantage of other components defined in the <em>elytron</em>
subsystem such as credential stores. If client configuration is provided
by BOTH the deployment and the <em>elytron</em> subsystem, the <em>elytron</em>
subsystem&#8217;s configuration is used.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_other_clients_using_wildfly-config">6.5. Client configuration using wildfly-config.xml</h3>
<div class="paragraph">
<p>Prior to WildFly 11, many WildFly client libraries used different configuration strategies. WildFly 11 introduces a new <code>wildfly-config.xml</code> file which unifies all client configuration in a single place. In addition to being able to configure authentication using Elytron as described in the previous section, a <code>wildfly-config.xml</code> file can also be used to:</p>
</div>
<div class="sect3">
<h4 id="configure-ejb-client-connections-global-interceptors-and-invocation-timeout">6.5.1. Configure EJB client connections, global interceptors, and invocation timeout</h4>
<div class="paragraph">
<p>Schema location: [<a href="https://github.com/wildfly/jboss-ejb-client/blob/4.0.2.Final/src/main/resources/schema/wildfly-client-ejb_3_0.xsd" class="bare">https://github.com/wildfly/jboss-ejb-client/blob/4.0.2.Final/src/main/resources/schema/wildfly-client-ejb_3_0.xsd</a>]</p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="title">wildfly-config.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;configuration&gt;
...
    &lt;jboss-ejb-client xmlns="urn:jboss:wildfly-client-ejb:3.0"&gt;
        &lt;invocation-timeout seconds="10"/&gt;
        &lt;connections&gt;
            &lt;connection uri="remote+http://10.20.30.40:8080"/&gt;
        &lt;/connections&gt;
        &lt;global-interceptors&gt;
            &lt;interceptor class="org.jboss.example.ExampleInterceptor"/&gt;
        &lt;/global-interceptors&gt;
    &lt;/jboss-ejb-client&gt;
...
&lt;/configuration&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-http-client">6.5.2. Configure HTTP client</h4>
<div class="paragraph">
<p>Schema location:[<a href="https://github.com/wildfly/wildfly-http-client/blob/1.0.2.Final/common/src/main/resources/schema/wildfly-http-client_1_0.xsd" class="bare">https://github.com/wildfly/wildfly-http-client/blob/1.0.2.Final/common/src/main/resources/schema/wildfly-http-client_1_0.xsd</a>]</p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="title">wildfly-config.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;configuration&gt;
...
    &lt;http-client xmlns="urn:wildfly-http-client:1.0"&gt;
        &lt;defaults&gt;
            &lt;eagerly-acquire-session value="true" /&gt;
            &lt;buffer-pool buffer-size="2000" max-size="10" direct="true" thread-local-size="1" /&gt;
        &lt;/defaults&gt;
    &lt;/http-client&gt;
...
&lt;/configuration&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-remoting-endpoint">6.5.3. Configure a remoting endpoint</h4>
<div class="paragraph">
<p>Schema location:[<a href="https://github.com/jboss-remoting/jboss-remoting/blob/5.0.1.Final/src/main/resources/schema/jboss-remoting_5_0.xsd" class="bare">https://github.com/jboss-remoting/jboss-remoting/blob/5.0.1.Final/src/main/resources/schema/jboss-remoting_5_0.xsd</a>]</p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="title">wildfly-config.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;configuration&gt;
...
    &lt;endpoint xmlns="urn:jboss-remoting:5.0"&gt;
        &lt;connections&gt;
            &lt;connection destination="remote+http://10.20.30.40:8080" read-timeout="50" write-timeout="50" heartbeat-interval="10000"/&gt;
        &lt;/connections&gt;
    &lt;/endpoint&gt;
...
&lt;/configuration&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-the-default-xnio-worker">6.5.4. Configure the default XNIO worker</h4>
<div class="paragraph">
<p>Schema location:[<a href="https://github.com/xnio/xnio/blob/3.5.1.Final/api/src/main/resources/schema/xnio_3_5.xsd" class="bare">https://github.com/xnio/xnio/blob/3.5.1.Final/api/src/main/resources/schema/xnio_3_5.xsd</a>]</p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="paragraph">
<p><strong>wildfly-config.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;configuration&gt;
...
    &lt;worker xmlns="urn:xnio:3.5"&gt;
        &lt;io-threads value="10"/&gt;
        &lt;task-keepalive value="100"/&gt;
        &lt;stack-size value="5000"/&gt;
    &lt;/worker&gt;
...
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that WildFly client libraries do have reasonable default configuration. Thus, adding configuration for these clients to <code>wildfly-config.xml</code> isn’t mandatory.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Elytron_and_Java_Authorization_Contract_for_Containers-JACC">7. Elytron and Java Authorization Contract for Containers (JACC)</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
This document will guide you on how to enable JACC using Elytron
Subsystem.
</blockquote>
</div>
<div class="sect2">
<h3 id="disabling-jacc-in-legacy-security-subsystem-picketbox">7.1. Disabling JACC in Legacy Security Subsystem (PicketBox)</h3>
<div class="paragraph">
<p>By default, the application server uses the legacy security subsystem
(PicketBox) to configure the JACC policy provider and factory. The
default configuration maps to implementations from PicketBox.</p>
</div>
<div class="paragraph">
<p>In order to use Elytron to manage JACC configuration (or any other
policy you want to install to the application server) you must first
disable JACC in legacy security subsystem. For that, please execute the
following CLI command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=security:write-attribute(name=initialize-jacc, value=false)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command above tells the legacy security subsystem to not initialize
any JACC related configuration, but rely on the policies defined via
Elytron subsystem as we&#8217;ll see in the next sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="defining-a-jacc-policy-provider">7.2. Defining a JACC Policy Provider</h3>
<div class="paragraph">
<p>Elytron subsystem provides a built-in policy provider based on JACC
specification. To create the policy provider you can execute a CLI
command as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone@localhost:9990 /] /subsystem=elytron/policy=jacc:add(jacc-policy={})</code></pre>
</div>
</div>
<div class="paragraph">
<p>After executing the command above, please reload the server
configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone@localhost:9990 /] reload</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enabling-jacc-to-a-web-deployment">7.3. Enabling JACC to a Web Deployment</h3>
<div class="paragraph">
<p>Once JACC Policy Provider is defined you can enable JACC to web
deployments by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone@localhost:9990 /] /subsystem=undertow/application-security-domain=other:add(http-authentication-factory=application-http-authentication,enable-jacc=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command above defines a default security domain for applications if
none is provided in <strong>jboss-web.xml.</strong> In case you already have a
<strong>application-security-domain</strong> defined and just want to enable JACC you
can execute a command as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone@localhost:9990 /] /subsystem=undertow/application-security-domain=my-security-domain:write-attribute(name=enable-jacc,value=true)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enabling-jacc-to-a-ejb-deployment">7.4. Enabling JACC to a EJB Deployment</h3>
<div class="paragraph">
<p>Once JACC Policy Provider is defined you can enable JACC to EJB
deployments by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone@localhost:9990 /] /subsystem=ejb3/application-security-domain=other:add(security-domain=ApplicationDomain,enable-jacc=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command above defines a default security domain for EJBs. In case
you already have a *application-security-domain *defined and just want
to enable JACC you can execute a command as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone@localhost:9990 /] /subsystem=ejb3/application-security-domain=my-security-domain:write-attribute(name=enable-jacc,value=true)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="KeyCloak_Integration">8. Using KeyCloak with WildFly Elytron</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TBD</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="OpenSSL">9. OpenSSL</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="Web_Single_Sign_On">10. Web Single Sign-On</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document will guide on how to enable single sign-on across different applications deployed into different servers, where these applications belong to same security domain.</p>
</div>
<div class="sect2">
<h3 id="create-a-server-configuration-template">10.1. Create a Server Configuration Template</h3>
<div class="paragraph">
<p>For this document, you&#8217;ll need to run at least two server instances in order to check single sign-on and how it affect usability in your applications. Users should be able to log in once and have access to any application using the same security domain.</p>
</div>
<div class="paragraph">
<p>All configuration described in the next sections should be done with a server instance using <strong>standalone-ha.xml</strong> (or standalone-full-ha.xml).</p>
</div>
<div class="paragraph">
<p>Run a server instance using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bin/standalone.sh -c standalone-ha.xml</pre>
</div>
</div>
<div class="sect3">
<h4 id="create-a-http-authentication-factory">10.1.1. Create a HTTP Authentication Factory</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you already have a <em>http-authentication-factory</em>&nbsp;defined in Elytron subsystem and just want to use it to enable single sign-on to your applications, please skip this section.{info}
First, you need a <em>security-domain</em> which we&#8217;ll use to authenticate users. Please, execute the following CLI commands:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre># Creates a FileSystem Realm, an identity store where users are stored in the local filesystem
/subsystem=elytron/filesystem-realm=example-realm:add(path=/tmp/example-realm)

# Creates a Security Domain
/subsystem=elytron/security-domain=example-domain:add(default-realm=example-realm, permission-mapper=default-permission-mapper,realms=[{realm=example-realm, role-decoder=groups-to-roles}]

# Creates an user that you can use to access your applications
/subsystem=elytron/filesystem-realm=example-realm:add-identity(identity=alice)
/subsystem=elytron/filesystem-realm=example-realm:add-identity-attribute(identity=alice, name=groups, value=["user"])
/subsystem=elytron/filesystem-realm=example-realm:set-password(identity=alice, clear={password=alice})</pre>
</div>
</div>
<div class="paragraph">
<p>Now you can create a <em>http-authentication-factory</em> that you&#8217;ll use to actually protect your web applications using Undertow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Create a Http Authentication Factory
/subsystem=elytron/http-authentication-factory=example-http-authentication:add(security-domain=example-domain, http-server-mechanism-factory=global, mechanism-configurations=[{mechanism-name=FORM}]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-a-application-security-domain-in-undertow">10.1.2. Create a Application Security Domain in Undertow</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you already have a&nbsp;_application-security-domain_&nbsp;defined in Undertow subsystem and just want to use it to enable single sign-on to your applications, please skip this section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to protect applications using the configuration defined in Elytron subsystem, you should create a application-security-domain definition in Undertow subsystem as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/subsystem=undertow/application-security-domain=other:add(http-authentication-factory=example-http-authentication)</pre>
</div>
</div>
<div class="paragraph">
<p>By default, if your application does not define any specific <em>security-domain</em> in <em>jboss-web.xml</em>, the application server will choose one with a name <strong>other</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-a-key-store">10.1.3. Create a Key Store</h4>
<div class="paragraph">
<p>In order to create a <em>key-store</em> in Elytron subsystem, first create a Java Key Store as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">keytool -genkeypair -alias localhost -keyalg RSA -keysize 1024 -validity 365 -keystore keystore.jks -dname "CN=localhost" -keypass secret -storepass secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the <em>keystore.jks</em> file is created, execute the following CLI commands to create a <em>key-store</em> definition in Elytron:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/subsystem=elytron/key-store=example-keystore:add(path=keystore.jks, relative-to=jboss.server.config.dir, credential-reference={clear-text=secret}, type=JKS)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-single-sign-on">10.1.4. Enable Single Sign-On</h4>
<div class="paragraph">
<p>Single Sign-On is enabled to a specific <em>application-security-domain</em> definition in Undertow subsystem. It is important that the servers you will be using to deploy applications are using the same configuration.</p>
</div>
<div class="paragraph">
<p>To enable single-sign on, just change an existing application-security-domain in Undertow subsystem as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/application-security-domain=other/setting=single-sign-on:add(key-store=example-keystore, key-alias=localhost, domain=localhost, credential-reference={clear-text=secret})</code></pre>
</div>
</div>
<div class="paragraph">
<p>After restarting the servers, users should be able to log in once and have access to any application using the same <em>application-security-domain</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-two-server-instances">10.2. Create Two Server Instances</h3>
<div class="paragraph">
<p>All configuration you did so far should be reflect in <em>$JBOSS_HOME</em>/<em>standalone/standalone-ha.xml.</em> You can now create two distinct server configuration directories_:\_</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cp -r standalone standalone-a
cp -r standalone standalone-b</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you can run the two instances using the command below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$JBOSS_HOME/bin/standalone.sh -c standalone-ha.xml -Djboss.node.name=node-a -Djboss.socket.binding.port-offset=200 -Djboss.server.base.dir=$JBOSS_HOME/standalone-a
$JBOSS_HOME/bin/standalone.sh -c standalone-ha.xml -Djboss.node.name=node-b -Djboss.socket.binding.port-offset=300 -Djboss.server.base.dir=$JBOSS_HOME/standalone-b ----</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy-an-application">10.3. Deploy an Application</h3>
<div class="paragraph">
<p>For the sake of simplicity, these are the minimum files you need in your application:</p>
</div>
<div class="listingblock">
<div class="title">WEB-INF/web.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;web-app version="3.1" xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"&gt;

    &lt;security-constraint&gt;
        &lt;display-name&gt;SecurityConstraint&lt;/display-name&gt;
        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;All Resources&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
        &lt;/web-resource-collection&gt;
        &lt;auth-constraint&gt;
            &lt;role-name&gt;user&lt;/role-name&gt;
        &lt;/auth-constraint&gt;
    &lt;/security-constraint&gt;

    &lt;login-config&gt;
        &lt;auth-method&gt;FORM&lt;/auth-method&gt;
        &lt;form-login-config&gt;
            &lt;form-login-page&gt;/login.html&lt;/form-login-page&gt;
            &lt;form-error-page&gt;/login.html&lt;/form-error-page&gt;
        &lt;/form-login-config&gt;
    &lt;/login-config&gt;

    &lt;security-role&gt;
        &lt;role-name&gt;user&lt;/role-name&gt;
    &lt;/security-role&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">login.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">&lt;html&gt;
    &lt;body&gt;
        &lt;form method="post" action="j_security_check"&gt;
            &lt;input type="text" name="j_username"&gt;
            &lt;input type="password" name="j_password"&gt;
            &lt;input type="submit" value="Log In"&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Make sure you have at least a welcome file (e.g.: index.html\|jsp).
</td>
</tr>
</table>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Deploy your application into both server instances and try to log in using the user you created at the beginning of this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Username: <strong>alice</strong></p>
</li>
<li>
<p>Password: <strong>alice</strong></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Migrate_Legacy_Security_to_Elytron_Security">11. Migrate Legacy Security to Elytron Security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="authentication-configuration">11.1. Authentication Configuration</h3>

</div>
<div class="sect2">
<h3 id="Properties_File_Based_Authentication_Migration">11.2. Properties Based Authentication / Authorization</h3>
<div class="sect3">
<h4 id="picketbox-based-configuration">11.2.1. PicketBox Based Configuration</h4>
<div class="paragraph">
<p>This migration example assumes a deployed web application is configured
to require authentication using FORM based authentication and is
referencing a PicketBox based security domain using the
UsersRolesLoginModule to load user information from a pair or properties
files.</p>
</div>
<div class="sect4">
<h5 id="original-configuration">Original Configuration</h5>
<div class="paragraph">
<p>A security domain can be defined in the legacy security subsystem using
the following management operations: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=application-security:add
./subsystem=security/security-domain=application-security/authentication=classic:add(login-modules=[{code=UsersRoles, flag=Required, module-options={usersProperties=file://${jboss.server.config.dir}/example-users.properties, rolesProperties=file://${jboss.server.config.dir}/example-roles.properties}}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would result in a security domain definition: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;security-domain name="application-security"&gt;
    &lt;authentication&gt;
      &lt;login-module code="UsersRoles" flag="required"&gt;
        &lt;module-option name="usersProperties" value="file://${jboss.server.config.dir}/example-users.properties"/&gt;
        &lt;module-option name="rolesProperties" value="file://${jboss.server.config.dir}/example-roles.properties"/&gt;
      &lt;/login-module&gt;
    &lt;/authentication&gt;
  &lt;/security-domain&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="intermediate-configuration">Intermediate Configuration</h5>
<div class="paragraph">
<p>It is possible to take a previously defined PicketBox security domain
and expose it as an Elytron security realm so it can be wired into a
complete Elytron based configuration, if only properties based
authentication was to be migrated it would be recommended to jump to the
fully migration configuration and avoid the unnecessary dependency on
the legacy security subsystem but for situations where that is not
immediately possible these commands illustrate an intermediate solution.</p>
</div>
<div class="paragraph">
<p>These steps assume the original configuration is already in place.</p>
</div>
<div class="paragraph">
<p>The first step is to add a mapping to an Elytron security realm within
the legacy security subsystem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/elytron-realm=application-security:add(legacy-jaas-config=application-security)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:jboss:domain:security:2.0"&gt;
    ...
    &lt;elytron-integration&gt;
      &lt;security-realms&gt;
        &lt;elytron-realm name="application-security" legacy-jaas-config="application-security"/&gt;
      &lt;/security-realms&gt;
    &lt;/elytron-integration&gt;
    ...
  &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the Elytron subsystem a security domain can be defined which
references the exported security realm and also a http authentication
factory which supports FORM based authentication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/security-domain=application-security:add(realms=[{realm=application-security}], default-realm=application-security, permission-mapper=default-permission-mapper)
./subsystem=elytron/http-authentication-factory=application-security-http:add(http-server-mechanism-factory=global, security-domain=application-security, mechanism-configurations=[{mechanism-name=FORM}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the resulting configuration: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:wildfly:elytron:1.0" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
    ...
    &lt;security-domains&gt;
      ...
      &lt;security-domain name="application-security" default-realm="application-security" permission-mapper="default-permission-mapper"&gt;
        &lt;realm name="application-security"/&gt;
      &lt;/security-domain&gt;
    &lt;/security-domains&gt;
    ...
    &lt;http&gt;
      ...
      &lt;http-authentication-factory name="application-security-http" http-server-mechanism-factory="global" security-domain="application-security"&gt;
        &lt;mechanism-configuration&gt;
          &lt;mechanism mechanism-name="FORM"/&gt;
        &lt;/mechanism-configuration&gt;
      &lt;/http-authentication-factory&gt;
      ...
    &lt;/http&gt;
    ...
  &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally configuration needs to be added to the Undertow subsystem to map
the security domain referenced by the deployment to the newly defined
http authentication factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=undertow/application-security-domain=application-security:add(http-authentication-factory=application-security-http)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:jboss:domain:undertow:4.0"&gt;
    ...
    &lt;application-security-domains&gt;
      &lt;application-security-domain name="application-security" http-authentication-factory="application-security-http"/&gt;
    &lt;/application-security-domains&gt;
    ...
  &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Note: If the deployment was already deployed at this point the
application server should be reloaded or the deployment redeployed for
the application security domain mapping to take effect.</em></p>
</div>
<div class="paragraph">
<p>The following command can then be used to verify the mapping was applied
to the deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone@localhost:9990 /] ./subsystem=undertow/application-security-domain=application-security:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "enable-jacc" =&gt; false,
        "http-authentication-factory" =&gt; "application-security-http",
        "override-deployment-config" =&gt; false,
        "referencing-deployments" =&gt; ["HelloWorld.war"],
        "setting" =&gt; undefined
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The deployment being tested here is 'HelloWorld.war' and the output from
the previous command shows this deployment is referencing the mapping.</p>
</div>
<div class="paragraph">
<p>At this stage the previously defined security domain is used for it&#8217;s
LoginModule configuration but this is wrapped by Elytron components
which take over authentication.</p>
</div>
</div>
<div class="sect4">
<h5 id="fully-migrated-configuration">Fully Migrated Configuration</h5>
<div class="paragraph">
<p>Alternatively the configuration can be completely defined within the
Elytron subsystem, in this case it is assumed none of the previous
commands have been executed and this is started from a clean
configuration - however if the security domain definition does exist in
the legacy security subsystem that will remain completely independent.</p>
</div>
<div class="paragraph">
<p>First a new security realm can be defined within the Elytron subsystem
referencing the files referenced previously: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/properties-realm=application-properties:add(users-properties={path=example-users.properties, relative-to=jboss.server.config.dir, plain-text=true, digest-realm-name="Application Security"}, groups-properties={path=example-roles.properties, relative-to=jboss.server.config.dir}, groups-attribute=Roles)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As before a security domain and http authentication factory can be
defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/security-domain=application-security:add(realms=[{realm=application-properties}], default-realm=application-properties, permission-mapper=default-permission-mapper)
./subsystem=elytron/http-authentication-factory=application-security-http:add(http-server-mechanism-factory=global, security-domain=application-security, mechanism-configurations=[{mechanism-name=FORM}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following overall configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:wildfly:elytron:1.0" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
    ...
    &lt;security-domains&gt;
      ...
      &lt;security-domain name="application-security" default-realm="application-properties" permission-mapper="default-permission-mapper"&gt;
        &lt;realm name="application-properties"/&gt;
      &lt;/security-domain&gt;
    &lt;/security-domains&gt;
    &lt;security-realms&gt;
      ...
      &lt;properties-realm name="application-properties" groups-attribute="Roles"&gt;
        &lt;users-properties path="example-users.properties" relative-to="jboss.server.config.dir" digest-realm-name="Application Security" plain-text="true"/&gt;
        &lt;groups-properties path="example-roles.properties" relative-to="jboss.server.config.dir"/&gt;
      &lt;/properties-realm&gt;
    &lt;/security-realms&gt;
    ...
    &lt;http&gt;
      ...
      &lt;http-authentication-factory name="application-security-http" http-server-mechanism-factory="global" security-domain="application-security"&gt;
        &lt;mechanism-configuration&gt;
          &lt;mechanism mechanism-name="FORM"/&gt;
        &lt;/mechanism-configuration&gt;
      &lt;/http-authentication-factory&gt;
      ...
    &lt;/http&gt;
    ...
  &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As before the application-security-domain mapping should be added to the
Undertow subsystem and the server reloaded or the deployment redeployed
as required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=undertow/application-security-domain=application-security:add(http-authentication-factory=application-security-http)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:jboss:domain:undertow:4.0"&gt;
    ...
    &lt;application-security-domains&gt;
      &lt;application-security-domain name="application-security" http-authentication-factory="application-security-http"/&gt;
    &lt;/application-security-domains&gt;
    ...
  &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this stage the authentication is the equivalent of the original
configuration however now Elytron components are used exclusively.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="legacy-security-realm">11.2.2. Legacy Security Realm</h4>
<div class="sect4">
<h5 id="original-configuration-1">Original Configuration</h5>
<div class="paragraph">
<p>A legacy security realm can be defined using the following commands to
load users passwords and group information from properties files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./core-service=management/security-realm=ApplicationSecurity:add
./core-service=management/security-realm=ApplicationSecurity/authentication=properties:add(relative-to=jboss.server.config.dir, path=example-users.properties, plain-text=true)
./core-service=management/security-realm=ApplicationSecurity/authorization=properties:add(relative-to=jboss.server.config.dir, path=example-roles.properties)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following realm definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;security-realm name="ApplicationSecurity"&gt;
    &lt;authentication&gt;
      &lt;properties path="example-users.properties" relative-to="jboss.server.config.dir" plain-text="true"/&gt;
    &lt;/authentication&gt;
    &lt;authorization&gt;
      &lt;properties path="example-roles.properties" relative-to="jboss.server.config.dir"/&gt;
    &lt;/authorization&gt;
  &lt;/security-realm&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A legacy security realm would typically be used to secure either the
management interfaces or remoting connectors.</p>
</div>
</div>
<div class="sect4">
<h5 id="migrated-configuration">Migrated Configuration</h5>
<div class="paragraph">
<p>One of the motivations for adding the Elytron based security to the
application server is to allow a consistent security solution to be used
across the server, to replace the security realm the same steps as
described in the previous 'Fully Migrated' section can be followed again
up until the http-authentication-factory is defined.</p>
</div>
<div class="paragraph">
<p>A legacy security realm can also be used for SASL based authentication
so a sasl-authentication-factory should also be defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/sasl-authentication-factory=application-security-sasl:add(sasl-server-factory=elytron, security-domain=application-security, mechanism-configurations=[{mechanism-name=PLAIN}])</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:wildfly:elytron:1.0" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
    ...
    &lt;sasl&gt;
      ...
      &lt;sasl-authentication-factory name="application-security-sasl" sasl-server-factory="elytron" security-domain="application-security"&gt;
        &lt;mechanism-configuration&gt;
          &lt;mechanism mechanism-name="PLAIN"/&gt;
        &lt;/mechanism-configuration&gt;
      &lt;/sasl-authentication-factory&gt;
      ...
    &lt;/sasl&gt;
  &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be associated with a Remoting connector to use for
authentication and the existing security realm reference cleared.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=remoting/http-connector=http-remoting-connector:write-attribute(name=sasl-authentication-factory, value=application-security-sasl)
./subsystem=remoting/http-connector=http-remoting-connector:undefine-attribute(name=security-realm)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:jboss:domain:remoting:4.0"&gt;
    ...
    &lt;http-connector name="http-remoting-connector" connector-ref="default" sasl-authentication-factory="application-security-sasl"/&gt;
  &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this new configuration was to be used to secure the management
interfaces more suitable names should be chosen but the following
commands illustrate how to set the two authentication factories and
clear the existing security realm reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./core-service=management/management-interface=http-interface:write-attribute(name=http-authentication-factory, value=application-security-http)
./core-service=management/management-interface=http-interface:write-attribute(name=http-upgrade.sasl-authentication-factory, value=application-security-sasl)
./core-service=management/management-interface=http-interface:undefine-attribute(name=security-realm)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;management-interfaces&gt;
    &lt;http-interface http-authentication-factory="application-security-http"&gt;
      &lt;http-upgrade enabled="true" sasl-authentication-factory="application-security-sasl"/&gt;
      &lt;socket-binding http="management-http"/&gt;
    &lt;/http-interface&gt;
  &lt;/management-interfaces&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="LDAP_Based_Authentication_Migration">11.3. LDAP Authentication Migration</h3>
<div class="paragraph">
<p>The section describing how to migrate from properties based
authentication using either PicketBox or legacy security realms to
Elytron also contained a lot of additional information regarding
defining security domains, authentication factories, and how these are
mapped to be used for authentication. This section will illustrate some
equivalent LDAP configuration using legacy security realms and PicketBox
security domains and show the equivalent configuration using Elytron but
will not repeat the steps to wire it all together covered in the
previous section.</p>
</div>
<div class="paragraph">
<p>These configuration examples are developed against a test LDAP sever
with user entries like: -</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dn: uid=TestUserOne,ou=users,dc=group-to-principal,dc=wildfly,dc=org
objectClass: top
objectClass: inetOrgPerson
objectClass: uidObject
objectClass: person
objectClass: organizationalPerson
cn: Test User One
sn: Test User One
uid: TestUserOne
userPassword: {SSHA}UG8ov2rnrnBKakcARVvraZHqTa7mFWJZlWt2HA==</pre>
</div>
</div>
<div class="paragraph">
<p>The group entries then look like: -</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dn: uid=GroupOne,ou=groups,dc=group-to-principal,dc=wildfly,dc=org
objectClass: top
objectClass: groupOfUniqueNames
objectClass: uidObject
cn: Group One
uid: GroupOne
uniqueMember: uid=TestUserOne,ou=users,dc=group-to-principal,dc=wildfly,dc=org</pre>
</div>
</div>
<div class="paragraph">
<p>For authentication purposes the username will be matched against the
'uid' attribute, also the resulting group name will be taken from the
'uid' attribute of the group entry.</p>
</div>
<div class="sect3">
<h4 id="legacy-security-realm">11.3.1. Legacy Security Realm</h4>
<div class="paragraph">
<p>A connection to the LDAP server and related security realm can be
created with the following commands: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">batch
./core-service=management/ldap-connection=MyLdapConnection:add(url="ldap://localhost:10389", search-dn="uid=admin,ou=system", search-credential="secret")
 
./core-service=management/security-realm=LDAPRealm:add
./core-service=management/security-realm=LDAPRealm/authentication=ldap:add(connection="MyLdapConnection", username-attribute=uid, base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org")
 
 
./core-service=management/security-realm=LDAPRealm/authorization=ldap:add(connection=MyLdapConnection)
./core-service=management/security-realm=LDAPRealm/authorization=ldap/username-to-dn=username-filter:add(attribute=uid, base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org")
./core-service=management/security-realm=LDAPRealm/authorization=ldap/group-search=group-to-principal:add(base-dn="ou=groups,dc=group-to-principal,dc=wildfly,dc=org", iterative=true, prefer-original-connection=true, principal-attribute=uniqueMember, search-by=DISTINGUISHED_NAME, group-name=SIMPLE, group-name-attribute=uid)
run-batch</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;management&gt;
    &lt;security-realms&gt;
      ...
      &lt;security-realm name="LDAPRealm"&gt;
        &lt;authentication&gt;
          &lt;ldap connection="MyLdapConnection" base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org"&gt;
            &lt;username-filter attribute="uid"/&gt;
          &lt;/ldap&gt;
        &lt;/authentication&gt;
        &lt;authorization&gt;
          &lt;ldap connection="MyLdapConnection"&gt;
            &lt;username-to-dn&gt;
              &lt;username-filter base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org" attribute="uid"/&gt;
            &lt;/username-to-dn&gt;
            &lt;group-search group-name="SIMPLE" iterative="true" group-name-attribute="uid"&gt;
              &lt;group-to-principal search-by="DISTINGUISHED_NAME" base-dn="ou=groups,dc=group-to-principal,dc=wildfly,dc=org" prefer-original-connection="true"&gt;
                &lt;membership-filter principal-attribute="uniqueMember"/&gt;
              &lt;/group-to-principal&gt;
            &lt;/group-search&gt;
          &lt;/ldap&gt;
        &lt;/authorization&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
    &lt;outbound-connections&gt;
      &lt;ldap name="MyLdapConnection" url="ldap://localhost:10389" search-dn="uid=admin,ou=system" search-credential="secret"/&gt;
    &lt;/outbound-connections&gt;
    ...
  &lt;/management&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="picketbox-ldapextloginmodule">11.3.2. PicketBox LdapExtLoginModule</h4>
<div class="paragraph">
<p>The following commands can create a PicketBox security domain configured
to use the LdapExtLoginModule to verify a username and password.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=application-security:add
./subsystem=security/security-domain=application-security/authentication=classic:add(login-modules=[{code=LdapExtended, flag=Required, module-options={ \
java.naming.factory.initial=com.sun.jndi.ldap.LdapCtxFactory, \
java.naming.provider.url=ldap://localhost:10389, \
java.naming.security.authentication=simple, \
bindDN="uid=admin,ou=system", \
bindCredential=secret, \
baseCtxDN="ou=users,dc=group-to-principal,dc=wildfly,dc=org", \
baseFilter="(uid={0})", \
rolesCtxDN="ou=groups,dc=group-to-principal,dc=wildfly,dc=org",\
roleFilter="(uniqueMember={1})", \
roleAttributeID="uid" \
}}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:jboss:domain:security:2.0"&gt;
    ...
    &lt;security-domains&gt;
      ...
      &lt;security-domain name="application-security"&gt;
        &lt;authentication&gt;
          &lt;login-module code="LdapExtended" flag="required"&gt;
            &lt;module-option name="java.naming.factory.initial" value="com.sun.jndi.ldap.LdapCtxFactory"/&gt;
            &lt;module-option name="java.naming.provider.url" value="ldap://localhost:10389"/&gt;
            &lt;module-option name="java.naming.security.authentication" value="simple"/&gt;
            &lt;module-option name="bindDN" value="uid=admin,ou=system"/&gt;
            &lt;module-option name="bindCredential" value="secret"/&gt;
            &lt;module-option name="baseCtxDN" value="ou=users,dc=group-to-principal,dc=wildfly,dc=org"/&gt;
            &lt;module-option name="baseFilter" value="(uid={0})"/&gt;
            &lt;module-option name="rolesCtxDN" value="ou=groups,dc=group-to-principal,dc=wildfly,dc=org"/&gt;
            &lt;module-option name="roleFilter" value="(uniqueMember={1})"/&gt;
            &lt;module-option name="roleAttributeID" value="uid"/&gt;
          &lt;/login-module&gt;
        &lt;/authentication&gt;
      &lt;/security-domain&gt;
    &lt;/security-domains&gt;
  &lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="migrated">11.3.3. Migrated</h4>
<div class="paragraph">
<p>Within the Elytron subsystem a directory context can be defined for the
connection to LDAP: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/dir-context=ldap-connection:add(url=ldap://localhost:10389, principal="uid=admin,ou=system", credential-reference={clear-text=secret})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then a security realm can be created to search LDAP and verify the
supplied password: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/ldap-realm=ldap-realm:add(dir-context=ldap-connection, \
direct-verification=true, \
identity-mapping={search-base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org", \
rdn-identifier="uid", \
attribute-mapping=[{filter-base-dn="ou=groups,dc=group-to-principal,dc=wildfly,dc=org",filter="(uniqueMember={1})",from="uid",to="Roles"}]})</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the prior two examples information is loaded from LDAP to use
directly as groups or roles, in the Elytron case information can be
loaded from LDAP to associate with the identity as attributes - these
can subsequently be mapped to roles but attributes can be loaded for
other purposes as well.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
By default, if no <code>role-decoder</code> is defined for given <code>security-domain</code>,
identity attribute " `Roles`" is mapped to the identity roles.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This leads to the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:wildfly:elytron:1.0" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
    ...
    &lt;security-realms&gt;
      ...
      &lt;ldap-realm name="ldap-realm" dir-context="ldap-connection" direct-verification="true"&gt;
        &lt;identity-mapping rdn-identifier="uid" search-base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org"&gt;
          &lt;attribute-mapping&gt;
            &lt;attribute from="uid" to="Roles" filter="(uniqueMember={1})" filter-base-dn="ou=groups,dc=group-to-principal,dc=wildfly,dc=org"/&gt;
          &lt;/attribute-mapping&gt;
        &lt;/identity-mapping&gt;
      &lt;/ldap-realm&gt;
    &lt;/security-realms&gt;
    ...
    &lt;dir-contexts&gt;
      &lt;dir-context name="ldap-connection" url="ldap://localhost:10389" principal="uid=admin,ou=system"&gt;
        &lt;credential-reference clear-text="secret"/&gt;
      &lt;/dir-context&gt;
    &lt;/dir-contexts&gt;
  &lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Composite_Stores_Migration">11.4. Composite Stores Migration</h3>
<div class="paragraph">
<p>When using either PicketBox or the legacy security realms it is possible to define a configuration where authentication is performed against one identity store whilst the information used for authorization is loaded from a different store, when using WildFly Elytron this can be achieved by using an aggregate security realm.</p>
</div>
<div class="paragraph">
<p>The example here makes use of a properties file for authentication and then searches LDAP to load group / role information. Both of these are based on the previous examples within this document so the environmental information is not repeated here.</p>
</div>
<div class="sect3">
<h4 id="picketbox-based-configuration-2">11.4.1. PicketBox Based Configuration</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=application-security:add
./subsystem=security/security-domain=application-security/authentication=classic:add(login-modules=[ \
{code=UsersRoles, flag=Required, module-options={ \
password-stacking=useFirstPass, \
usersProperties=file://${jboss.server.config.dir}/example-users.properties, \
rolesProperties=file://${jboss.server.config.dir}/example-roles.properties}} \
{code=LdapExtended, flag=Required, module-options={ \
password-stacking=useFirstPass, \
java.naming.factory.initial=com.sun.jndi.ldap.LdapCtxFactory, \
java.naming.provider.url=ldap://localhost:10389, \
java.naming.security.authentication=simple, \
bindDN="uid=admin,ou=system", \
bindCredential=secret, \
baseCtxDN="ou=users,dc=group-to-principal,dc=wildfly,dc=org", \
baseFilter="(uid={0})", \
rolesCtxDN="ou=groups,dc=group-to-principal,dc=wildfly,dc=org",\
roleFilter="(uniqueMember={1})", \
roleAttributeID="uid" \
}}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following domain definition</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;security-domain name="application-security"&gt;
  &lt;authentication&gt;
    &lt;login-module code="UsersRoles" flag="required"&gt;
      &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
      &lt;module-option name="usersProperties" value="file://${jboss.server.config.dir}/example-users.properties"/&gt;
      &lt;module-option name="rolesProperties" value="file://${jboss.server.config.dir}/example-roles.properties"/&gt;
    &lt;/login-module&gt;
    &lt;login-module code="LdapExtended" flag="required"&gt;
      &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
      &lt;module-option name="java.naming.factory.initial" value="com.sun.jndi.ldap.LdapCtxFactory"/&gt;
      &lt;module-option name="java.naming.provider.url" value="ldap://localhost:10389"/&gt;
      &lt;module-option name="java.naming.security.authentication" value="simple"/&gt;
      &lt;module-option name="bindDN" value="uid=admin,ou=system"/&gt;
      &lt;module-option name="bindCredential" value="secret"/&gt;
      &lt;module-option name="baseCtxDN" value="ou=users,dc=group-to-principal,dc=wildfly,dc=org"/&gt;
      &lt;module-option name="baseFilter" value="(uid={0})"/&gt;
      &lt;module-option name="rolesCtxDN" value="ou=groups,dc=group-to-principal,dc=wildfly,dc=org"/&gt;
      &lt;module-option name="roleFilter" value="(uniqueMember={1})"/&gt;
      &lt;module-option name="roleAttributeID" value="uid"/&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/security-domain&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>During an authentication attempt the 'UsersRoles' login module will first be called to perform authentication based on the supplied credential, then the 'LdapExtLoginModule' will be called which will proceed to query LDAP to load the roles for the identity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./core-service=management/ldap-connection=MyLdapConnection:add(url="ldap://localhost:10389", search-dn="uid=admin,ou=system", search-credential="secret")

./core-service=management/security-realm=ApplicationSecurity:add
./core-service=management/security-realm=ApplicationSecurity/authentication=properties:add(path=example-users.properties, relative-to=jboss.server.config.dir, plain-text=true)

batch
./core-service=management/security-realm=ApplicationSecurity/authorization=ldap:add(connection=MyLdapConnection)
./core-service=management/security-realm=ApplicationSecurity/authorization=ldap/username-to-dn=username-filter:add(attribute=uid, base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org")
./core-service=management/security-realm=ApplicationSecurity/authorization=ldap/group-search=group-to-principal:add(base-dn="ou=groups,dc=group-to-principal,dc=wildfly,dc=org", iterative=true, prefer-original-connection=true, principal-attribute=uniqueMember, search-by=DISTINGUISHED_NAME, group-name=SIMPLE, group-name-attribute=uid)
run-batch</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following realm definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;security-realm name="ApplicationSecurity"&gt;
  &lt;authentication&gt;
    &lt;properties path="example-users.properties" relative-to="jboss.server.config.dir" plain-text="true"/&gt;
  &lt;/authentication&gt;
  &lt;authorization&gt;
    &lt;ldap connection="MyLdapConnection"&gt;
      &lt;username-to-dn&gt;
        &lt;username-filter base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org" attribute="uid"/&gt;
      &lt;/username-to-dn&gt;
      &lt;group-search group-name="SIMPLE" iterative="true" group-name-attribute="uid"&gt;
        &lt;group-to-principal search-by="DISTINGUISHED_NAME" base-dn="ou=groups,dc=group-to-principal,dc=wildfly,dc=org" prefer-original-connection="true"&gt;
          &lt;membership-filter principal-attribute="uniqueMember"/&gt;
        &lt;/group-to-principal&gt;
      &lt;/group-search&gt;
    &lt;/ldap&gt;
  &lt;/authorization&gt;
&lt;/security-realm&gt;

&lt;outbound-connections&gt;
  &lt;ldap name="MyLdapConnection" url="ldap://localhost:10389" search-dn="uid=admin,ou=system" search-credential="secret"/&gt;
&lt;/outbound-connections&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the PicketBox example, authentication is first performed using the properties file - then group searching is performed against LDAP.</p>
</div>
</div>
<div class="sect3">
<h4 id="migrated-wildfly-elytron-configuration">11.4.2. Migrated WildFly Elytron Configuration</h4>
<div class="paragraph">
<p>The equivalent WildFly Elytron configuration can be defined with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/dir-context=ldap-connection:add(url=ldap://localhost:10389, principal="uid=admin,ou=system", credential-reference={clear-text=secret})

./subsystem=elytron/ldap-realm=ldap-realm:add(dir-context=ldap-connection, \
direct-verification=true, \
identity-mapping={search-base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org", \
rdn-identifier="uid", \
attribute-mapping=[{filter-base-dn="ou=groups,dc=group-to-principal,dc=wildfly,dc=org",filter="(uniqueMember={1})",from="uid",to="Roles"}]})

./subsystem=elytron/properties-realm=application-properties:add(users-properties={path=example-users.properties, relative-to=jboss.server.config.dir, plain-text=true, digest-realm-name="Application Security"}, groups-properties={path=example-roles.properties, relative-to=jboss.server.config.dir}, groups-attribute=Roles)

./subsystem=elytron/aggregate-realm=combined-realm:add(authentication-realm=application-properties, authorization-realm=ldap-realm)

./subsystem=elytron/security-domain=application-security:add(realms=[{realm=combined-realm}], default-realm=combined-realm, permission-mapper=default-permission-mapper)
./subsystem=elytron/http-authentication-factory=application-security-http:add(http-server-mechanism-factory=global, security-domain=application-security, mechanism-configurations=[{mechanism-name=BASIC}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following realm definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:wildfly:elytron:1.1" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
  ...
  &lt;security-domains&gt;
    ...
    &lt;security-domain name="application-security" default-realm="combined-realm" permission-mapper="default-permission-mapper"&gt;
      &lt;realm name="combined-realm"/&gt;
    &lt;/security-domain&gt;
  &lt;/security-domains&gt;
  &lt;security-realms&gt;
    &lt;aggregate-realm name="combined-realm" authentication-realm="application-properties" authorization-realm="ldap-realm"/&gt;
      ...
      &lt;properties-realm name="application-properties" groups-attribute="Roles"&gt;
        &lt;users-properties path="example-users.properties" relative-to="jboss.server.config.dir" digest-realm-name="Application Security" plain-text="true"/&gt;
        &lt;groups-properties path="example-roles.properties" relative-to="jboss.server.config.dir"/&gt;
      &lt;/properties-realm&gt;
      &lt;ldap-realm name="ldap-realm" dir-context="ldap-connection" direct-verification="true"&gt;
        &lt;identity-mapping rdn-identifier="uid" search-base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org"&gt;
          &lt;attribute-mapping&gt;
            &lt;attribute from="uid" to="Roles" filter="(uniqueMember={1})" filter-base-dn="ou=groups,dc=group-to-principal,dc=wildfly,dc=org"/&gt;
          &lt;/attribute-mapping&gt;
        &lt;/identity-mapping&gt;
      &lt;/ldap-realm&gt;
  &lt;/security-realms&gt;
  ...
  &lt;http&gt;
    ...
    &lt;http-authentication-factory name="application-security-http" http-server-mechanism-factory="global" security-domain="application-security"&gt;
      &lt;mechanism-configuration&gt;
        &lt;mechanism mechanism-name="BASIC"/&gt;
      &lt;/mechanism-configuration&gt;
    &lt;/http-authentication-factory&gt;
    ...
  &lt;/http&gt;
  ...
  &lt;dir-contexts&gt;
    &lt;dir-context name="ldap-connection" url="ldap://localhost:10389" principal="uid=admin,ou=system"&gt;
      &lt;credential-reference clear-text="secret"/&gt;
    &lt;/dir-context&gt;
  &lt;/dir-contexts&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the WildFly Elytron example a new security realm 'aggregate-realm' has been defined, this definition specifies which of the defined security realms should be used for the authentication step and which of the security realms should be used for the loading of the identity used for subsequent authorization decisions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Database_Authentication_Migration">11.5. Database Authentication</h3>
<div class="paragraph">
<p>The section describing how to migrate from database accessible via JDBC
datasource based authentication using PicketBox to Elytron. This section
will illustrate some equivalent configuration using PicketBox security
domains and show the equivalent configuration using Elytron but will not
repeat the steps to wire it all together covered in the previous
sections.</p>
</div>
<div class="paragraph">
<p>These configuration examples are developed against a test database with
users table like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">CREATE TABLE User (
    id BIGINT NOT NULL,
    username VARCHAR(255),
    password VARCHAR(255),
    role ENUM('admin', 'manager', 'user'),
    PRIMARY KEY (id),
    UNIQUE (username)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For authentication purposes the username will be matched against the '
`username&#8217; column, password will be expected in hex-encoded MD5 hash in
' `password&#8217; column. User role for authorization purposes will be taken
from ' `role&#8217; column.</p>
</div>
<div class="sect3">
<h4 id="picketbox-database-loginmodule">11.5.1. PicketBox Database LoginModule</h4>
<div class="paragraph">
<p>The following commands can create a PicketBox security domain configured
to use database accessible via JDBC datasource to verify a username and
password and to assign roles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=application-security/:add
./subsystem=security/security-domain=application-security/authentication=classic:add(login-modules=[{code=Database, flag=Required, module-options={ \
    dsJndiName="java:jboss/datasources/ExampleDS", \
    principalsQuery="SELECT password FROM User WHERE username = ?", \
    rolesQuery="SELECT role, 'Roles' FROM User WHERE username = ?", \
    hashAlgorithm=MD5, \
    hashEncoding=base64 \
}}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        &lt;subsystem xmlns="urn:jboss:domain:security:2.0"&gt;
            &lt;security-domains&gt;
                ...
                &lt;security-domain name="application-security"&gt;
                    &lt;authentication&gt;
                        &lt;login-module code="Database" flag="required"&gt;
                            &lt;module-option name="dsJndiName" value="java:jboss/datasources/ExampleDS"/&gt;
                            &lt;module-option name="principalsQuery" value="SELECT password FROM User WHERE username = ?"/&gt;
                            &lt;module-option name="rolesQuery" value="SELECT role, 'Roles' FROM User WHERE username = ?"/&gt;
                            &lt;module-option name="hashAlgorithm" value="MD5"/&gt;
                            &lt;module-option name="hashEncoding" value="base64"/&gt;
                        &lt;/login-module&gt;
                    &lt;/authentication&gt;
                &lt;/security-domain&gt;
            &lt;/security-domains&gt;
        &lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="migrated">11.5.2. Migrated</h4>
<div class="paragraph">
<p>Within the Elytron subsystem to use database accesible via JDBC you need
to define <code>jdbc-realm</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/jdbc-realm=jdbc-realm:add(principal-query=[{ \
    data-source=ExampleDS, \
    sql="SELECT role, password FROM User WHERE username = ?", \
    attribute-mapping=[{index=1, to=Roles}] \
    simple-digest-mapper={algorithm=simple-digest-md5, password-index=2}, \
}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following overall configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        &lt;subsystem xmlns="urn:wildfly:elytron:1.0" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
            ...
            &lt;security-realms&gt;
                ...
                &lt;jdbc-realm name="jdbc-realm"&gt;
                    &lt;principal-query sql="SELECT role, password FROM User WHERE username = ?" data-source="ExampleDS"&gt;
                        &lt;attribute-mapping&gt;
                            &lt;attribute to="Roles" index="1"/&gt;
                        &lt;/attribute-mapping&gt;
                        &lt;simple-digest-mapper password-index="2"/&gt;
                    &lt;/principal-query&gt;
                &lt;/jdbc-realm&gt;
                ...
            &lt;/security-realms&gt;
            ...
        &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In comparison with PicketBox solution, Elytron <code>jdbc-realm</code> use one SQL
query to obtain all user attributes and credentials. Their extraction
from SQL result specifies mappers.</p>
</div>
</div>
<div class="sect3">
<h4 id="n-m-relation-beetween-user-and-roles">11.5.3. N-M relation beetween user and roles</h4>
<div class="paragraph">
<p>When using a n:m-relation beetween user and roles (which means: the user has multiple roles), the previous configuration does not work.</p>
</div>
<div class="paragraph">
<p>The database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">CREATE TABLE User (
id BIGINT NOT NULL,
username VARCHAR(255),
password VARCHAR(255),
PRIMARY KEY (id),
UNIQUE (username)
)

CREATE TABLE Role(
id BIGINT NOT NULL,
rolename VARCHAR(255),
PRIMARY KEY (id),
UNIQUE (rolename)
)

CREATE TABLE Userrole(
userid BIGINT not null,
roleid BIGINT not null,
PRIMARY KEY (userid, roleid),
FOREIGN KEY (userid) references User(id,
FOREIGN KEY (roleid) references Role(id)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you need two configure two principal queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;jdbc-realm name="jdbc-realm"&gt;
    &lt;principal-query sql="SELECT PASSWORD FROM USER WHERE USERNAME = ?" data-source="ExampleDS"&gt;
        &lt;clear-password-mapper password-index="1"/&gt;
    &lt;/principal-query&gt;
    &lt;principal-query sql="SELECT R.ROLENAME from ROLE AS R, USERROLE AS UR, USER AS U WHERE U.USERNAME=? AND UR.ROLEID = R.ID AND UR.USERID = U.ID" data-source="ExampleDS"&gt;
        &lt;attribute-mapping&gt;
            &lt;attribute to="roles" index="1"/&gt;
        &lt;/attribute-mapping&gt;
    &lt;/principal-query&gt;
&lt;/jdbc-realm&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second query needs an attribute mapping to decode the selected rolename column (index 1):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;mappers&gt;
...
&lt;simple-role-decoder name="from-roles-attribute" attribute="roles"/&gt;
...
&lt;/mappers&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The role decoder is referenced by the security domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;security-domain name="MyDomain" default-realm="jdbc-realm" permission-mapper="default-permission-mapper"&gt;
&lt;realm name="MyDbRealm" role-decoder="from-roles-attribute"/&gt;
&lt;/security-domain&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Kerberos_Based_Authentication_Migration">11.6. Kerberos Authentication Migration</h3>
<div class="paragraph">
<p>When working with Kerberos configuration it is possible for the
application server to rely on configuration from the environment or the
key configuration can be specified using system properties, for the
purpose of these examples I define system properties - these properties
are applicable to both the legacy configuration and the migrated Elytron
configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./system-property=sun.security.krb5.debug:add(value=true)
./system-property=java.security.krb5.realm:add(value=ELYTRON.ORG)
./system-property=java.security.krb5.kdc:add(value=kdc.elytron.org)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line makes debugging easier but the last two lines specify the
Kerberos realm in use and the address of the KDC.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;system-properties&gt;
    &lt;property name="sun.security.krb5.debug" value="true"/&gt;
    &lt;property name="java.security.krb5.realm" value="ELYTRON.ORG"/&gt;
    &lt;property name="java.security.krb5.kdc" value="kdc.elytron.org"/&gt;
  &lt;/system-properties&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="http-authentication">11.6.1. HTTP Authentication</h4>
<div class="sect4">
<h5 id="legacy-security-realm">Legacy Security Realm</h5>
<div class="paragraph">
<p>A legacy security realm can be define so that SPNEGO authentication can
be enabled for the HTTP management interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./core-service=management/security-realm=Kerberos:add
./core-service=management/security-realm=Kerberos/server-identity=kerberos:add
./core-service=management/security-realm=Kerberos/server-identity=kerberos/keytab=HTTP\/test-server.elytron.org@ELYTRON.ORG:add(path=/home/darranl/src/kerberos/test-server.keytab, debug=true)
./core-service=management/security-realm=Kerberos/authentication=kerberos:add(remove-realm=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;security-realms&gt;
    ...
    &lt;security-realm name="Kerberos"&gt;
      &lt;server-identities&gt;
        &lt;kerberos&gt;
          &lt;keytab principal="HTTP/test-server.elytron.org@ELYTRON.ORG" path="/home/darranl/src/kerberos/test-server.keytab" debug="true"/&gt;
        &lt;/kerberos&gt;
      &lt;/server-identities&gt;
      &lt;authentication&gt;
        &lt;kerberos remove-realm="true"/&gt;
      &lt;/authentication&gt;
    &lt;/security-realm&gt;
  &lt;/security-realms&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="application-spnego">Application SPNEGO</h5>
<div class="paragraph">
<p>Alternatively deployed applications would make use of a pair of security
domains.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">./subsystem=security/security-domain=host:add
./subsystem=security/security-domain=host/authentication=classic:add
./subsystem=security/security-domain=host/authentication=classic/login-module=1:add(code=Kerberos, flag=Required, module-options={storeKey=true, useKeyTab=true, principal=HTTP/test-server.elytron.org@ELYTRON.ORG, keyTab=/home/darranl/src/kerberos/test-server.keytab, debug=true}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=SPNEGO:add
./subsystem=security/security-domain=SPNEGO/authentication=classic:add
./subsystem=security/security-domain=SPNEGO/authentication=classic/login-module=1:add(code=SPNEGO, flag=requisite,  module-options={password-stacking=useFirstPass, serverSecurityDomain=host})
./subsystem=security/security-domain=SPNEGO/authentication=classic/login-module=1:write-attribute(name=module, value=org.jboss.security.negotiation)
./subsystem=security/security-domain=SPNEGO/authentication=classic/login-module=2:add(code=UsersRoles, flag=required, module-options={password-stacking=useFirstPass, usersProperties=file:///home/darranl/src/kerberos/spnego-users.properties, rolesProperties=file:///home/darranl/src/kerberos/spnego-roles.properties, defaultUsersProperties=file:///home/darranl/src/kerberos/spnego-users.properties, defaultRolesProperties=file:///home/darranl/src/kerberos/spnego-roles.properties})</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:jboss:domain:security:2.0"&gt;
    &lt;security-domains&gt;
      ...
      &lt;security-domain name="host"&gt;
        &lt;authentication&gt;
          &lt;login-module name="1" code="Kerberos" flag="required"&gt;
            &lt;module-option name="storeKey" value="true"/&gt;
            &lt;module-option name="useKeyTab" value="true"/&gt;
            &lt;module-option name="principal" value="HTTP/test-server.elytron.org@ELYTRON.ORG"/&gt;
            &lt;module-option name="keyTab" value="/home/darranl/src/kerberos/test-server.keytab"/&gt;
            &lt;module-option name="debug" value="true"/&gt;
          &lt;/login-module&gt;
        &lt;/authentication&gt;
      &lt;/security-domain&gt;
      &lt;security-domain name="SPNEGO"&gt;
        &lt;authentication&gt;
          &lt;login-module name="1" code="SPNEGO" flag="requisite" module="org.jboss.security.negotiation"&gt;
            &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
            &lt;module-option name="serverSecurityDomain" value="host"/&gt;
          &lt;/login-module&gt;
          &lt;login-module name="2" code="UsersRoles" flag="required"&gt;
            &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
            &lt;module-option name="usersProperties" value="file:///home/darranl/src/kerberos/spnego-users.properties"/&gt;
            &lt;module-option name="rolesProperties" value="file:///home/darranl/src/kerberos/spnego-roles.properties"/&gt;
            &lt;module-option name="defaultUsersProperties" value="file:///home/darranl/src/kerberos/spnego-users.properties"/&gt;
            &lt;module-option name="defaultRolesProperties" value="file:///home/darranl/src/kerberos/spnego-roles.properties"/&gt;
          &lt;/login-module&gt;
        &lt;/authentication&gt;
      &lt;/security-domain&gt;
    &lt;/security-domains&gt;
  &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An application can now be deployed referencing the SPNEGO security
domain and secured with SPNEGO mechanism.</p>
</div>
</div>
<div class="sect4">
<h5 id="migrated-spnego">Migrated SPNEGO</h5>
<div class="paragraph">
<p>The equivalent configuration can be achieved with WildFly Elytron by
first defining a security realm which will be used to load identity
information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/properties-realm=spnego-properties:add(users-properties={path=/home/darranl/src/kerberos/spnego-users.properties, plain-text=true, digest-realm-name=ELYTRON.ORG}, groups-properties={path=/home/darranl/src/kerberos/spnego-roles.properties})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next a Kerberos security factory is defined which allows the server to
load it&#8217;s own Kerberos identity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/kerberos-security-factory=test-server:add(path=/home/darranl/src/kerberos/test-server.keytab, principal=HTTP/test-server.elytron.org@ELYTRON.ORG, debug=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the previous examples we define a security realm to pull
together the policy as well as a HTTP authentication factory for the
authentication policy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/security-domain=SPNEGODomain:add(default-realm=spnego-properties, realms=[{realm=spnego-properties, role-decoder=groups-to-roles}], permission-mapper=default-permission-mapper)
./subsystem=elytron/http-authentication-factory=spnego-http-authentication:add(security-domain=SPNEGODomain, http-server-mechanism-factory=global,mechanism-configurations=[{mechanism-name=SPNEGO, credential-security-factory=test-server}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Overall this results in the following configuration: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:wildfly:elytron:1.0" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
    ...
    &lt;security-domains&gt;
    ...
      &lt;security-domain name="SPNEGODomain" default-realm="spnego-properties" permission-mapper="default-permission-mapper"&gt;
        &lt;realm name="spnego-properties" role-decoder="groups-to-roles"/&gt;
      &lt;/security-domain&gt;
    &lt;/security-domains&gt;
    &lt;security-realms&gt;
      ...
      &lt;properties-realm name="spnego-properties"&gt;
        &lt;users-properties path="/home/darranl/src/kerberos/spnego-users.properties" digest-realm-name="ELYTRON.ORG" plain-text="true"/&gt;
        &lt;groups-properties path="/home/darranl/src/kerberos/spnego-roles.properties"/&gt;
      &lt;/properties-realm&gt;
    &lt;/security-realms&gt;
    &lt;credential-security-factories&gt;
      &lt;kerberos-security-factory name="test-server" principal="HTTP/test-server.elytron.org@ELYTRON.ORG" path="/home/darranl/src/kerberos/test-server.keytab" debug="true"/&gt;
    &lt;/credential-security-factories&gt;
    ...
    &lt;http&gt;
      ...
      &lt;http-authentication-factory name="spnego-http-authentication" http-server-mechanism-factory="global" security-domain="SPNEGODomain"&gt;
        &lt;mechanism-configuration&gt;
          &lt;mechanism mechanism-name="SPNEGO" credential-security-factory="test-server"/&gt;
        &lt;/mechanism-configuration&gt;
      &lt;/http-authentication-factory&gt;
      ...
    &lt;/http&gt;
    ...
  &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, to enable SPNEGO authentication for the HTTP management interface,
update this interface to reference the <code>http-authentication-factory</code>
defined above, as described in the
<a href="https://docs.jboss.org/author/display/WFLY/Migrate+Legacy+Security+to+Elytron+Security#MigrateLegacySecuritytoElytronSecurity-MigratedConfiguration">properties
authentication section</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, to secure an application using SPNEGO authentication, an
application security domain can be defined in the Undertow subsystem to
map security domains to the <code>http-authentication-factory</code> defined above,
as described in the
<a href="https://docs.jboss.org/author/display/WFLY/Migrate+Legacy+Security+to+Elytron+Security#MigrateLegacySecuritytoElytronSecurity-FullyMigratedConfiguration">properties
authentication section</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="remoting-sasl-authentication">11.6.2. Remoting / SASL Authentication</h4>
<div class="sect4">
<h5 id="legacy-security-realm-1">Legacy Security Realm</h5>
<div class="paragraph">
<p>It is also possible to define a legacy security realm for Kerberos /
GSSAPI SASL authenticatio for Remoting authentication such as the native
management interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./core-service=management/security-realm=Kerberos:add
./core-service=management/security-realm=Kerberos/server-identity=kerberos:add
./core-service=management/security-realm=Kerberos/server-identity=kerberos/keytab=remote\/test-server.elytron.org@ELYTRON.ORG:add(path=/home/darranl/src/kerberos/remote-test-server.keytab, debug=true)
./core-service=management/security-realm=Kerberos/authentication=kerberos:add(remove-realm=true)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;management&gt;
    &lt;security-realms&gt;
      ...
      &lt;security-realm name="Kerberos"&gt;
        &lt;server-identities&gt;
          &lt;kerberos&gt;
            &lt;keytab principal="remote/test-server.elytron.org@ELYTRON.ORG" path="/home/darranl/src/kerberos/remote-test-server.keytab" debug="true"/&gt;
          &lt;/kerberos&gt;
        &lt;/server-identities&gt;
        &lt;authentication&gt;
          &lt;kerberos remove-realm="true"/&gt;
        &lt;/authentication&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
    ...
  &lt;/management&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="migrated-gssapi">Migrated GSSAPI</h5>
<div class="paragraph">
<p>The steps to define the equivalent Elytron configuration are very
similar to the HTTP example.</p>
</div>
<div class="paragraph">
<p>First define the security realm to load the identity from: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./path=kerberos:add(relative-to=user.home, path=src/kerberos)
./subsystem=elytron/properties-realm=kerberos-properties:add(users-properties={path=kerberos-users.properties, relative-to=kerberos, digest-realm-name=ELYTRON.ORG}, groups-properties={path=kerberos-groups.properties, relative-to=kerberos})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then define the Kerberos security factory for the server&#8217;s identity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/kerberos-security-factory=test-server:add(relative-to=kerberos, path=remote-test-server.keytab, principal=remote/test-server.elytron.org@ELYTRON.ORG)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally define the security domain and this time a SASL authentication
factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/security-domain=KerberosDomain:add(default-realm=kerberos-properties, realms=[{realm=kerberos-properties, role-decoder=groups-to-roles}], permission-mapper=default-permission-mapper)
./subsystem=elytron/sasl-authentication-factory=gssapi-authentication-factory:add(security-domain=KerberosDomain, sasl-server-factory=elytron, mechanism-configurations=[{mechanism-name=GSSAPI, credential-security-factory=test-server}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following subsystem configuration: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  &lt;subsystem xmlns="urn:wildfly:elytron:1.0" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
    ...
    &lt;security-domains&gt;
      ...
      &lt;security-domain name="KerberosDomain" default-realm="kerberos-properties" permission-mapper="default-permission-mapper"&gt;
        &lt;realm name="kerberos-properties" role-decoder="groups-to-roles"/&gt;
      &lt;/security-domain&gt;
    &lt;/security-domains&gt;
    &lt;security-realms&gt;
     ...
       &lt;properties-realm name="kerberos-properties"&gt;
         &lt;users-properties path="kerberos-users.properties" relative-to="kerberos" digest-realm-name="ELYTRON.ORG"/&gt;
         &lt;groups-properties path="kerberos-groups.properties" relative-to="kerberos"/&gt;
       &lt;/properties-realm&gt;
     &lt;/security-realms&gt;
     &lt;credential-security-factories&gt;
       &lt;kerberos-security-factory name="test-server" principal="remote/test-server.elytron.org@ELYTRON.ORG" path="remote-test-server.keytab" relative-to="kerberos"/&gt;
     &lt;/credential-security-factories&gt;
     ...
     &lt;sasl&gt;
       ...
       &lt;sasl-authentication-factory name="gssapi-authentication-factory" sasl-server-factory="elytron" security-domain="KerberosDomain"&gt;
         &lt;mechanism-configuration&gt;
           &lt;mechanism mechanism-name="GSSAPI" credential-security-factory="test-server"/&gt;
         &lt;/mechanism-configuration&gt;
       &lt;/sasl-authentication-factory&gt;
       ...
     &lt;/sasl&gt;
   &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The management interface or Remoting connectors can now be updated to
reference the SASL authentication factory.</p>
</div>
<div class="paragraph">
<p>The two Elytron examples defined here could also be combined into one to
use a shared security domain and security realm and just use protocol
specific authentication factories each referencing their own Kerberos
security factory.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Caching_Migration">11.7. Caching Migration</h3>
<div class="paragraph">
<p>Where a PicketBox based security domain is defined it is possible to enable caching for that security domain, this enables subsequent hits to the identity store to be avoided as an in memory cache can be used instead, this example demonstrates how caching can be used with a WildFly Elytron based configuration.</p>
</div>
<div class="paragraph">
<p>The purpose of this chapter is to highlight the migration of a configuration with caching enabled, this example is based in the previous LDAP example but with caching enabled.</p>
</div>
<div class="sect3">
<h4 id="picketbox-example">11.7.1. PicketBox Example</h4>
<div class="paragraph">
<p>A PicketBox based security domain can be defined with the following commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=application-security:add(cache-type=default)
./subsystem=security/security-domain=application-security/authentication=classic:add(login-modules=[{code=LdapExtended, flag=Required, module-options={ \
java.naming.factory.initial=com.sun.jndi.ldap.LdapCtxFactory, \
java.naming.provider.url=ldap://localhost:10389, \
java.naming.security.authentication=simple, \
bindDN="uid=admin,ou=system", \
bindCredential=secret, \
baseCtxDN="ou=users,dc=group-to-principal,dc=wildfly,dc=org", \
baseFilter="(uid={0})", \
rolesCtxDN="ou=groups,dc=group-to-principal,dc=wildfly,dc=org",\
roleFilter="(uniqueMember={1})", \
roleAttributeID="uid" \
}}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in the following security domain definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:security:2.0"&gt;
  &lt;security-domains&gt;
    ...
    &lt;security-domain name="application-security" cache-type="default"&gt;
      &lt;authentication&gt;
        &lt;login-module code="LdapExtended" flag="required"&gt;
          &lt;module-option name="java.naming.factory.initial" value="com.sun.jndi.ldap.LdapCtxFactory"/&gt;
          &lt;module-option name="java.naming.provider.url" value="ldap://localhost:10389"/&gt;
          &lt;module-option name="java.naming.security.authentication" value="simple"/&gt;
          &lt;module-option name="bindDN" value="uid=admin,ou=system"/&gt;
          &lt;module-option name="bindCredential" value="secret"/&gt;
          &lt;module-option name="baseCtxDN" value="ou=users,dc=group-to-principal,dc=wildfly,dc=org"/&gt;
          &lt;module-option name="baseFilter" value="(uid={0})"/&gt;
          &lt;module-option name="rolesCtxDN" value="ou=groups,dc=group-to-principal,dc=wildfly,dc=org"/&gt;
          &lt;module-option name="roleFilter" value="(uniqueMember={1})"/&gt;
          &lt;module-option name="roleAttributeID" value="uid"/&gt;
        &lt;/login-module&gt;
      &lt;/authentication&gt;
    &lt;/security-domain&gt;
  &lt;/security-domains&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="migrated-example">11.7.2. Migrated Example</h4>
<div class="paragraph">
<p>When using WildFly Elytron where caching is required the individual security realm is wrapped using a cache, a migrated configuration can be defined with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/dir-context=ldap-connection:add(url=ldap://localhost:10389, principal="uid=admin,ou=system", credential-reference={clear-text=secret})
./subsystem=elytron/ldap-realm=ldap-realm:add(dir-context=ldap-connection, \
direct-verification=true, \
identity-mapping={search-base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org", \
rdn-identifier="uid", \
attribute-mapping=[{filter-base-dn="ou=groups,dc=group-to-principal,dc=wildfly,dc=org",filter="(uniqueMember={1})",from="uid",to="Roles"}]})
./subsystem=elytron/caching-realm=cached-ldap:add(realm=ldap-realm)</code></pre>
</div>
</div>
<div class="paragraph">
<p>These can then be used in a security domain and subsequently an authentication factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/security-domain=application-security:add(realms=[{realm=cached-ldap}], default-realm=cached-ldap, permission-mapper=default-permission-mapper)
./subsystem=elytron/http-authentication-factory=application-security-http:add(http-server-mechanism-factory=global, security-domain=application-security, mechanism-configurations=[{mechanism-name=BASIC}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this final step it is very important that the caching-realm is referenced rather than the original realm otherwise caching will be bypassed.</p>
</div>
<div class="paragraph">
<p>This results in the following definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:wildfly:elytron:1.1" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
  ...
  &lt;security-domains&gt;
    ...
    &lt;security-domain name="application-security" default-realm="cached-ldap" permission-mapper="default-permission-mapper"&gt;
      &lt;realm name="cached-ldap"/&gt;
    &lt;/security-domain&gt;
  &lt;/security-domains&gt;
  &lt;security-realms&gt;
    ...
    &lt;ldap-realm name="ldap-realm" dir-context="ldap-connection" direct-verification="true"&gt;
      &lt;identity-mapping rdn-identifier="uid" search-base-dn="ou=users,dc=group-to-principal,dc=wildfly,dc=org"&gt;
        &lt;attribute-mapping&gt;
          &lt;attribute from="uid" to="Roles" filter="(uniqueMember={1})" filter-base-dn="ou=groups,dc=group-to-principal,dc=wildfly,dc=org"/&gt;
        &lt;/attribute-mapping&gt;
      &lt;/identity-mapping&gt;
    &lt;/ldap-realm&gt;
    &lt;caching-realm name="cached-ldap" realm="ldap-realm"/&gt;
  &lt;/security-realms&gt;
  ...
  &lt;http&gt;
    ...
    &lt;http-authentication-factory name="application-security-http" http-server-mechanism-factory="global" security-domain="application-security"&gt;
      &lt;mechanism-configuration&gt;
        &lt;mechanism mechanism-name="BASIC"/&gt;
      &lt;/mechanism-configuration&gt;
    &lt;/http-authentication-factory&gt;
    ...
  &lt;/http&gt;
  ...
  &lt;dir-contexts&gt;
    &lt;dir-context name="ldap-connection" url="ldap://localhost:10389" principal="uid=admin,ou=system"&gt;
      &lt;credential-reference clear-text="secret"/&gt;
    &lt;/dir-context&gt;
  &lt;/dir-contexts&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clients">11.8. Clients</h3>

</div>
<div class="sect2">
<h3 id="Application_Client_Migration">11.9. Application Client Migration</h3>
<div class="sect3">
<h4 id="naming-client">11.9.1. Naming Client</h4>
<div class="paragraph">
<p>This migration example assumes a client application performs a remote
JNDI lookup using an ﻿﻿ <code>InitialContext</code> backed by the
<code>org.jboss.naming.remote.client.InitialContextFactory</code> class.</p>
</div>
<div class="sect4">
<h5 id="original-configuration">Original Configuration</h5>
<div class="paragraph">
<p>An <code>InitialContext</code> backed by the
<code>org.jboss.naming.remote.client.InitialContextFactory</code> class can be
created by specifying properties that contain the URL of the naming
provider to connect to along with appropriate user credentials:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Properties properties = new Properties();
properties.put(Context.INITIAL_CONTEXT_FACTORY, "org.jboss.naming.remote.client.InitialContextFactory");
properties.put(Context.PROVIDER_URL, "http-remoting://127.0.0.1:8080");
properties.put(Context.SECURITY_PRINCIPAL, "bob");
properties.put(Context.SECURITY_CREDENTIALS, "secret");
InitialContext context = new InitialContext(properties);
Bar bar = (Bar) context.lookup("foo/bar");
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="migrated-configuration">Migrated Configuration</h5>
<div class="paragraph">
<p>An <code>InitialContext</code> backed by the
<code>org.wildfly.naming.client.WildFlyInitialContextFactory</code> class can be
created by specifying a property that contains the URL of the naming
provider to connect to. The user credentials can be specified using a
WildFly client configuration file or programmatically.</p>
</div>
<div class="sect5">
<h6 id="configuration-file-approach">Configuration File Approach</h6>
<div class="paragraph">
<p>A <code>wildfly-config.xml</code> file that contains the user credentials to use
when establishing a connection to the naming provider can be added to
the client application&#8217;s <code>META-INF</code> directory:</p>
</div>
<div class="paragraph">
<p><strong>wildfly-config.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;configuration&gt;
    &lt;authentication-client xmlns="urn:elytron:1.0"&gt;
        &lt;authentication-rules&gt;
            &lt;rule use-configuration="namingConfig"&gt;
                &lt;match-host name="127.0.0.1"/&gt;
            &lt;/rule&gt;
        &lt;/authentication-rules&gt;
        &lt;authentication-configurations&gt;
            &lt;configuration name="namingConfig"&gt;
                &lt;set-user-name name="bob"/&gt;
                &lt;credentials&gt;
                    &lt;clear-password password="secret"/&gt;
                &lt;/credentials&gt;
            &lt;/configuration&gt;
        &lt;/authentication-configurations&gt;
    &lt;/authentication-client&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An <code>InitialContext</code> can then be created as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Properties properties = new Properties();
properties.put(Context.INITIAL_CONTEXT_FACTORY, "org.wildfly.naming.client.WildFlyInitialContextFactory");
properties.put(Context.PROVIDER_URL, "remote+http://127.0.0.1:8080");
InitialContext context = new InitialContext(properties);
Bar bar = (Bar) context.lookup("foo/bar");
...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="programmatic-approach">Programmatic Approach</h6>
<div class="paragraph">
<p>The user credentials to use when establishing a connection to the naming
provider can be specified directly in the client application&#8217;s code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">// create your authentication configuration
AuthenticationConfiguration namingConfig = AuthenticationConfiguration.empty().useName("bob").usePassword("secret");
 
// create your authentication context
AuthenticationContext context = AuthenticationContext.empty().with(MatchRule.ALL.matchHost("127.0.0.1"), namingConfig);
 
// create a callable that creates and uses an InitialContext
Callable&lt;Void&gt; callable = () -&gt; {
    Properties properties = new Properties();
    properties.put(Context.INITIAL_CONTEXT_FACTORY, "org.wildfly.naming.client.WildFlyInitialContextFactory");
    properties.put(Context.PROVIDER_URL, "remote+http://127.0.0.1:8080");
    InitialContext context = new InitialContext(properties);
    Bar bar = (Bar) context.lookup("foo/bar");
    ...
    return null;
};
 
// use your authentication context to run your callable
context.runCallable(callable);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ejb-client">11.9.2. EJB Client</h4>
<div class="paragraph">
<p>This migration example assumes a client application is configured to
invoke an EJB deployed on a remote server using a
<code>jboss-ejb-client.properties</code> file.</p>
</div>
<div class="sect4">
<h5 id="original-configuration-1">Original Configuration</h5>
<div class="paragraph">
<p>A <code>jboss-ejb-client.properties</code> file that contains the information
needed to connect to the remote server can be specified in a client
application&#8217;s <code>META-INF</code> directory:</p>
</div>
<div class="paragraph">
<p><strong>jboss-ejb-client.properties</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false
remote.connections=default
remote.connection.default.host=127.0.0.1
remote.connection.default.port = 8080
remote.connection.default.username=bob
remote.connection.default.password=secret</pre>
</div>
</div>
<div class="paragraph">
<p>An EJB can then be looked up and a method can be invoked on it as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">// create an InitialContext
Properties properties = new Properties();
properties.put(Context.INITIAL_CONTEXT_FACTORY, "org.jboss.naming.remote.client.InitialContextFactory");
properties.put(Context.URL_PKG_PREFIXES, "org.jboss.ejb.client.naming");
InitialContext context = new InitialContext(properties);
 
// look up an EJB and invoke one of its methods
RemoteCalculator statelessRemoteCalculator = (RemoteCalculator) context.lookup(
    "ejb:/ejb-remote-server-side//CalculatorBean!" + RemoteCalculator.class.getName());
int sum = statelessRemoteCalculator.add(101, 202);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="migrated-configuration-1">Migrated Configuration</h5>
<div class="paragraph">
<p>The information needed to connect to the remote server can be specified
using a WildFly client configuration file or programmatically.</p>
</div>
<div class="sect5">
<h6 id="configuration-file-approach-1">Configuration File Approach</h6>
<div class="paragraph">
<p>A <code>wildfly-config.xml</code> file that contains the information needed to
connect to the remote server can be added to the client application&#8217;s
<code>META-INF</code> directory:</p>
</div>
<div class="paragraph">
<p><strong>wildfly-config.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;configuration&gt;
    &lt;authentication-client xmlns="urn:elytron:1.0"&gt;
        &lt;authentication-rules&gt;
            &lt;rule use-configuration="ejbConfig"&gt;
                &lt;match-host name="127.0.0.1"/&gt;
            &lt;/rule&gt;
        &lt;/authentication-rules&gt;
        &lt;authentication-configurations&gt;
            &lt;configuration name="ejbConfig"&gt;
                &lt;set-user-name name="bob"/&gt;
                &lt;credentials&gt;
                    &lt;clear-password password="secret"/&gt;
                &lt;/credentials&gt;
            &lt;/configuration&gt;
        &lt;/authentication-configurations&gt;
    &lt;/authentication-client&gt;
    &lt;jboss-ejb-client xmlns="urn:jboss:wildfly-client-ejb:3.0"&gt;
        &lt;connections&gt;
            &lt;connection uri="remote+http://127.0.0.1:8080" /&gt;
        &lt;/connections&gt;
    &lt;/jboss-ejb-client&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An EJB can then be looked up and a method can be invoked on it as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">// create an InitialContext
Properties properties = new Properties();
properties.put(Context.INITIAL_CONTEXT_FACTORY, "org.wildfly.naming.client.WildFlyInitialContextFactory");
InitialContext context = new InitialContext(properties);
 
// look up an EJB and invoke one of its methods (same as before)
RemoteCalculator statelessRemoteCalculator = (RemoteCalculator) context.lookup(
    "ejb:/ejb-remote-server-side//CalculatorBean!" + RemoteCalculator.class.getName());
int sum = statelessRemoteCalculator.add(101, 202);</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="programmatic-approach-1">Programmatic Approach</h6>
<div class="paragraph">
<p>The information needed to connect to the remote server can be specified
directly in the client application&#8217;s code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">// create your authentication configuration
AuthenticationConfiguration ejbConfig = AuthenticationConfiguration.empty().useName("bob").usePassword("secret");
 
// create your authentication context
AuthenticationContext context = AuthenticationContext.empty().with(MatchRule.ALL.matchHost("127.0.0.1"), ejbConfig);
 
// create a callable that invokes an EJB
Callable&lt;Void&gt; callable = () -&gt; {
 
    // create an InitialContext
    Properties properties = new Properties();
    properties.put(Context.INITIAL_CONTEXT_FACTORY, "org.wildfly.naming.client.WildFlyInitialContextFactory");
    properties.put(Context.PROVIDER_URL, "remote+http://127.0.0.1:8080");
    InitialContext context = new InitialContext(properties);
 
    // look up an EJB and invoke one of its methods (same as before)
    RemoteCalculator statelessRemoteCalculator = (RemoteCalculator) context.lookup(
        "ejb:/ejb-remote-server-side//CalculatorBean!" + RemoteCalculator.class.getName());
    int sum = statelessRemoteCalculator.add(101, 202);
    ...
    return null;
};
 
// use your authentication context to run your callable
context.runCallable(callable);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="general-utilities">11.10. General Utilities</h3>

</div>
<div class="sect2">
<h3 id="Security_Vault_Migration">11.11. Security Vault Migration</h3>
<div class="paragraph">
<p>Security Vault is primarily used in legacy configurations, a vault is
used to store sensitive strings outside of the configuration files.
WildFly server may only contain a single security vault.</p>
</div>
<div class="paragraph">
<p>Credential Store introduced in WildFly 11 is meant to expand Security
Vault in terms of storing different credential types and introduce easy
to implemnent SPI which allows to deploy custom implemenations of
CredentialStore SPI. Credentials are stored safely encrypted in storage
file outside WildFly configuration files. Each WildFly server may
contain multiple credential stores.</p>
</div>
<div class="paragraph">
<p>To easily migrate vault content into credential store we have added
"vault" command into WildFly Elytron Tool. The tool could be found at
$JBOSS_HOME/bin directory. It has several scripts named "elytron-tool.*"
dependent on your platform of choice. One can use also simple form "java
-jar $JBOSS_HOME/bin/wildfly-elytron-tool.jar &lt;command&gt; &lt;arguments&gt;" if
it better suites ones needs.</p>
</div>
<div class="sect3">
<h4 id="single-security-vault-conversion">11.11.1. Single Security Vault Conversion</h4>
<div class="paragraph">
<p>To convert <strong>single</strong> security vault credential store use following
example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to get sample vault use testing resources of Elytron Tool project from
<a href="https://github.com/wildfly-security/wildfly-elytron-tool/tree/master/src/test/resources/vault-v1">GitHub</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Command to run actual conversion:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><code>./bin/elytron-tool.sh vault --enc-dir vault_data/ --keystore vault-jceks.keystore --keystore-password MASK-2hKo56F1a3jYGnJwhPmiF5 --iteration 34 --salt 12345678 --alias test --location cs-v1.store --summary</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><code>Vault (enc-dir="vault_data/";keystore="vault-jceks.keystore") converted to credential store "cs-v1.store"</code><br>
<code>Vault Conversion summary:</code><br>
<code>--------------------------------------</code><br>
<code>Vault Conversion Successful</code><br>
<code>CLI command to add new credential store:</code><br>
<code>/subsystem=elytron/credential-store=test:add(relative-to=jboss.server.data.dir,create=true,modifiable=true,location="cs-v1.store",implementation-properties={"keyStoreType"&#8658;"JCEKS"},credential-reference={clear-text="MASK-2hKo56F1a3jYGnJwhPmiF5;12345678;34"})</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Use elytron-tool.sh vault --help to get description of all parameters.</p>
</div>
<div class="sect4">
<h5 id="notes">Notes:</h5>
<div class="ulist">
<ul>
<li>
<p>Elytron Tool cannot handle very first version of Security Vault data
file.<br></p>
</li>
<li>
<p>--keystore-password can come in two forms (1) masked as shown in the
example or (2) clear text. Parameter --salt and --iteration are there to
supply information to decrypt the masked password or to generate masked
password in output. In case --salt and --iteration are omitted default
values are used.<br></p>
</li>
<li>
<p>When --summary parameter is specified, one can see nice output with
CLI command to be used in WildFly console to add converted credential
store to the configuration.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bulk-security-vault-conversion">11.11.2. Bulk Security Vault Conversion</h4>
<div class="paragraph">
<p>There is possibility to convert multiple vaults to credential store
using --bulk-convert parameter with description file.<br>
Example of description file from our <a href="https://github.com/wildfly-security/wildfly-elytron-tool/blob/master/src/test/java/org/wildfly/security/tool/VaultCommandTest.java">tests</a>:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><code># Bulk conversion descriptor</code><br>
<code>keystore:target/test-classes/vault-v1/vault-jceks.keystore</code><br>
<code>keystore-password:MASK-2hKo56F1a3jYGnJwhPmiF5</code><br>
<code>enc-dir:target/test-classes/vault-v1/vault_data/</code><br>
<code>salt:12345678</code><br>
<code>iteration:34</code><br>
<code>location:target/v1-cs-1.store</code><br>
<code>alias:test</code></p>
</div>
<div class="paragraph">
<p><code>keystore:target/test-classes/vault-v1/vault-jceks.keystore</code><br>
<code>keystore-password:secretsecret</code><br>
<code>enc-dir:target/test-classes/vault-v1/vault_data/</code><br>
<code>location:target/v1-cs-2.store</code><br>
<code>alias:test</code></p>
</div>
<div class="paragraph">
<p><code># different vault vault-v1-more</code><br>
<code>keystore:target/test-classes/vault-v1-more/vault-jceks.keystore</code><br>
<code>keystore-password:MASK-2hKo56F1a3jYGnJwhPmiF5</code><br>
<code>enc-dir:target/test-classes/vault-v1-more/vault_data/</code><br>
<code>salt:12345678</code><br>
<code>iteration:34</code><br>
<code>location:target/v1-cs-more.store</code><br>
<code>alias:test</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>After each "keystore:" option new conversion starts. All options are
mandatory except "salt:", "iteration:" and "properties:"</p>
</div>
<div class="paragraph">
<p>Execute following command:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><code>./bin/elytron-tool.sh vault --bulk-convert bulk-vault-conversion-desc --summary</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><code>Vault (enc-dir="vault-v1/vault_data/";keystore="vault-v1/vault-jceks.keystore") converted to credential store "v1-cs-1.store"</code><br>
<code>Vault Conversion summary:</code><br>
<code>--------------------------------------</code><br>
<code>Vault Conversion Successful</code><br>
<code>CLI command to add new credential store:</code><br>
<code>/subsystem=elytron/credential-store=test:add(relative-to=jboss.server.data.dir,create=true,modifiable=true,location="v1-cs-1.store",implementation-properties={"keyStoreType"&#8658;"JCEKS"},credential-reference={clear-text="MASK-2hKo56F1a3jYGnJwhPmiF5;12345678;34"})</code><br>
<code>--------------------------------------</code></p>
</div>
<div class="paragraph">
<p><code>Vault (enc-dir="vault-v1/vault_data/";keystore="vault-v1/vault-jceks.keystore") converted to credential store "v1-cs-2.store"</code><br>
<code>Vault Conversion summary:</code><br>
<code>--------------------------------------</code><br>
<code>Vault Conversion Successful</code><br>
<code>CLI command to add new credential store:</code><br>
<code>/subsystem=elytron/credential-store=test:add(relative-to=jboss.server.data.dir,create=true,modifiable=true,location="v1-cs-2.store",implementation-properties={"keyStoreType"&#8658;"JCEKS"},credential-reference={clear-text="secretsecret"})</code><br>
<code>--------------------------------------</code></p>
</div>
<div class="paragraph">
<p><code>Vault (enc-dir="vault-v1-more/vault_data/";keystore="vault-v1-more/vault-jceks.keystore") converted to credential store "v1-cs-more.store"</code><br>
<code>Vault Conversion summary:</code><br>
<code>--------------------------------------</code><br>
<code>Vault Conversion Successful</code><br>
<code>CLI command to add new credential store:</code><br>
<code>/subsystem=elytron/credential-store=test:add(relative-to=jboss.server.data.dir,create=true,modifiable=true,location="v1-cs-more.store",implementation-properties={"keyStoreType"&#8658;"JCEKS"},credential-reference={clear-text="MASK-2hKo56F1a3jYGnJwhPmiF5;12345678;34"})</code><br>
<code>--------------------------------------</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The result is conversion of all vaults with proper CLI commands.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Security_Property_Migration">11.12. Security Properties</h3>
<div class="paragraph">
<p>Lets suppose security properties "a" and "c" defined in legacy security:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        &lt;subsystem xmlns="urn:jboss:domain:security:2.0"&gt;
            ...
            &lt;security-properties&gt;
                &lt;property name="a" value="b" /&gt;
                &lt;property name="c" value="d" /&gt;
            &lt;/security-properties&gt;
        &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To define security properties in Elytron subsystem you need to set
attribute <code>security-properties</code> of the subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron:write-attribute(name=security-properties, value={ \
    a = "b", \
    c = "d" \
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also add or change one another property without modification of
others using map operations. Following command will set property "e":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron:map-put(name=security-properties, key=e, value=f)</code></pre>
</div>
</div>
<div class="paragraph">
<p>By the same way you can also remove one of properties - in example newly
created property "e":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron:map-remove(name=security-properties, key=e)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output XML configuration will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        &lt;subsystem xmlns="urn:wildfly:elytron:1.0" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
            &lt;security-properties&gt;
                &lt;security-property name="a" value="b"/&gt;
                &lt;security-property name="c" value="d"/&gt;
            &lt;/security-properties&gt;
            ...
        &lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ssl-migration">11.13. SSL Migration</h3>

</div>
<div class="sect2">
<h3 id="Simple_SSL_Migration">11.14. Simple SSL Migration</h3>
<div class="sect3">
<h4 id="simple-ssl-migration">11.14.1. Simple SSL Migration</h4>
<div class="paragraph">
<p>This section describe securing HTTP connections to the server using SSL
using Elytron.<br>
It suppose you have already configured SSL using legacy
<code>security-realm</code>, for example by
<a href="Admin_Guide.html#src-557075_AdminGuide-EnableSSL">Admin Guide#Enable
SSL</a>, and your configuration looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;security-realm name="ApplicationRealm"&gt;
  &lt;server-identities&gt;
    &lt;ssl&gt;
      &lt;keystore path="server.keystore" relative-to="jboss.server.config.dir" keystore-password="keystore_password" alias="server" key-password="key_password" /&gt;
    &lt;/ssl&gt;
  &lt;/server-identities&gt;
&lt;/security-realm&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To switch to Elytron you need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create Elytron <code>key-store</code> - specifying where is the keystore file
stored and password by which it is encrypted. Default type of keystore
generated using keytool is JKS:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=LocalhostKeyStore:add(path=server.keystore,relative-to=jboss.server.config.dir,credential-reference={clear-text="keystore_password"},type=JKS)</code></pre>
</div>
</div>
</li>
<li>
<p>Create Elytron <code>key-manager</code> - specifying keystore, alias (using
<code>alias-filter</code>) and password of key:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-manager=LocalhostKeyManager:add(key-store=LocalhostKeyStore,alias-filter=server,credential-reference={clear-text="key_password"})</code></pre>
</div>
</div>
</li>
<li>
<p>Create Elytron <code>server-ssl-context</code> - specifying only reference to
<code>key-manager</code> defined above:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/server-ssl-context=LocalhostSslContext:add(key-manager=LocalhostKeyManager)</code></pre>
</div>
</div>
</li>
<li>
<p>Switch <code>https-listener</code> from legacy <code>security-realm</code> to newly
created Elytron <code>ssl-context</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context,value=LocalhostSslContext)</code></pre>
</div>
</div>
</li>
<li>
<p>And reload the server:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Output XML configuration of Elytron subsystem should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        &lt;subsystem xmlns="urn:wildfly:elytron:1.0" ...&gt;
            ...
            &lt;tls&gt;
                &lt;key-stores&gt;
                    &lt;key-store name="LocalhostKeyStore"&gt;
                        &lt;credential-reference clear-text="keystore_password"/&gt;
                        &lt;implementation type="JKS"/&gt;
                        &lt;file path="server.keystore" relative-to="jboss.server.config.dir"/&gt;
                    &lt;/key-store&gt;
                &lt;/key-stores&gt;
                &lt;key-managers&gt;
                    &lt;key-manager name="LocalhostKeyManager" key-store="LocalhostKeyStore"&gt;
                        &lt;credential-reference clear-text="key_password"/&gt;
                    &lt;/key-manager&gt;
                &lt;/key-managers&gt;
                &lt;server-ssl-contexts&gt;
                    &lt;server-ssl-context name="LocalhostSslContext" key-manager="LocalhostKeyManager"/&gt;
                &lt;/server-ssl-contexts&gt;
            &lt;/tls&gt;
        &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output <code>https-listener</code> in Undertow subsystem should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;https-listener name="https" socket-binding="https" ssl-context="LocalhostSslContext" enable-http2="true"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="client-cert-ssl-authentication-migration">11.14.2. Client-Cert SSL Authentication Migration</h4>
<div class="paragraph">
<p>This suppose you have already configured Client-Cert SSL authentication
using <code>truststore</code> in legacy <code>security-realm</code>, for example by
<a href="Admin_Guide.html#src-557075_AdminGuide-AddClient-CerttoSSL">Admin
Guide#Add Client-Cert to SSL</a>, and your configuration looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;security-realm name="ApplicationRealm"&gt;
  &lt;server-identities&gt;
    &lt;ssl&gt;
      &lt;keystore path="server.keystore" relative-to="jboss.server.config.dir" keystore-password="keystore_password" alias="server" key-password="key_password" /&gt;
    &lt;/ssl&gt;
  &lt;/server-identities&gt;
  &lt;authentication&gt;
    &lt;truststore path="server.truststore" relative-to="jboss.server.config.dir" keystore-password="truststore_password" /&gt;
    &lt;local default-user="$local"/&gt;
    &lt;properties path="application-users.properties" relative-to="jboss.server.config.dir"/&gt;
  &lt;/authentication&gt;
&lt;/security-realm&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Following configuration is sufficient to prevent users without valid
certificate and private key to access the server, but it does not
provide user identity to the application. That require to define
<code>CLIENT_CERT</code> HTTP mechanism / <code>EXTERNAL</code> SASL mechanism, which will be
described later.)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At first use steps above to migrate basic part of the configuration.
Then continue by following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create <code>key-store</code> of truststore - like for keystore above:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/key-store=TrustStore:add(path=server.truststore,relative-to=jboss.server.config.dir,credential-reference={clear-text="truststore_password"},type=JKS)</code></pre>
</div>
</div>
</li>
<li>
<p>Create <code>trust-manager</code> - specifying <code>key-store</code> of trustore, created
above:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/trust-manager=TrustManager:add(key-store=TrustStore)</code></pre>
</div>
</div>
</li>
<li>
<p>Modify <code>server-ssl-context</code> to use newly created trustmanager:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/server-ssl-context=LocalhostSslContext:write-attribute(name=trust-manager,value=TrustManager)</code></pre>
</div>
</div>
</li>
<li>
<p>Enable client authentication for <code>server-ssl-context</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">/subsystem=elytron/server-ssl-context=LocalhostSslContext:write-attribute(name=need-client-auth,value=true)</code></pre>
</div>
</div>
</li>
<li>
<p>And reload the server:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Output XML configuration of Elytron subsystem should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:wildfly:elytron:1.0" ...&gt;
    ...
    &lt;tls&gt;
        &lt;key-stores&gt;
            &lt;key-store name="LocalhostKeyStore"&gt;
                &lt;credential-reference clear-text="keystore_password"/&gt;
                &lt;implementation type="JKS"/&gt;
                &lt;file path="server.keystore" relative-to="jboss.server.config.dir"/&gt;
            &lt;/key-store&gt;
            &lt;key-store name="TrustStore"&gt;
                &lt;credential-reference clear-text="truststore_password"/&gt;
                &lt;implementation type="JKS"/&gt;
                &lt;file path="server.truststore" relative-to="jboss.server.config.dir"/&gt;
            &lt;/key-store&gt;
        &lt;/key-stores&gt;
        &lt;key-managers&gt;
            &lt;key-manager name="LocalhostKeyManager" key-store="LocalhostKeyStore" alias-filter="server"&gt;
                &lt;credential-reference clear-text="key_password"/&gt;
            &lt;/key-manager&gt;
        &lt;/key-managers&gt;
        &lt;trust-managers&gt;
            &lt;trust-manager name="TrustManager" key-store="TrustStore"/&gt;
        &lt;/trust-managers&gt;
        &lt;server-ssl-contexts&gt;
            &lt;server-ssl-context name="LocalhostSslContext" need-client-auth="true" key-manager="LocalhostKeyManager" trust-manager="TrustManager"/&gt;
        &lt;/server-ssl-contexts&gt;
    &lt;/tls&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="SSL_with_Client_Cert_Migration">11.15. SSL with Client Cert Migration</h3>
<div class="paragraph">
<p>As this documentation is primarily intended for users migrating to WildFly Elytron I am going to jump straight into the configuration required with WildFly Elytron.</p>
</div>
<div class="paragraph">
<p>This section will cover how to create the various resources required to achieve CLIENT_CERT authentication with fallback to username / password authentication for both HTTP and SASL (i.e. Remoting) - both are being covered at the same time as predominantly they require the same core configuration, it is not until the definition of the authentication factories that the configuration becomes really specific.</p>
</div>
<div class="paragraph">
<p>The WildFly Elytron project already contains a dummy certificate authority set up that we use for testing, the KeyStores within this documentation are from the dummy certificate authority although for anything other than testing these should be replaced with your own.</p>
</div>
<div class="paragraph">
<p>As a first step we define some paths that point to the wildfly-elytron project so we can use these in the subsequent configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=application-security:add
./subsystem=security/security-domain=application-security/authentication=classic:add(login-modules=[{code=UsersRoles, flag=Required, module-options={usersProperties=file://${jboss.server.config.dir}/example-users.properties, rolesProperties=file://${jboss.server.config.dir}/example-roles.properties}}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;paths&gt;
  &lt;path name="elytron.project" path="/home/darranl/src/wildfly10/wildfly-elytron"/&gt;
  &lt;path name="elytron.project.jks" path="src/test/resources/ca/jks" relative-to="elytron.project"/&gt;
  &lt;path name="elytron.project.properties" path="src/test/resources/org/wildfly/security/auth/realm" relative-to="elytron.project"/&gt;
&lt;/paths&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="keystores-keymanagers-and-trustmanagers">11.15.1. KeyStores, KeyManagers, and TrustManagers.</h4>
<div class="paragraph">
<p>The next step is to define the KeyStore resources, for this example three different keystores are used: -</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">localhost.keystore</dt>
<dd>
<p>Contains the servers key and certificate for 'localhost'.</p>
</dd>
<dt class="hdlist1">beetles.keystore</dt>
<dd>
<p>Contains the individual client certificates.</p>
</dd>
<dt class="hdlist1">ca.keystore</dt>
<dd>
<p>Contains the certificate of the certificate authority.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When we define the overall configuration we will use the localhost keystore along with the ca keystore for the incoming connections so initially all client certificates signed by the certificate authority will be accepted and subsequently a security realm will check it against the actual certificates within beetles keystore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/key-store=localhost:add(type=jks, relative-to=elytron.project.jks, path=localhost.keystore, credential-reference={clear-text=Elytron})
./subsystem=elytron/key-store=beetles:add(type=jks, relative-to=elytron.project.jks, path=beetles.keystore, credential-reference={clear-text=Elytron})
./subsystem=elytron/key-store=ca:add(type=jks, relative-to=elytron.project.jks, path=ca.truststore, credential-reference={clear-text=Elytron})</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:wildfly:elytron:1.1" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
  ...
  &lt;tls&gt;
    &lt;key-stores&gt;
      &lt;key-store name="localhost"&gt;
        &lt;credential-reference clear-text="Elytron"/&gt;
        &lt;implementation type="jks"/&gt;
        &lt;file path="localhost.keystore" relative-to="elytron.project.jks"/&gt;
      &lt;/key-store&gt;
      &lt;key-store name="beetles"&gt;
        &lt;credential-reference clear-text="Elytron"/&gt;
        &lt;implementation type="jks"/&gt;
        &lt;file path="beetles.keystore" relative-to="elytron.project.jks"/&gt;
      &lt;/key-store&gt;
      &lt;key-store name="ca"&gt;
        &lt;credential-reference clear-text="Elytron"/&gt;
        &lt;implementation type="jks"/&gt;
        &lt;file path="ca.truststore" relative-to="elytron.project.jks"/&gt;
      &lt;/key-store&gt;
    &lt;/key-stores&gt;
  &lt;/tls&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next the key and trust manager resources will be defined using these keystores.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/key-manager=localhost-manager:add(algorithm=SunX509, key-store=localhost, credential-reference={clear-text=Elytron})
./subsystem=elytron/trust-manager=ca-manager:add(algorithm=SunX509, key-store=ca)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:wildfly:elytron:1.1" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
  ...
  &lt;tls&gt;
   ...
     &lt;key-managers&gt;
       &lt;key-manager name="localhost-manager" algorithm="SunX509" key-store="localhost"&gt;
         &lt;credential-reference clear-text="Elytron"/&gt;
       &lt;/key-manager&gt;
     &lt;/key-managers&gt;
     &lt;trust-managers&gt;
       &lt;trust-manager name="ca-manager" algorithm="SunX509" key-store="ca"/&gt;
     &lt;/trust-managers&gt;
  &lt;/tls&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="realms-and-domains">11.15.2. Realms and Domains</h4>
<div class="paragraph">
<p>Two security realms are now defined, one of these uses properties files from within the WildFly Elytron project to support username/password authentication and the other using the clients certificates for verification.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/properties-realm=test-users:add(users-properties={relative-to=elytron.project.properties, path=clear.properties, plain-text=true, digest-realm-name=ManagementRealm}, groups-properties={relative-to=elytron.project.properties, path=groups.properties})
./subsystem=elytron/key-store-realm=key-store-realm:add(key-store=beetles)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:wildfly:elytron:1.1" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
  ...
  &lt;security-realms&gt;
    ...
    &lt;key-store-realm name="key-store-realm" key-store="beetles"/&gt;
    ...
    &lt;properties-realm name="test-users"&gt;
      &lt;users-properties path="clear.properties" relative-to="elytron.project.properties" digest-realm-name="ManagementRealm" plain-text="true"/&gt;
      &lt;groups-properties path="groups.properties" relative-to="elytron.project.properties"/&gt;
    &lt;/properties-realm&gt;
  &lt;/security-realms&gt;
  ...
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>These security realms can now be referenced from a security domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/security-domain=client-cert-domain:add(realms=[{realm=test-users},{realm=key-store-realm}], \
  default-realm=test-users, \
  permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:wildfly:elytron:1.1" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
  ...
  &lt;security-domains&gt;
    ...
    &lt;security-domain name="client-cert-domain" default-realm="test-users" permission-mapper="default-permission-mapper"&gt;
      &lt;realm name="test-users"/&gt;
      &lt;realm name="key-store-realm"/&gt;
    &lt;/security-domain&gt;
  &lt;/security-domains&gt;
  ...
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before moving onto the individual authentication factories a couple of additional utility resources are also required: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./subsystem=elytron/constant-realm-mapper=key-store-realm:add(realm-name=key-store-realm)
./subsystem=elytron/x500-attribute-principal-decoder=x500-decoder:add(attribute-name=CN, maximum-segments=1)</pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:wildfly:elytron:1.1" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
  ...
  &lt;mappers&gt;
    ...
    &lt;x500-attribute-principal-decoder name="x500-decoder" attribute-name="CN" maximum-segments="1"/&gt;
    ...
    &lt;constant-realm-mapper name="key-store-realm" realm-name="key-store-realm"/&gt;
    ...
  &lt;/mappers&gt;
  ...
&lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-authentication-factory">11.15.3. HTTP Authentication Factory</h4>
<div class="paragraph">
<p>For the HTTP connections we now define a HTTP authentication factory using the previously defined resources and it is configured to support CLIENT_CERT and DIGEST authentication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./subsystem=elytron/http-authentication-factory=client-cert-digest:add(http-server-mechanism-factory=global, \
  security-domain=client-cert-domain, \
 mechanism-configurations=[{ \
  mechanism-name=CLIENT_CERT, \
  realm-mapper=key-store-realm, \
  pre-realm-principal-transformer=x500-decoder}, \
 {mechanism-name=DIGEST, mechanism-realm-configurations=[{realm-name=ManagementRealm}]}])</pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;subsystem xmlns="urn:wildfly:elytron:1.1" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
  ...
  &lt;http&gt;
    ...
    &lt;http-authentication-factory name="client-cert-digest" http-server-mechanism-factory="global" security-domain="client-cert-domain"&gt;
      &lt;mechanism-configuration&gt;
        &lt;mechanism mechanism-name="CLIENT_CERT" pre-realm-principal-transformer="x500-decoder" realm-mapper="key-store-realm"/&gt;
        &lt;mechanism mechanism-name="DIGEST"&gt;
          &lt;mechanism-realm realm-name="ManagementRealm"/&gt;
        &lt;/mechanism&gt;
      &lt;/mechanism-configuration&gt;
    &lt;/http-authentication-factory&gt;
    ...
  &lt;/http&gt;
  ...
&lt;/subsystem&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Where DIGEST authentication is used we rely on the default configuration within the security domain to select the 'test-users' realm, however where CLIENT_CERT authentication is in use an alternative realm-mapper is referenced to ensure the 'key-store-realm' is used.</p>
</div>
<div class="paragraph">
<p>Additionally for CLIENT_CERT authentication a principal-transformer is referenced to extract the CN attribute from the distinguished name of the client certificate and use this when accessing the identity from the security realm.</p>
</div>
</div>
<div class="sect3">
<h4 id="sasl-authentication-factory">11.15.4. SASL Authentication Factory</h4>
<div class="paragraph">
<p>The architecture of the two authentication factories if very similar so a SASL authentication factory can be defined in the same way as the HTTP equivalent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./subsystem=elytron/sasl-authentication-factory=client-cert-digest:add(sasl-server-factory=elytron, \
  security-domain=client-cert-domain, \
  mechanism-configurations=[{mechanism-name=EXTERNAL, \
  realm-mapper=key-store-realm, \
  pre-realm-principal-transformer=x500-decoder}, \
  {mechanism-name=DIGEST-MD5, mechanism-realm-configurations=[{realm-name=ManagementRealm}]}])</pre>
</div>
</div>
<div class="paragraph">
<p>This results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:wildfly:elytron:1.1" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
  ...
  &lt;sasl&gt;
    ...
    &lt;sasl-authentication-factory name="client-cert-digest" sasl-server-factory="elytron" security-domain="client-cert-domain"&gt;
      &lt;mechanism-configuration&gt;
        &lt;mechanism mechanism-name="EXTERNAL" pre-realm-principal-transformer="x500-decoder" realm-mapper="key-store-realm"/&gt;
        &lt;mechanism mechanism-name="DIGEST-MD5"&gt;
          &lt;mechanism-realm realm-name="ManagementRealm"/&gt;
        &lt;/mechanism&gt;
      &lt;/mechanism-configuration&gt;
    &lt;/sasl-authentication-factory&gt;
    ...
  &lt;/sasl&gt;
  ...
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Realm mappers and principal transformers are defined in the same way as were defined for HTTP.</p>
</div>
</div>
<div class="sect3">
<h4 id="ssl-context">11.15.5. SSL Context</h4>
<div class="paragraph">
<p>An SSL context is also defined for use by the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./subsystem=elytron/server-ssl-context=localhost:add(key-manager=localhost-manager, trust-manager=ca-manager, \
  security-domain=client-cert-domain, \
  authentication-optional=true, \
  want-client-auth=true, \
  need-client-auth=false)</pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;subsystem xmlns="urn:wildfly:elytron:1.1" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
  ...
  &lt;tls&gt;
    ...
    &lt;server-ssl-contexts&gt;
      &lt;server-ssl-context name="localhost" security-domain="client-cert-domain" want-client-auth="true" need-client-auth="false" authentication-optional="true" key-manager="localhost-manager" trust-manager="ca-manager"/&gt;
    &lt;/server-ssl-contexts&gt;
  &lt;/tls&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we will be supporting fallback to username/password authentication need-client-auth is set to false as well as authentication-optional being set to false, this allows connections to be established but an alternative form of authentication will be required.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-for-management">11.15.6. Using for Management</h4>
<div class="paragraph">
<p>At this point the management interfaces can be updated to use the newly defined resources, we need to add references to the two new authentication factories and the SSL context, we can also remove the existing reference to the legacy security realm. As this is modifying existing interfaces a server reload will also be required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./core-service=management/management-interface=http-interface:write-attribute(name=ssl-context, value=localhost)
./core-service=management/management-interface=http-interface:write-attribute(name=secure-socket-binding, value=management-https)
./core-service=management/management-interface=http-interface:write-attribute(name=http-authentication-factory, value=client-cert-digest)
./core-service=management/management-interface=http-interface:write-attribute(name=http-upgrade.sasl-authentication-factory, value=client-cert-digest)
./core-service=management/management-interface=http-interface:undefine-attribute(name=security-realm)
:reload</pre>
</div>
</div>
<div class="paragraph">
<p>The management interface configuration then becomes: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;management&gt;
  ...
  &lt;management-interfaces&gt;
    &lt;http-interface http-authentication-factory="client-cert-digest" ssl-context="localhost"&gt;
      &lt;http-upgrade enabled="true" sasl-authentication-factory="client-cert-digest"/&gt;
      &lt;socket-binding http="management-http" https="management-https"/&gt;
    &lt;/http-interface&gt;
  &lt;/management-interfaces&gt;
  ...
&lt;/management&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="admin-clients">Admin Clients</h5>
<div class="paragraph">
<p>At this stage assuming the same files have been used as in this example it should be possible to connect to the management interface of the server either using a web browser or the JBoss CLI with the username elytron and password passwd12#$</p>
</div>
<div class="paragraph">
<p>For certificate based authentication the keys and certificates from the WildFly Elytron tests can be used, these are found in JKS keystores under 'src/test/resources/ca/jks', these keystores have a password of Elytron.</p>
</div>
<div class="sect5">
<h6 id="web-browser-configuration">Web Browser Configuration</h6>
<div class="paragraph">
<p>A PKCS#12 file can be created from the test keystores,this can then be imported into the web browser to use when connecting to the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>keytool -importkeystore -srckeystore ladybird.keystore \
  -destkeystore ladybird.pkcs12 \
  -srcstoretype jks \
  -deststoretype pkcs12 \
  -deststorepass Elytron \
  -srcalias ladybird \
  -destalias ladybird</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="cli-configuration">CLI Configuration</h6>
<div class="paragraph">
<p>Since the integration of WildFly Elytron it is possible with the CLI to use a configuration file wildfly-config.xml to define the security settings including the settings for the client side SSL context.</p>
</div>
<div class="paragraph">
<p>For the purpose of this example copy the ladybird,keystore and ca.truststore from the Wildfly Elytron testsuite to the location the JBoss CLI is being started from, the following wildfly-config.xml can be created in this location as well: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;configuration&gt;
    &lt;authentication-client xmlns="urn:elytron:1.0"&gt;
        &lt;key-stores&gt;
            &lt;key-store name="ladybird" type="jks" &gt;
                &lt;file name="ladybird.keystore"/&gt;
                &lt;key-store-clear-password password="Elytron" /&gt;
            &lt;/key-store&gt;
            &lt;key-store name="ca" type="jks"&gt;
                &lt;file name="ca.truststore"/&gt;
                &lt;key-store-clear-password password="Elytron" /&gt;
            &lt;/key-store&gt;
        &lt;/key-stores&gt;
        &lt;ssl-context-rules&gt;
            &lt;rule use-ssl-context="default" /&gt;
        &lt;/ssl-context-rules&gt;
        &lt;ssl-contexts&gt;
            &lt;ssl-context name="default"&gt;
                &lt;key-store-ssl-certificate key-store-name="ladybird" alias="ladybird"&gt;
                    &lt;key-store-clear-password password="Elytron" /&gt;
                &lt;/key-store-ssl-certificate&gt;
                &lt;trust-store key-store-name="ca" /&gt;
            &lt;/ssl-context&gt;
        &lt;/ssl-contexts&gt;
    &lt;/authentication-client&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CLI can now be started using the following command: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./jboss-cli.sh -c -Dwildfly.config.url=wildfly-config.xml</pre>
</div>
</div>
<div class="paragraph">
<p>The :whoami command can be used within the CLI to double check the current identity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9993 /] :whoami(verbose=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "identity" =&gt; {"username" =&gt; "Ladybird"},
        "mapped-roles" =&gt; ["SuperUser"]
    }
}</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="documentation-still-needed">11.16. Documentation Still Needed</h3>
<div class="ulist">
<ul>
<li>
<p>How to migrate application which uses different identity store for
authentication and authorization (migration to Elytron aggregate-realm).</p>
</li>
<li>
<p>How migrate to using cache (migration to caching-realm)</p>
</li>
<li>
<p>Limitations for migration from PicketBox/legacy security to Elytron,
for example, Infinispan cache cannot be used, any others?</p>
</li>
</ul>
</div>
</div>
</div>
</div>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/wildflysite/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Wildfly</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wildfly</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wildfly"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wildfly</span></a></li><li><a href="https://www.twitter.com/WildFlyAS"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">WildFlyAS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
