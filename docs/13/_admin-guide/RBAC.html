<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Authorizing management actions with Role Based Access Control | Wildfly</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Authorizing management actions with Role Based Access Control" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/RBAC.html" />
<meta property="og:url" content="https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/RBAC.html" />
<meta property="og:site_name" content="Wildfly" />
<script type="application/ld+json">
{"@type":"WebPage","url":"https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/RBAC.html","headline":"Authorizing management actions with Role Based Access Control","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/wildflysite/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://jbossorg.github.io/wildflysite/feed.xml" title="Wildfly" /></head>
<body><div class="header navigation">
  <div class="logo-wrapper">
    <a href="/wildflysite/"><img class="wf-logo" src="/wildflysite/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/wildflysite/" class="">Home</a>
        </li>
        <li>
          <a href="/wildflysite/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/wildflysite/blog/" class="">Blog</a>
        </li>
        <li>
          <a href="/wildflysite/about/" class="">About</a>
        </li>
        <li>
          <a href="/wildflysite/contribute/" class="">Contribute</a>
        </li>
        <li>
          <a href="/wildflysite/docs/" class="">Docs</a>
        </li>
        <li>
          <a class="button-cta secondary" href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>WildFly introduces a Role Based Access Control scheme that allows
different administrative users to have different sets of permissions to
read and update parts of the management tree. This replaces the simple
permission scheme used in JBoss AS 7, where anyone who could
successfully authenticate to the management security realm would have
all permissions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="access-control-providers">Access Control Providers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly ships with two access control "providers", the "simple"
provider, and the "rbac" provider. The "simple" provider is the default,
and provides a permission scheme equivalent to the JBoss AS 7 behavior
where any authenticated administrator has all permissions. The "rbac"
provider gives the finer grained permission scheme that is the focus of
this section.</p>
</div>
<div class="paragraph">
<p>The access control configuration is included in the management section
of a standalone server&#8217;s standalone.xml, or in a new "management"
section in a managed domain&#8217;s domain.xml. The access control policy is
centrally configured in a managed domain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;management&gt;
    . . .
    &lt;access-control provider="simple"&gt;
        &lt;role-mapping&gt;
            &lt;role name="SuperUser"&gt;
                &lt;include&gt;
                    &lt;user name="$local"/&gt;
                &lt;/include&gt;
            &lt;/role&gt;
        &lt;/role-mapping&gt;
    &lt;/access-control&gt;
&lt;/management&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the provider is set to "simple" by default. With the
"simple" provider, the nested "role-mapping" section is not actually
relevant. It&#8217;s there to help ensure that if the provider attribute is
switched to "rbac" there will be at least one user mapped to a role that
can continue to administer the system. This default mapping assigns the
"$local" user name to the RBAC role that provides all permissions, the
"SuperUser" role. The "$local" user name is the name an administrator
will be assigned if he or she uses the CLI on the same system as the
WildFly instance and the
<a href="Detailed_Configuration.html#src-557240_DetailedConfiguration-authentication-local">"local"
authentication scheme</a> is enabled.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rbac-provider-overview">RBAC provider overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The access control scheme implemented by the "rbac" provider is based on
seven standard roles. A role is a named set of permissions to perform
one of the actions: addressing (i.e. looking up) a management resource,
reading it, or modifying it. The different roles have constraints
applied to their permissions that are used to determine whether the
permission is granted.</p>
</div>
<div class="sect2">
<h3 id="rbac-roles">RBAC roles</h3>
<div class="paragraph">
<p>The seven standard roles are divided into two broad categories, based on
whether the role can deal with items that are considered to be "security
sensitive". Resources, attributes and operations that may affect
administrative security (e.g. security realm resources and attributes
that contain passwords) are "security sensitive".</p>
</div>
<div class="paragraph">
<p>Four roles are not given permissions for "security sensitive" items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Monitor – a read-only role. Cannot modify any resource.</p>
</li>
<li>
<p>Operator – Monitor permissions, plus can modify runtime state, but
cannot modify anything that ends up in the persistent configuration.
Could, for example, restart a server.</p>
</li>
<li>
<p>Maintainer – Operator permissions, plus can modify the persistent
configuration.</p>
</li>
<li>
<p>Deployer – like a Maintainer, but with permission to modify persistent
configuration constrained to resources that are considered to be
"application resources". A deployment is an application resource. The
messaging server is not. Items like datasources and JMS destinations are
not considered to be application resources by default, but this is
<a href="#application-constraint">configurable</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Three roles are granted permissions for security sensitive items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SuperUser – has all permissions. Equivalent to a JBoss AS 7
administrator.</p>
</li>
<li>
<p>Administrator – has all permissions except cannot read or write
resources related to the administrative audit logging system.</p>
</li>
<li>
<p>Auditor – can read anything. Can only modify the resources related to
the administrative audit logging system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Auditor and Administrator roles are meant for organizations that
want a separation of responsibilities between those who audit normal
administrative actions and those who perform them, with those who
perform most actions (Administrator role) not being able to read or
alter the auditing configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="access-control-constraints">Access control constraints</h3>
<div class="paragraph">
<p>The following factors are used to determine whether a given role is
granted a permission:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What the requested action is (address, read, write)</p>
</li>
<li>
<p>Whether the resource, attribute or operation affects the persistent
configuration</p>
</li>
<li>
<p>Whether the resource, attribute or operation is related to the
administrative audit logging function</p>
</li>
<li>
<p>Whether the resource, attribute or operation is configured as security
sensitive</p>
</li>
<li>
<p>Whether an attribute or operation parameter value has a security vault
expression</p>
</li>
<li>
<p>Whether a resource is considered to be associated with applications,
as opposed to being part of a general container configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first three of these factors are non-configurable; the latter three
allow some customization. See "
<a href="#configuring-constraints">Configuring constraints</a>"
for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="addressing-a-resource">Addressing a resource</h3>
<div class="paragraph">
<p>As mentioned above, permissions are granted to perform one of three
actions, addressing a resource, reading it, and modifying. The latter
two actions are fairly self-explanatory. But what is meant by
"addressing" a resource?</p>
</div>
<div class="paragraph">
<p>"Addressing" a resource refers to taking an action that allows the user
to determine whether a resource at a given address actually exists. For
example, the "read-children-names" operation lets a user determine valid
addresses. Trying to read a resource and getting a "Permission denied"
error also gives the user a clue that there actually is a resource at
the requested address.</p>
</div>
<div class="paragraph">
<p>Some resources may include sensitive information as part of their
address. For example, security realm resources include the realm name as
the last element in the address. That realm name is potentially security
sensitive; for example it is part of the data used when creating a hash
of a user password. Because some addresses may contain security
sensitive data, a user needs permission to even "address" a resource. If
a user attempts to address a resource and does not have permission, they
will not receive a "permission denied" type error. Rather, the system
will respond as if the resource does not even exist, e.g. excluding the
resource from the result of the "read-children-names" operation or
responding with a "No such resource" error instead of "Permission
denied" if the user is attempting to read or write the resource.</p>
</div>
<div class="paragraph">
<p>Another term for "addressing" a resource is "looking up" the resource.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="switching-to-the-rbac-provider">Switching to the "rbac" provider</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the CLI to switch the access-control provider.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Before changing the provider to "rbac", be sure your configuration has a
user who will be mapped to one of the RBAC roles, preferably with at
least one in the Administrator or SuperUser role. Otherwise your
installation will not be manageable except by shutting it down and
editing the xml configuration. If you have started with one of the
standard xml configurations shipped with WildFly, the "$local" user will
be mapped to the "SuperUser" role and the
<a href="Detailed_Configuration.html#src-557240_DetailedConfiguration-authentication-local">"local"
authentication scheme</a> will be enabled. This will allow a user running
the CLI on the same system as the WildFly process to have full
administrative permissions. Remote CLI users and web-based admin console
users will have no permissions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We recommend <a href="#mapping-users-and-groups-to-roles">mapping at least one
user</a> besides "$local" before switching the provider to "rbac". You can
do all of the configuration associated with the "rbac" provider even
when the provider is set to "simple"</p>
</div>
<div class="paragraph">
<p>The management resources related to access control are located in the
<code>core-service=management/access=authorization</code> portion of the management
resource tree. Update the <code>provider</code> attribute to change between the
"simple" and "rbac" providers. Any update requires a reload or restart
to take effect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] cd core-service=management/access=authorization
[standalone@localhost:9990 access=authorization] :write-attribute(name=provider,value=rbac)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}
[standalone@localhost:9990 access=authorization] reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a managed domain, the access control configuration is part of the
domain wide configuration, so the resource address is the same as above,
but the CLI is connected to the master Domain Controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] cd core-service=management/access=authorization
[domain@localhost:9990 access=authorization] :write-attribute(name=provider,value=rbac)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    },
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {
            "outcome" =&gt; "success",
            "response-headers" =&gt; {
                "operation-requires-reload" =&gt; true,
                "process-state" =&gt; "reload-required"
            }
        }},
        "server-two" =&gt; {"response" =&gt; {
            "outcome" =&gt; "success",
            "response-headers" =&gt; {
                "operation-requires-reload" =&gt; true,
                "process-state" =&gt; "reload-required"
            }
        }}
    }}}}
}
[domain@localhost:9990 access=authorization] reload --host=master</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with a standalone server, a reload or restart is required for the
change to take effect. In this case, all hosts and servers in the domain
will need to be reloaded or restarted, starting with the master Domain
Controller, so be sure to plan well before making this change.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mapping-users-and-groups-to-roles">Mapping users and groups to roles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once the "rbac" access control provider is enabled, only users who are
mapped to one of the available roles will have any administrative
permissions at all. So, to make RBAC useful, a mapping between
individual users or groups of users and the available roles must be
performed.</p>
</div>
<div class="sect2">
<h3 id="mapping-individual-users">Mapping individual users</h3>
<div class="paragraph">
<p>The easiest way to map individual users to roles is to use the web-based
admin console.</p>
</div>
<div class="paragraph">
<p>Navigate to the "Administration" tab and the "Users" subtab. From there
individual user mappings can be added, removed, or edited.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/wildflysite/assets/img/posts/images/usermapping.png" alt="images/usermapping.png" width="450"></span></p>
</div>
<div class="paragraph">
<p>The CLI can also be used to map individuals users to roles.</p>
</div>
<div class="paragraph">
<p>First, if one does not exist, create the parent resource for all
mappings for a role. Here we create the resource for the <code>Administrator</code>
role.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Administrator:add
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this is done, map a user to the role:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Administrator/include=user-jsmith:add(name=jsmith,type=USER)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if user <code>jsmith</code> authenticates to any security realm associated with
the management interface they are using, he will be mapped to the
<code>Administrator</code> role.</p>
</div>
<div class="paragraph">
<p>To restrict the mapping to a particular security realm, change the
<code>realm</code> attribute to the realm name. This might be useful if different
realms are associated with different management interfaces, and the goal
is to limit a user to a particular interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Administrator/include=user-mjones:add(name=mjones,type=USER,realm=ManagementRealm)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-groups">User groups</h3>
<div class="paragraph">
<p>A "group" is an arbitrary collection of users that may exist in the end
user environment. They can be named whatever the end user organization
wants and can contain whatever users the end user organization wants.
Some of the authentication store types supported by WildFly security
realms include the ability to access information about what groups a
user is a member of and associate this information with the <code>Subject</code>
produced when the user is authenticated. This is currently supported for
the following authentication store types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>properties file (via the <code>&lt;realm_name&gt;-groups.properties</code> file)</p>
</li>
<li>
<p>LDAP (via directory-server-specific configuration)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groups are convenient when it comes to associating a user with a role,
since entire groups can be associated with a role in a single mapping.</p>
</div>
</div>
<div class="sect2">
<h3 id="mapping-groups-to-roles">Mapping groups to roles</h3>
<div class="paragraph">
<p>The easiest way to map groups to roles is to use the web-based admin
console.</p>
</div>
<div class="paragraph">
<p>Navigate to the "Administration" tab and the "Groups" subtab. From there
group mappings can be added, removed, or edited.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/wildflysite/assets/img/posts/images/groupmapping.png" alt="images/groupmapping.png" width="450"></span></p>
</div>
<div class="paragraph">
<p>The CLI can also be used to map groups to roles. The only difference to
individual user mapping is the value of the <code>type</code> attribute should be
<code>GROUP</code> instead of <code>USER</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Administrator/include=group-SeniorAdmins:add(name=SeniorAdmins,type=GROUP)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with individual user mappings, the mapping can be restricted to users
authenticating via a particular security realm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Administrator/include=group-PowerAdmins:add(name=PowerAdmins,type=GROUP,realm=ManagementRealm)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="including-all-authenticated-users-in-a-role">Including all authenticated users in a role</h3>
<div class="paragraph">
<p>It&#8217;s possible to specify that all authenticated users should be mapped
to a particular role. This could be used, for example, to ensure that
anyone who can authenticate can at least have <code>Monitor</code> privileges.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A user who can authenticate to the management security realm but who
does not map to a role will not be able to perform any administrative
functions, not even reads.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the web based admin console, navigate to the "Administration" tab,
"Roles" subtab, highlight the relevant role, click the "Edit" button and
click on the "Include All" checkbox:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/wildflysite/assets/img/posts/images/includeall.png" alt="images/includeall.png" width="450"></span></p>
</div>
<div class="paragraph">
<p>The same change can be made using the CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">[domain@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Monitor:write-attribute(name=include-all,value=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="excluding-users-and-groups">Excluding users and groups</h3>
<div class="paragraph">
<p>It is also possible to explicitly exclude certain users and groups from
a role. Exclusions take precedence over inclusions, including cases
where the <code>include-all</code> attribute is set to true for a role.</p>
</div>
<div class="paragraph">
<p>In the admin console, excludes are done in the same screens as includes.
In the add dialog, simply change the "Type" pulldown to "Exclude".</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/wildflysite/assets/img/posts/images/excludemapping.png" alt="images/excludemapping.png" width="450"></span></p>
</div>
<div class="paragraph">
<p>In the CLI, excludes are identical to includes, except the resource
address has <code>exclude</code> instead of <code>include</code> as the key for the last
address element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Monitor/exclude=group-Temps:add(name=Temps,type=GROUP)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="users-who-map-to-multiple-roles">Users who map to multiple roles</h3>
<div class="paragraph">
<p>It is possible that a given user will be mapped to more than one role.
When this occurs, by default the user will be granted the union of the
permissions of the two roles. This behavior can be changed <strong>on a global
basis</strong> to instead respond to the user request with an error if this
situation is detected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] cd core-service=management/access=authorization
[standalone@localhost:9990 access=authorization] :write-attribute(name=permission-combination-policy,value=rejecting)
{"outcome" =&gt; "success"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that no reload is required; the change takes immediate effect.</p>
</div>
<div class="paragraph">
<p>To restore the default behavior, set the value to "permissive":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] cd core-service=management/access=authorization
[standalone@localhost:9990 access=authorization] :write-attribute(name=permission-combination-policy,value=permissive)
{"outcome" =&gt; "success"}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-custom-roles-in-a-managed-domain">Adding custom roles in a managed domain</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A managed domain may involve a variety of servers running different
configurations and hosting different applications. In such an
environment, it is likely that there will be different teams of
administrators responsible for different parts of the domain. To allow
organizations to grant permissions to only parts of a domain, WildFly&#8217;s
RBAC scheme allows for the creation of custom "scoped roles". Scoped
roles are based on the seven standard roles, but with permissions
limited to a portion of the domain – either to a set of server groups or
to a set of hosts.</p>
</div>
<div class="sect2">
<h3 id="server-group-scoped-roles">Server group scoped roles</h3>
<div class="paragraph">
<p>The privileges for a server-group scoped role are constrained to
resources associated with one or more server groups. Server groups are
often associated with a particular application or set of applications;
organizations that have separate teams responsible for different
applications may find server-group scoped roles useful.</p>
</div>
<div class="paragraph">
<p>A server-group scoped role is equivalent to the default role upon which
it is based, but with privileges constrained to target resources in the
resource trees rooted in the server group resources. The server-group
scoped role can be configured to include privileges for the following
resources trees logically related to the server group:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Profile</p>
</li>
<li>
<p>Socket Binding Group</p>
</li>
<li>
<p>Deployment</p>
</li>
<li>
<p>Deployment override</p>
</li>
<li>
<p>Server group</p>
</li>
<li>
<p>Server config</p>
</li>
<li>
<p>Server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Resources in the profile, socket binding group, server config and server
portions of the tree that are not logically related to a server group
associated with the server-group scoped role will not be addressable by
a user in that role. So, in a domain with server groups "a" and "b", a
user in a server-group scoped role that grants access to "a" will not be
able to address /server-group=b. The system will treat that resource as
non-existent for that user.</p>
</div>
<div class="paragraph">
<p>In addition to these privileges, users in a server-group scoped role
will have non-sensitive read privileges (equivalent to the Monitor role)
for resources other than those listed above.</p>
</div>
<div class="paragraph">
<p>The easiest way to create a server-group scoped role is to
<a href="#using-the-admin-console-to-create-scoped-roles">use the admin console</a>.
But you can also use the CLI to create a server-group scoped role.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">[domain@localhost:9990 /] /core-service=management/access=authorization/server-group-scoped-role=MainGroupAdmins:add(base-role=Administrator,server-groups=[main-server-group])
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the role is created, users or groups can be mapped to it the same
as with the seven standard roles.</p>
</div>
</div>
<div class="sect2">
<h3 id="host-scoped-roles">Host scoped roles</h3>
<div class="paragraph">
<p>The privileges for a host-scoped role are constrained to resources
associated with one or more hosts. A user with a host-scoped role cannot
modify the domain wide configuration. Organizations may use host-scoped
roles to give administrators relatively broad administrative rights for
a host without granting such rights across the managed domain.</p>
</div>
<div class="paragraph">
<p>A host-scoped role is equivalent to the default role upon which it is
based, but with privileges constrained to target resources in the
resource trees rooted in the host resources for one or more specified
hosts.</p>
</div>
<div class="paragraph">
<p>In addition to these privileges, users in a host-scoped role will have
non-sensitive read privileges (equivalent to the Monitor role) for
domain wide resources (i.e. those not in the /host=* section of the
tree.)</p>
</div>
<div class="paragraph">
<p>Resources in the /host=* portion of the tree that are unrelated to the
hosts specified for the Host Scoped Role will not be visible to users in
that host-scoped role. So, in a domain with hosts "a" and "b", a user in
a host-scoped role that grants access to "a" will not be able to address
/host=b. The system will treat that resource as non-existent for that
user.</p>
</div>
<div class="paragraph">
<p>The easiest way to create a host-scoped role is to
<a href="#using-the-admin-console-to-create-scoped-roles">use the admin console</a>.
But you can also use the CLI to create a host scoped role.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] /core-service=management/access=authorization/host-scoped-role=MasterOperators:add(base-role=Operator,hosts=[master]}
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the role is created, users or groups can be mapped to it the same
as with the seven standard roles.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-admin-console-to-create-scoped-roles">Using the admin console to create scoped roles</h3>
<div class="paragraph">
<p>Both server-group and host scoped roles can be added, removed or edited
via the admin console. Select "Scoped Roles" from the "Administration"
tab, "Roles" subtab:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/wildflysite/assets/img/posts/images/scopedroles.png" alt="images/scopedroles.png" width="450"></span></p>
</div>
<div class="paragraph">
<p>When adding a new scoped role, use the dialogue&#8217;s "Type" pull down to
choose between a host scoped role and a server-group scoped role. Then
place the names of the relevant hosts or server groups in the "Scope"
text are.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/wildflysite/assets/img/posts/images/addscopedrole.png" alt="images/addscopedrole.png" width="450"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-constraints">Configuring constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following factors are used to determine whether a given role is
granted a permission:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What the requested action is (address, read, write)</p>
</li>
<li>
<p>Whether the resource, attribute or operation affects the persistent
configuration</p>
</li>
<li>
<p>Whether the resource, attribute or operation is related to the
administrative audit logging function</p>
</li>
<li>
<p>Whether the resource, attribute or operation is configured as security
sensitive</p>
</li>
<li>
<p>Whether an attribute or operation parameter value has a security vault
expression</p>
</li>
<li>
<p>Whether a resource is considered to be associated with applications,
as opposed to being part of a general container configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first three of these factors are non-configurable; the latter three
allow some customization.</p>
</div>
<div class="sect2">
<h3 id="configuring-sensitivity">Configuring sensitivity</h3>
<div class="paragraph">
<p>"Sensitivity" constraints are about restricting access to
security-sensitive data. Different organizations may have different
opinions about what is security sensitive, so WildFly provides
configuration options to allow users to tailor these constraints.</p>
</div>
<div class="sect3">
<h4 id="sensitive-resources-attributes-and-operations">Sensitive resources, attributes and operations</h4>
<div class="paragraph">
<p>The developers of the WildFly core and of any subsystem may annotate
resources, attributes or operations with a "sensitivity classification".
Classifications are either provided by the core and may be applicable
anywhere in the management model, or they are scoped to a particular
subsystem. For each classification, there will be a setting declaring
whether by default the addressing, read and write actions are considered
to be sensitive. If an action is sensitive, only users in the roles able
to deal with sensitive data (Administrator, Auditor, SuperUser) will
have permissions.</p>
</div>
<div class="paragraph">
<p>Using the CLI, administrators can see the settings for a classification.
For example, there is a core classification called "socket-config" that
is applied to elements throughout the model that relate to configuring
sockets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] cd core-service=management/access=authorization/constraint=sensitivity-classification/type=core/classification=socket-config
[domain@localhost:9990 classification=socket-config] ls -l
ATTRIBUTE                       VALUE     TYPE
configured-requires-addressable undefined BOOLEAN
configured-requires-read        undefined BOOLEAN
configured-requires-write       undefined BOOLEAN
default-requires-addressable    false     BOOLEAN
default-requires-read           false     BOOLEAN
default-requires-write          true      BOOLEAN
 
CHILD      MIN-OCCURS MAX-OCCURS
applies-to n/a        n/a</code></pre>
</div>
</div>
<div class="paragraph">
<p>The various <code>default-requires-&#8230;&#8203;</code> attributes indicate whether a user
must be in a role that allows security sensitive actions in order to
perform the action. In the <code>socket-config</code> example above,
<code>default-requires-write</code> is true, while the others are false. So, by
default modifying a setting involving socket configuration is considered
sensitive, while addressing those resources or doing reads is not
sensitive.</p>
</div>
<div class="paragraph">
<p>The <code>default-requires-&#8230;&#8203;</code> attributes are read-only. The
<code>configured-requires-&#8230;&#8203;</code> attributes however can be modified to override
the default settings with ones appropriate for your organization. For
example, if your organization doesn&#8217;t regard modifying socket
configuration settings to be security sensitive, you can change that
setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 classification=socket-config] :write-attribute(name=configured-requires-write,value=false)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Administrators can also read the management model to see to which
resources, attributes and operations a particular sensitivity
classification applies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 classification=socket-config] :read-children-resources(child-type=applies-to)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "/host=master" =&gt; {
            "address" =&gt; "/host=master",
            "attributes" =&gt; [],
            "entire-resource" =&gt; false,
            "operations" =&gt; ["resolve-internet-address"]
        },
        "/host=master/core-service=host-environment" =&gt; {
            "address" =&gt; "/host=master/core-service=host-environment",
            "attributes" =&gt; [
                "host-controller-port",
                "host-controller-address",
                "process-controller-port",
                "process-controller-address"
            ],
            "entire-resource" =&gt; false,
            "operations" =&gt; []
        },
        "/host=master/core-service=management/management-interface=http-interface" =&gt; {
            "address" =&gt; "/host=master/core-service=management/management-interface=http-interface",
            "attributes" =&gt; [
                "port",
                "secure-interface",
                "secure-port",
                "interface"
            ],
            "entire-resource" =&gt; false,
            "operations" =&gt; []
        },
        "/host=master/core-service=management/management-interface=native-interface" =&gt; {
            "address" =&gt; "/host=master/core-service=management/management-interface=native-interface",
            "attributes" =&gt; [
                "port",
                "interface"
            ],
            "entire-resource" =&gt; false,
            "operations" =&gt; []
        },
        "/host=master/interface=*" =&gt; {
            "address" =&gt; "/host=master/interface=*",
            "attributes" =&gt; [],
            "entire-resource" =&gt; true,
            "operations" =&gt; ["resolve-internet-address"]
        },
        "/host=master/server-config=*/interface=*" =&gt; {
            "address" =&gt; "/host=master/server-config=*/interface=*",
            "attributes" =&gt; [],
            "entire-resource" =&gt; true,
            "operations" =&gt; []
        },
        "/interface=*" =&gt; {
            "address" =&gt; "/interface=*",
            "attributes" =&gt; [],
            "entire-resource" =&gt; true,
            "operations" =&gt; []
        },
        "/profile=*/subsystem=messaging/hornetq-server=*/broadcast-group=*" =&gt; {
            "address" =&gt; "/profile=*/subsystem=messaging/hornetq-server=*/broadcast-group=*",
            "attributes" =&gt; [
                "group-address",
                "group-port",
                "local-bind-address",
                "local-bind-port"
            ],
            "entire-resource" =&gt; false,
            "operations" =&gt; []
        },
        "/profile=*/subsystem=messaging/hornetq-server=*/discovery-group=*" =&gt; {
            "address" =&gt; "/profile=*/subsystem=messaging/hornetq-server=*/discovery-group=*",
            "attributes" =&gt; [
                "group-address",
                "group-port",
                "local-bind-address"
            ],
            "entire-resource" =&gt; false,
            "operations" =&gt; []
        },
        "/profile=*/subsystem=transactions" =&gt; {
            "address" =&gt; "/profile=*/subsystem=transactions",
            "attributes" =&gt; ["process-id-socket-max-ports"],
            "entire-resource" =&gt; false,
            "operations" =&gt; []
        },
        "/server-group=*" =&gt; {
            "address" =&gt; "/server-group=*",
            "attributes" =&gt; ["socket-binding-port-offset"],
            "entire-resource" =&gt; false,
            "operations" =&gt; []
        },
        "/socket-binding-group=*" =&gt; {
            "address" =&gt; "/socket-binding-group=*",
            "attributes" =&gt; [],
            "entire-resource" =&gt; true,
            "operations" =&gt; []
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There will be a separate child for each address to which the
classification applies. The <code>entire-resource</code> attribute will be true if
the classification applies to the entire resource. Otherwise, the
<code>attributes</code> and <code>operations</code> attributes will include the names of
attributes or operations to which the classification applies.</p>
</div>
<div class="sect4">
<h5 id="classifications-with-broad-use">Classifications with broad use</h5>
<div class="paragraph">
<p>Several of the core sensitivity classifications are commonly used across
the management model and deserve special mention.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">credential</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An attribute whose value is some sort of credential, e.g. a
password or a username. By default sensitive for both reads and writes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security-domain-ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An attribute whose value is the name of a security
domain. By default sensitive for both reads and writes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security-realm-ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An attribute whose value is the name of a security
realm. By default sensitive for both reads and writes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">socket-binding-ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An attribute whose value is the name of a socket
binding. By default not sensitive for any action</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">socket-config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A resource, attribute or operation that somehow relates
to configuring a socket. By default sensitive for writes</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="values-with-security-vault-expressions">Values with security vault expressions</h4>
<div class="paragraph">
<p>By default any attribute or operation parameter whose value includes a
security vault expression will be treated as sensitive, even if no
sensitivity classification applies or the classification does not treat
the action as sensitive.</p>
</div>
<div class="paragraph">
<p>This setting can be <strong>globally</strong> changed via the CLI. There is a resource
for this configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] cd core-service=management/access=authorization/constraint=vault-expression
[domain@localhost:9990 constraint=vault-expression] ls -l
ATTRIBUTE                 VALUE     TYPE
configured-requires-read  undefined BOOLEAN
configured-requires-write undefined BOOLEAN
default-requires-read     true      BOOLEAN
default-requires-write    true      BOOLEAN</code></pre>
</div>
</div>
<div class="paragraph">
<p>The various <code>default-requires-&#8230;&#8203;</code> attributes indicate whether a user
must be in a role that allows security sensitive actions in order to
perform the action. So, by default both reading and writing attributes
whose values include vault expressions requires a user to be in one of
the roles with sensitive data permissions.</p>
</div>
<div class="paragraph">
<p>The <code>default-requires-&#8230;&#8203;</code> attributes are read-only. The
<code>configured-requires-&#8230;&#8203;</code> attributes however can be modified to override
the default settings with settings appropriate for your organization.
For example, if your organization doesn&#8217;t regard reading vault
expressions to be security sensitive, you can change that setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 constraint=vault-expression] :write-attribute(name=configured-requires-read,value=false)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This vault-expression constraint overlaps somewhat with the
<a href="#classifications-with-broad-use">core
"credential" sensitivity classification</a> in that the most typical uses
of a vault expression are in attributes that contain a user name or
password, and those will typically be annotated with the "credential"
sensitivity classification. So, if you change the settings for the
"credential" sensitivity classification you may also need to make a
corresponding change to the vault-expression constraint settings, or
your change will not have full effect.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Be aware though, that vault expressions can be used in any attribute
that supports expressions, not just in credential-type attributes. So it
is important to be familiar with where and how your organization uses
vault expressions before changing these settings.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-deployer-role-access">Configuring "Deployer" role access</h3>
<div class="paragraph">
<p>The standard <a href="#standard-rbac-roles">Deployer role</a>
has its write permissions limited to resources that are considered to be
"application resources"; i.e. conceptually part of an application and
not part of the general server configuration. By default, only
deployment resources are considered to be application resources.
However, different organizations may have different opinions on what
qualifies as an application resource, so for resource types that
subsystems authors consider <em>potentially</em> to be application resources,
WildFly provides a configuration option to declare them as such. Such
resources will be annotated with an "application classification".</p>
</div>
<div class="paragraph">
<p>For example, the mail subsystem provides such a classification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] cd /core-service=management/access=authorization/constraint=application-classification/type=mail/classification=mail-session
[domain@localhost:9990 classification=mail-session] ls -l
ATTRIBUTE              VALUE     TYPE
configured-application undefined BOOLEAN
default-application    false     BOOLEAN
 
CHILD      MIN-OCCURS MAX-OCCURS
applies-to n/a        n/a</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>read-resource</code> or <code>read-children-resources</code> to see what resources
have this classification applied:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 classification=mail-session] :read-children-resources(child-type=applies-to)
{
    "outcome" =&gt; "success",
    "result" =&gt; {"/profile=*/subsystem=mail/mail-session=*" =&gt; {
        "address" =&gt; "/profile=*/subsystem=mail/mail-session=*",
        "attributes" =&gt; [],
        "entire-resource" =&gt; true,
        "operations" =&gt; []
    }}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This indicates that this classification, intuitively enough, only
applies to mail subsystem mail-session resources.</p>
</div>
<div class="paragraph">
<p>To make resources with this classification writeable by users in the
Deployer role, set the <code>configured-application</code> attribute to true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 classification=mail-session] :write-attribute(name=configured-application,value=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="application-classifications-shipped-with-wildfly">Application classifications shipped with WildFly</h4>
<div class="paragraph">
<p>The subsystems shipped with the full WildFly distribution include the
following application classifications:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Subsystem</th>
<th class="tableblock halign-left valign-top">Classification</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data-source</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc-driver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xa-data-source</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logger</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging-profile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail-session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messaging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jms-queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messaging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jms-topic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messaging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messaging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security-setting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">naming</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">binding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource-adapters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource-adapter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security-domain</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In each case the classification applies to the resources you would
expect, given its name.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rbac-effect-on-administrator-user-experience">RBAC effect on administrator user experience</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The RBAC scheme will result in reduced permissions for administrators
who do not map to the SuperUser role, so this will of course have some
impact on their experience when using administrative tools like the
admin console and the CLI.</p>
</div>
<div class="sect2">
<h3 id="admin-console">Admin console</h3>
<div class="paragraph">
<p>The admin console takes great pains to provide a good user experience
even when the user has reduced permissions. Resources the user is not
permitted to see will simply not be shown, or if appropriate will be
replaced in the UI with an indication that the user is not authorized.
Interaction units like "Add" and "Remove" buttons and "Edit" links will
be suppressed if the user has no write permissions.</p>
</div>
</div>
<div class="sect2">
<h3 id="cli">CLI</h3>
<div class="paragraph">
<p>The CLI is a much more unconstrained tool than the admin console is,
allowing users to try to execute whatever operations they wish, so it&#8217;s
more likely that users who attempt to do things for which they lack
necessary permissions will receive failure messages. For example, a user
in the Monitor role cannot read passwords:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] /profile=default/subsystem=datasources/data-source=ExampleDS:read-attribute(name=password)
{
    "outcome" =&gt; "failed",
    "result" =&gt; undefined,
    "failure-description" =&gt; "WFLYCTL0313: Unauthorized to execute operation 'read-attribute' for resource '[
    (\"profile\" =&gt; \"default\"),
    (\"subsystem\" =&gt; \"datasources\"),
    (\"data-source\" =&gt; \"ExampleDS\")
]' -- \"WFLYCTL0332: Permission denied\"",
    "rolled-back" =&gt; true
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the user isn&#8217;t even allowed to
<a href="#addressing-a-resource">address the resource</a> then the
response would be as if the resource doesn&#8217;t exist, even though it
actually does:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] /profile=default/subsystem=security/security-domain=other:read-resource
{
    "outcome" =&gt; "failed",
    "failure-description" =&gt; "WFLYCTL0216: Management resource '[
    (\"profile\" =&gt; \"default\"),
    (\"subsystem\" =&gt; \"security\"),
    (\"security-domain\" =&gt; \"other\")
]' not found",
    "rolled-back" =&gt; true
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This prevents unauthorized users fishing for sensitive data in resource
addresses by checking for "Permission denied" type failures.</p>
</div>
<div class="paragraph">
<p>Users who use the <code>read-resource</code> operation may ask for data, some of
which they are allowed to see and some of which they are not. If this
happens, the request will not fail, but inaccessible data will be elided
and a response header will be included advising on what was not
included. Here we show the effect of a Monitor trying to recursively
read the security subsystem configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] /profile=default/subsystem=security:read-resource(recursive=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "deep-copy-subject-mode" =&gt; undefined,
        "security-domain" =&gt; undefined,
        "vault" =&gt; undefined
    },
    "response-headers" =&gt; {"access-control" =&gt; [{
        "absolute-address" =&gt; [
            ("profile" =&gt; "default"),
            ("subsystem" =&gt; "security")
        ],
        "relative-address" =&gt; [],
        "filtered-attributes" =&gt; ["deep-copy-subject-mode"],
        "filtered-children-types" =&gt; ["security-domain"]
    }]}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>response-headers</code> section includes access control data in a list
with one element per relevant resource. (In this case there&#8217;s just one.)
The absolute and relative address of the resource is shown, along with
the fact that the value of the <code>deep-copy-subject-mode</code> attribute has
been filtered (i.e. undefined is shown as the value, which may not be
the real value) as well as the fact that child resources of type
<code>security-domain</code> have been filtered.</p>
</div>
</div>
<div class="sect2">
<h3 id="description-of-access-control-constraints-in-the-management-model-metadata">Description of access control constraints in the management model</h3>
<div class="paragraph">
<p>metadata</p>
</div>
<div class="paragraph">
<p>The management model descriptive metadata returned from operations like
<code>read-resource-description</code> and <code>read-operation-description</code> can be
configured to include information describing the access control
constraints relevant to the resource, This is done by using the
<code>access-control</code> parameter. The output will be tailored to the caller&#8217;s
permissions. For example, a user who maps to the Monitor role could ask
for information about a resource in the mail subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] cd /profile=default/subsystem=mail/mail-session=default/server=smtp
[domain@localhost:9990 server=smtp] :read-resource-description(access-control=trim-descriptions)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "description" =&gt; undefined,
        "access-constraints" =&gt; {"application" =&gt; {"mail-session" =&gt; {"type" =&gt; "mail"}}},
        "attributes" =&gt; undefined,
        "operations" =&gt; undefined,
        "children" =&gt; {},
        "access-control" =&gt; {
            "default" =&gt; {
                "read" =&gt; true,
                "write" =&gt; false,
                "attributes" =&gt; {
                    "outbound-socket-binding-ref" =&gt; {
                        "read" =&gt; true,
                        "write" =&gt; false
                    },
                    "username" =&gt; {
                        "read" =&gt; false,
                        "write" =&gt; false
                    },
                    "tls" =&gt; {
                        "read" =&gt; true,
                        "write" =&gt; false
                    },
                    "ssl" =&gt; {
                        "read" =&gt; true,
                        "write" =&gt; false
                    },
                    "password" =&gt; {
                        "read" =&gt; false,
                        "write" =&gt; false
                    }
                }
            },
            "exceptions" =&gt; {}
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because <code>trim-descriptions</code> was used as the value for the
<code>access-control</code> parameter, the typical "description", "attributes",
"operations" and "children" data is largely suppressed. (For more on
this, <a href="#access-control-param">see below</a>.) The
<code>access-constraints</code> field indicates that this resource is annotated
with an application constraint. The <code>access-control</code> field includes information about the
permissions the current caller has for this resource. The <code>default</code>
section shows the default settings for resources of this type. The
<code>read</code> and <code>write</code> fields directly under <code>default</code> show that the caller
can, in general, read this resource but cannot write it. The
<code>attributes</code> section shows the individual attribute settings. Note that
Monitor cannot read the <code>username</code> and <code>password</code> attributes.</p>
</div>
<div class="paragraph">
<p>There are three valid values for the <code>access-control</code> parameter to
<code>read-resource-description</code> and <code>read-operation-description</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>none</strong> – do not include access control information in the response.
This is the default behavior if no parameter is included.</p>
</li>
<li>
<p><strong>trim-descriptions</strong> – remove the normal description details, as shown
in the example above</p>
</li>
<li>
<p><strong>combined-descriptions</strong> – include both the normal output and the
access control data</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="learning-about-your-own-role-mappings">Learning about your own role mappings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Users can learn in which roles they are operating. In the admin console,
click on your name in the top right corner; the roles you are in will be
shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/wildflysite/assets/img/posts/images/callersroles.png" alt="images/callersroles.png" width="450"></span></p>
</div>
<div class="paragraph">
<p>CLI users should use the <code>whoami</code> operation with the <code>verbose</code> attribute
set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@localhost:9990 /] :whoami(verbose=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "identity" =&gt; {
            "username" =&gt; "aadams",
            "realm" =&gt; "ManagementRealm"
        },
        "mapped-roles" =&gt; [
            "Maintainer"
        ]
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="run-as-capability-for-superusers">"Run-as" capability for SuperUsers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a user maps to the SuperUser role, WildFly also supports letting that
user request that they instead map to one or more other roles. This can
be useful when doing demos, or when the SuperUser is changing the RBAC
configuration and wants to see what effect the changes have from the
perspective of a user in another role. This capability is only available
to the SuperUser role, so it can only be used to narrow a user&#8217;s
permissions, not to potentially increase them.</p>
</div>
<div class="sect2">
<h3 id="cli-run-as">CLI run-as</h3>
<div class="paragraph">
<p>With the CLI, run-as capability is on a per-request basis. It is done by
using the "roles" operation header, the value of which can be the name
of a single role or a bracket-enclosed, comma-delimited list of role
names.</p>
</div>
<div class="paragraph">
<p>Example with a low level operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] :whoami(verbose=true){roles=[Operator,Auditor]}
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "identity" =&gt; {
            "username" =&gt; "$local",
            "realm" =&gt; "ManagementRealm"
        },
        "mapped-roles" =&gt; [
            "Auditor",
            "Operator"
        ]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example with a CLI command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] deploy /tmp/helloworld.war --headers={roles=Monitor}
{"WFLYCTL0062: Composite operation failed and was rolled back. Steps that failed:" =&gt; {"Operation step-1" =&gt; "WFLYCTL0313: Unauthorized to execute operation 'add' for resource '[(\"deployment\" =&gt; \"helloworld.war\")]' -- \"WFLYCTL0332: Permission denied\""}}
[standalone@localhost:9990 /] deploy /tmp/helloworld.war --headers={roles=Maintainer}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we show the effect of switching to a role that isn&#8217;t granted the
necessary permission.</p>
</div>
</div>
<div class="sect2">
<h3 id="admin-console-run-as">Admin console run-as</h3>
<div class="paragraph">
<p>Admin console users can change the role in which they operate by
clicking on their name in the top right corner and clicking on the "Run
as&#8230;&#8203;" link.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/wildflysite/assets/img/posts/images/callersroles.png" alt="images/callersroles.png" width="450"></span></p>
</div>
<div class="paragraph">
<p>Then select the role in which you wish to operate:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/wildflysite/assets/img/posts/images/runasrole.png" alt="images/runasrole.png" width="450"></span></p>
</div>
<div class="paragraph">
<p>The console will need to be restarted in order for the change to take
effect.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-run-as-roles-with-the-simple-access-control-provider">Using run-as roles with the "simple" access control provider</h3>
<div class="paragraph">
<p>This "run-as" capability is available even if the "simple" access
control provider is used. When the "simple" provider is used, any
authenticated administrator is treated the same as if they would map to
SuperUser when the "rbac" provider is used.<br>
However, the "simple" provider actually understands all of the "rbac"
provider configuration settings described above, but only makes use of
them if the "run-as" capability is used for a request. Otherwise, the
SuperUser role has all permissions, so detailed configuration is
irrelevant.</p>
</div>
<div class="paragraph">
<p>Using the run-as capability with the "simple" provider may be useful if
an administrator is setting up an rbac provider configuration before
switching the provider to rbac to make that configuration take effect.
The administrator can then run-as different roles to see the effect of
the planned settings.</p>
</div>
</div>
</div>
</div>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/wildflysite/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Wildfly</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wildfly</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wildfly"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wildfly</span></a></li><li><a href="https://www.twitter.com/WildFlyAS"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">WildFlyAS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
