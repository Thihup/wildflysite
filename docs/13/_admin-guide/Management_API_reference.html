<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Management API reference | Wildfly</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Management API reference" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/Management_API_reference.html" />
<meta property="og:url" content="https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/Management_API_reference.html" />
<meta property="og:site_name" content="Wildfly" />
<script type="application/ld+json">
{"@type":"WebPage","url":"https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/Management_API_reference.html","headline":"Management API reference","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/wildflysite/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://jbossorg.github.io/wildflysite/feed.xml" title="Wildfly" /></head>
<body><div class="header navigation">
  <div class="logo-wrapper">
    <a href="/wildflysite/"><img class="wf-logo" src="/wildflysite/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/wildflysite/" class="">Home</a>
        </li>
        <li>
          <a href="/wildflysite/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/wildflysite/blog/" class="">Blog</a>
        </li>
        <li>
          <a href="/wildflysite/about/" class="">About</a>
        </li>
        <li>
          <a href="/wildflysite/contribute/" class="">Contribute</a>
        </li>
        <li>
          <a href="/wildflysite/docs/" class="">Docs</a>
        </li>
        <li>
          <a class="button-cta secondary" href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section is an in depth reference to the WildFly management API.
Readers are encouraged to read the
<a href="#Management_Clients">Management clients</a> and
<a href="#Core_management_concepts">Core management concepts</a> sections
for fundamental background information, as well as the
<a href="#Management_tasks">Management tasks</a> and
<a href="#Domain_Setup">Domain setup</a> sections for key task oriented
information. This section is meant as an in depth reference to delve
into some of the key details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Global_operations">Global operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The WildFly management API includes a number of operations that apply to
every resource.</p>
</div>
<div class="sect2">
<h3 id="the-read-resource-operation">The read-resource operation</h3>
<div class="paragraph">
<p>Reads a management resource&#8217;s attribute values along with either basic
or complete information about any child resources. Supports the<br>
following parameters, none of which are required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>recursive</code> – (boolean, default is <code>false</code>) – whether to include
complete information about child resources, recursively.</p>
</li>
<li>
<p><code>recursive-depth</code> – (int) – The depth to which information about child
resources should be included if <code>recursive</code> is <code>true</code>. If not set, the
depth will be unlimited; i.e. all descendant resources will be included.</p>
</li>
<li>
<p><code>proxies</code> – (boolean, default is <code>false</code>) – whether to include remote
resources in a recursive query (i.e. host level resources from slave
Host Controllers in a query of the Domain Controller; running server
resources in a query of a host).</p>
</li>
<li>
<p><code>include-runtime</code> – (boolean, default is <code>false</code>) – whether to include
runtime attributes (i.e. those whose value does not come from the
persistent configuration) in the response.</p>
</li>
<li>
<p><code>include-defaults</code> – (boolean, default is <code>true</code>) – whether to include
in the result default values not set by users. Many attributes have a
default value that will be used in the runtime if the users have not
provided an explicit value. If this parameter is <code>false</code> the value for
such attributes in the result will be <code>undefined</code>. If <code>true</code> the result
will include the default value for such parameters.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-read-attribute-operation">The read-attribute operation</h3>
<div class="paragraph">
<p>Reads the value of an individual attribute. Takes a single, required,
parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the attribute to read.</p>
</li>
<li>
<p><code>include-defaults</code> – (boolean, default is <code>true</code>) – whether to include
in the result default values not set by users. Many attributes have a
default value that will be used in the runtime if the users have not
provided an explicit value. If this parameter is <code>false</code> the value for
such attributes in the result will be <code>undefined</code>. If <code>true</code> the result
will include the default value for such parameters.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-write-attribute-operation">The write-attribute operation</h3>
<div class="paragraph">
<p>Writes the value of an individual attribute. Takes two required
parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the attribute to write.</p>
</li>
<li>
<p><code>value</code> – (type depends on the attribute being written) – the new
value.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-undefine-attribute-operation">The undefine-attribute operation</h3>
<div class="paragraph">
<p>Sets the value of an individual attribute to the <code>undefined</code> value, if
such a value is allowed for the attribute. The operation will fail if
the <code>undefined</code> value is not allowed. Takes a single required parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the attribute to write.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-list-add-operation">The list-add operation</h3>
<div class="paragraph">
<p>Adds an element to the value of a list attribute, adding the element to
the end of the list unless the optional attribute <code>index</code> is passed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the list attribute to add new value
to.</p>
</li>
<li>
<p><code>value</code> – (type depends on the element being written) – the new
element to be added to the attribute value.</p>
</li>
<li>
<p><code>index</code> – (int, optional) – index where in the list to add the new
element. By default it is <code>undefined</code> meaning add at the end. Index is
zero based.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This operation will fail if the specified attribute is not a list.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-list-remove-operation">The list-remove operation</h3>
<div class="paragraph">
<p>Removes an element from the value of a list attribute, either the
element at a specified <code>index</code>, or the first element whose value matches
a specified <code>value</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the list attribute to add new value
to.</p>
</li>
<li>
<p><code>value</code> – (type depends on the element being written, optional) – the
element to be removed. Optional and ignored if <code>index</code> is specified.</p>
</li>
<li>
<p><code>index</code> – (int, optional) – index in the list whose element should be
removed. By default it is <code>undefined</code>, meaning <code>value</code> should be
specified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This operation will fail if the specified attribute is not a list.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-list-get-operation">The list-get operation</h3>
<div class="paragraph">
<p>Gets one element from a list attribute by its index</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the list attribute</p>
</li>
<li>
<p><code>index</code> – (int, required) – index of element to get from list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This operation will fail if the specified attribute is not a list.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-list-clear-operation">The list-clear operation</h3>
<div class="paragraph">
<p>Empties the list attribute. It is different from <code>:undefine-attribute</code>
as it results in attribute of type list with 0 elements, whereas
<code>:undefine-attribute</code> results in an <code>undefined</code> value for the attribute</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the list attribute</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This operation will fail if the specified attribute is not a list.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-map-put-operation">The map-put operation</h3>
<div class="paragraph">
<p>Adds an key/value pair entry to the value of a map attribute:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the map attribute to add the new entry
to.</p>
</li>
<li>
<p><code>key</code> – (string) – the key of the new entry to be added.</p>
</li>
<li>
<p><code>value</code> – (type depends on the entry being written) – the value of the
new entry to be added to the attribute value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This operation will fail if the specified attribute is not a map.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-map-remove-operation">The map-remove operation</h3>
<div class="paragraph">
<p>Removes an entry from the value of a map attribute:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the map attribute to remove the new
entry from.</p>
</li>
<li>
<p><code>key</code> – (string) – the key of the entry to be removed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This operation will fail if the specified attribute is not a map.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-map-get-operation">The map-get operation</h3>
<div class="paragraph">
<p>Gets the value of one entry from a map attribute</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the map attribute</p>
</li>
<li>
<p><code>key</code> – (string) – the key of the entry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This operation will fail if the specified attribute is not a map.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-map-clear-operation">The map-clear operation</h3>
<div class="paragraph">
<p>Empties the map attribute. It is different from <code>:undefine-attribute</code> as
it results in attribute of type map with 0 entries, whereas
<code>:undefine-attribute</code> results in an <code>undefined</code> value for the attribute</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the map attribute</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This operation will fail if the specified attribute is not a map.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-read-resource-description-operation">The read-resource-description operation</h3>
<div class="paragraph">
<p>Returns the description of a resource&#8217;s attributes, types of children
and, optionally, operations. Supports the<br>
following parameters, none of which are required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>recursive</code> – (boolean, default is <code>false</code>) – whether to include
information about child resources, recursively.</p>
</li>
<li>
<p><code>proxies</code> – (boolean, default is <code>false</code>) – whether to include remote
resources in a recursive query (i.e. host level resources from slave
Host Controllers in a query of the Domain Controller; running server
resources in a query of a host)</p>
</li>
<li>
<p><code>operations</code> – (boolean, default is <code>false</code>) – whether to include
descriptions of the resource&#8217;s operations</p>
</li>
<li>
<p><code>inherited</code> – (boolean, default is <code>true</code>) – if <code>operations</code> is
<code>true</code>, whether to include descriptions of operations inherited from
higher level resources. The global operations described in this section
are themselves inherited from the root resource, so the primary effect
of setting <code>inherited</code> to <code>false</code> is to exclude the descriptions of the
global operations from the output.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#Description_of_the_Management_Model">Description of the
Management Model</a> for details on the result of this operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-read-operation-names-operation">The read-operation-names operation</h3>
<div class="paragraph">
<p>Returns a list of the names of all the operations the resource supports.
Takes no parameters.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-read-operation-description-operation">The read-operation-description operation</h3>
<div class="paragraph">
<p>Returns the description of an operation, along with details of its
parameter types and its return value. Takes a single, required,
parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the operation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#Description_of_the_Management_Model">Description of the
Management Model</a> for details on the result of this operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-read-children-types-operation">The read-children-types operation</h3>
<div class="paragraph">
<p>Returns a list of the
<a href="Management_resources.html#src-557064_Managementresources-Address">types
of child resources</a> the resource supports. Takes two optional
parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>include-aliases</code> – (boolean, default is <code>false</code>) – whether to include
alias children (i.e. those which are aliases of other sub-resources) in
the response.</p>
</li>
<li>
<p><code>include-singletons</code> – (boolean, default is <code>false</code>) – whether to
include singleton children (i.e. those are children that acts as
resource aggregate and are registered with a wildcard name) in the
response
<a href="http://lists.jboss.org/pipermail/wildfly-dev/2014-August/002701.html">wildfly-dev
discussion around this topic</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-read-children-names-operation">The read-children-names operation</h3>
<div class="paragraph">
<p>Returns a list of the names of all child resources of a given
<a href="Management_resources.html#src-557064_Managementresources-Address">type</a>.
Takes a single, required, parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>child-type</code> – (string) – the name of the type</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-read-children-resources-operation">The read-children-resources operation</h3>
<div class="paragraph">
<p>Returns information about all of a resource&#8217;s children that are of a
given
<a href="Management_resources.html#src-557064_Managementresources-Address">type</a>.
For each child resource, the returned information is equivalent to
executing the <code>read-resource</code> operation on that resource. Takes the
following parameters, of which only \{{child-type} is required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>child-type</code> – (string) – the name of the type of child resource</p>
</li>
<li>
<p><code>recursive</code> – (boolean, default is <code>false</code>) – whether to include
complete information about child resources, recursively.</p>
</li>
<li>
<p><code>recursive-depth</code> – (int) – The depth to which information about child
resources should be included if <code>recursive</code> is \{{true}. If not set,
the depth will be unlimited; i.e. all descendant resources will be
included.</p>
</li>
<li>
<p><code>proxies</code> – (boolean, default is <code>false</code>) – whether to include remote
resources in a recursive query (i.e. host level resources from slave
Host Controllers in a query of the Domain Controller; running server
resources in a query of a host)</p>
</li>
<li>
<p><code>include-runtime</code> – (boolean, default is <code>false</code>) – whether to include
runtime attributes (i.e. those whose value does not come from the
persistent configuration) in the response.</p>
</li>
<li>
<p><code>include-defaults</code> – (boolean, default is <code>true</code>) – whether to include
in the result default values not set by users. Many attributes have a
default value that will be used in the runtime if the users have not
provided an explicit value. If this parameter is <code>false</code> the value for
such attributes in the result will be <code>undefined</code>. If <code>true</code> the result
will include the default value for such parameters.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-read-attribute-group-operation">The read-attribute-group operation</h3>
<div class="paragraph">
<p>Returns a list of attributes of a
<a href="Management_resources.html#src-557064_Managementresources-Address">type</a>
for a given attribute group name. For each attribute the returned
information is equivalent to executing the <code>read-attribute</code> operation of
that resource. Takes the following parameters, of which only \{{name}
is required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – (string) – the name of the attribute group to read.</p>
</li>
<li>
<p><code>include-defaults</code> – (boolean, default is <code>true</code>) – whether to include
in the result default values not set by users. Many attributes have a
default value that will be used in the runtime if the users have not
provided an explicit value. If this parameter is <code>false</code> the value for
such attributes in the result will be <code>undefined</code>. If <code>true</code> the result
will include the default value for such parameters.</p>
</li>
<li>
<p><code>include-runtime</code> – (boolean, default is <code>false</code>) – whether to include
runtime attributes (i.e. those whose value does not come from the
persistent configuration) in the response.</p>
</li>
<li>
<p><code>include-aliases</code> – (boolean, default is <code>false</code>) – whether to include
alias attributes (i.e. those which are alias of other attributes) in the
response.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-read-attribute-group-names-operation">The read-attribute-group-names operation</h3>
<div class="paragraph">
<p>Returns a list of attribute groups names for a given
<a href="Management_resources.html#src-557064_Managementresources-Address">type</a>.
Takes no parameters.</p>
</div>
</div>
<div class="sect2">
<h3 id="standard-operations">Standard Operations</h3>
<div class="paragraph">
<p>Besides the global operations described above, by convention nearly
every resource should expose an <code>add</code> operation and a <code>remove</code>
operation. Exceptions to this convention are the root resource, and
resources that do not store persistent configuration and are created
dynamically at runtime (e.g. resources representing the JVM&#8217;s platform
mbeans or resources representing aspects of the running state of a
deployment.)</p>
</div>
<div class="sect3">
<h4 id="the-add-operation">The add operation</h4>
<div class="paragraph">
<p>The operation that creates a new resource must be named <code>add</code>. The
operation may take zero or more parameters; what those parameters are
depends on the resource being created.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-remove-operation">The remove operation</h4>
<div class="paragraph">
<p>The operation that removes an existing resource must be named <code>remove</code>.
The operation should take no parameters.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Detyped_management_and_the_jboss-dmr_library">Detyped management and the jboss-dmr library</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The management model exposed by WildFly is very large and complex. There
are dozens, probably hundreds of logical concepts involved – hosts,
server groups, servers, subsystems, datasources, web connectors, and on
and on – each of which in a classic objected oriented API design could
be represented by a Java <em>type</em> (i.e. a Java class or interface.)
However, a primary goal in the development of WildFly&#8217;s native
management API was to ensure that clients built to use the API had as
few compile-time and run-time dependencies on JBoss-provided classes as
possible, and that the API exposed by those libraries be powerful but
also simple and stable. A management client running with the management
libraries created for an earlier version of WildFly should still work if
used to manage a later version domain. The management client libraries
needed to be <em>forward compatible</em>.</p>
</div>
<div class="paragraph">
<p>It is highly unlikely that an API that consists of hundreds of Java
types could be kept forward compatible. Instead, the WildFly management
API is a <em>detyped</em> API. A detyped API is like decaffeinated coffee – it
still has a little bit of caffeine, but not enough to keep you awake at
night. WildFly&#8217;s management API still has a few Java types in it (it&#8217;s
impossible for a Java library to have no types!) but not enough to keep
you (or us) up at night worrying that your management clients won&#8217;t be
forward compatible.</p>
</div>
<div class="paragraph">
<p>A detyped API works by making it possible to build up arbitrarily
complex data structures using a small number of Java types. All of the
parameter values and return values in the API are expressed using those
few types. Ideally, most of the types are basic JDK types, like
<code>java.lang.String</code>, <code>java.lang.Integer</code>, etc. In addition to the basic
JDK types, WildFly&#8217;s detyped management API uses a small library called
<strong>jboss-dmr</strong>. The purpose of this section is to provide a basic overview
of the jboss-dmr library.</p>
</div>
<div class="paragraph">
<p>Even if you don&#8217;t use jboss-dmr directly (probably the case for all but
a few users), some of the information in this section may be useful.
When you invoke operations using the application server&#8217;s Command Line
Interface, the return values are just the text representation of of a
jboss-dmr <code>ModelNode</code>. If your CLI commands require complex parameter
values, you may yourself end up writing the text representation of a
<code>ModelNode</code>. And if you use the HTTP management API, all response bodies
as well as the request body for any POST will be a JSON representation
of a <code>ModelNode</code>.</p>
</div>
<div class="paragraph">
<p>The source code for jboss-dmr is available on
<a href="https://github.com/jbossas/jboss-dmr">Github</a>. The maven coordinates for
a jboss-dmr release are <code>org.jboss.jboss-dmr:jboss-dmr</code>.</p>
</div>
<div class="sect2">
<h3 id="modelnode-and-modeltype">ModelNode and ModelType</h3>
<div class="paragraph">
<p>The public API exposed by jboss-dmr is very simple: just three classes,
one of which is an enum!</p>
</div>
<div class="paragraph">
<p>The primary class is <code>org.jboss.dmr.ModelNode</code>. A <code>ModelNode</code> is
essentially just a wrapper around some <em>value</em>; the value is typically
some basic JDK type. A <code>ModelNode</code> exposes a <code>getType()</code> method. This
method returns a value of type <code>org.jboss.dmr.ModelType</code>, which is an
enum of all the valid types of values. And that&#8217;s 95% of the public API;
a class and an enum. (We&#8217;ll get to the third class, <code>Property</code>, below.)</p>
</div>
<div class="sect3">
<h4 id="basic-modelnode-manipulation">Basic ModelNode manipulation</h4>
<div class="paragraph">
<p>To illustrate how to work with <code>ModelNode</code> s, we&#8217;ll use the
<a href="http://www.beanshell.org">Beanshell</a> scripting library. We won&#8217;t get into
many details of beanshell here; it&#8217;s a simple and intuitive tool and
hopefully the following examples are as well.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll start by launching a beanshell interpreter, with the jboss-dmr
library available on the classpath. Then we&#8217;ll tell beanshell to import
all the jboss-dmr classes so they are available for use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">$ java -cp bsh-2.0b4.jar:jboss-dmr-1.0.0.Final.jar bsh.Interpreter
BeanShell 2.0b4 - by Pat Niemeyer (pat@pat.net)
bsh % import org.jboss.dmr.*;
bsh %</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, create a <code>ModelNode</code> and use the beanshell <code>print</code> function to
output what type it is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % ModelNode node = new ModelNode();
bsh % print(node.getType());
UNDEFINED</code></pre>
</div>
</div>
<div class="paragraph">
<p>A new <code>ModelNode</code> has no value stored, so its type is
<code>ModelType.UNDEFINED</code>.</p>
</div>
<div class="paragraph">
<p>Use one of the overloaded <code>set</code> method variants to assign a node&#8217;s
value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % node.set(1);
bsh % print(node.getType());
INT
bsh % node.set(true);
bsh % print(node.getType());
BOOLEAN
bsh % node.set("Hello, world");
bsh % print(node.getType());
STRING</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use one of the <code>asXXX()</code> methods to retrieve the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % node.set(2);
bsh % print(node.asInt());
2
bsh % node.set("A string");
bsh % print(node.asString());
A string</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ModelNode</code> will attempt to perform type conversions when you invoke the
<code>asXXX</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % node.set(1);
bsh % print(node.asString());
1
bsh % print(node.asBoolean());
true
bsh % node.set(0);
bsh % print(node.asBoolean());
false
bsh % node.set("true");
bsh % print(node.asBoolean());
true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Not all type conversions are possible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % node.set("A string");
bsh % print(node.asInt());
// Error: // Uncaught Exception: Method Invocation node.asInt : at Line: 20 : in file: &lt;unknown file&gt; : node .asInt ( )
 
Target exception: java.lang.NumberFormatException: For input string: "A string"
 
java.lang.NumberFormatException: For input string: "A string"
 at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)
 at java.lang.Integer.parseInt(Integer.java:449)
 at java.lang.Integer.parseInt(Integer.java:499)
 at org.jboss.dmr.StringModelValue.asInt(StringModelValue.java:61)
 at org.jboss.dmr.ModelNode.asInt(ModelNode.java:117)
        ....</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ModelNode.getType()</code> method can be used to ensure a node has an
expected value type before attempting a type conversion.</p>
</div>
<div class="paragraph">
<p>One <code>set</code> variant takes another <code>ModelNode</code> as its argument. The value
of the passed in node is copied, so there is no shared state between the
two model nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % node.set("A string");
bsh % ModelNode another = new ModelNode();
bsh % another.set(node);
bsh % print(another.asString());
A string
bsh % node.set("changed");
bsh % print(node.asString());
changed
bsh % print(another.asString());
A string</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>ModelNode</code> can be cloned. Again, there is no shared state between the
original node and its clone:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % ModelNode clone = another.clone();
bsh % print(clone.asString());
A string
bsh % another.set(42);
bsh % print(another.asString());
42
bsh % print(clone.asString());
A string</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>protect()</code> method to make a <code>ModelNode</code> immutable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % clone.protect();
bsh % clone.set("A different string");
// Error: // Uncaught Exception: Method Invocation clone.set : at Line: 15 : in file: &lt;unknown file&gt; : clone .set ( "A different string" )
 
Target exception: java.lang.UnsupportedOperationException
 
java.lang.UnsupportedOperationException
 at org.jboss.dmr.ModelNode.checkProtect(ModelNode.java:1441)
 at org.jboss.dmr.ModelNode.set(ModelNode.java:351)
        ....</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="lists">Lists</h4>
<div class="paragraph">
<p>The above examples aren&#8217;t particularly interesting; if all we can do
with a <code>ModelNode</code> is wrap a simple Java primitive, what use is that?
However, a <code>ModelNode&#8217;s value can be more complex than a simple
primitive, and using these more complex types we can build complex data
structures. The first more complex type is `ModelType.LIST</code>.</p>
</div>
<div class="paragraph">
<p>Use the <code>add</code> methods to initialize a node&#8217;s value as a list and add to
the list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % ModelNode list = new ModelNode();
bsh % list.add(5);
bsh % list.add(10);
bsh % print(list.getType());
LIST</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>asInt()</code> to find the size of the list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % print(list.asInt());
2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the overloaded <code>get</code> method variant that takes an int param to
retrieve an item. The item is returned as a <code>ModelNode</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % ModelNode child = list.get(1);
bsh % print(child.asInt());
10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Elements in a list need not all be of the same type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % list.add("A string");
bsh % print(list.get(1).getType());
INT
bsh % print(list.get(2).getType());
STRING</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Here&#8217;s one of the trickiest things about jboss-dmr:</strong> <em>The</em> <code>get</code>
<em>methods actually mutate state; they are not "read-only"</em>. For example,
calling <code>get</code> with an index that does not exist yet in the list will
actually create a child of type <code>ModelType.UNDEFINED</code> at that index (and
will create UNDEFINED children for any intervening indices.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % ModelNode four = list.get(4);
bsh % print(four.getType());
UNDEFINED
bsh % print(list.asInt());
6</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the <code>get</code> call always returns a <code>ModelNode</code> and never <code>null</code> it is
safe to manipulate the return value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % list.get(5).set(30);
bsh % print(list.get(5).asInt());
30</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s not so interesting in the above example, but later on with node
of type <code>ModelType.OBJECT</code> we&#8217;ll see how that kind of method chaining
can let you build up fairly complex data structures with a minimum of
code.</p>
</div>
<div class="paragraph">
<p>Use the <code>asList()</code> method to get a <code>List&lt;ModelNode&gt;</code> of the children:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % for (ModelNode element : list.asList()) {
print(element.getType());
}
INT
INT
STRING
UNDEFINED
UNDEFINED
INT</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>asString()</code> and <code>toString()</code> methods provide slightly differently
formatted text representations of a <code>ModelType.LIST</code> node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % print(list.asString());
[5,10,"A string",undefined,undefined,30]
bsh % print(list.toString());
[
    5,
    10,
    "A string",
    undefined,
    undefined,
    30
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, if you&#8217;ve previously used <code>set</code> to assign a node&#8217;s value to
some non-list type, you cannot use the <code>add</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % node.add(5);
// Error: // Uncaught Exception: Method Invocation node.add : at Line: 18 : in file: &lt;unknown file&gt; : node .add ( 5 )
 
Target exception: java.lang.IllegalArgumentException
 
java.lang.IllegalArgumentException
 at org.jboss.dmr.ModelValue.addChild(ModelValue.java:120)
 at org.jboss.dmr.ModelNode.add(ModelNode.java:1007)
 at org.jboss.dmr.ModelNode.add(ModelNode.java:761)
        ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can, however, use the <code>setEmptyList()</code> method to change the node&#8217;s
type, and then use <code>add</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % node.setEmptyList();
bsh % node.add(5);
bsh % print(node.toString());
[5]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dmr-properties">Properties</h4>
<div class="paragraph">
<p>The third public class in the jboss-dmr library is
<code>org.jboss.dmr.Property</code>. A <code>Property</code> is a <code>String &#8658; ModelNode</code> tuple.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % Property prop = new Property("stuff", list);
bsh % print(prop.toString());
org.jboss.dmr.Property@79a5f739
bsh % print(prop.getName());
stuff
bsh % print(prop.getValue());
[
    5,
    10,
    "A string",
    undefined,
    undefined,
    30
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The property can be passed to <code>ModelNode.set</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % node.set(prop);
bsh % print(node.getType());
PROPERTY</code></pre>
</div>
</div>
<div class="paragraph">
<p>The text format for a node of <code>ModelType.PROPERTY</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % print(node.toString());
("stuff" =&gt; [
    5,
    10,
    "A string",
    undefined,
    undefined,
    30
])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Directly instantiating a <code>Property</code> via its constructor is not common.
More typically one of the two argument <code>ModelNode.add</code> or
<code>ModelNode.set</code> variants is used. The first argument is the property
name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % ModelNode simpleProp = new ModelNode();
bsh % simpleProp.set("enabled", true);
bsh % print(simpleProp.toString());
("enabled" =&gt; true)
bsh % print(simpleProp.getType());
PROPERTY
bsh % ModelNode propList = new ModelNode();
bsh % propList.add("min", 1);
bsh % propList.add("max", 10);
bsh % print(propList.toString());
[
    ("min" =&gt; 1),
    ("max" =&gt; 10)
]
bsh % print(propList.getType());
LIST
bsh % print(propList.get(0).getType());
PROPERTY</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>asPropertyList()</code> method provides easy access to a
<code>List&lt;Property&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % for (Property prop : propList.asPropertyList()) {
print(prop.getName() + " = " + prop.getValue());
}
min = 1
max = 10</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="modeltype.object">ModelType.OBJECT</h4>
<div class="paragraph">
<p>The most powerful and most commonly used complex value type in jboss-dmr
is <code>ModelType.OBJECT</code>. A <code>ModelNode</code> whose value is <code>ModelType.OBJECT</code>
internally maintains a <code>Map&lt;String, ModelNode</code>.</p>
</div>
<div class="paragraph">
<p>Use the <code>get</code> method variant that takes a string argument to add an
entry to the map. If no entry exists under the given name, a new entry
is added with a the value being a <code>ModelType.UNDEFINED</code> node. The node
is returned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % ModelNode range = new ModelNode();
bsh % ModelNode min = range.get("min");
bsh % print(range.toString());
{"min" =&gt; undefined}
bsh % min.set(2);
bsh % print(range.toString());
{"min" =&gt; 2}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again <strong>it is important to remember that the</strong> <code>get</code> <strong>operation may mutate
the state of a model node by adding a new entry.</strong> <em>It is not a read-only
operation.</em></p>
</div>
<div class="paragraph">
<p>Since <code>get</code> will never return <code>null</code>, a common pattern is to use method
chaining to create the key/value pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % range.get("max").set(10);
bsh % print(range.toString());
{
    "min" =&gt; 2,
    "max" =&gt; 10
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A call to <code>get</code> passing an already existing key will of course return
the same model node as was returned the first time <code>get</code> was called with
that key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % print(min == range.get("min"));
true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple parameters can be passed to <code>get</code>. This is a simple way to
traverse a tree made up of <code>ModelType.OBJECT</code> nodes. Again, <code>get</code> may
mutate the node on which it is invoked; e.g. it will actually create the
tree if nodes do not exist. This next example uses a workaround to get
beanshell to handle the overloaded <code>get</code> method that takes a variable
number of arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % String[] varargs = { "US", "Missouri", "St. Louis" };
bsh % salesTerritories.get(varargs).set("Brian");
bsh % print(salesTerritories.toString());
{"US" =&gt; {"Missouri" =&gt; {"St. Louis" =&gt; "Brian"}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The normal syntax would be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>salesTerritories.get("US", "Missouri", "St. Louis").set("Brian");</pre>
</div>
</div>
<div class="paragraph">
<p>The key/value pairs in the map can be accessed as a <code>List&lt;Property</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % for (Property prop : range.asPropertyList()) {
print(prop.getName() + " = " + prop.getValue());
}
min = 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The semantics of the backing map in a node of <code>ModelType.OBJECT</code> are
those of a <code>LinkedHashMap</code>. The map remembers the order in which
key/value pairs are added. This is relevant when iterating over the
pairs after calling <code>asPropertyList()</code> and for controlling the order in
which key/value pairs appear in the output from <code>toString()</code>.</p>
</div>
<div class="paragraph">
<p>Since the <code>get</code> method will actually mutate the state of a node if the
given key does not exist, <code>ModelNode</code> provides a couple methods to let
you check whether the entry is there. The <code>has</code> method simply does that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % print(range.has("unit"));
false
bsh % print(range.has("min"));
true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Very often, the need is to not only know whether the key/value pair
exists, but whether the value is defined (i.e. not
<code>ModelType.UNDEFINED</code>. This kind of check is analogous to checking
whether a field in a Java class has a null value. The <code>hasDefined</code> lets
you do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % print(range.hasDefined("unit"));
false
bsh % // Establish an undefined child 'unit';
bsh % range.get("unit");
bsh % print(range.toString());
{
    "min" =&gt; 2,
    "max" =&gt; 10,
    "unit" =&gt; undefined
}
bsh % print(range.hasDefined("unit"));
false
bsh % range.get("unit").set("meters");
bsh % print(range.hasDefined("unit"));
true</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="modeltype.expression">ModelType.EXPRESSION</h4>
<div class="paragraph">
<p>A value of type <code>ModelType.EXPRESSION</code> is stored as a string, but can
later be <em>resolved</em> to different value. The string has a special syntax
that should be familiar to those who have used the system property
substitution feature in previous JBoss AS releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">[&lt;prefix&gt;][${&lt;system-property-name&gt;[:&lt;default-value&gt;]}][&lt;suffix&gt;]*</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>${queue.length}
http://${host}
http://${host:localhost}:${port:8080}/index.html</pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>setExpression</code> method to set a node&#8217;s value to type expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % ModelNode expression = new ModelNode();
bsh % expression.setExpression("${queue.length}");
bsh % print(expression.getType());
EXPRESSION</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling <code>asString()</code> returns the same string that was input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % print(expression.asString());
${queue.length}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, calling <code>toString()</code> tells you that this node&#8217;s value is not of
<code>ModelType.STRING</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % print(expression.toString());
expression "${queue.length}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the <code>resolve</code> operation is called, the string is parsed and any
embedded system properties are resolved against the JVM&#8217;s current system
property values. A new <code>ModelNode</code> is returned whose value is the
resolved string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % System.setProperty("queue.length", "10");
bsh % ModelNode resolved = expression.resolve();
bsh % print(resolved.asInt());
10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the type of the <code>ModelNode</code> returned by <code>resolve()</code> is
<code>ModelType.STRING</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % print(resolved.getType());
STRING</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>resolved.asInt()</code> call in the previous example only worked because
the string "10" happens to be convertible into the int 10.</p>
</div>
<div class="paragraph">
<p>Calling <code>resolve()</code> has no effect on the value of the node on which the
method is invoked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % resolved = expression.resolve();
bsh % print(resolved.toString());
"10"
bsh % print(expression.toString());
expression "${queue.length}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>If an expression cannot be resolved, <code>resolve</code> just uses the original
string. The string can include more than one system property
substitution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % expression.setExpression("http://${host}:${port}/index.html");
bsh % resolved = expression.resolve();
bsh % print(resolved.asString());
http://${host}:${port}/index.html</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression can optionally include a default value, separated from
the name of the system property by a colon:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % expression.setExpression("http://${host:localhost}:${port:8080}/index.html");
bsh % resolved = expression.resolve();
bsh % print(resolved.asString());
http://localhost:8080/index.html</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actually including a system property substitution in the expression is
not required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % expression.setExpression("no system property");
bsh % resolved = expression.resolve();
bsh % print(resolved.asString());
no system property
bsh % print(expression.toString());
expression "no system property"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>resolve</code> method works on nodes of other types as well; it returns a
copy without attempting any real resolution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % ModelNode basic = new ModelNode();
bsh % basic.set(10);
bsh % resolved = basic.resolve();
bsh % print(resolved.getType());
INT
bsh % resolved.set(5);
bsh % print(resolved.asInt());
5
bsh % print(basic.asInt());
10</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="modeltype.type">ModelType.TYPE</h4>
<div class="paragraph">
<p>You can also pass one of the values of the <code>ModelType</code> enum to <code>set</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bsh % ModelNode type = new ModelNode();
bsh % type.set(ModelType.LIST);
bsh % print(type.getType());
TYPE
bsh % print(type.toString());
LIST</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is useful when using a <code>ModelNode</code> data structure to describe
another <code>ModelNode</code> data structure.</p>
</div>
</div>
<div class="sect3">
<h4 id="full-list-of-modelnode-types">Full list of ModelNode types</h4>
<div class="paragraph">
<p>BIG_DECIMAL<br>
BIG_INTEGER<br>
BOOLEAN<br>
BYTES<br>
DOUBLE<br>
EXPRESSION<br>
INT<br>
LIST<br>
LONG<br>
OBJECT<br>
PROPERTY<br>
STRING<br>
TYPE<br>
UNDEFINED</p>
</div>
</div>
<div class="sect3">
<h4 id="text-representation-of-a-modelnode">Text representation of a ModelNode</h4>
<div class="paragraph">
<p>TODO – document the grammar</p>
</div>
</div>
<div class="sect3">
<h4 id="json-representation-of-a-modelnode">JSON representation of a ModelNode</h4>
<div class="paragraph">
<p>TODO – document the grammar</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Description_of_the_Management_Model">Description of the Management Model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A detailed description of the resources, attributes and operations that
make up the management model provided by an individual WildFly instance
or by any Domain Controller or slave Host Controller process can be
queried using the <code>read-resource-description</code>, <code>read-operation-names</code>,
<code>read-operation-description</code> and <code>read-child-types</code> operations described
in the <a href="Global_operations.html">Global operations</a> section. In this
section we provide details on what&#8217;s included in those descriptions.</p>
</div>
<div class="sect2">
<h3 id="description-of-the-wildfly-managed-resources">Description of the WildFly Managed Resources</h3>
<div class="paragraph">
<p>All portions of the management model exposed by WildFly are addressable
via an ordered list of key/value pairs. For each addressable
<a href="Management_resources.html#management-resources">Management Resource</a>, the following
descriptive information will be available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>description</code> – String – text description of this portion of the model</p>
</li>
<li>
<p><code>min-occurs</code> – int, either 0 or 1 – Minimum number of resources of
this type that must exist in a valid model. If not present, the default
value is 0.</p>
</li>
<li>
<p><code>max-occurs</code> – int – Maximum number of resources of this type that may
exist in a valid model. If not present, the default value depends upon
the value of the final key/value pair in the address of the described
resource. If this value is '*', the default value is Integer.MAX_VALUE,
i.e. there is no limit. If this value is some other string, the default
value is 1.</p>
</li>
<li>
<p><code>attributes</code> – Map of String (the attribute name) to complex structure
– the configuration attributes available in this portion of the model.
See the <a href="#description-of-an-attribute">Description of an Attribute</a> section
for the representation of each attribute.</p>
</li>
<li>
<p><code>operations</code> – Map of String (the operation name) to complex structure
– the operations that can be targeted at this address. See the
<a href="#description-of-an-operation">Description of an Operation</a> section
for the representation of each operation.</p>
</li>
<li>
<p><code>children</code> – Map of String (the type of child) to complex structure –
the relationship of this portion of the model to other addressable
portions of the model. See the
<a href="#description-of-parentchild-relationships">Description of Parent/Child Relationships</a>
section for the representation of each child relationship.</p>
</li>
<li>
<p><code>head-comment-allowed</code> – boolean – This description key is for
possible future use.</p>
</li>
<li>
<p><code>tail-comment-allowed</code> – boolean – This description key is for
possible future use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
     "description =&gt; "A manageable resource",
     "tail-comment-allowed" =&gt; false,
     "attributes" =&gt; {
          "foo" =&gt; {
               .... details of attribute foo
          }
      },
     "operations" =&gt; {
          "start" =&gt; {
               .... details of the start operation
          }
      },
     "children" =&gt; {
          "bar" =&gt; {
               .... details of the relationship with children of type "bar"
          }
      }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="description-of-an-attribute">Description of an Attribute</h4>
<div class="paragraph">
<p>An attribute is a portion of the management model that is not directly
addressable. Instead, it is conceptually a property of an addressable
<a href="../Management_resources.html">management resource</a>. For
each attribute in the model, the following descriptive information will
be available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>description</code> – String – text description of the attribute</p>
</li>
<li>
<p><code>type</code> – <code>org.jboss.dmr.ModelType</code> – the type of the attribute value.
One of the enum values BIG_DECIMAL, BIG_INTEGER, BOOLEAN, BYTES, DOUBLE,
INT, LIST, LONG, OBJECT, PROPERTY, STRING. Most of these are
self-explanatory. An OBJECT will be represented in the detyped model as
a map of string keys to values of some other legal type, conceptually
similar to a <code>javax.management.openmbean.CompositeData</code>. A PROPERTY is a
single key/value pair, where the key is a string, and the value is of
some other legal type.</p>
</li>
<li>
<p><code>value-type</code> – ModelType or complex structure – Only present if type
is LIST or OBJECT. If all elements in the LIST or all the values of the
OBJECT type are of the same type, this will be one of the ModelType
enums BIG_DECIMAL, BIG_INTEGER, BOOLEAN, BYTES, DOUBLE, INT, LONG,
STRING. Otherwise, <code>value-type</code> will detail the structure of the
attribute value, enumerating the value&#8217;s fields and the type of their
value. So, an attribute with a <code>type</code> of LIST and a <code>value-type</code> value
of <code>ModelType.STRING</code> is analogous to a Java <code>List&lt;String&gt;</code>, while one
with a <code>value-type</code> value of <code>ModelType.INT</code> is analogous to a Java
<code>List&lt;Integer&gt;</code>. An attribute with a <code>type</code> of OBJECT and a <code>value-type</code>
value of <code>ModelType.STRING</code> is analogous to a Java
<code>Map&lt;String, String&gt;</code>. An attribute with a <code>type</code> of OBJECT and a
<code>value-type</code> whose value is not of type <code>ModelType</code> represents a
fully-defined complex object, with the object&#8217;s legal fields and their
values described.</p>
</li>
<li>
<p><code>expressions-allowed</code> – boolean – indicates whether the value of the
attribute may be of type <code>ModelType.EXPRESSION</code>, instead of its standard
type (see <code>type</code> and <code>value-type</code> above for discussion of an attribute&#8217;s
standard type.) A value of ModelType.EXPRESSION contains a
system-property substitution expression that the server will resolve
against the server-side system property map before using the value. For
example, an attribute named max-threads may have an expression value of
<code>${example.pool.max-threads:10</code>} instead of just 10. Default value if
not present is false.</p>
</li>
<li>
<p><code>required</code> – boolean – true if the attribute must have a defined value
in a representation of its portion of the model unless another attribute
included in a list of <code>alternatives</code> is defined; false if it may be
undefined (implying a null value) even in the absence of alternatives.
If not present, true is the default.</p>
</li>
<li>
<p><code>nillable</code> – boolean – true if the attribute might not have a defined
value in a representation of its portion of the model. A nillable
attribute may<br>
be undefined either because it is not <code>required</code> or because it is
required but has <code>alternatives</code> and one of the alternatives is defined.</p>
</li>
<li>
<p><code>storage</code> – String – Either "configuration" or "runtime". If
"configuration", the attribute&#8217;s value is stored as part of the
persistent configuration (e.g. in domain.xml, host.xml or
standalone.xml.) If "runtime" the attribute&#8217;s value is not stored in the
persistent configuration; the value only exists as long as the resource
is running.</p>
</li>
<li>
<p><code>access-type</code> – String – One of "read-only", "read-write" or "metric".
Whether an attribute value can be written, or can only read. A "metric"
is a read-only attribute whose value is not stored in the persistent
configuration, and whose value may change due to activity on the server.
If an attribute is "read-write", the resource will expose an operation
named "write-attribute" whose "name" parameter will accept this
attribute&#8217;s name and whose "value" parameter will accept a valid value
for this attribute. That operation will be the standard means of
updating this attribute&#8217;s value.</p>
</li>
<li>
<p><code>restart-required</code> – String – One of "no-services", "all-services",
"resource-services" or "jvm". Only relevant to attributes whose
access-type is read-write. Indicates whether execution of a
write-attribute operation whose name parameter specifies this attribute
requires a restart of services (or an entire JVM) in order for the
change to take effect in the runtime . See the discussion of
<a href="#applying-updates-to-runtime-services">Applying
Updates to Runtime Services</a> below. Default value is "no-services".</p>
</li>
<li>
<p><code>default</code> – the default value for the attribute that will be used in
runtime services if the attribute is not explicitly defined and no other
attributes listed as <code>alternatives</code> are defined.</p>
</li>
<li>
<p><code>alternatives</code> – List of string – Indicates an exclusive relationship
between attributes. If this attribute is defined, the other attributes
listed in this descriptor&#8217;s value should be undefined, even if their
<code>required</code> descriptor says true; i.e. the presence of this attribute
satisfies the requirement. Note that an attribute that is not explicitly
configured but has a <code>default</code> value is still regarded as not being
defined for purposes of checking whether the exclusive relationship has
been violated. Default is undefined; i.e. this does not apply to most
attributes.</p>
</li>
<li>
<p><code>requires</code> – List of string – Indicates that if this attribute has a
value (other than undefined), the other attributes listed in this
descriptor&#8217;s value must also have a value, even if their required
descriptor says false. This would typically be used in conjunction with
alternatives. For example, attributes "a" and "b" are required, but are
alternatives to each other; "c" and "d" are optional. But "b" requires
"c" and "d", so if "b" is used, "c" and "d" must also be defined.
Default is undefined; i.e. this does not apply to most attributes.</p>
</li>
<li>
<p><code>capability-reference</code> – string – if defined indicates that this
attribute&#8217;s value specifies the dynamic portion of the name of the
specified capability provided by another resource. This indicates the
attribute is a reference to another area of the management model. (Note
that at present some attributes that reference other areas of the model
may not provide this information.)</p>
</li>
<li>
<p><code>head-comment-allowed</code> – boolean – This description key is for
possible future use.</p>
</li>
<li>
<p><code>tail-comment-allowed</code> – boolean – This description key is for
possible future use.</p>
</li>
<li>
<p>arbitrary key/value pairs that further describe the attribute value,
e.g. "max" &#8658; 2. See the <a href="#arbitrary-descriptors">Arbitrary
Descriptors</a> section.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">"foo" =&gt; {
     "description" =&gt; "The foo",
     "type" =&gt; INT,
     "max" =&gt; 2
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">"bar" =&gt; {
     "description" =&gt; "The bar",
     "type" =&gt; OBJECT,
     "value-type" =&gt; {
          "size" =&gt; INT,
          "color" =&gt; STRING
     }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-of-an-operation">Description of an Operation</h4>
<div class="paragraph">
<p>A management resource may have operations associated with it. The
description of an operation will include the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>operation-name</code> – String – the name of the operation</p>
</li>
<li>
<p><code>description</code> – String – text description of the operation</p>
</li>
<li>
<p><code>request-properties</code> – Map of String to complex structure –
description of the parameters of the operation. Keys are the names of
the parameters, values are descriptions of the parameter value types.
See
<a href="#description-of-an-operation-parameter-or-return-value">below</a>
for details on the description of parameter value types.</p>
</li>
<li>
<p><code>reply-properties</code> – complex structure, or empty – description of the
return value of the operation, with an empty node meaning void. See
<a href="#description-of-an-operation-parameter-or-return-value">below</a>
for details on the description of operation return value types.</p>
</li>
<li>
<p><code>restart-required</code> – String – One of "no-services", "all-services",
"resource-services" or "jvm". Indicates whether the operation makes a
configuration change that requires a restart of services (or an entire
JVM) in order for the change to take effect in the runtime. See
the discussion of <a href="#applying-updates-to-runtime-services">Applying
Updates to Runtime Services</a> below. Default value is "no-services".</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="description-of-an-operation-parameter-or-return-value">Description of an Operation Parameter or Return Value</h5>
<div class="ulist">
<ul>
<li>
<p><code>description</code> – String – text description of the parameter or return
value</p>
</li>
<li>
<p><code>type</code> – <code>org.jboss.dmr.ModelType</code> – the type of the parameter or
return value. One of the enum values BIG_DECIMAL, BIG_INTEGER, BOOLEAN,
BYTES, DOUBLE, INT, LIST, LONG, OBJECT, PROPERTY, STRING.</p>
</li>
<li>
<p><code>value-type</code> – <code>ModelType</code> or complex structure – Only present if type
is LIST or OBJECT. If all elements in the LIST or all the values of the
OBJECT type are of the same type, this will be one of the ModelType
enums BIG_DECIMAL, BIG_INTEGER, BOOLEAN, BYTES, DOUBLE, INT, LIST, LONG,
PROPERTY, STRING. Otherwise, value-type will detail the structure of the
attribute value, enumerating the value&#8217;s fields and the type of their
value.So, a parameter with a <code>type</code> of LIST and a <code>value-type</code> value of
<code>ModelType.STRING</code> is analogous to a Java <code>List&lt;String&gt;</code>, while one with
a <code>value-type</code> value of <code>ModelType.INT</code> is analogous to a Java
<code>List&lt;Integer&gt;</code>. A parameter with a <code>type</code> of OBJECT and a <code>value-type</code>
value of <code>ModelType.STRING</code> is analogous to a Java
<code>Map&lt;String, String&gt;</code>. A parameter with a <code>type</code> of OBJECT and a
<code>value-type</code> whose value is not of type <code>ModelType</code> represents a
fully-defined complex object, with the object&#8217;s legal fields and their
values described.</p>
</li>
<li>
<p><code>expressions-allowed</code> – boolean – indicates whether the value of the
the parameter or return value may be of type <code>ModelType.EXPRESSION</code>,
instead its standard type (see type and value-type above for discussion
of the standard type.) A value of ModelType.EXPRESSION contains a
system-property substitution expression that the server will resolve
against the server-side system property map before using the value. For
example, a parameter named max-threads may have an expression value of
<code>${example.pool.max-threads:10</code>} instead of just 10. Default value if
not present is false.</p>
</li>
<li>
<p><code>required</code> – boolean – true if the parameter or return value must have
a defined value in the operation or response unless another item
included in a list of <code>alternatives</code> is defined; false if it may be
undefined (implying a null value) even in the absence of alternatives.
If not present, true is the default.</p>
</li>
<li>
<p><code>nillable</code> – boolean – true if the parameter or return value might not
have a defined value in a representation of its portion of the model. A
nillable parameter or return value may be undefined either because it is
not <code>required</code> or because it is required but has <code>alternatives</code> and one
of the alternatives is defined.</p>
</li>
<li>
<p><code>default</code> – the default value for the parameter that will be used in
runtime services if the parameter is not explicitly defined and no other
parameters listed as <code>alternatives</code> are defined.</p>
</li>
<li>
<p><code>restart-required</code> – String – One of "no-services", "all-services",
"resource-services" or "jvm". Only relevant to attributes whose
access-type is read-write. Indicates whether execution of a
write-attribute operation whose name parameter specifies this attribute
requires a restart of services (or an entire JVM) in order for the
change to take effect in the runtime . See the discussion of
<a href="#applying-updates-to-runtime-services">Applying
Updates to Runtime Services</a> below. Default value is "no-services".</p>
</li>
<li>
<p><code>alternatives</code> – List of string – Indicates an exclusive relationship
between parameters. If this attribute is defined, the other parameters
listed in this descriptor&#8217;s value should be undefined, even if their
required descriptor says true; i.e. the presence of this parameter
satisfies the requirement. Note that an parameer that is not explicitly
configured but has a <code>default</code> value is still regarded as not being
defined for purposes of checking whether the exclusive relationship has
been violated. Default is undefined; i.e. this does not apply to most
parameters.</p>
</li>
<li>
<p><code>requires</code> – List of string – Indicates that if this parameter has a
value (other than undefined), the other parameters listed in this
descriptor&#8217;s value must also have a value, even if their required
descriptor says false. This would typically be used in conjunction with
alternatives. For example, parameters "a" and "b" are required, but are
alternatives to each other; "c" and "d" are optional. But "b" requires
"c" and "d", so if "b" is used, "c" and "d" must also be defined.
Default is undefined; i.e. this does not apply to most parameters.</p>
</li>
<li>
<p>arbitrary key/value pairs that further describe the attribute value,
e.g. "max" &#8658;2. See the <a href="#arbitrary-descriptors">Arbitrary Descriptors</a>
section.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="arbitrary-descriptors">Arbitrary Descriptors</h4>
<div class="paragraph">
<p>The description of an attribute, operation parameter or operation return
value type can include arbitrary key/value pairs that provide extra
information. Whether a particular key/value pair is present depends on
the context, e.g. a pair with key "max" would probably only occur as
part of the description of some numeric type.</p>
</div>
<div class="paragraph">
<p>Following are standard keys and their expected value type. If descriptor
authors want to add an arbitrary key/value pair to some descriptor and
the semantic matches the meaning of one of the following items, the
standard key/value type must be used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>min</code> – int – the minimum value of some numeric type. The absence of
this item implies there is no minimum value.</p>
</li>
<li>
<p><code>max</code> – int – the maximum value of some numeric type. The absence of
this item implies there is no maximum value.</p>
</li>
<li>
<p><code>min-length</code> – int – the minimum length of some string, list or byte[]
type. The absence of this item implies a minimum length of zero.</p>
</li>
<li>
<p><code>max-length</code> – int – the maximum length of some string, list or
byte[]. The absence of this item implies there is no maximum value.</p>
</li>
<li>
<p><code>allowed</code> – List – a list of legal values. The type of the elements in
the list should match the type of the attribute.</p>
</li>
<li>
<p><code>unit</code> - The unit of the value, if one is applicable - e.g. ns, ms, s,
m, h, KB, MB, TB. See the
<code>org.jboss.as.controller.client.helpers.MeasurementUnit</code> in the
org.jboss.as:jboss-as-controller-client artifact for a listing of legal
measurement units..</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
     "operation-name" =&gt; "incrementFoo",
     "description" =&gt; "Increase the value of the 'foo' attribute by the given amount",
     "request-properties" =&gt; {
          "increment" =&gt; {
               "type" =&gt; INT,
               "description" =&gt; "The amount to increment",
               "required" =&gt; true
     }},
     "reply-properties" =&gt; {
               "type" =&gt; INT,
               "description" =&gt; "The new value",
     }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
     "operation-name" =&gt; "start",
     "description" =&gt; "Starts the thing",
     "request-properties" =&gt; {},
     "reply-properties" =&gt; {}
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="description-of-parentchild-relationships">Description of Parent/Child Relationships</h4>
<div class="paragraph">
<p>The address used to target an addressable portion of the model must be
an ordered list of key value pairs. The effect of this requirement is
the addressable portions of the model naturally form a tree structure,
with parent nodes in the tree defining what the valid keys are and the
children defining what the valid values are. The parent node also
defines the cardinality of the relationship. The description of the
parent node includes a children element that describes these
relationships:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
     ....
     "children" =&gt; {
          "connector" =&gt; {
               .... description of the relationship with children of type "connector"
          },
          "virtual-host" =&gt; {
               .... description of the relationship with children of type "virtual-host"
          }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The description of each relationship will include the following
elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>description</code> – String – text description of the relationship</p>
</li>
<li>
<p><code>model-description</code> – either "undefined" or a complex structure – This
is a node of ModelType.OBJECT, the keys of which are legal values for
the value portion of the address of a resource of this type, with the
special character '*' indicating the value portion can have an arbitrary
value. The values in the node are the full description of the particular
child resource (its text description, attributes, operations, children)
as detailed above. This <code>model-description</code> may also be "undefined",
i.e. a null value, if the query that asked for the parent node&#8217;s
description did not include the "recursive" param set to true.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example with if the recursive flag was set to true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
     "description" =&gt; "The connectors used to handle client connections",
     "model-description" =&gt; {
          "*" =&gt; {
              "description" =&gt; "Handles client connections",
              "min-occurs" =&gt; 1,
              "attributes =&gt; {
                   ... details of children as documented above
              },
              "operations" =&gt; {
                   .... details of operations as documented above
              },
              "children" =&gt; {
                   .... details of the children's children
              }
          }
     }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the recursive flag was false:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
     "description" =&gt; "The connectors used to handle client connections",
     "model-description" =&gt; undefined
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="applying-updates-to-runtime-services">Applying Updates to Runtime Services</h4>
<div class="paragraph">
<p>An attribute or operation description may include a <code>restart-required</code>
descriptor; this section is an explanation of the
meaning of that descriptor.</p>
</div>
<div class="paragraph">
<p>An operation that changes a management resource&#8217;s persistent
configuration usually can also also affect a runtime service associated
with the resource. For example, there is a runtime service associated
with any host.xml or standalone.xml <code>&lt;interface&gt;</code> element; other
services in the runtime depend on that service to provide the
<code>InetAddress</code> associated with the interface. In many cases, an update to
a resource&#8217;s persistent configuration can be immediately applied to the
associated runtime service. The runtime service&#8217;s state is updated to
reflect the new value(s).</p>
</div>
<div class="paragraph">
<p>However, in many cases the runtime service&#8217;s state cannot be updated
without restarting the service. Restarting a service can have broad
effects. A restart of a service A will trigger a restart of other
services B, C and D that depend on A, triggering a restart of services that
depend on B, C and D, etc. Those service restarts may very well disrupt
handling of end-user requests.</p>
</div>
<div class="paragraph">
<p>Because restarting a service can be disruptive to end-user request
handling, the handlers for management operations will not restart any
service without some form of explicit instruction from the end user
indicating a service restart is desired. In a few cases, simply
executing the operation is an indication the user wants services to
restart (e.g. a <code>/host=master/server-config=server-one:restart</code>
operation in a managed domain, or a <code>/:reload</code> operation on a standalone
server.) For all other cases, if an operation (or attribute write)
cannot be performed without restarting a service, the metadata
describing the operation or attribute will include a <code>restart-required</code>
descriptor whose value indicates what is necessary
for the operation to affect the runtime:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>no-services</code> – Applying the operation to the runtime does not require
the restart of any services. This value is the default if the
restart-required descriptor is not present.</p>
</li>
<li>
<p><code>all-services</code> – The operation can only immediately update the
persistent configuration; applying the operation to the runtime will
require a subsequent restart of all services in the affected VM.
Executing the operation will put the server into a <code>reload-required</code>
state. Until a restart of all services is performed the response to this
operation and to any subsequent operation will include a response header
<code>"process-state" &#8658; "reload-required"</code>. For a standalone server, a
restart of all services can be accomplished by executing the <code>reload</code>
CLI command. For a server in a managed domain, restarting all services
is done via a reload operation targeting the particular server (e.g.
<code>/host=master/server=server-one:reload</code>).</p>
</li>
<li>
<p><code>jvm</code> --The operation can only immediately update the persistent
configuration; applying the operation to the runtime will require a full
process restart (i.e. stop the JVM and launch a new JVM). Executing the
operation will put the server into a <code>restart-required</code> state. Until
a restart is performed the response to this operation and to any
subsequent operation will include a response header
<code>"process-state" &#8658; "restart-required"</code>. For a standalone server, a full
process restart requires first stopping the server via OS-level
operations (Ctrl-C, kill) or via the <code>shutdown</code> CLI command, and then
starting the server again from the command line. For a server in a
managed domain, restarting a server requires executing the
<code>/host=&lt;host&gt;/server-config=&lt;server&gt;:restart</code> operation.</p>
</li>
<li>
<p><code>resource-services</code> – The operation can only immediately update the
persistent configuration; applying the operation to the runtime will
require a subsequent restart of some services associated with the
resource. If the operation includes the request header
<code>"allow-resource-service-restart" &#8658; true</code>, the handler for the
operation will go ahead and restart the runtime service. Otherwise
executing the operation will put the server into a <code>reload-required</code>
state. (See the discussion of <code>all-services</code> above for more on the
<code>reload-required</code> state.)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="The_HTTP_management_API">The HTTP management API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction">Introduction</h3>
<div class="paragraph">
<p>The Management API in WildFly is accessible through multiple channels,
one of them being HTTP and JSON.</p>
</div>
<div class="paragraph">
<p>Even if you haven&#8217;t used a curl command line you might already have used
this channel since it is how the web console interact with the
Management API.</p>
</div>
<div class="paragraph">
<p>WildFly is distributed secured by default, the default security
mechanism is <em>username / password</em> based making use of <strong>HTTP Digest</strong> for
the authentication process.</p>
</div>
<div class="paragraph">
<p>Thus <strong>you need to create a user</strong> with the add-user.sh script.</p>
</div>
</div>
<div class="sect2">
<h3 id="interacting-with-the-model">Interacting with the model</h3>
<div class="paragraph">
<p>Since we must be authenticated , the client will have to support HTTP
Digest authentication.</p>
</div>
<div class="paragraph">
<p>For example this can be activated in <em>curl</em> using the <em>--digest</em> option.</p>
</div>
<div class="paragraph">
<p>The WildFly HTTP Management API adheres to the REST principles so the
GET operations must be idempotent.</p>
</div>
<div class="paragraph">
<p>This means that using a request with method <strong>GET</strong> can be used to read
the model but <strong>you won&#8217;t be able to change it</strong>.</p>
</div>
<div class="paragraph">
<p>You must use <strong>POST</strong> to change the model or read it. A <strong>POST</strong> request may
contain the operation either in DMR or in JSON format as its body.</p>
</div>
<div class="paragraph">
<p>You have to define the <strong>Content-Type=application/json</strong> header in the
request to specify that you are using some JSON.</p>
</div>
<div class="paragraph">
<p>If you want to submit DMR in the request body then the <strong>Content-Type</strong> or
the <strong>Accept</strong> header should be <strong>"application/dmr-encoded"</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="get-for-reading">GET for Reading</h3>
<div class="paragraph">
<p>While you can do everything with <strong>POST</strong>, some operations can be called
through a 'classical' <strong>GET</strong> request.</p>
</div>
<div class="paragraph">
<p>These are the supported operations for a GET :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>attribute : for a read-attribute operation</p>
</li>
<li>
<p>resource : for a read-resource operation</p>
</li>
<li>
<p>resource-description : for a read-resource-description operation</p>
</li>
<li>
<p>snapshots : for the list-snapshots operation</p>
</li>
<li>
<p>operation-description : for a read-operation-description operation</p>
</li>
<li>
<p>operation-names : for ad read-operation-names operation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The URL format is the following one : <em><a href="http://server:9990/management/" class="bare">http://server:9990/management/</a></em>
<em>&lt;path_to_resource&gt;?operation=&lt;operation_name&gt;&amp;operation_parameter=&lt;value&gt;&#8230;&#8203;</em></p>
</div>
<div class="paragraph">
<p><em>path_to_resource</em> is the path to the wanted resource replacing all '='
with '/' : thus for example subsystem=undertow/server=default-server
becomes subsystem/undertow/server/default-server.</p>
</div>
<div class="paragraph">
<p>So to read the server-state :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:9990/management?operation=attribute&amp;name=server-state&amp;json.pretty=1</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lets-read-some-resource">Let&#8217;s read some resource</h3>
<div class="ulist">
<ul>
<li>
<p>This is simple operation that is equivalent of running
:read-attribute(name=server-state) with CLI in root directory</p>
<div class="ulist">
<ul>
<li>
<p>Using GET</p>
<div class="literalblock">
<div class="content">
<pre>http://localhost:9990/management?operation=attribute&amp;name=server-state&amp;json.pretty=1</pre>
</div>
</div>
</li>
<li>
<p>Using POST</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">$ curl --digest -L -D - http://localhost:9990/management --header "Content-Type: application/json" -d '{"operation":"read-attribute","name":"server-state","json.pretty":1}' -u admin
Enter host password for user 'admin':
HTTP/1.1 401 Unauthorized
Connection: keep-alive
WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="P80WU3BANtQNMTQwNjg5Mzc5MDQ2MlpjmRaZ+Vlp1OVeNEGBeXg=",opaque="00000000000000000000000000000000",algorithm=MD5
Content-Length: 77
Content-Type: text/html
Date: Fri, 01 Aug 2014 11:49:50 GMT
 
HTTP/1.1 200 OK
Connection: keep-alive
Authentication-Info: nextnonce="M+h9aADejeINMTQwNjg5Mzc5MDQ2OPQbHKdAS8pRE8BbGEDY5uI="
Content-Type: application/json; charset=utf-8
Content-Length: 55
Date: Fri, 01 Aug 2014 11:49:50 GMT
 
{
    "outcome" : "success",
    "result" : "running"
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Here&#8217;s an example of an operation on a resource with a nested address
and passed parameters. This is same as if you would run
<strong>/host=master/server=server-01:read-attribute(name=server-state)</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">$ curl --digest -L -D - http://localhost:9990/management --header "Content-Type: application/json" -d '{"operation":"read-attribute","address":[{"host":"master"},{"server":"server-01"}],"name":"server-state","json.pretty":1}'
HTTP/1.1 200 OK
Transfer-encoding: chunked
Content-type: application/json
Date: Tue, 17 Apr 2012 04:02:24 GMT
 
{
    "outcome" : "success",
    "result" : "running"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Following example will get us information from http connection in
undertow subsystem including run-time attributes<br>
This is the same as running
/subsystem=undertow/server=default-server:read-resource(include-runtime=true,recursive=true)
in CLI</p>
<div class="ulist">
<ul>
<li>
<p>Using GET</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">http://localhost:9990/management/subsystem/undertow/server/default-server?operation=resource&amp;recursive=true&amp;json.pretty=1
 
{
    "default-host" : "default-host",
    "servlet-container" : "default",
    "ajp-listener" : null,
    "host" : {"default-host" : {
        "alias" : ["localhost"],
        "default-web-module" : "ROOT.war",
        "filter-ref" : {
            "server-header" : {"predicate" : null},
            "x-powered-by-header" : {"predicate" : null}
        },
        "location" : {"/" : {
            "handler" : "welcome-content",
            "filter-ref" : null
        }},
        "setting" : null
    }},
    "http-listener" : {"default" : {
        "allow-encoded-slash" : false,
        "allow-equals-in-cookie-value" : false,
        "always-set-keep-alive" : true,
        "buffer-pipelined-data" : true,
        "buffer-pool" : "default",
        "certificate-forwarding" : false,
        "decode-url" : true,
        "enabled" : true,
        "max-buffered-request-size" : 16384,
        "max-cookies" : 200,
        "max-header-size" : 51200,
        "max-headers" : 200,
        "max-parameters" : 1000,
        "max-post-size" : 10485760,
        "proxy-address-forwarding" : false,
        "read-timeout" : null,
        "receive-buffer" : null,
        "record-request-start-time" : false,
        "redirect-socket" : "https",
        "send-buffer" : null,
        "socket-binding" : "http",
        "tcp-backlog" : null,
        "tcp-keep-alive" : null,
        "url-charset" : "UTF-8",
        "worker" : "default",
        "write-timeout" : null
    }},
    "https-listener" : null
}</code></pre>
</div>
</div>
</li>
<li>
<p>Using POST</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">$ curl --digest -D - http://localhost:9990/management --header "Content-Type: application/json" -d '{"operation":"read-resource", "include-runtime":"true" , "recursive":"true", "address":["subsystem","undertow","server","default-server"], "json.pretty":1}' -u admin:admin
HTTP/1.1 401 Unauthorized
Connection: keep-alive
WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="a3paQ9E0/l8NMTQwNjg5OTU0NDk4OKjmim2lopZNc5zCevjYWpk=",opaque="00000000000000000000000000000000",algorithm=MD5
Content-Length: 77
Content-Type: text/html
Date: Fri, 01 Aug 2014 13:25:44 GMT
 
HTTP/1.1 200 OK
Connection: keep-alive
Authentication-Info: nextnonce="nTOSJd3ufO4NMTQwNjg5OTU0NDk5MeUsRw5rKXUT4Qvk1nbrG5c="
Content-Type: application/json; charset=utf-8
Content-Length: 1729
Date: Fri, 01 Aug 2014 13:25:45 GMT
 
{
    "outcome" : "success",
    "result" : {
        "default-host" : "default-host",
        "servlet-container" : "default",
        "ajp-listener" : null,
        "host" : {"default-host" : {
            "alias" : ["localhost"],
            "default-web-module" : "ROOT.war",
            "filter-ref" : {
                "server-header" : {"predicate" : null},
                "x-powered-by-header" : {"predicate" : null}
            },
            "location" : {"/" : {
                "handler" : "welcome-content",
                "filter-ref" : null
            }},
            "setting" : null
        }},
        "http-listener" : {"default" : {
            "allow-encoded-slash" : false,
            "allow-equals-in-cookie-value" : false,
            "always-set-keep-alive" : true,
            "buffer-pipelined-data" : true,
            "buffer-pool" : "default",
            "certificate-forwarding" : false,
            "decode-url" : true,
            "enabled" : true,
            "max-buffered-request-size" : 16384,
            "max-cookies" : 200,
            "max-header-size" : 51200,
            "max-headers" : 200,
            "max-parameters" : 1000,
            "max-post-size" : 10485760,
            "proxy-address-forwarding" : false,
            "read-timeout" : null,
            "receive-buffer" : null,
            "record-request-start-time" : false,
            "redirect-socket" : "https",
            "send-buffer" : null,
            "socket-binding" : "http",
            "tcp-backlog" : null,
            "tcp-keep-alive" : null,
            "url-charset" : "UTF-8",
            "worker" : "default",
            "write-timeout" : null
        }},
        "https-listener" : null
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>You may also used some encoded DMR but the result won&#8217;t be human
readable</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl --digest -u admin:admin --header "Content-Type: application/dmr-encoded" -d bwAAAAMACW9wZXJhdGlvbnMADXJlYWQtcmVzb3VyY2UAB2FkZHJlc3NsAAAAAAAHcmVjdXJzZVoB  http://localhost:9990/management</code></pre>
</div>
</div>
</li>
<li>
<p>You can deploy applications on the server</p>
<div class="ulist">
<ul>
<li>
<p>First upload the file which will create a managed content. You will
have to use <a href="http://localhost:9990/management/" class="bare">http://localhost:9990/management/</a><strong>add-content</strong></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">curl --digest -u admin:admin --form file=@tiny-webapp.war  http://localhost:9990/management/add-content
{"outcome" : "success", "result" : { "BYTES_VALUE" : "+QJlHTDrogO9pm/57GkT/vxWNz0=" }}</code></pre>
</div>
</div>
</li>
<li>
<p>Now let&#8217;s deploy the application</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">curl --digest -u admin:admin -L --header "Content-Type: application/json" -d '{"content":[{"hash": {"BYTES_VALUE" : "+QJlHTDrogO9pm/57GkT/vxWNz0="}}], "address": [{"deployment":"tiny-webapp.war"}], "operation":"add", "enabled":"true"}' http://localhost:9990/management
{"outcome" : "success"}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-some-jax-rs-code">Using some JAX-RS code</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">HttpAuthenticationFeature feature = HttpAuthenticationFeature.digest("admin", "admin");
Client client = ClientBuilder.newClient();
client.register(feature);
Entity&lt;SimpleOperation&gt; operation = Entity.entity(
    new SimpleOperation("read-resource", true, "subsystem", "undertow", "server", "default-server"),
    MediaType.APPLICATION_JSON_TYPE);
WebTarget managementResource = client.target("http://localhost:9990/management");
String response = managementResource.request(MediaType.APPLICATION_JSON_TYPE)
    .header("Content-type", MediaType.APPLICATION_JSON)
    .post(operation, String.class);
System.out.println(response);
 
 
{"outcome" : "success", "result" : {"default-host" : "default-host", "servlet-container" : "default", "ajp-listener" : null, "host" : {"default-host" : {"alias" : ["localhost"], "default-web-module" : "ROOT.war", "filter-ref" : {"server-header" : {"predicate" : null}, "x-powered-by-header" : {"predicate" : null}}, "location" : {"/" : {"handler" : "welcome-content", "filter-ref" : null}}, "setting" : null}}, "http-listener" : {"default" : {"allow-encoded-slash" : false, "allow-equals-in-cookie-value" : false, "always-set-keep-alive" : true, "buffer-pipelined-data" : true, "buffer-pool" : "default", "certificate-forwarding" : false, "decode-url" : true, "enabled" : true, "max-buffered-request-size" : 16384, "max-cookies" : 200, "max-header-size" : 51200, "max-headers" : 200, "max-parameters" : 1000, "max-post-size" : 10485760, "proxy-address-forwarding" : false, "read-timeout" : null, "receive-buffer" : null, "record-request-start-time" : false, "redirect-socket" : "https", "send-buffer" : null, "socket-binding" : "http", "tcp-backlog" : null, "tcp-keep-alive" : null, "url-charset" : "UTF-8", "worker" : "default", "write-timeout" : null}}, "https-listener" : null}}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="The_native_management_API">The native management API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A standalone WildFly process, or a managed domain Domain Controller or
slave Host Controller process can be configured to listen for remote
management requests using its "native management interface":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;native-interface interface="management" port="9999" security-realm="ManagementRealm"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>~(See standalone/configuration/standalone.xml or
domain/configuration/host.xml)~</p>
</div>
<div class="paragraph">
<p>The CLI tool that comes with the application server uses this interface,
and user can develop custom clients that use it as well. In this section
we&#8217;ll cover the basics on how to develop such a client. We&#8217;ll also cover
details on the format of low-level management operation requests and
responses – information that should prove useful for users of the CLI
tool as well.</p>
</div>
<div class="sect2">
<h3 id="native-management-client-dependencies">Native Management Client Dependencies</h3>
<div class="paragraph">
<p>The native management interface uses an open protocol based on the JBoss
Remoting library. JBoss Remoting is used to establish a communication
channel from the client to the process being managed. Once the
communication channel is established the primary traffic over the
channel is management requests initiated by the client and asynchronous
responses from the target process.</p>
</div>
<div class="paragraph">
<p>A custom Java-based client should have the maven artifact
<code>org.jboss.as:jboss-as-controller-client</code> and its dependencies on the
classpath. The other dependencies are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Maven Artifact</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.remoting:jboss-remoting</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote communication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss:jboss-dmr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Detyped representation of the management model</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.as:jboss-as-protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wire protocol for remote WildFly
management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.sasl:jboss-sasl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SASL authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.xnio:xnio-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-blocking IO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.xnio:xnio-nio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-blocking IO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.logging:jboss-logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.threads:jboss-threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thread management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.marshalling:jboss-marshalling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marshalling and unmarshalling
data to/from streams</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The client API is entirely within the
<code>org.jboss.as:jboss-as-controller-client</code> artifact; the other
dependencies are part of the internal implementation of
<code>org.jboss.as:jboss-as-controller-client</code> and are not compile-time
dependencies of any custom client based on it.</p>
</div>
<div class="paragraph">
<p>The management protocol is an open protocol, so a completely custom
client could be developed without using these libraries (e.g. using
Python or some other language.)</p>
</div>
</div>
<div class="sect2">
<h3 id="working-with-a-modelcontrollerclient">Working with a ModelControllerClient</h3>
<div class="paragraph">
<p>The <code>org.jboss.as.controller.client.ModelControllerClient</code> class is the
main class a custom client would use to manage a WildFly server instance
or a Domain Controller or slave Host Controller.</p>
</div>
<div class="paragraph">
<p>The custom client must have maven artifact
<code>org.jboss.as:jboss-as-controller-client</code> and its dependencies on the
classpath.</p>
</div>
<div class="sect3">
<h4 id="creating-the-modelcontrollerclient">Creating the ModelControllerClient</h4>
<div class="paragraph">
<p>To create a management client that can connect to your target process&#8217;s
native management socket, simply:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ModelControllerClient client = ModelControllerClient.Factory.create(InetAddress.getByName("localhost"), 9999);</pre>
</div>
</div>
<div class="paragraph">
<p>The address and port are what is configured in the target process'
<code>&lt;management&gt;&lt;management-interfaces&gt;&lt;native-interface&#8230;&#8203;/&gt;</code> element.</p>
</div>
<div class="paragraph">
<p>Typically, however, the native management interface will be secured,
requiring clients to authenticate. On the client side, the custom client
will need to provide the user&#8217;s authentication credentials, obtained in
whatever manner is appropriate for the client (e.g. from a dialog box in
a GUI-based client.) Access to these credentials is provided by passing
in an implementation of the
<code>javax.security.auth.callback.CallbackHandler</code> interface. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">static ModelControllerClient createClient(final InetAddress host, final int port,
                  final String username, final char[] password, final String securityRealmName) {
 
    final CallbackHandler callbackHandler = new CallbackHandler() {
 
        public void handle(Callback[] callbacks) throws IOException, UnsupportedCallbackException {
            for (Callback current : callbacks) {
                if (current instanceof NameCallback) {
                    NameCallback ncb = (NameCallback) current;
                    ncb.setName(username);
                } else if (current instanceof PasswordCallback) {
                    PasswordCallback pcb = (PasswordCallback) current;
                    pcb.setPassword(password.toCharArray());
                } else if (current instanceof RealmCallback) {
                    RealmCallback rcb = (RealmCallback) current;
                    rcb.setText(rcb.getDefaultText());
                } else {
                    throw new UnsupportedCallbackException(current);
                }
            }
        }
    };
 
    return ModelControllerClient.Factory.create(host, port, callbackHandler);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-an-operation-request-object">Creating an operation request object</h4>
<div class="paragraph">
<p>Management requests are formulated using the <code>org.jboss.dmr.ModelNode</code>
class from the <code>jboss-dmr</code> library. The <code>jboss-dmr</code> library allows the
complete WildFly management model to be expressed using a very small
number of Java types. See
<a href="#Detyped_management_and_the_jboss-dmr_library">Detyped
management and the jboss-dmr library</a> for full details on using this
library.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s show an example of creating an operation request object that can
be used to
<a href="Global_operations.html#src-557234_Globaloperations-read-resource-description">read
the resource description</a> for the web subsystem&#8217;s HTTP connector:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ModelNode op = new ModelNode();
op.get("operation").set("read-resource-description");
 
ModelNode address = op.get("address");
address.add("subsystem", "web");
address.add("connector", "http");
 
op.get("recursive").set(true);
op.get("operations").set(true);</code></pre>
</div>
</div>
<div class="paragraph">
<p>What we&#8217;ve done here is created a ModelNode of type <code>ModelType.OBJECT</code>
with the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>operation</code> – the name of the operation to invoke. All operation
requests <strong>must</strong> include this field and its value must be a String.</p>
</li>
<li>
<p><code>address</code> – the address of the resource to invoke the operation
against. This field&#8217;s must be of <code>ModelType.LIST</code> with each element in
the list being a <code>ModelType.PROPERTY</code>. If this field is omitted the
operation will target the root resource. The operation can be targeted
at any address in the management model; here we are targeting it at the
resource for the web subsystem&#8217;s http connector.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, the request includes two optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>recursive</code> – true means you want the description of child resources
under this resource. Default is false</p>
</li>
<li>
<p><code>operations</code> – true means you want the description of operations
exposed by the resource to be included. Default is false.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Different operations take different parameters, and some take no
parameters at all.</p>
</div>
<div class="paragraph">
<p>See <a href="#format-of-a-detyped-operation-request">Format of a
Detyped Operation Request</a> for full details on the structure of a
ModelNode that will represent an operation request.</p>
</div>
<div class="paragraph">
<p>The example above produces an operation request ModelNode equivalent to
what the CLI produces internally when it parses and executes the
following low-level CLI command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[localhost:9999 /] /subsystem=web/connector=http:read-resource-description(recursive=true,operations=true)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="execute-the-operation-and-manipulate-the-result">Execute the operation and manipulate the result:</h4>
<div class="paragraph">
<p>The <code>execute</code> method sends the operation request ModelNode to the
process being managed and returns a ModelNode the contains the process'
response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ModelNode returnVal = client.execute(op);
System.out.println(returnVal.get("result").toString());</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#format-of-a-detyped-operation-response">Format of a
Detyped Operation Response</a> for general details on the structure of the
"returnVal" ModelNode.</p>
</div>
<div class="paragraph">
<p>The <code>execute</code> operation shown above will block the calling thread until
the response is received from the process being managed.
<code>ModelControllerClient</code> also exposes and API allowing asynchronous
invocation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Future&lt;ModelNode&gt; future = client.executeAsync(op);
. . .  // do other stuff
ModelNode returnVal = future.get();
System.out.println(returnVal.get("result").toString());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="close-the-modelcontrollerclient">Close the ModelControllerClient</h4>
<div class="paragraph">
<p>A <code>ModelControllerClient</code> can be reused for multiple requests. Creating
a new <code>ModelControllerClient</code> for each request is an anti-pattern.
However, when the <code>ModelControllerClient</code> is no longer needed, it should
always be explicitly closed, allowing it to close down any connections
to the process it was managing and release other resources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">client.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="format-of-a-detyped-operation-request">Format of a Detyped Operation Request</h3>
<div class="paragraph">
<p>The basic method a user of the WildFly {wildflyVersion} programmatic management API
would use is very simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ModelNode execute(ModelNode operation) throws IOException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the return value is the detyped representation of the response,
and <code>operation</code> is the detyped representation of the operation being
invoked.</p>
</div>
<div class="paragraph">
<p>The purpose of this section is to document the structure of <code>operation</code>.</p>
</div>
<div class="paragraph">
<p>See <a href="#format-of-a-detyped-operation-response">Format of a
Detyped Operation Response</a> for a discussion of the format of the
response.</p>
</div>
<div class="sect3">
<h4 id="simple-operations">Simple Operations</h4>
<div class="paragraph">
<p>A text representation of simple operation would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "operation" =&gt; "write-attribute",
    "address" =&gt; [
        ("profile" =&gt; "production"),
        ("subsystem" =&gt; "threads"),
        ("bounded-queue-thread-pool" =&gt; "pool1")
    ],
    "name" =&gt; "count",
    "value" =&gt; 20
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java code to produce that output would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ModelNode op = new ModelNode();
op.get("operation").set("write-attribute");
ModelNode addr = op.get("address");
addr.add("profile", "production");
addr.add("subsystem", "threads");
addr.add("bounded-queue-thread-pool", "pool1");
op.get("name").set("count");
op.get("value").set(20);
System.out.println(op);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The order in which the outermost elements appear in the request is not
relevant. The required elements are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>operation</code> – String – The name of the operation being invoked.</p>
</li>
<li>
<p><code>address</code> – the address of the managed resource against which the
request should be executed. If not set, the address is the root
resource. The address is an ordered list of key-value pairs describing
where the resource resides in the overall management resource tree.
Management resources are organized in a tree, so the order in which
elements in the address occur is important.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The other key/value pairs are parameter names and their values. The
names and values should match what is specified in the
<a href="Description_of_the_Management_Model.html#src-557210_DescriptionoftheManagementModel-operation-description">operation&#8217;s
description</a>.</p>
</div>
<div class="paragraph">
<p>Parameters may have any name, except for the reserved words <code>operation</code>,
<code>address</code> and <code>operation-headers</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="operation-headers">Operation Headers</h4>
<div class="paragraph">
<p>Besides the special operation and address values discussed above,
operation requests can also include special "header" values that help
control how the operation executes. These headers are created under the
special reserved word <code>operation-headers</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ModelNode op = new ModelNode();
op.get("operation").set("write-attribute");
ModelNode addr = op.get("address");
addr.add("base", "domain");
addr.add("profile", "production");
addr.add("subsystem", "threads");
addr.add("bounded-queue-thread-pool", "pool1");
op.get("name").set("count");
op.get("value").set(20);
op.get("operation-headers", "rollback-on-runtime-failure").set(false);
System.out.println(op);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This produces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "operation" =&gt; "write-attribute",
    "address" =&gt; [
        ("profile" =&gt; "production"),
        ("subsystem" =&gt; "threads"),
        ("bounded-queue-thread-pool" =&gt; "pool1")
    ],
    "name" =&gt; "count",
    "value" =&gt; 20,
    "operation-headers" =&gt; {
        "rollback-on-runtime-failure =&gt; false
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following operation headers are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rollback-on-runtime-failure</code> – boolean, optional, defaults to true.
Whether an operation that successfully updates the persistent
configuration model should be reverted if it fails to apply to the
runtime. Operations that affect the persistent configuration are applied
in two stages – first to the configuration model and then to the actual
running services. If there is an error applying to the configuration
model the operation will be aborted with no configuration change and no
change to running services will be attempted. However, operations are
allowed to change the configuration model even if there is a failure to
apply the change to the running services – if and only if this
<code>rollback-on-runtime-failure</code> header is set to <code>false</code>. So, this header
only deals with what happens if there is a problem applying an operation
to the running state of a server (e.g. actually increasing the size of a
runtime thread pool.)</p>
</li>
<li>
<p><code>rollout-plan</code> – only relevant to requests made to a Domain Controller
or Host Controller. See "
<a href="#operations-with-a-rollout-plan">Operations with a
Rollout Plan</a>" for details.</p>
</li>
<li>
<p><code>allow-resource-service-restart</code> – boolean, optional, defaults to
false. Whether an operation that requires restarting some runtime
services in order to take effect should do so. See discussion of
<code>resource-services</code> in the
<a href="Description_of_the_Management_Model.html#src-557210_DescriptionoftheManagementModel-applying-runtime-updates">"Applying
Updates to Runtime Services" section of the Description of the
Management Model section</a> for further details.</p>
</li>
<li>
<p><code>roles</code> – String or list of strings. Name(s) of RBAC role(s) the
permissions for which should be used when making access control
decisions instead of those from the roles normally associated with the
user invoking the operation. Only respected if the user is normally
associated with a role with all permissions (i.e. SuperUser), meaning
this can only be used to reduce permissions for a caller, not to
increase permissions.</p>
</li>
<li>
<p><code>blocking-timeout</code> – int, optional, defaults to 300. Maximum time, in
seconds, that the operation should block at various points waiting for
completion. If this period is exceeded, the operation will roll back.
Does not represent an overall maximum execution time for an operation;
rather it is meant to serve as a sort of fail-safe measure to prevent
problematic operations indefinitely tying up resources.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="composite-operations">Composite Operations</h4>
<div class="paragraph">
<p>The root resource for a Domain or Host Controller or an individual
server will expose an operation named " `composite`". This operation
executes a list of other operations as an atomic unit (although the
atomicity requirement can be
<a href="#composite-operations">relaxed</a>.
The structure of the request for the " `composite`" operation has the
same fundamental structure as a simple operation (i.e. operation name,
address, params as key value pairs).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "operation" =&gt; "composite",
    "address" =&gt; [],
    "steps" =&gt; [
         {
              "operation" =&gt; "write-attribute",
              "address" =&gt; [
                   ("profile" =&gt; "production"),
                   ("subsystem" =&gt; "threads"),
                   ("bounded-queue-thread-pool" =&gt; "pool1")
              ],
              "count" =&gt; "count",
              "value" =&gt; 20
         },
         {
              "operation" =&gt; "write-attribute",
              "address" =&gt; [
                   ("profile" =&gt; "production"),
                   ("subsystem" =&gt; "threads"),
                   ("bounded-queue-thread-pool" =&gt; "pool2")
              ],
              "name" =&gt; "count",
              "value" =&gt; 10
         }
    ],
    "operation-headers" =&gt; {
        "rollback-on-runtime-failure =&gt; false
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The "composite" operation takes a single parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>steps</code> – a list, where each item in the list has the same structure
as a simple operation request. In the example above each of the two
steps is modifying the thread pool configuration for a different pool.
There need not be any particular relationship between the steps. Note
that the <code>rollback-on-runtime-failure</code> and <code>rollout-plan</code> operation
headers are not supported for the individual steps in a composite
operation.</p>
<div class="literalblock">
<div class="content">
<pre> +
The `rollback-on-runtime-failure` operation header discussed above has a
particular meaning when applied to a composite operation, controlling
whether steps that successfully execute should be reverted if other
steps fail at runtime. Note that if any steps modify the persistent
configuration, and any of those steps fail, all steps will be reverted.
Partial/incomplete changes to the persistent configuration are not
allowed.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="operations-with-a-rollout-plan">Operations with a Rollout Plan</h4>
<div class="paragraph">
<p>Operations targeted at domain or host level resources can potentially
impact multiple servers. Such operations can include a "rollout plan"
detailing the sequence in which the operation should be applied to
servers as well as policies for detailing whether the operation should
be reverted if it fails to execute successfully on some servers.</p>
</div>
<div class="paragraph">
<p>If the operation includes a rollout plan, the structure is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "operation" =&gt; "write-attribute",
    "address" =&gt; [
        ("profile" =&gt; "production"),
        ("subsystem" =&gt; "threads"),
        ("bounded-queue-thread-pool" =&gt; "pool1")
    ],
    "name" =&gt; "count",
    "value" =&gt; 20,
    "operation-headers" =&gt; {
        "rollout-plan" =&gt; {
            "in-series" =&gt; [
                {
                    "concurrent-groups" =&gt; {
                        "groupA" =&gt; {
                            "rolling-to-servers" =&gt; true,
                            "max-failure-percentage" =&gt; 20
                        },
                        "groupB" =&gt; undefined
                    }
                },
                {
                   "server-group" =&gt; {
                        "groupC" =&gt; {
                            "rolling-to-servers" =&gt; false,
                            "max-failed-servers" =&gt; 1
                        }
                    }
                },
                {
                    "concurrent-groups" =&gt; {
                        "groupD" =&gt; {
                            "rolling-to-servers" =&gt; true,
                            "max-failure-percentage" =&gt; 20
                        },
                        "groupE" =&gt; undefined
                    }
                }
            ],
            "rollback-across-groups" =&gt; true
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the rollout plan is another structure in the
operation-headers section. The root node of the structure allows two
children:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>in-series</code> – a list – A list of activities that are to be performed
in series, with each activity reaching completion before the next step
is executed. Each activity involves the application of the operation to
the servers in one or more server groups. See below for details on each
element in the list.</p>
</li>
<li>
<p><code>rollback-across-groups</code> – boolean – indicates whether the need to
rollback the operation on all the servers in one server group should
trigger a rollback across all the server groups. This is an optional
setting, and defaults to <code>false</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each element in the list under the <code>in-series</code> node must have one or the
other of the following structures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>concurrent-groups</code> – a map of server group names to policies
controlling how the operation should be applied to that server group.
For each server group in the map, the operation may be applied
concurrently. See below for details on the per-server-group policy
configuration.</p>
</li>
<li>
<p><code>server-group</code> – a single key/value mapping of a server group name to
a policy controlling how the operation should be applied to that server
group. See below for details on the policy configuration. (Note: there
is no difference in plan execution between this and a "
`concurrent-groups`" map with a single entry.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The policy controlling how the operation is applied to the servers
within a server group has the following elements, each of which is
optional:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rolling-to-servers</code> – boolean – If true, the operation will be
applied to each server in the group in series. If false or not
specified, the operation will be applied to the servers in the group
concurrently.</p>
</li>
<li>
<p><code>max-failed-servers</code> – int – Maximum number of servers in the group
that can fail to apply the operation before it should be reverted on all
servers in the group. The default value if not specified is zero; i.e.
failure on any server triggers rollback across the group.</p>
</li>
<li>
<p><code>max-failure-percentage</code> – int between 0 and 100 – Maximum percentage
of the total number of servers in the group that can fail to apply the
operation before it should be reverted on all servers in the group. The
default value if not specified is zero; i.e. failure on any server
triggers rollback across the group.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If both <code>max-failed-servers</code> and <code>max-failure-percentage</code> are set,
<code>max-failure-percentage</code> takes precedence.</p>
</div>
<div class="paragraph">
<p>Looking at the (contrived) example above, application of the operation
to the servers in the domain would be done in 3 phases. If the policy
for any server group triggers a rollback of the operation across the
server group, all other server groups will be rolled back as well. The 3
phases are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Server groups groupA and groupB will have the operation applied
concurrently. The operation will be applied to the servers in groupA in
series, while all servers in groupB will handle the operation
concurrently. If more than 20% of the servers in groupA fail to apply
the operation, it will be rolled back across that group. If any servers
in groupB fail to apply the operation it will be rolled back across that
group.</p>
</li>
<li>
<p>Once all servers in groupA and groupB are complete, the operation
will be applied to the servers in groupC. Those servers will handle the
operation concurrently. If more than one server in groupC fails to apply
the operation it will be rolled back across that group.</p>
</li>
<li>
<p>Once all servers in groupC are complete, server groups groupD and
groupE will have the operation applied concurrently. The operation will
be applied to the servers in groupD in series, while all servers in
groupE will handle the operation concurrently. If more than 20% of the
servers in groupD fail to apply the operation, it will be rolled back
across that group. If any servers in groupE fail to apply the operation
it will be rolled back across that group.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="default-rollout-plan">Default Rollout Plan</h5>
<div class="paragraph">
<p>All operations that impact multiple servers will be executed with a
rollout plan. However, actually specifying the rollout plan in the
operation request is not required. If no <code>rollout-plan</code> operation header
is specified, a default plan will be generated. The plan will have the
following characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There will only be a single high level phase. All server groups
affected by the operation will have the operation applied concurrently.</p>
</li>
<li>
<p>Within each server group, the operation will be applied to all servers
concurrently.</p>
</li>
<li>
<p>Failure on any server in a server group will cause rollback across the
group.</p>
</li>
<li>
<p>Failure of any server group will result in rollback of all other
server groups.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="creating-and-reusing-a-rollout-plan">Creating and reusing a Rollout Plan</h5>
<div class="paragraph">
<p>Since a rollout plan may be quite complex, having to pass it as a header
every time can become quickly painful. So instead we can store it in the
model and then reference it when we want to use it.<br>
To create a rollout plan you can use the operation <code>rollout-plan add</code>
like this :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>rollout-plan add --name=simple --content={"rollout-plan" =&gt; {"in-series" =&gt; [{"server-group" =&gt; {"main-server-group" =&gt; {"rolling-to-servers" =&gt; false,"max-failed-servers" =&gt; 1}}}, {"server-group" =&gt; {"other-server-group" =&gt; {"rolling-to-servers" =&gt; true,"max-failure-percentage" =&gt; 20}}}],"rollback-across-groups" =&gt; true}}</pre>
</div>
</div>
<div class="paragraph">
<p>This will create a rollout plan called <code>simple</code> in the content
repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[domain@192.168.1.20:9999 /] /management-client-content=rollout-plans/rollout-plan=simple:read-resource
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "content" =&gt; {"rollout-plan" =&gt; {
            "in-series" =&gt; [
                {"server-group" =&gt; {"main-server-group" =&gt; {
                    "rolling-to-servers" =&gt; false,
                    "max-failed-servers" =&gt; 1
                }}},
                {"server-group" =&gt; {"other-server-group" =&gt; {
                    "rolling-to-servers" =&gt; true,
                    "max-failure-percentage" =&gt; 20
                }}}
            ],
            "rollback-across-groups" =&gt; true
        }},
        "hash" =&gt; bytes {
            0x13, 0x12, 0x76, 0x65, 0x8a, 0x28, 0xb8, 0xbc,
            0x34, 0x3c, 0xe9, 0xe6, 0x9f, 0x24, 0x05, 0xd2,
            0x30, 0xff, 0xa4, 0x34
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you may reference the roolout plan in your command by adding a
header just like this :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>deploy /quickstart/ejb-in-war/target/wildfly-ejb-in-war.war --all-server-groups --headers={rollout name=simple}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="format-of-a-detyped-operation-response">Format of a Detyped Operation Response</h3>
<div class="paragraph">
<p>As noted previously, the basic method a user of the WildFly {wildflyVersion}
programmatic management API would use is very simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ModelNode execute(ModelNode operation) throws IOException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the return value is the detyped representation of the response,
and <code>operation</code> is the detyped representation of the operating being
invoked.</p>
</div>
<div class="paragraph">
<p>The purpose of this section is to document the structure of the return
value.</p>
</div>
<div class="paragraph">
<p>For the format of the request, see
<a href="#format-of-a-detyped-operation-request">Format of a
Detyped Operation Request</a>.</p>
</div>
<div class="sect3">
<h4 id="simple-responses">Simple Responses</h4>
<div class="paragraph">
<p>Simple responses are provided by the following types of operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-composite operations that target a single server. (See below for
more on composite operations).</p>
</li>
<li>
<p>Non-composite operations that target a Domain Controller or slave Host
Controller and don&#8217;t require the responder to apply the operation on
multiple servers and aggregate their results (e.g. a simple read of a
domain configuration property.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The response will always include a simple boolean outcome field, with
one of three possible values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>success</code> – the operation executed successfully</p>
</li>
<li>
<p><code>failed</code> – the operation failed</p>
</li>
<li>
<p><code>cancelled</code> – the execution of the operation was cancelled. (This
would be an unusual outcome for a simple operation which would generally
very rapidly reach a point in its execution where it couldn&#8217;t be
cancelled.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The other fields in the response will depend on whether the operation
was successful.</p>
</div>
<div class="paragraph">
<p>The response for a failed operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "failed",
    "failure-description" =&gt; "[JBAS-12345] Some failure message"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A response for a successful operation will include an additional field:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>result</code> – the return value, or <code>undefined</code> for void operations or
those that return null</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A non-void result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "Brian",
        "age" =&gt; 22
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A void result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response for a cancelled operation has no other fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "cancelled"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="response-headers">Response Headers</h4>
<div class="paragraph">
<p>Besides the standard <code>outcome</code>, <code>result</code> and <code>failure-description</code>
fields described above, the response may also include various headers
that provide more information about the affect of the operation or about
the overall state of the server. The headers will be child element under
a field named <code>response-headers</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A response header is typically related to whether an operation could be
applied to the targeted runtime without requiring a restart of some or
all services, or even of the target process itself. Please see the
<a href="Description_of_the_Management_Model.html#src-557210_DescriptionoftheManagementModel-applying-runtime-updates">"Applying
Updates to Runtime Services" section of the Description of the
Management Model section</a> for a discussion of the basic concepts related
to what happens if an operation requires a service restart to be
applied.</p>
</div>
<div class="paragraph">
<p>The current possible response headers are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>operation-requires-reload</code> – boolean – indicates that the specific
operation that has generated this response requires a restart of all
services in the process in order to take effect in the runtime. This
would typically only have a value of 'true'; the absence of the header
is the same as a value of 'false.'</p>
</li>
<li>
<p><code>operation-requires-restart</code> – boolean – indicates that the specific
operation that has generated this response requires a full process
restart in order to take effect in the runtime. This would typically
only have a value of 'true'; the absence of the header is the same as a
value of 'false.'</p>
</li>
<li>
<p><code>process-state</code> – enumeration – Provides information about the overall
state of the target process. One of the following values:</p>
<div class="ulist">
<ul>
<li>
<p><code>starting</code> – the process is starting</p>
</li>
<li>
<p><code>running</code> – the process is in a normal running state. The
<code>process-state</code> header would typically not be seen with this value; the
absence of the header is the same as a value of 'running'.</p>
</li>
<li>
<p><code>reload-required</code> – some operation (not necessarily this one) has
executed that requires a restart of all services in order for a
configuration change to take effect in the runtime.</p>
</li>
<li>
<p><code>restart-required</code> – some operation (not necessarily this one) has
executed that requires a full process restart in order for a
configuration change to take effect in the runtime.</p>
</li>
<li>
<p><code>stopping</code> – the process is stopping</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="basic-composite-operation-responses">Basic Composite Operation Responses</h4>
<div class="paragraph">
<p>A composite operation is one that incorporates more than one simple
operation in a list and executes them atomically. See the
<a href="#composite-operations">"Composite
Operations" section</a> for more information.</p>
</div>
<div class="paragraph">
<p>Basic composite responses are provided by the following types of
operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Composite operations that target a single server.</p>
</li>
<li>
<p>Composite operations that target a Domain Controller or a slave Host
Controller and don&#8217;t require the responder to apply the operation on
multiple servers and aggregate their results (e.g. a list of simple
reads of domain configuration properties.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The high level format of a basic composite operation response is largely
the same as that of a simple operation response, although there is an
important semantic difference. For a composite operation, the meaning of
the outcome flag is controlled by the value of the operation request&#8217;s
<code>rollback-on-runtime-failure</code> header field. If that field was <code>false</code>
(default is true), the outcome flag will be success if all steps were
successfully applied to the persistent configuration even if <strong>none</strong> of
the composite operation&#8217;s steps was successfully applied to the runtime.</p>
</div>
<div class="paragraph">
<p>What&#8217;s distinctive about a composite operation response is the <code>result</code>
field. First, even if the operation was not successful, the <code>result</code>
field will usually be present. (It won&#8217;t be present if there was some
sort of immediate failure that prevented the responder from even
attempting to execute the individual operations.) Second, the content of
the <code>result</code> field will be a map. Each entry in the map will record the
result of an element in the <code>steps</code> parameter of the composite operation
request. The key for each item in the map will be the string " <code>step-X`"
where "X" is the 1-based index of the step&#8217;s position in the request&#8217;s
`steps</code> list. So each individual operation in the composite operation
will have its result recorded.</p>
</div>
<div class="paragraph">
<p>The individual operation results will have the same basic format as the
simple operation results described above. However, there are some
differences from the simple operation case when the individual
operation&#8217;s <code>outcome</code> flag is <code>failed</code>. These relate to the fact that in
a composite operation, individual operations can be rolled back or not
even attempted.</p>
</div>
<div class="paragraph">
<p>If an individual operation was not even attempted (because the overall
operation was cancelled or, more likely, a prior operation failed):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "cancelled"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An individual operation that failed and was rolled back:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "failed",
    "failure-description" =&gt; "[JBAS-12345] Some failure message",
    "rolled-back" =&gt; true
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An individual operation that itself succeeded but was rolled back due to
failure of another operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "failed",
    "result" =&gt; {
        "name" =&gt; "Brian",
        "age" =&gt; 22
    },
    "rolled-back" =&gt; true
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An operation that failed and was rolled back:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "failed",
    "failure-description" =&gt; "[JBAS-12345] Some failure message",
    "rolled-back" =&gt; true
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of the response for a successful 2 step composite
operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "success",
    "result" =&gt; [
        {
            "outcome" =&gt; "success",
            "result" =&gt; {
                "name" =&gt; "Brian",
                "age" =&gt; 22
            }
        },
        {
            "outcome" =&gt; "success",
            "result" =&gt; undefined
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And for a failed 3 step composite operation, where the first step
succeeded and the second failed, triggering cancellation of the 3rd and
rollback of the others:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "failed",
    "failure-description" =&gt; "[JBAS-99999] Composite operation failed; see individual operation results for details",
    "result" =&gt; [
        {
            "outcome" =&gt; "failed",
            "result" =&gt; {
                "name" =&gt; "Brian",
                "age" =&gt; 22
            },
            "rolled-back" =&gt; true
        },
        {
            "outcome" =&gt; "failed",
            "failure-description" =&gt; "[JBAS-12345] Some failure message",
            "rolled-back" =&gt; true
        },
        {
            "outcome" =&gt; "cancelled"
        }
    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multi-server-responses">Multi-Server Responses</h4>
<div class="paragraph">
<p>Multi-server responses are provided by operations that target a Domain
Controller or slave Host Controller and require the responder to apply
the operation on multiple servers and aggregate their results (e.g.
nearly all domain or host configuration updates.)</p>
</div>
<div class="paragraph">
<p>Multi-server operations are executed in several stages.</p>
</div>
<div class="paragraph">
<p>First, the operation may need to be applied against the authoritative
configuration model maintained by the Domain Controller (for
<code>domain.xml</code> confgurations) or a Host Controller (for a <code>host.xml</code>
configuration). If there is a failure at this stage, the operation is
automatically rolled back, with a response like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "failed",
    "failure-description" =&gt; {
        "domain-failure-description" =&gt; "[JBAS-33333] Failed to apply X to the domain model"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the operation was addressed to the domain model, in the next stage
the Domain Controller will ask each slave Host Controller to apply it to
its local copy of the domain model. If any Host Controller fails to do
so, the Domain Controller will tell all Host Controllers to revert the
change, and it will revert the change locally as well. The response to
the client will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "failed",
    "failure-description" =&gt; {
        "host-failure-descriptions" =&gt; {
            "hostA" =&gt; "[DOM-3333] Failed to apply to the domain model",
            "hostB" =&gt; "[DOM-3333] Failed to apply to the domain model"
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the preceding stages succeed, the operation will be pushed to all
affected servers. If the operation is successful on all servers, the
response will look like this (this example operation has a void
response, hence the result for each server is undefined):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {
        "groupA" =&gt; {
            "serverA-1" =&gt; {
                "host" =&gt; "host1",
                "response" =&gt; {
                    "outcome" =&gt; "success",
                    "result" =&gt; undefined
                }
            },
            "serverA-2" =&gt; {
                "host" =&gt; "host2",
                "response" =&gt; {
                    "outcome" =&gt; "success",
                    "result" =&gt; undefined
                }
            }
        },
        "groupB" =&gt; {
            "serverB-1" =&gt; {
                "host" =&gt; "host1",
                "response" =&gt; {
                    "outcome" =&gt; "success",
                    "result" =&gt; undefined
                }
            },
            "serverB-2" =&gt; {
                "host" =&gt; "host2",
                "response" =&gt; {
                    "outcome" =&gt; "success",
                    "result" =&gt; undefined
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The operation need not succeed on all servers in order to get an
<code>"outcome" &#8658; "success"</code> result. All that is required is that it succeed
on at least one server without the rollback policies in the rollout plan
triggering a rollback on that server. An example response in such a
situation would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {
        "groupA" =&gt; {
            "serverA-1" =&gt; {
                "host" =&gt; "host1",
                "response" =&gt; {
                    "outcome" =&gt; "success",
                    "result" =&gt; undefined
                }
            },
            "serverA-2" =&gt; {
                "host" =&gt; "host2",
                "response" =&gt; {
                    "outcome" =&gt; "success",
                    "result" =&gt; undefined
                }
            }
        },
        "groupB" =&gt; {
            "serverB-1" =&gt; {
                "host" =&gt; "host1",
                "response" =&gt; {
                    "outcome" =&gt; "success",
                    "result" =&gt; undefined,
                    "rolled-back" =&gt; true
                }
            },
            "serverB-2" =&gt; {
                "host" =&gt; "host2",
                "response" =&gt; {
                    "outcome" =&gt; "success",
                    "result" =&gt; undefined,
                    "rolled-back" =&gt; true
                }
            },
            "serverB-3" =&gt; {
                "host" =&gt; "host3",
                "response" =&gt; {
                    "outcome" =&gt; "failed",
                    "failure-description" =&gt; "[DOM-4556] Something didn't work right",
                    "rolled-back" =&gt; true
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, if the operation fails or is rolled back on all servers, an
example response would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">{
    "outcome" =&gt; "failed",
    "server-groups" =&gt; {
        "groupA" =&gt; {
            "serverA-1" =&gt; {
                "host" =&gt; "host1",
                "response" =&gt; {
                    "outcome" =&gt; "success",
                    "result" =&gt; undefined
                }
            },
            "serverA-2" =&gt; {
                "host" =&gt; "host2",
                "response" =&gt; {
                    "outcome" =&gt; "success",
                    "result" =&gt; undefined
                }
            }
        },
        "groupB" =&gt; {
            "serverB-1" =&gt; {
                "host" =&gt; "host1",
                "response" =&gt; {
                    "outcome" =&gt; "failed",
                    "result" =&gt; undefined,
                    "rolled-back" =&gt; true
                }
            },
            "serverB-2" =&gt; {
                "host" =&gt; "host2",
                "response" =&gt; {
                    "outcome" =&gt; "failed",
                    "result" =&gt; undefined,
                    "rolled-back" =&gt; true
                }
            },
            "serverB-3" =&gt; {
                "host" =&gt; "host3",
                "response" =&gt; {
                    "outcome" =&gt; "failed",
                    "failure-description" =&gt; "[DOM-4556] Something didn't work right",
                    "rolled-back" =&gt; true
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/wildflysite/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Wildfly</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wildfly</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wildfly"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wildfly</span></a></li><li><a href="https://www.twitter.com/WildFlyAS"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">WildFlyAS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
