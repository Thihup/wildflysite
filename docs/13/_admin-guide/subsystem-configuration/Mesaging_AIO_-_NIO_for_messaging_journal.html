<!DOCTYPE html>
<html>

<head>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <link rel="shortcut icon" type="image/png" href="/wildflysite/favicon.ico" >
  <link rel="stylesheet" href="/wildflysite/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">


</head>

<body class="AIO - NIO for messaging journal">
  <div class="header-banner">
  <p>This site is in beta. Please share feedback by creating an <a href="https://github.com/jbossorg/wildflysite/issues/new" target="_blank">issue ticket</a>.</p>
</div>

  <div class="content">
    <div class="header navigation">
  <div class="logo-wrapper">
    <a href="/wildflysite/"><img class="wf-logo" src="/wildflysite/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/wildflysite/" class="">Home</a>
        </li>
        <li>
          <a href="/wildflysite/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/wildflysite/blog/" class="">Blog</a>
        </li>
        <li>
          <a href="/wildflysite/about/" class="">About</a>
        </li>
        <li>
          <a href="/wildflysite/contribute/" class="">Contribute</a>
        </li>
        <li>
          
            <a href="/wildflysite/docs/14/" class="active">Docs</a>
          
        </li>
        <li>
          <a class="button-cta secondary" href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
      </ul>
    </nav>
  </div>
</div>

    <div class="docs-page grid-wrapper">
  <div class="grid__item width-12-12 docs-v-icons">
    <a href="/wildflysite/docs/14/" ><img src="/wildflysite/assets/img/docs/wildfly_icons_docs-14-inactive.png"></a>
    <a href="/wildflysite/docs/13/" ><img src="/wildflysite/assets/img/docs/wildfly_icons_docs-13-active.png"></a>
    <a href="https://docs.wildfly.org/12/" target="_blank"><img src="/wildflysite/assets/img/docs/wildfly_icons_docs-12-inactive.png"></a>
    <img src="/wildflysite/assets/img/docs/wildfly_icons_docs-11-coming.png">
    <img src="/wildflysite/assets/img/docs/wildfly_icons_docs-10-coming.png">
    <img src="/wildflysite/assets/img/docs/wildfly_icons_docs-09-coming.png">
    <img src="/wildflysite/assets/img/docs/wildfly_icons_docs-08-coming.png">
  </div>
  <div class="grid__item width-12-12"><h1 class="title">AIO - NIO for messaging journal</h1></div>
  <div class="grid__item width-3-12 doc-toc"><ul class="inline_toc">
  <li><a href="#aio-issue-on-wildfly-10">AIO issue on WildFly 10</a></li>
  <li><a href="#aio-issue-on-wildfly-9">AIO issue on WildFly 9</a></li>
</ul></div>
  <div class="grid__item width-9-12 doc-content"><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apache ActiveMQ Artemis (like HornetQ beforehand) ships with a <strong>high
performance journal</strong>. Since Apache ActiveMQ Artemis handles its own
persistence, rather than relying on a database or other 3rd party
persistence engine it is very highly optimised for the specific
messaging use cases. The majority of the journal is written in Java,
however we abstract out the interaction with the actual file system to
allow different pluggable implementations.</p>
</div>
<div class="paragraph">
<p>Apache ActiveMQ Artemis ships with two implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Java NIO.</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first implementation uses standard Java NIO to interface with the
file system. This provides extremely good performance and runs on any
platform where there&#8217;s a Java 6+ runtime.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Linux Asynchronous IO</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The second implementation uses a thin native code wrapper to talk to the
Linux asynchronous IO library (AIO). With AIO, Apache ActiveMQ Artemis
will be called back when the data has made it to disk, allowing us to
avoid explicit syncs altogether and simply send back confirmation of
completion when AIO informs us that the data has been persisted.</p>
</div>
<div class="paragraph">
<p>Using AIO will typically provide even better performance than using Java
NIO.</p>
</div>
<div class="paragraph">
<p>The AIO journal is only available when running Linux kernel 2.6 or later
and after having installed libaio (if it&#8217;s not already installed).</p>
</div>
<div class="paragraph">
<p>Also, please note that AIO will only work with the following file
systems: ext2, ext3, ext4, jfs, xfs. With other file systems, e.g. NFS
it may appear to work, but it will fall back to a slower synchronous
behaviour. Don&#8217;t put the journal on a NFS share!</p>
</div>
<div class="paragraph">
<p><strong>One point that should be added is that AIO doesn&#8217;t work well with
encrypted partitions, thus you have to move to NIO on those.</strong></p>
</div>
<div class="paragraph">
<p>What are the symptoms of an AIO isssue ?</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aio-issue-on-wildfly-10">AIO issue on WildFly 10</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you see the following exception in your WildFly log file / console</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[org.apache.activemq.artemis.core.server] (ServerService Thread Pool -- 64) AMQ222010: Critical IO Error, shutting down the server. file=AIOSequentialFile:/home/wildfly/wildfly-10.0.0.Final/standalone/data/activemq/journal/activemq-data-2.amq, message=Cannot open file:The Argument is invalid: java.io.IOException: Cannot open file:The Argument is invalid
 at org.apache.activemq.artemis.jlibaio.LibaioContext.open(Native Method)</pre>
</div>
</div>
<div class="paragraph">
<p>that means that AIO isn&#8217;t working properly on your system.</p>
</div>
<div class="paragraph">
<p>To use NIO instead execute the following commnd using jboss-cli :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=messaging-activemq/server=default:write-attribute(name=journal-type, value=NIO)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to reload or restart your server and you should see the
following trace in your server console :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>INFO  [org.apache.activemq.artemis.core.server] (ServerService Thread Pool -- 64) AMQ221013: Using NIO Journal</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aio-issue-on-wildfly-9">AIO issue on WildFly 9</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>[org.hornetq.core.server] (ServerService Thread Pool -- 64) HQ222010: Critical IO Error, shutting down the server. file=AIOSequentialFile:/home/wildfly/wildfly-9.0.2.Final/standalone/data/messagingjournal/hornetq-data-1.hq, message=Can't open file: HornetQException[errorType=NATIVE_ERROR_CANT_OPEN_CLOSE_FILE message=Can't open file]
 at org.hornetq.core.libaio.Native.init(Native Method)</pre>
</div>
</div>
<div class="paragraph">
<p>that means that AIO isn&#8217;t working properly on your system.</p>
</div>
<div class="paragraph">
<p>To use NIO instead execute the following commnd using jboss-cli :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=messaging/hornetq-server=default:write-attribute(name=journal-type,value=NIO)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to reload or restart your server and you see the following
trace in your server console :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>INFO  [org.hornetq.core.server] (ServerService Thread Pool -- 64) HQ221013: Using NIO Journal</pre>
</div>
</div>
</div>
</div></div>
</div>



  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/wildflysite/"><img class="wf-logo" src="/wildflysite/assets/img/wildfly_icons_one-color-logo.png"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">WildFly is open. All dependencies of this project are available under the <a href='https://www.gnu.org/licenses/old-licenses/lgpl-2.1.en.html' target='_blank'>LGPL 2.1</a> or compatible license.<br/><br/>This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/wildfly/wildfly.org/fork' target='_blank'>fork it</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <strong>Navigation</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="/wildflysite/downloads">Downloads</a></li>
          
            <li><a href="/wildflysitef/docs">Docs</a></li>
          
            <li><a href="https://github.com/wildfly/wildfly">Github</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <strong>Contribute</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://issues.jboss.org/browse/WFLY">Submit a bug</a></li>
          
            <li><a href="https://community.jboss.org/en/wildfly?view=discussion">Join the forum</a></li>
          
            <li><a href="https://github.com/wildfly/wildfly/fork">Fork WildFly</a></li>
          
            <li><a href="https://twitter.com/WildFlyAS">Follow us</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <strong>Get Help</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://community.jboss.org/en/wildfly?view=discussion">Join the forum</a></li>
          
            <li><a href="https://www.hipchat.com/gFOhnVQke">Join HipChat</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <strong>Find more Red Hat Middleware Community Projects</strong>
        <ul class="footer-links">
          
            <li><a href="https://www.apiman.io/">APIMan</a></li>
          
            <li><a href="http://arquillian.org">Arquillian</a></li>
          
            <li><a href="http://byteman.jboss.org/">Byteman</a></li>
          
            <li><a href="http://capedwarf.org/">CapeDwarf</a></li>
          
            <li><a href="https://github.com/alechenninger/chronicler">Chronicler</a></li>
          
            <li><a href="https://github.com/darcy-framework">Darcy</a></li>
          
            <li><a href="http://debezium.io/">Debezium</a></li>
          
            <li><a href="https://www.drools.org/">Drools</a></li>
          
            <li><a href="http://gatein.jboss.org/">GateIn</a></li>
          
            <li><a href="http://www.hawkular.org/">Hawkular</a></li>
          
            <li><a href="http://hawt.io/">Hawtio</a></li>
          
            <li><a href="http://hibernate.org/">Hibernate</a></li>
          
            <li><a href="http://www.infinispan.org/">Infinispan</a></li>
          
            <li><a href="https://devstudio.jboss.com/">JBoss DevStudio</a></li>
          
            <li><a href="http://forge.jboss.org/">JBoss Forge</a></li>
          
            <li><a href="https://github.com/jboss-logging">JBoss Logging</a></li>
          
            <li><a href="http://jbossremoting.jboss.org/">JBoss Remoting</a></li>
          
            <li><a href="https://www.jbpm.org/">jBPM</a></li>
          
            <li><a href="https://jsfunit.jboss.org/">JSFUnit</a></li>
          
            <li><a href="https://www.keycloak.org/">Keycloak</a></li>
          
            <li><a href="http://modcluster.io/">Mod Cluster</a></li>
          
            <li><a href="http://modeshape.jboss.org/">ModeShape</a></li>
          
            <li><a href="https://www.optaplanner.org/">OptaPlanner</a></li>
          
            <li><a href="https://picketbox.jboss.org/">Picketbox</a></li>
          
            <li><a href="http://resteasy.jboss.org/">RESTEasy</a></li>
          
            <li><a href="https://riftsaw.jboss.org/">Riftsaw</a></li>
          
            <li><a href="http://savara.jboss.org/">Savara</a></li>
          
            <li><a href="http://seamframework.org/">Seam</a></li>
          
            <li><a href="http://arquillian.org/">Shrinkwrap</a></li>
          
            <li><a href="http://snowdrop.jboss.org/">Snowdrop</a></li>
          
            <li><a href="https://switchyard.jboss.org/">Switchyard</a></li>
          
            <li><a href="https://tattletale.jboss.org/">Tattletale</a></li>
          
            <li><a href="http://teiid.jboss.org/">Teiid</a></li>
          
            <li><a href="http://wildfly-swarm.io/">WildFly Swarm</a></li>
          
            <li><a href="http://wise.jboss.org/">Wise</a></li>
          
            <li><a href="https://xnio.jboss.org/">XNIO</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/"><img src="/wildflysite/assets/img/RHLogo_white.svg"></a>
    </span>
  </div>
</div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/wildflysite/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
  </script>
</body>

</html>
