<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Undertow subsystem configuration | Wildfly</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Undertow subsystem configuration" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/subsystem-configuration/Undertow.html" />
<meta property="og:url" content="https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/subsystem-configuration/Undertow.html" />
<meta property="og:site_name" content="Wildfly" />
<script type="application/ld+json">
{"@type":"WebPage","url":"https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/subsystem-configuration/Undertow.html","headline":"Undertow subsystem configuration","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/wildflysite/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://jbossorg.github.io/wildflysite/feed.xml" title="Wildfly" /></head>
<body><div class="header navigation">
  <div class="logo-wrapper">
    <a href="/wildflysite/"><img class="wf-logo" src="/wildflysite/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/wildflysite/" class="">Home</a>
        </li>
        <li>
          <a href="/wildflysite/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/wildflysite/blog/" class="">Blog</a>
        </li>
        <li>
          <a href="/wildflysite/about/" class="">About</a>
        </li>
        <li>
          <a href="/wildflysite/contribute/" class="">Contribute</a>
        </li>
        <li>
          <a href="/wildflysite/docs/" class="">Docs</a>
        </li>
        <li>
          <a class="button-cta secondary" href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div id="preamble">
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Web subsystem was replaced in WildFly 8 with Undertow.</strong></p>
</div>
</div>
</div>
<div class="paragraph">
<p>There are two main parts to the undertow subsystem, which are server and
Servlet container configuration, as well as some ancillary items.
Advanced topics like load balancing and failover are covered on the
"High Availability Guide". The default configuration does is suitable
for most use cases and provides reasonable performance settings.</p>
</div>
<div class="paragraph">
<p><strong>Required extension:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;extension module="org.wildfly.extension.undertow" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Basic subsystem configuration example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:undertow:1.0"&gt;
        &lt;buffer-caches&gt;
            &lt;buffer-cache name="default" buffer-size="1024" buffers-per-region="1024" max-regions="10"/&gt;
        &lt;/buffer-caches&gt;
        &lt;server name="default-server"&gt;
            &lt;http-listener name="default" socket-binding="http" /&gt;
            &lt;host name="default-host" alias="localhost"&gt;
                &lt;location name="/" handler="welcome-content" /&gt;
            &lt;/host&gt;
        &lt;/server&gt;
        &lt;servlet-container name="default" default-buffer-cache="default" stack-trace-on-error="local-only" &gt;
            &lt;jsp-config/&gt;
            &lt;persistent-sessions/&gt;
        &lt;/servlet-container&gt;
        &lt;handlers&gt;
            &lt;file name="welcome-content" path="${jboss.home.dir}/welcome-content" directory-listing="true"/&gt;
        &lt;/handlers&gt;
    &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Dependencies on other subsystems:</strong></p>
</div>
<div class="paragraph">
<p>IO Subsystem</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="buffer-cache-configuration">Buffer cache configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The buffer cache is used for caching content, such as static files.
Multiple buffer caches can be configured, which allows for separate
servers to use different sized caches.</p>
</div>
<div class="paragraph">
<p>Buffers are allocated in regions, and are of a fixed size. If you are
caching many small files then using a smaller buffer size will be
better.</p>
</div>
<div class="paragraph">
<p>The total amount of space used can be calculated by multiplying the
buffer size by the number of buffers per region by the maximum number of
regions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">  &lt;buffer-caches&gt;
    &lt;buffer-cache name="default" buffer-size="1024" buffers-per-region="1024" max-regions="10"/&gt;
  &lt;/buffer-caches&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buffer-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size of the buffers. Smaller buffers allow space to be
utilised more effectively</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buffers-per-region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The numbers of buffers per region</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max-regions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of regions. This controls the maximum
amount of memory that can be used for caching</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="server-configuration">Server configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A server represents an instance of Undertow. Basically this consists of
a set of connectors and some configured handlers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;server name="default-server" default-host="default-host" servlet-container="default" &gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default-host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the virtual host that will be used if an incoming request
as no Host: header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">servlet-container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the servlet container that will be used by this
server, unless is is explicitly overriden by the deployment</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="connector-configuration">Connector configuration</h3>
<div class="paragraph">
<p>Undertow provides HTTP, HTTPS and AJP connectors, which are configured
per server.</p>
</div>
<div class="sect3">
<h4 id="common-settings">Common settings</h4>
<div class="paragraph">
<p>The following settings are common to all connectors:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">socket-binding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The socket binding to use. This determines the address
and port the listener listens on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to an XNIO worker, as defined in the IO subsystem.
The worker that is in use controls the IO and blocking thread pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buffer-pool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to a buffer pool as defined in the IO
subsystem. These buffers are used internally to read and write requests.
In general these should be at least 8k, unless you are in a memory
constrained environment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the connector is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max-post-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum size of incoming post requests that is
allowed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buffer-pipelined-data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If responses to HTTP pipelined requests should
be buffered, and send out in a single write. This can improve
performance if HTTP pipe lining is in use and responses are small.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max-header-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum size of a HTTP header block that is
allowed. Responses with to much data in their header block will have the
request terminated and a bad request response send.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max-parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of query or path parameters that are
allowed. This limit exists to prevent hash collision based DOS attacks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max-headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of headers that are allowed. This limit
exists to prevent hash collision based DOS attacks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max-cookies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of cookies that are allowed. This limit
exists to prevent hash collision based DOS attacks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allow-encoded-slash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set this to true if you want the server to decode
percent encoded slash characters. This is probably a bad idea, as it can
have security implications, due to different servers interpreting the
slash differently. Only enable this if you have a legacy application
that requires it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">decode-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the URL should be decoded. If this is not set to true
then percent encoded characters in the URL will be left as is.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url-charset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The charset to decode the URL to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">always-set-keep-alive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the 'Connection: keep-alive' header should be
added to all responses, even if not required by spec.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disallowed-methods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of HTTP methods that are not
allowed. HTTP TRACE is disabled by default.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="http-connector">HTTP Connector</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;http-listener name="default" socket-binding="http"  /&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate-forwarding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this is set to true then the HTTP listener
will read a client certificate from the SSL_CLIENT_CERT header. This
allows client cert authentication to be used, even if the server does
not have a direct SSL connection to the end user. This should only be
enabled for servers behind a proxy that has been configured to always
set these headers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redirect-socket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The socket binding to redirect requests that require
security too.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy-address-forwarding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this is enabled then the X-Forwarded-For
and X-Forwarded-Proto headers will be used to determine the peer
address. This allows applications that are behind a proxy to see the
real address of the client, rather than the address of the proxy.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="https-listener">HTTPS listener</h4>
<div class="paragraph">
<p>Https listener provides secure access to the server. The most important
configuration option is security realm which defines SSL secure context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;https-listener name="default" socket-binding="https" security-realm="ssl-realm" /&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The security realm to use for the SSL configuration.
See Security realm examples for how to configure it: Examples</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">verify-client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of either NOT_REQUESTED, REQUESTED or REQUIRED. If
client cert auth is in use this should be either REQUESTED or REQUIRED.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled-cipher-suites</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of cypher suit names that are allowed.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="ajp-listener">AJP listener</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;ajp-listener name="default" socket-binding="ajp" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="host-configuration">Host configuration</h3>
<div class="paragraph">
<p>The host element corresponds to a virtual host.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The virtual host name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alias</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A whitespace separated list of additional host names that should
be matched</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default-web-module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of a deployment that should be used to
serve up requests that do not match anything.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="servlet-container-configuration">Servlet container configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The servlet-container element corresponds to an instance of an Undertow
Servlet container. Most servers will only need a single servlet
container, however there may be cases where it makes sense to define
multiple containers (in particular if you want applications to be
isolated, so they cannot dispatch to each other using the
RequestDispatcher. You can also use multiple Servlet containers to serve
different applications from the same context path on different virtual
hosts).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allow-non-standard-wrappers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Servlet specification requires
applications to only wrap the request/response using wrapper classes
that extend from the ServletRequestWrapper and ServletResponseWrapper
classes. If this is set to true then this restriction is relaxed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default-buffer-cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The buffer cache that is used to cache static
resources in the default Servlet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stack-trace-on-error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be either all, none, or local-only. When set
to none Undertow will never display stack traces. When set to All
Undertow will always display them (not recommended for production use).
When set to local-only Undertow will only display them for requests from
local addresses, where there are no headers to indicate that the request
has been proxied. Note that this feature means that the Undertow error
page will be displayed instead of the default error page specified in
web.xml.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default-encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default encoding to use for requests and
responses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">use-listener-encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this is true then the default encoding will
be the same as that used by the listener that received the request.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="jsp-configuration">JSP configuration</h3>

</div>
<div class="sect2">
<h3 id="session-cookie-configuration">Session Cookie Configuration</h3>
<div class="paragraph">
<p>This allows you to change the attributes of the session cookie.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cookie name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cookie domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">comment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cookie comment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http-only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the cookie is HTTP only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the cookie is marked secure</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The max age of the cookie</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="persistent-session-configuration">Persistent Session Configuration</h3>
<div class="paragraph">
<p>Persistent sessions allow session data to be saved across redeploys and
restarts. This feature is enabled by adding the persistent-sessions
element to the server config. This is mostly intended to be a
development time feature.</p>
</div>
<div class="paragraph">
<p>If the path is not specified then session data is stored in memory, and
will only be persistent across redeploys, rather than restarts.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to the persistent sessions data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">relative-to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location that the path is relevant to</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Undertow_AJP_listeners">AJP listeners</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The AJP listeners are child resources of the subsystem undertow. They
are used with mod_jk, mod_proxy and mod_cluster of the Apache httpd
front-end. Each listener does reference a particular socket binding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9999 /] /subsystem=undertow/server=default-server:read-children-names(child-type=ajp-listener)
{
    "outcome" =&gt; "success",
    "result" =&gt; [
        "ajp-listener",
    ]
}
Â 
[standalone@localhost:9999 /] /subsystem=undertow/server=default-server/ajp-listener=*:read-resource(recursive=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "enabled" =&gt; "true",
        "scheme" =&gt; "http",
        "socket-binding" =&gt; "ajp",
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creating a new <code>ajp-listener</code> requires you to declare a new
<code>socket binding</code> first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9999 /] /socket-binding-group=standard-sockets/socket-binding=ajp:add(port=8009)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The newly created, unused socket binding can then be used to create a
new connector configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9999 /] /subsystem=undertow/server=default-server/ajp-listener=myListener:add(socket-binding=ajp, scheme=http, enabled=true)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Undertow_using_as_a_Load_Balancer">Using Wildfly as a Load Balancer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wildfly 10 adds support for using the Undertow subsystem as a load
balancer. Wildfly supports two different approaches, you can either
define a static load balancer, and specify the back end hosts in your
configuration, or use it as a mod_cluster frontend, and use mod_cluster
to dynamically update the hosts.</p>
</div>
<div class="sect2">
<h3 id="general-overview">General Overview</h3>
<div class="paragraph">
<p>Wildly uses Undertow&#8217;s proxy capabilities to act as a load balancer.
Undertow will connect to the back end servers using its built in client,
and proxies requests.</p>
</div>
<div class="paragraph">
<p>The following protocols are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>http</p>
</li>
<li>
<p>ajp</p>
</li>
<li>
<p>http2</p>
</li>
<li>
<p>h2c (clear text HTTP2)<br>
Of these protocols h2c should give the best performance, if the back end
servers support it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Undertow proxy uses async IO, the only threads that are involved in
the request is the IO thread that is responsible for the connection. The
connection to the back end server is made from the same thread, which
removes the need for any thread safety constructs.<br>
If both the front and back end servers support server push, and HTTP2 is
in use then the proxy also supports pushing responses to the client. In
cases where proxy and backend are capable of server push, but the client
does not support it the server will send a X-Disable-Push header to let
the backend know that it should not attempt to push for this request.</p>
</div>
<div class="sect3">
<h4 id="load-balancer-server-profiles">Load balancer server profiles</h4>
<div class="paragraph">
<p>WildFly 11 adds load balancer profiles for both standalone and domain modes.</p>
</div>
<div class="sect4">
<h5 id="example-start-standalone-load-balancer">Example: Start standalone load balancer</h5>
<div class="listingblock">
<div class="content">
<pre># configure correct path to WildFly installation
WILDFLY_HOME=/path/to/wildfly
# configure correct IP of the node
MY_IP=192.168.1.1

# run the load balancer profile
$WILDFLY_HOME/bin/standalone.sh -b $MY_IP -bprivate $MY_IP -c standalone-load-balancer.xml</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s highly recommended to use private/internal network for communication between load balancer and nodes. To do this set the correct IP address to the {{private}} interface ({{-bprivate}} argument).</p>
</div>
</div>
<div class="sect4">
<h5 id="example-start-worker-node">Example: Start worker node</h5>
<div class="paragraph">
<p>Run the server with the HA (or Full HA) profile, which has {{mod_cluster}} component included. If the UDP multicast is working in your environment, the workers should work out of the box without any change. If it&#8217;s not the case, then configure the IP address of the load-balancer statically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># configure correct path to WildFly installation
WILDFLY_HOME=/path/to/wildfly
# configure correct IP of the node
MY_IP=192.168.1.2

# Configure static load balancer IP address.
# This is necessary when UDP multicast doesn't work in your environment.
LOAD_BALANCER_IP=192.168.1.1
$WILDFLY_HOME/bin/jboss-cli.sh &lt;&lt;EOT
embed-server -c=standalone-ha.xml
/subsystem=modcluster/mod-cluster-config=configuration:write-attribute(name=advertise,value=false)
/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=proxy1:add(host=$LOAD_BALANCER_IP,port=8090)
/subsystem=modcluster/mod-cluster-config=configuration:list-add(name=proxies,value=proxy1)
EOT

# start the woker node with HA profile
$WILDFLY_HOME/bin/standalone.sh -c standalone-ha.xml -b $MY_IP -bprivate $MY_IP</pre>
</div>
</div>
<div class="paragraph">
<p>Again, to make it safe, users should configure private/internal IP address into {{MY_IP}} variable.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-wildly-as-a-static-load-balancer">Using Wildly as a static load balancer</h3>
<div class="paragraph">
<p>To use WildFly as a static load balancer the first step is to create a
proxy handler in the Undertow subsystem. For the purposes of this
example we are going to assume that our load balancer is going to load
balance between two servers, sv1.foo.com and sv2.foo.com, and will be
using the AJP protocol.</p>
</div>
<div class="paragraph">
<p>The first step is to add a reverse proxy handler to the Undertow
subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/configuration=handler/reverse-proxy=my-handler:add()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we need to define outbound socket bindings for remote hosts</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=remote-host1/:add(host=sv1.foo.com, port=8009)
/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=remote-host2/:add(host=sv2.foo.com, port=8009)</code></pre>
</div>
</div>
<div class="paragraph">
<p>and than we add them as hosts to reverse proxy handler</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/configuration=handler/reverse-proxy=my-handler/host=host1:add(outbound-socket-binding=remote-host1, scheme=ajp, instance-id=myroute, path=/test)
/subsystem=undertow/configuration=handler/reverse-proxy=my-handler/host=host2:add(outbound-socket-binding=remote-host2, scheme=ajp, instance-id=myroute, path=/test)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we need to actually add the reverse proxy to a location. I am going
to assume we are serving the path <code>/app</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=undertow/server=default-server/host=default-host/location=\/app:add(handler=my-handler)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all there is to it. If you point your browser to
<code><a href="http://localhost:8080/app" class="bare">http://localhost:8080/app</a></code> you should be able to see the proxied
content.</p>
</div>
<div class="paragraph">
<p>The full details of all configuration options available can be found in
the <a href="https://wildscribe.github.io/WildFly/10.1/subsystem/undertow/index.html">subsystem reference</a>.</p>
</div>
</div>
</div>
</div>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/wildflysite/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Wildfly</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wildfly</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wildfly"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wildfly</span></a></li><li><a href="https://www.twitter.com/WildFlyAS"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">WildFlyAS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
