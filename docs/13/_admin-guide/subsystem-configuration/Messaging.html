<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Messaging configuration | Wildfly</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Messaging configuration" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/subsystem-configuration/Messaging.html" />
<meta property="og:url" content="https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/subsystem-configuration/Messaging.html" />
<meta property="og:site_name" content="Wildfly" />
<script type="application/ld+json">
{"@type":"WebPage","url":"https://jbossorg.github.io/wildflysite/docs/13/_admin-guide/subsystem-configuration/Messaging.html","headline":"Messaging configuration","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/wildflysite/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://jbossorg.github.io/wildflysite/feed.xml" title="Wildfly" /></head>
<body><div class="header navigation">
  <div class="logo-wrapper">
    <a href="/wildflysite/"><img class="wf-logo" src="/wildflysite/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/wildflysite/" class="">Home</a>
        </li>
        <li>
          <a href="/wildflysite/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/wildflysite/blog/" class="">Blog</a>
        </li>
        <li>
          <a href="/wildflysite/about/" class="">About</a>
        </li>
        <li>
          <a href="/wildflysite/contribute/" class="">Contribute</a>
        </li>
        <li>
          <a href="/wildflysite/docs/" class="">Docs</a>
        </li>
        <li>
          <a class="button-cta secondary" href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The JMS server configuration is done through the <em>messaging-activemq</em>
subsystem. In this chapter we are going outline the frequently used
configuration options. For a more detailed explanation please consult
the Artemis user guide (See "Component Reference").</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="required-extension">Required Extension</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration options discussed in this section assume that the the
<code>org.wildfly.extension.messaging-activemq</code> extension is present in your
configuration. This extension is not included in the standard
<code>standalone.xml</code> and <code>standalone-ha.xml</code> configurations included in the
WildFly distribution. It is, however, included with the
<code>standalone-full.xml</code> and <code>standalone-full-ha.xml</code> configurations.</p>
</div>
<div class="paragraph">
<p>You can add the extension to a configuration without it either by adding
an <code>&lt;extension module="org.wildfly.extension.messaging-activemq"/&gt;</code>
element to the xml or by using the following CLI operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /]/extension=org.wildfly.extension.messaging-activemq:add</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connectors">Connectors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three kind of connectors that can be used to connect to
WildFly JMS Server</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>invm-connector</code> can be used by a local client (i.e. one running in
the same JVM as the server)</p>
</li>
<li>
<p><code>netty-connector</code> can be used by a remote client (and uses Netty over
TCP for the communication)</p>
</li>
<li>
<p><code>http-connector</code> can be used by a remote client (and uses Undertow Web
Server to upgrade from a HTTP connection)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jms-connection-factories">JMS Connection Factories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three kinds of <em>basic</em> JMS <code>connection-factory</code> that depends
on the type of connectors that is used.</p>
</div>
<div class="paragraph">
<p>There is also a <code>pooled-connection-factory</code> which is special in that it
is essentially a configuration facade for <em>both</em> the inbound and
outbound connectors of the the Artemis JCA Resource Adapter. An MDB can
be configured to use a <code>pooled-connection-factory</code> (e.g. using
<code>@ResourceAdapter</code>). In this context, the MDB leverages the <em>inbound
connector</em> of the Artemis JCA RA. Other kinds of clients can look up the
pooled-connection-factory in JNDI (or inject it) and use it to send
messages. In this context, such a client would leverage the <em>outbound
connector</em> of the Artemis JCA RA. A <code>pooled-connection-factory</code> is also
special because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is only available to local clients, although it can be configured
to point to a remote server.</p>
</li>
<li>
<p>As the name suggests, it is pooled and therefore provides superior
performance to the clients which are able to use it. The pool size can
be configured via the <code>max-pool-size</code> and <code>min-pool-size</code> attributes.</p>
</li>
<li>
<p>It should only be used to <em>send</em> (i.e. produce) messages when looked
up in JNDI or injected.</p>
</li>
<li>
<p>It can be configured to use specific security credentials via the
<code>user</code> and <code>password</code> attributes. This is useful if the remote server to
which it is pointing is secured.</p>
</li>
<li>
<p>Resources acquired from it will be automatically enlisted any on-going
JTA transaction. If you want to send a message from an EJB using CMT
then this is likely the connection factory you want to use so the send
operation will be atomically committed along with the rest of the EJB&#8217;s
transaction operations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To be clear, the <em>inbound connector</em> of the Artemis JCA RA (which is for
consuming messages) is only used by MDBs and other JCA-based components.
It is not available to traditional clients.</p>
</div>
<div class="paragraph">
<p>Both a <code>connection-factory</code> and a <code>pooled-connection-factory</code> reference
a <code>connector</code> declaration.</p>
</div>
<div class="paragraph">
<p>A <code>netty-connector</code> is associated with a <code>socket-binding</code> which tells
the client using the <code>connection-factory</code> where to connect.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>connection-factory</code> referencing a <code>netty-connector</code> is suitable to
be used by a <em>remote</em> client to send messages to or receive messages
from the server (assuming the connection-factory has an appropriately
exported <code>entry</code>).</p>
</li>
<li>
<p>A <code>pooled-connection-factory</code> looked up in JNDI or injected which is
referencing a <code>netty-connector</code> is suitable to be used by a <em>local</em>
client to send messages to a remote server granted the <code>socket-binding</code>
references an <code>outbound-socket-binding</code> pointing to the remote server in
question.</p>
</li>
<li>
<p>A <code>pooled-connection-factory</code> used by an MDB which is referencing a
<code>remote-connector</code> is suitable to consume messages from a remote server
granted the <code>socket-binding</code> references an <code>outbound-socket-binding</code>
pointing to the remote server in question.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An <code>in-vm-connector</code> is associated with a <code>server-id</code> which tells the
client using the <code>connection-factory</code> where to connect (since multiple
Artemis servers can run in a single JVM).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>connection-factory</code> referencing an <code>in-vm-connector</code> is suitable to
be used by a <em>local</em> client to either send messages to or receive
messages from a local server.</p>
</li>
<li>
<p>A <code>pooled-connection-factory</code> looked up in JNDI or injected which is
referencing an <code>in-vm-connector</code> is suitable to be used by a <em>local</em>
client only to send messages to a local server.</p>
</li>
<li>
<p>A <code>pooled-connection-factory</code> used by an MDB which is referencing an
<code>in-vm-connector</code> is suitable only to consume messages from a local
server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>http-connector</code> is associated with the <code>socket-binding</code> that
represents the HTTP socket (by default, named <code>http</code>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>connection-factory</code> referencing a <code>http-connector</code> is suitable to
be used by a remote client to send messages to or receive messages from
the server by connecting to its HTTP port before upgrading to the
messaging protocol.</p>
</li>
<li>
<p>A <code>pooled-connection-factory</code> referencing a <code>http-connector</code> is
suitable to be used by a local client to send messages to a remote
server granted the <code>socket-binding</code> references an
<code>outbound-socket-binding</code> pointing to the remote server in question.</p>
</li>
<li>
<p>A <code>pooled-connection-factory</code> used by an MDB which is referencing a
<code>http-connector</code> is suitable only to consume messages from a remote
server granted the <code>socket-binding</code> references an
<code>outbound-socket-binding</code> pointing to the remote server in question.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>entry</code> declaration of a <code>connection-factory</code> or a
<code>pooled-connection-factory</code> specifies the JNDI name under which the
factory will be exposed. Only JNDI names bound in the
<code>"java:jboss/exported"</code> namespace are available to remote clients. If a
<code>connection-factory</code> has an entry bound in the <code>"java:jboss/exported"</code>
namespace a remote client would look-up the <code>connection-factory</code> using
the text <em>after</em> <code>"java:jboss/exported"</code>. For example, the "
<code>RemoteConnectionFactory`" is bound by default to
`"java:jboss/exported/jms/RemoteConnectionFactory"</code> which means a remote
client would look-up this <code>connection-factory</code> using "
<code>jms/RemoteConnectionFactory`". A `pooled-connection-factory</code> should
<em>not</em> have any <code>entry</code> bound in the " <code>java:jboss/exported`" namespace
because a `pooled-connection-factory</code> is not suitable for remote
clients.</p>
</div>
<div class="paragraph">
<p>Since JMS 2.0, a default JMS connection factory is accessible to EE
application under the JNDI name <code>java:comp/DefaultJMSConnectionFactory.</code>
WildFly messaging subsystem defines a <code>pooled-connection-factory</code> that
is used to provide this default connection factory. Any parameter change
on this <code>pooled-connection-factory</code> will be take into account by any EE
application looking the default JMS provider under the JNDI name
<code>java:comp/DefaultJMSConnectionFactory.</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:messaging-activemq:1.0"&gt;
    &lt;server name="default"&gt;
        [...]
        &lt;http-connector name="http-connector"
                        socket-binding="http"
                        endpoint="http-acceptor" /&gt;
        &lt;http-connector name="http-connector-throughput"
                        socket-binding="http"
                        endpoint="http-acceptor-throughput"&gt;
            &lt;param name="batch-delay"
                   value="50"/&gt;
        &lt;/http-connector&gt;
        &lt;in-vm-connector name="in-vm"
                         server-id="0"/&gt;
      [...]
      &lt;connection-factory name="InVmConnectionFactory"
                            connectors="in-vm"
                            entries="java:/ConnectionFactory" /&gt;
      &lt;pooled-connection-factory name="activemq-ra"
                            transaction="xa"
                            connectors="in-vm"
                            entries="java:/JmsXA java:jboss/DefaultJMSConnectionFactory"/&gt;
      [...]
   &lt;/server&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>~(See standalone/configuration/standalone-full.xml)~</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jms-queues-and-topics">JMS Queues and Topics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JMS queues and topics are sub resources of the messaging-actively
subsystem. One can define either a <code>jms-queue</code> or <code>jms-topic</code>. Each
destination <em>must</em> be given a <code>name</code> and contain at least one entry in
its <code>entries</code> element (separated by whitespace).</p>
</div>
<div class="paragraph">
<p>Each entry refers to a JNDI name of the queue or topic. Keep in mind
that any <code>jms-queue</code> or <code>jms-topic</code> which needs to be accessed by a
remote client needs to have an entry in the "java:jboss/exported"
namespace. As with connection factories, if a <code>jms-queue</code> or or
<code>jms-topic</code> has an entry bound in the "java:jboss/exported" namespace a
remote client would look it up using the text <em>after</em>
<code>"java:jboss/exported`". For example, the following `jms-queue</code>
"testQueue" is bound to "java:jboss/exported/jms/queue/test" which means
a remote client would look-up this \{{kms-queue} using
"jms/queue/test". A local client could look it up using
"java:jboss/exported/jms/queue/test", "java:jms/queue/test", or more
simply "jms/queue/test":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:messaging-activemq:1.0"&gt;
    &lt;server name="default"&gt;
    [...]
    &lt;jms-queue name="testQueue"
               entries="jms/queue/test java:jboss/exported/jms/queue/test" /&gt;
    &lt;jms-topic name="testTopic"
               entries="jms/topic/test java:jboss/exported/jms/topic/test" /&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>~(See standalone/configuration/standalone-full.xml)~</p>
</div>
<div class="paragraph">
<p>JMS endpoints can easily be created through the CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] jms-queue add --queue-address=myQueue --entries=queues/myQueue</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] /subsystem=messaging-activemq/server=default/jms-queue=myQueue:read-resource
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "durable" =&gt; true,
        "entries" =&gt; ["queues/myQueue"],
        "selector" =&gt; undefined
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A number of additional commands to maintain the JMS subsystem are
available as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] jms-queue --help --commands
add
...
remove
To read the description of a specific command execute 'jms-queue command_name --help'.</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dead-letter-redelivery">Dead Letter &amp; Redelivery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some of the settings are applied against an address wild card instead of
a specific messaging destination. The dead letter queue and redelivery
settings belong into this group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:messaging-activemq:1.0"&gt;
   &lt;server name="default"&gt;
      [...]
      &lt;address-setting name="#"
                       dead-letter-address="jms.queue.DLQ"
                       expiry-address="jms.queue.ExpiryQueue"
                       [...] /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>~(See standalone/configuration/standalone-full.xml)~</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-settings-for-artemis-addresses-and-jms-destinations">Security Settings for Artemis addresses and JMS destinations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Security constraints are matched against an address wildcard, similar to
the DLQ and redelivery settings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:messaging-activemq:1.0"&gt;
   &lt;server name="default"&gt;
      [...]
      &lt;security-setting name="#"&gt;
          &lt;role name="guest"
                send="true"
                consume="true"
                create-non-durable-queue="true"
                delete-non-durable-queue="true"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>~(See standalone/configuration/standalone-full.xml)~</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-domain-for-users">Security Domain for Users</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, Artemis will use the " <code>other`" JAAS security domain. This
domain is used to authenticate users making connections to Artemis and
then they are authorized to perform specific functions based on their
role(s) and the `security-settings</code> described above. This domain can be
changed by using the <code>security-domain</code>, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:messaging-activemq:1.0"&gt;
   &lt;server name="default"&gt;
       &lt;security domain="mySecurityDomain" /&gt;
      [...]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-elytron-subsystem">Using the Elytron Subsystem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also use the elytron subsystem to secure the messaging-activemq
subsystem.</p>
</div>
<div class="paragraph">
<p>To use an Elytron security domain:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Undefine the legacy security domain.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=messaging-activemq/server=default:undefine-attribute(name=security-domain)</code></pre>
</div>
</div>
</li>
<li>
<p>Set an Elytron security domain.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=messaging-activemq/server=default:write-attribute(name=elytron-domain, value=myElytronSecurityDomain)</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
You can only define either <code>security-domain</code> or <code>elytron-domain</code>, but
you cannot have both defined at the same time. If neither is defined,
WildFly will use the <code>security-domain</code> default value of <code>other</code>, which
maps to the <code>other</code> legacy security domain.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cluster-authentication">Cluster Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the Artemis server is configured to be clustered, it will use the
<code>cluster</code> 's <code>user</code> and <code>password</code> attributes to connect to other
Artemis nodes in the cluster.</p>
</div>
<div class="paragraph">
<p>If you do not change the default value of &lt;cluster-password&gt;, Artemis
will fail to authenticate with the error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>HQ224018: Failed to create session: HornetQExceptionerrorType=CLUSTER_SECURITY_EXCEPTION message=HQ119099: Unable to authenticate cluster user: HORNETQ.CLUSTER.ADMIN.USER</code></pre>
</div>
</div>
<div class="paragraph">
<p>To prevent this error, you must specify a value for
<code>&lt;cluster-password&gt;</code>. It is possible to encrypt this value by following
<a href="https://access.redhat.com/site/documentation/en-US/JBoss_Enterprise_Application_Platform/6.1/html/Security_Guide/sect-Password_Vaults_for_Sensitive_Strings.html">this
guide</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use the system property
jboss.messaging.cluster.password to specify the cluster password from
the command line.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deployment-of--jms.xml-files">Deployment of -jms.xml files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starting with WildFly {wildflyVersion}, you have the ability to deploy a -jms.xml file
defining JMS destinations, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;messaging-deployment xmlns="urn:jboss:messaging-activemq-deployment:1.0"&gt;
   &lt;server name="default"&gt;
      &lt;jms-destinations&gt;
         &lt;jms-queue name="sample"&gt;
            &lt;entry name="jms/queue/sample"/&gt;
            &lt;entry name="java:jboss/exported/jms/queue/sample"/&gt;
         &lt;/jms-queue&gt;
      &lt;/jms-destinations&gt;
   &lt;/server&gt;
&lt;/messaging-deployment&gt;</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This feature <strong>is primarily intended for development</strong> as destinations
deployed this way can not be managed with any of the provided management
tools (e.g. console, CLI, etc).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jms-bridge">JMS Bridge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The function of a JMS bridge is to consume messages from a source JMS
destination, and send them to a target JMS destination. Typically either
the source or the target destinations are on different servers.
The bridge can also be used to bridge messages from other non Artemis
JMS servers, as long as they are JMS 1.1 compliant.</p>
</div>
<div class="paragraph">
<p>The JMS Bridge is provided by the Artemis project. For a detailed
description of the available configuration properties, please consult
the project documentation.</p>
</div>
<div class="sect2">
<h3 id="modules-for-other-messaging-brokers">Modules for other messaging brokers</h3>
<div class="paragraph">
<p>Source and target JMS resources (destination and connection factories)
are looked up using JNDI.
If either the source or the target resources are managed by another
messaging server than WildFly, the required client classes must be
bundled in a module. The name of the module must then be declared when
the JMS Bridge is configured.</p>
</div>
<div class="paragraph">
<p>The use of a JMS bridges with any messaging provider will require to
create a module containing the jar of this provider.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s suppose we want to use an hypothetical messaging provider named
AcmeMQ. We want to bridge messages coming from a source AcmeMQ
destination to a target destination on the local WildFly messaging
server. To lookup AcmeMQ resources from JNDI, 2 jars are required,
acmemq-1.2.3.jar, mylogapi-0.0.1.jar (please note these jars do not
exist, this is just for the example purpose). We must <em>not</em> include a
JMS jar since it will be provided by a WildFly module directly.</p>
</div>
<div class="paragraph">
<p>To use these resources in a JMS bridge, we must bundle them in a WildFly
module:</p>
</div>
<div class="paragraph">
<p>in JBOSS_HOME/modules, we create the layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>modules/
`-- org
    `-- acmemq
        `-- main
            |-- acmemq-1.2.3.jar
            |-- mylogapi-0.0.1.jar
            `-- module.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>We define the module in <code>module.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.1" name="org.acmemq"&gt;
    &lt;properties&gt;
        &lt;property name="jboss.api" value="private"/&gt;
    &lt;/properties&gt;
 
 
    &lt;resources&gt;
        &lt;!-- insert resources required to connect to the source or target   --&gt;
        &lt;!-- messaging brokers if it not another WildFly instance           --&gt;
        &lt;resource-root path="acmemq-1.2.3.jar" /&gt;
        &lt;resource-root path="mylogapi-0.0.1.jar" /&gt;
    &lt;/resources&gt;
 
 
    &lt;dependencies&gt;
       &lt;!-- add the dependencies required by JMS Bridge code                --&gt;
       &lt;module name="javax.api" /&gt;
       &lt;module name="javax.jms.api" /&gt;
       &lt;module name="javax.transaction.api"/&gt;
       &lt;module name="org.jboss.remote-naming"/&gt;
       &lt;!-- we depend on org.apache.activemq.artemis module since we will send messages to  --&gt;
       &lt;!-- the Artemis server embedded in the local WildFly instance       --&gt;
       &lt;module name="org.apache.activemq.artemis" /&gt;
    &lt;/dependencies&gt;
&lt;/module&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration">Configuration</h3>
<div class="paragraph">
<p>A JMS bridge is defined inside a <code>jms-bridge</code> section of the
<code>messaging-activemq</code> subsystem in the XML configuration files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:messaging-activemq:1.0"&gt;
   &lt;jms-bridge name="myBridge" module="org.acmemq"&gt;
      &lt;source connection-factory="ConnectionFactory"
              destination="sourceQ"
              user="user1"
              password="pwd1"
              quality-of-service="AT_MOST_ONCE"
              failure-retry-interval="500"
              max-retries="1"
              max-batch-size="500"
              max-batch-time="500"
              add-messageID-in-header="true"&gt;
         &lt;source-context&gt;
            &lt;property name="java.naming.factory.initial"
                      value="org.acmemq.jndi.AcmeMQInitialContextFactory"/&gt;
            &lt;property name="java.naming.provider.url"
                      value="tcp://127.0.0.1:9292"/&gt;
         &lt;/source-context&gt;
      &lt;/source&gt;
      &lt;target connection-factory"/jms/invmTargetCF"
              destination="/jms/targetQ" /&gt;
      &lt;/target&gt;
   &lt;/jms-bridge&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>source</code> and <code>target</code> sections contain the name of the JMS resource
( <code>connection-factory</code> and <code>destination</code>) that will be looked up in
JNDI.
It optionally defines the <code>user</code> and <code>password</code> credentials. If they are
set, they will be passed as arguments when creating the JMS connection
from the looked up ConnectionFactory.
It is also possible to define JNDI context properties in the
<code>source-context</code> and <code>target-context</code> sections. If these sections are
absent, the JMS resources will be looked up in the local WildFly
instance (as it is the case in the <code>target</code> section in the example
above).</p>
</div>
</div>
<div class="sect2">
<h3 id="management-commands">Management commands</h3>
<div class="paragraph">
<p>A JMS Bridge can also be managed using the WildFly command line
interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] /subsystem=messaging/jms-bridge=myBridge/:add(module="org.acmemq",
      source-destination="sourceQ",
      source-connection-factory="ConnectionFactory",
      source-user="user1",
      source-password="pwd1",
      source-context={"java.naming.factory.initial" =&gt; "org.acmemq.jndi.AcmeMQInitialContextFactory",
                      "java.naming.provider.url" =&gt; "tcp://127.0.0.1:9292"},
      target-destination="/jms/targetQ",
      target-connection-factory="/jms/invmTargetCF",
      quality-of-service=AT_MOST_ONCE,
      failure-retry-interval=500,
      max-retries=1,
      max-batch-size=500,
      max-batch-time=500,
      add-messageID-in-header=true)
{"outcome" =&gt; "success"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also see the complete JMS Bridge resource description from the
CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] /subsystem=messaging/jms-bridge=*/:read-resource-description
{
    "outcome" =&gt; "success",
    "result" =&gt; [{
        "address" =&gt; [
            ("subsystem" =&gt; "messaging"),
            ("jms-bridge" =&gt; "*")
        ],
        "outcome" =&gt; "success",
        "result" =&gt; {
            "description" =&gt; "A JMS bridge instance.",
            "attributes" =&gt; {
                ...
        }
    }]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="component-reference">Component Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The messaging-activemq subsystem is provided by the Artemis project. For
a detailed description of the available configuration properties, please
consult the project documentation.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Artemis Homepage: <a href="http://activemq.apache.org/artemis/" class="bare">http://activemq.apache.org/artemis/</a></p>
</li>
<li>
<p>Artemis User Documentation:
<a href="http://activemq.apache.org/artemis/docs.html" class="bare">http://activemq.apache.org/artemis/docs.html</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Messaging_Connect_a_pooled-connection-factory_to_a_Remote_Artemis_Server">Connect a pooled-connection-factory to a Remote Artemis Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>messaging-activemq</code> subsystem allows to configure a
<code>pooled-connection-factory</code> resource to let a local client deployed in
WildFly connect to a remote Artemis server.</p>
</div>
<div class="paragraph">
<p>The configuration of such a <code>pooled-connection-factory</code> is done in 3
steps:</p>
</div>
<div class="paragraph">
<p>\1. create an outbound-socket-binding pointing to the remote messaging
server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">   /socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=remote-artemis:add(host=&lt;server host&gt;, port=61616)</code></pre>
</div>
</div>
<div class="paragraph">
<p>\2. create a remote-connector referencing the outbound-socket-binding
created at step (1).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">  /subsystem=messaging-activemq/server=default/remote-connector=remote-artemis:add(socket-binding=remote-artemis)</code></pre>
</div>
</div>
<div class="paragraph">
<p>\3. create a pooled-connection-factory referencing the remote-connector
created at step (2).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">  /subsystem=messaging-activemq/server=default/pooled-connection-factory=remote-artemis:add(connectors=[remote-artemis], entries=[java:/jms/remoteCF])</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="configuration-of-a-mdb-using-a-pooled-connection-factory">Configuration of a MDB using a pooled-connection-factory</h3>
<div class="paragraph">
<p>When a <code>pooled-connection-factory</code> is configured to connect to a remote
Artemis, it is possible to configure Message-Driven Beans (MDB) to have
them consume messages from this remote server.</p>
</div>
<div class="paragraph">
<p>The MDB must be annotated with the <code>@ResourceAdapter</code> annotation using
the <strong>name</strong> of the <code>pooled-connection-factory resource</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import org.jboss.ejb3.annotation.ResourceAdapter;
 
  @ResourceAdapter("remote-artemis")
  @MessageDriven(name = "MyMDB", activationConfig = {
    ...
})
public class MyMDB implements MessageListener {
      public void onMessage(Message message) {
       ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the MDB needs to produce messages to the remote server, it must
inject the <code>pooled-connection-factory</code> by looking it up in JNDI using
one of its <code>entries</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
@JMSConnectionFactory("java:/jms/remoteCF")
private JMSContext context;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="configuration-of-the-destination">Configuration of the destination</h4>
<div class="paragraph">
<p>A MDB must also specify which destination it will consume messages from.</p>
</div>
<div class="paragraph">
<p>The standard way is to define a <code>destinationLookup</code> activation config
property that corresponds to a JNDI lookup on the local server.<br>
When the MDB is consuming from a remote Artemis server, there may not
have such a JNDI binding in the local WildFly.<br>
It is possible to use the naming subsystem to configure
<a href="#Naming">external context federation</a> to have local JNDI
bindings delegating to external bindings.</p>
</div>
<div class="paragraph">
<p>However there is a simpler solution to configure the destination when
using the Artemis Resource Adapter.<br>
Instead of using JDNI to lookup the JMS Destination resource, you can
just specify the <strong>name</strong> of the destination (as configured in the remote
Artemis server) using the <code>destination</code> activation config property and
set the <code>useJNDI</code> activation config property to false to let the Artemis
Resource Adapter create automatically the JMS destination without
requiring any JNDI lookup.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ResourceAdapter("remote-artemis")
@MessageDriven(name = "MyMDB", activationConfig = {
    @ActivationConfigProperty(propertyName = "useJNDI",         propertyValue = "false"),
    @ActivationConfigProperty(propertyName = "destination",     propertyValue = "myQueue"),
    @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Queue"), 
    @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge")
})
public class MyMDB implements MessageListener {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These properties configure the MDB to consume messages from the JMS
Queue named <code>myQueue</code> hosted on the remote Artemis server.<br>
In most cases, such a MDB does not need to lookup other destinations to
process the consumed messages and it can use the JMSReplyTo destination
if it is defined on the message.<br>
If the MDB needs any other JMS destinations defined on the remote
server, it must use client-side JNDI by following the
<a href="http://activemq.apache.org/artemis/docs/1.1.0/using-jms.html#jndi-configuration">Artemis
documentation</a> or configure external configuration context in the naming
subsystem (which allows to inject the JMS resources using the
<code>@Resource</code> annotation).</p>
</div>
<div class="paragraph">
<p>[[Messaging_Backward_&amp;_Forward_Compatibility]]
= Backward &amp; Forward Compatibility</p>
</div>
<div class="paragraph">
<p>WildFly 10 supports both backwards and forwards compatibility with
legacy versions that were using HornetQ as their messaging brokers (such
as JBoss AS7, WildFly {wildflyVersion} &amp; 9).<br>
These two compatibility modes are provided by the ActiveMQ Artemis
project that supports the HornetQ&#8217;s CORE protocol:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>backward compatibility: WildFly 10 JMS clients (using Artemis) can
connect to legacy app server (running HornetQ)</p>
</li>
<li>
<p>forward compatibility: legacy JMS clients (using HornetQ) can connect
to WildFly 10 app server (running Artemis).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="forward-compatibility">Forward Compatibility</h3>
<div class="paragraph">
<p>Forward compatibility requires no code change in legacy JMS clients. It
is provided by WildFly 10 messaging-activemq subsystem and its
resources.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>legacy-connection-factory</code> is a subresource of the
<code>messaging-activemq&#8217;s `server</code> and can be used to store in JNDI a
HornetQ-based JMS ConnectionFactory.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:messaging-activemq:1.0"&gt; 
    &lt;server name="default"&gt;
        ...
        &lt;legacy-connection-factory name="legacyConnectionFactory-discovery" 
                                   entries="java:jboss/exported/jms/RemoteConnectionFactory"
                                   ... /&gt;
    &lt;/server&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Legacy HornetQ-based JMS destinations can also be configured by
providing a <code>legacy-entries</code> attribute to the <code>jms-queue</code> and
<code>jms-topic</code> resource.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;jms-queue name="myQueue"
               entries="java:jboss/exported/jms/myQueue-new"
               legacy-entries="java:jboss/exported/jms/myQueue" /&gt;
    &lt;jms-topic name="testTopic"
               entries="java:jboss/exported/jms/myTopic-new"
               legacy-entries="java:jboss/exported/jms/myTopic" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>legacy-entries</code> must be used by legacy JMS clients (using HornetQ)
while the regular <code>entries</code> are for WildFly 10 JMS clients (using
Artemis).</p>
</div>
<div class="paragraph">
<p>The legacy JMS client will then lookup this <code>legacy</code> JMS resources to
communicate with WildFly 10.<br>
To avoid any code change in the legacy JMS clients, the legacy JNDI
entries must match the lookup expected by the legacy JMS client.</p>
</div>
<div class="sect3">
<h4 id="migration">Migration</h4>
<div class="paragraph">
<p>During migration, the legacy <code>messaging</code> subsystem will create
<code>legacy-connection-factory</code> resource and add <code>legacy-entries</code> to the
<code>jms-queue</code> and <code>jms-topic</code> resource if the boolean attribute
<code>add-legacy-entries</code> is set to <code>true</code> for its <code>migrate</code> operation. If
that is the case, the legacy entries in the migrated
<code>messaging-activemq</code> subsystem will correspond to the entries specified
in the legacy <code>messaging</code> subsystem and the regular entries will be
created with a <code>-new</code> suffix.<br>
If <code>add-legacy-entries</code> is set to <code>false</code> during migration, no legacy
resources will be created in the <code>messaging-activemq</code> subsystem and
legacy JMS clients will not be able to communicate with WildFly 10
servers.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="backward-compatibility">Backward Compatibility</h3>
<div class="paragraph">
<p>Backward compatibility requires no configuration change in the legacy
server.<br>
WildFly 10 JMS clients do not look up resources on the legacy server but
uses client-side JNDI to create their JMS resources. Artemis JMS client
can then uses these resources to communicate with the legacy server
using the HornetQ CORE protocol.</p>
</div>
<div class="paragraph">
<p>Artemis supports
<a href="http://activemq.apache.org/artemis/docs/1.1.0/using-jms.html#jndi-configuration">Client-side
JNDI</a> to create JMS resources ( <code>ConnectionFactory</code> and <code>Destination</code>).</p>
</div>
<div class="paragraph">
<p>For example, if a WidFly 10 JMS clients wants to communicate with a
legacy server using a JMS queue named <code>myQueue</code>, it must use the
following properties to configure its JNDI <code>InitialContext</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>java.naming.factory.initial=org.apache.activemq.artemis.jndi.ActiveMQInitialContextFactory
connectionFactory.jms/ConnectionFactory=tcp://&lt;legacy server address&gt;:5445? \
    protocolManagerFactoryStr=org.apache.activemq.artemis.core.protocol.hornetq.client.HornetQClientProtocolManagerFactory
queue.jms/myQueue=myQueue</code></pre>
</div>
</div>
<div class="paragraph">
<p>It can then use the <code>jms/ConnectionFactory</code> name to create the JMS
ConnectionFactory and <code>jms/myQueue</code> to create the JMS Queue.<br>
Note that the property
<code>protocolManagerFactoryStr=org.apache.activemq.artemis.core.protocol.hornetq.client.HornetQClientProtocolManagerFactory</code>
is mandatory when specifying the URL of the legacy connection factory so
that the Artemis JMS client can communicate with the HornetQ broker in
the legacy server.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Mesaging_AIO_-_NIO_for_messaging_journal">AIO - NIO for messaging journal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache ActiveMQ Artemis (like HornetQ beforehand) ships with a <strong>high
performance journal</strong>. Since Apache ActiveMQ Artemis handles its own
persistence, rather than relying on a database or other 3rd party
persistence engine it is very highly optimised for the specific
messaging use cases. The majority of the journal is written in Java,
however we abstract out the interaction with the actual file system to
allow different pluggable implementations.</p>
</div>
<div class="paragraph">
<p>Apache ActiveMQ Artemis ships with two implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Java NIO.</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first implementation uses standard Java NIO to interface with the
file system. This provides extremely good performance and runs on any
platform where there&#8217;s a Java 6+ runtime.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Linux Asynchronous IO</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The second implementation uses a thin native code wrapper to talk to the
Linux asynchronous IO library (AIO). With AIO, Apache ActiveMQ Artemis
will be called back when the data has made it to disk, allowing us to
avoid explicit syncs altogether and simply send back confirmation of
completion when AIO informs us that the data has been persisted.</p>
</div>
<div class="paragraph">
<p>Using AIO will typically provide even better performance than using Java
NIO.</p>
</div>
<div class="paragraph">
<p>The AIO journal is only available when running Linux kernel 2.6 or later
and after having installed libaio (if it&#8217;s not already installed).</p>
</div>
<div class="paragraph">
<p>Also, please note that AIO will only work with the following file
systems: ext2, ext3, ext4, jfs, xfs. With other file systems, e.g. NFS
it may appear to work, but it will fall back to a slower synchronous
behaviour. Don&#8217;t put the journal on a NFS share!</p>
</div>
<div class="paragraph">
<p><strong>One point that should be added is that AIO doesn&#8217;t work well with
encrypted partitions, thus you have to move to NIO on those.</strong></p>
</div>
<div class="paragraph">
<p>What are the symptoms of an AIO isssue ?</p>
</div>
<div class="sect2">
<h3 id="aio-issue-on-wildfly-10">AIO issue on WildFly 10</h3>
<div class="paragraph">
<p>If you see the following exception in your WildFly log file / console</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[org.apache.activemq.artemis.core.server] (ServerService Thread Pool -- 64) AMQ222010: Critical IO Error, shutting down the server. file=AIOSequentialFile:/home/wildfly/wildfly-10.0.0.Final/standalone/data/activemq/journal/activemq-data-2.amq, message=Cannot open file:The Argument is invalid: java.io.IOException: Cannot open file:The Argument is invalid
 at org.apache.activemq.artemis.jlibaio.LibaioContext.open(Native Method)</pre>
</div>
</div>
<div class="paragraph">
<p>that means that AIO isn&#8217;t working properly on your system.</p>
</div>
<div class="paragraph">
<p>To use NIO instead execute the following commnd using jboss-cli :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=messaging-activemq/server=default:write-attribute(name=journal-type, value=NIO)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to reload or restart your server and you should see the
following trace in your server console :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>INFO  [org.apache.activemq.artemis.core.server] (ServerService Thread Pool -- 64) AMQ221013: Using NIO Journal</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aio-issue-on-wildfly-9">AIO issue on WildFly 9</h3>
<div class="literalblock">
<div class="content">
<pre>[org.hornetq.core.server] (ServerService Thread Pool -- 64) HQ222010: Critical IO Error, shutting down the server. file=AIOSequentialFile:/home/wildfly/wildfly-9.0.2.Final/standalone/data/messagingjournal/hornetq-data-1.hq, message=Can't open file: HornetQException[errorType=NATIVE_ERROR_CANT_OPEN_CLOSE_FILE message=Can't open file]
 at org.hornetq.core.libaio.Native.init(Native Method)</pre>
</div>
</div>
<div class="paragraph">
<p>that means that AIO isn&#8217;t working properly on your system.</p>
</div>
<div class="paragraph">
<p>To use NIO instead execute the following commnd using jboss-cli :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=messaging/hornetq-server=default:write-attribute(name=journal-type,value=NIO)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to reload or restart your server and you see the following
trace in your server console :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>INFO  [org.hornetq.core.server] (ServerService Thread Pool -- 64) HQ221013: Using NIO Journal</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Messaging_JDBC_Store_for_Messaging_Journal">JDBC Store for Messaging Journal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Artemis server that are integrated to WildFly can be configured to
use a JDBC store for its messaging journal instead of its file-based
journal.<br>
The <code>server resource</code> of the messaging-activemq subsystem needs to
configure its <code>journal-datasource</code> attribute to be able to use JDBC
store. If this attribute is not defined, the regular file-base journal
will be used for the Artemis server.<br>
This attribute value must correspond to a data source defined in the
datasource subsystem.</p>
</div>
<div class="paragraph">
<p>For example, if the datasources subsystem defines an <code>ExampleDS</code> data
source at <code>/subsystem=datasources/data-source=ExampleDS</code>, the Artemis
server can use it for its JDBC store with the operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">/subsystem=messaging-activemq/server=default:write-attribute(name=journal-datasource, value=ExampleDS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Artemis JDBC store uses SQL commands to create the tables used to
persist its information.<br>
These SQL commands may differ depending on the type of database. The SQL
commands used by the JDBC store are located in the file at:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$JBOSS_HOME/modules/system/layers/base/org/wildfly/extension/messaging-activemq/main/database/journal-sql.properties</pre>
</div>
</div>
<div class="paragraph">
<p>By default, "vanilla" SQL commands are used to communicate with the
database. However some databases requires specific commands to create
table, update content, etc.</p>
</div>
<div class="paragraph">
<p>The journal-sql.properties can also specify these provider-specific
commands. You can customize them by adding a suffix to the vanilla SQL
properties.</p>
</div>
<div class="paragraph">
<p>The suffix is determined based on information from the JDBC driver and
the connection metadata. If the type of database is not supported by the
code, you can specify it explicitly with the journal-database property
on the server resource.</p>
</div>
<div class="paragraph">
<p>Artemis uses different JDBC tables to store its bindings information,
the persistent messages and the large messages (paging is not supported
yet).</p>
</div>
<div class="paragraph">
<p>The name of these tables can be configured with the
<code>journal-bindings-table</code>, <code>journal-messages-table</code>,
<code>journal-page-store-table, and journal-large-messages-table</code>.</p>
</div>
<div class="sect2">
<h3 id="reference">Reference</h3>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Artemis JDBC Persistence -
<a href="http://activemq.apache.org/artemis/docs/1.5.0/persistence.html#configuring-jdbc-persistence" class="bare">http://activemq.apache.org/artemis/docs/1.5.0/persistence.html#configuring-jdbc-persistence</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Messaging_Discovery_Configuration">Configuring Broadcast/Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each Artemis server can be configured to broadcast itself and/or discovery other Artemis servers within a cluster.
Artemis supports two mechanisms for configuring broadcast/discovery:</p>
</div>
<div class="sect2">
<h3 id="jgroups-based-broadcastdiscovery">JGroups-based broadcast/discovery</h3>
<div class="paragraph">
<p>Artemis can leverage the membership of an existing JGroups channel to both broadcast its identity and discover nodes on which Artemis servers are deployed.
WildFly&#8217;s default full-ha profile uses this mechanism for broadcast/discovery using the default JGroups channel of the server (as defined by the JGroups subsystem).</p>
</div>
<div class="paragraph">
<p>To add this support to a profile that does not include it by default, use the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] /subsystem=messaging-activemq/server=default/broadcast-group=bg-group1:add(jgroups-cluster=activemq-cluster,connectors=http-connector)
[standalone@localhost:9990 /]/subsystem=messaging-activemq/server=default/broadcast-group=dg-group1:add(jgroups-cluster=activemq-cluster)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To segregate Artemis servers use a distinct membership, configure broadcast/discovery using a separate channel.  To do this, first create the channel resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] /subsystem=jgroups/channel=messaging:add(stack=tcp)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a new JGroups channel resource based on the "tcp" protocol stack.
Now create your broadcast/discovery groups using this channel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] /subsystem=messaging-activemq/server=default/broadcast-group=bg-group2:add(jgroups-channel=messaging, jgroups-cluster=activemq-cluster, connectors=http-connector)
[standalone@localhost:9990 /] /subsystem=messaging-activemq/server=default/broadcast-group=dg-group2:add(jgroups-channel=messaging, jgroups-cluster=activemq-cluster)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multicast-broadcastdiscovery">Multicast broadcast/discovery</h3>
<div class="paragraph">
<p>To broadcast identity to standalone messaging clients, you can additionally configure broadcast/discovery using multicast sockets.</p>
</div>
<div class="paragraph">
<p>e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">[standalone@localhost:9990 /] /socket-binding-group=standard-sockets/socket-binding=messaging(interface=private, multicast-address=230.0.0.4, multicast-port=45689)

[standalone@localhost:9990 /] /subsystem=messaging-activemq/server=default/broadcast-group=bg-group3:add(socket-binding=messaging, connectors=http-connector)
[standalone@localhost:9990 /] /subsystem=messaging-activemq/server=default/broadcast-group=dg-group3:add(socket-binding=messaging)</code></pre>
</div>
</div>
</div>
</div>
</div>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/wildflysite/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Wildfly</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wildfly</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wildfly"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wildfly</span></a></li><li><a href="https://www.twitter.com/WildFlyAS"><svg class="svg-icon"><use xlink:href="/wildflysite/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">WildFlyAS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
